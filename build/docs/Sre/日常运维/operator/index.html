<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Sre/日常运维/operator">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">operator | LiteShell</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docusaurus.io/zh-CN/img/undraw_typewriter.svg"><meta data-rh="true" name="twitter:image" content="https://docusaurus.io/zh-CN/img/undraw_typewriter.svg"><meta data-rh="true" property="og:url" content="https://book.zlqit.com/docs/Sre/日常运维/operator"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="operator | LiteShell"><meta data-rh="true" name="description" content="1、网络"><meta data-rh="true" property="og:description" content="1、网络"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://book.zlqit.com/docs/Sre/日常运维/operator"><link data-rh="true" rel="alternate" href="https://book.zlqit.com/docs/Sre/日常运维/operator" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://book.zlqit.com/en/docs/Sre/日常运维/operator" hreflang="en"><link data-rh="true" rel="alternate" href="https://book.zlqit.com/docs/Sre/日常运维/operator" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="LiteShell RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="LiteShell Atom Feed"><link rel="stylesheet" href="/assets/css/styles.33a47b3b.css">
<link rel="preload" href="/assets/js/runtime~main.ae2aa7d1.js" as="script">
<link rel="preload" href="/assets/js/main.46fa2b5c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="LiteShell" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="LiteShell" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">LiteShell</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Sre</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/Sre/日常运维/operator">日常运维</a></li><li><a class="dropdown__link" href="/docs/Sre/中间件/Harbor">中间件</a></li><li><a class="dropdown__link" href="/docs/Sre/面试题/基础面试题">面试题</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Kubernetes</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Kubernetes/operator">Kubernetes</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Prometheus</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Prometheus/grafana/">grafana</a></li><li><a class="dropdown__link" href="/docs/Prometheus/prometheus/告警指标汇总">Prometheus</a></li><li><a class="dropdown__link" href="/docs/Prometheus/alertManager/alertmanager告警配置">AlertManager</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">DevOps</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/DevOps/jenkins/jenkins安装配置/jenkins安装配置">jenkins</a></li><li><a class="dropdown__link" href="/docs/DevOps/gitOps/tekton安装">gitOps</a></li><li><a class="dropdown__link" href="/docs/DevOps/ELK/ELK测试部署">ELK</a></li><li><a class="dropdown__link" href="/docs/DevOps/skywalking/zookeeper安装">skywalking</a></li><li><a class="dropdown__link" href="/docs/DevOps/observability/OpenTelemetry/">observability</a></li><li><a class="dropdown__link" href="/docs/DevOps/terraform/terraform">terraform</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Golang</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Golang/golang基础/Go核心编程2023/golang">golang基础</a></li><li><a class="dropdown__link" href="/docs/Golang/golang进阶/gin框架2023/Gin框架">golang进阶</a></li><li><a class="dropdown__link" href="/docs/Golang/golang运维/项目1-Bingo/Bingo">golang运维</a></li><li><a class="dropdown__link" href="/docs/Golang/VUE/vue入门教程/html基础">Vue</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">JAVA</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Java/JAVA/admin组件">Java</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Treasure</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/Treasure/English/英语语法入门">英语学习</a></li><li><a class="dropdown__link" href="/docs/Treasure/Wisdom/国学经典">Plan and strategize</a></li><li><a class="dropdown__link" href="/docs/Treasure/Studytour/西藏至游">read book</a></li></ul></div><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/Sre/日常运维/operator">operator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Sre/日常运维/镜像列表">镜像列表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Sre/日常运维/git操作">Git使用手册</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Sre/日常运维/npm操作">npm常用命令</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Sre/日常运维/脚本管理">脚本管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Sre/日常运维/clickhouse集群节点重新加入">clickhouse集群节点重新加入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Sre/日常运维/conflunce安装">conflunce安装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Sre/日常运维/磁盘管理">磁盘管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Sre/日常运维/计算机网络软考">计算机网络软考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Sre/日常运维/mac办公协作">mac办公协作</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Sre/日常运维/安全配置">安全配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Sre/日常运维/网络相关">网络相关</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">operator</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>operator</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1网络">1、网络<a href="#1网络" class="hash-link" aria-label="1、网络的直接链接" title="1、网络的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1sys泛红以及ssh暴力破解">1、sys泛红以及ssh暴力破解<a href="#1sys泛红以及ssh暴力破解" class="hash-link" aria-label="1、sys泛红以及ssh暴力破解的直接链接" title="1、sys泛红以及ssh暴力破解的直接链接">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">netstat</span><span class="token plain"> -nap </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> SYN_RECV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /var/log/secure </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/Failed/{print $(NF-3)}&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uniq</span><span class="token plain"> -c </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{print $2&quot; = &quot;$1;}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /var/log/secure </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/Failed/{print $(NF-3)}&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uniq</span><span class="token plain"> -c </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{print $2&quot; = &quot;$1;}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">（1）第一次握手：Client将标志位SYN置为1，随机产生一个值seq</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">J，并将该数据包发送给Server，Client进入SYN_SENT状态，等待Server确认。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">（2）第二次握手：Server收到数据包后由标志位SYN</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">知道Client请求建立连接，Server将标志位SYN和ACK都置为1，ack</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">J+1，随机产生一个值seq</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">K，并将该数据包发送给Client以确认连接请求，Server进入SYN_RCVD状态。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">（3）第三次握手：Client收到确认后，检查ack是否为J+1，ACK是否为1，如果正确则将标志位ACK置为1，ack</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">K+1，并将该数据包发送给Server，Server检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，Client和Server进入ESTABLISHED状态，完成三次握手，随后Client与Server之间可以开始传输数据了。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SYN攻击：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">在三次握手过程中，Server发送SYN-ACK之后，收到Client的ACK之前的TCP连接称为半连接（half-open connect），此时Server处于SYN_RCVD状态，当收到ACK后，Server转入ESTABLISHED状态。SYN攻击就是Client在短时间内伪造大量不存在的IP地址，并向Server不断地发送SYN包，Server回复确认包，并等待Client的确认，由于源地址是不存在的，因此，Server需要不断重发直至超时，这些伪造的SYN包将产时间占用未连接队列，导致正常的SYN请求因为队列满而被丢弃，从而引起网络堵塞甚至系统瘫痪。SYN攻击时一种典型的DDOS攻击，检测SYN攻击的方式非常简单，即当Server上有大量半连接状态且源IP地址是随机的，则可以断定遭到SYN攻击了，使用如下命令可以让之现行：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#netstat -nap | grep SYN_RECV</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$a</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ok&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token builtin class-name">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改内核防止sync工具的最大连接数</p><p>#查看
sysctl -a|grep net.ipv4.tcp_max_syn_backlog
#修改
sysctl -w net.ipv4.tcp_max_syn_backlog=3000</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2windows路由添加">2、windows路由添加<a href="#2windows路由添加" class="hash-link" aria-label="2、windows路由添加的直接链接" title="2、windows路由添加的直接链接">​</a></h3><p>添加永久路由</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">route print 打印路由信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">route </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.188</span><span class="token plain">.0.0 mask </span><span class="token number" style="color:#36acaa">255.255</span><span class="token plain">.0.0 </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.1.253 -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">route delete  </span><span class="token number" style="color:#36acaa">10.10</span><span class="token plain">.10.0</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">目的网段网络地址</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   表示删除路由</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">route change </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.0.0 mask </span><span class="token number" style="color:#36acaa">255.255</span><span class="token plain">.0.0 </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.14.1 metric </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CHANGE参数只能修改“网关”和“跳数”</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3网卡问题">3、网卡问题<a href="#3网卡问题" class="hash-link" aria-label="3、网卡问题的直接链接" title="3、网卡问题的直接链接">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">如果多个网卡存在</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">删除网卡： </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli  connection delete 网卡id </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /etc/sysconfig/network-scripts/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -f ifcfg-eth0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> ifcfg-ens192  ifcfg-eth0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> ifcfg-eth0: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TYPE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Ethernet&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">BROWSER_ONLY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DEFROUTE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;yes&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IPV4_FAILURE_FATAL</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IPV6INIT</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;yes&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;eth0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DEVICE</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;eth0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ONBOOT</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;yes&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IPADDR</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;192.168.100.236&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">PREFIX</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;24&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">GATEWAY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;192.168.100.254&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DNS1</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;114.114.114.114&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">PEERDNS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IPV6_PRIVACY</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DNS2</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;8.8.8.8&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli  c reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli  c </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli  c up eth0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">或者重启服务，重启系统</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-spring-cloud服务在访问redis时出现连接失败服务注册">4、 spring-cloud服务在访问redis时出现连接失败(服务注册)<a href="#4-spring-cloud服务在访问redis时出现连接失败服务注册" class="hash-link" aria-label="4、 spring-cloud服务在访问redis时出现连接失败(服务注册)的直接链接" title="4、 spring-cloud服务在访问redis时出现连接失败(服务注册)的直接链接">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">原因：是因为基于docker部署的服务在注册到nacos中时，注册的地址是容器的地址，服务之间跨主机无法访问容器中的地址。 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果是docker启动的容器，在映射端口映射到物理机的端口必须是6379,或者使用host网络。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5邮箱ssl配置">5、邮箱ssl配置<a href="#5邮箱ssl配置" class="hash-link" aria-label="5、邮箱ssl配置的直接链接" title="5、邮箱ssl配置的直接链接">​</a></h3><p>qq邮箱配置脚本</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@xjp-001-zlq ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat smtps-mailx.sh  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#/bin/bash </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">COLOR</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;echo -e \E[01;32m&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">COLOR_ERROR</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;echo -e \E[01;31m&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">END</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;\E[0m&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function-name function" style="color:#d73a49">INSTALL_SMTPS</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">set</span><span class="token plain"> -e </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> -d </span><span class="token string" style="color:#e3116c">&quot;/root/.certs&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y nss-tools mailx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /root/.certs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token builtin class-name">echo</span><span class="token plain"> -n </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> openssl s_client -connect mail.iandun.cn:465 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -ne </span><span class="token string" style="color:#e3116c">&#x27;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /root/.certs/iandun.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   certutil -A -n </span><span class="token string" style="color:#e3116c">&quot;GeoTrust SSL CA&quot;</span><span class="token plain"> -t </span><span class="token string" style="color:#e3116c">&quot;C,,&quot;</span><span class="token plain"> -d /root/.certs -i /root/.certs/iandun.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   certutil -A -n </span><span class="token string" style="color:#e3116c">&quot;GeoTrust Global CA&quot;</span><span class="token plain"> -t </span><span class="token string" style="color:#e3116c">&quot;C,,&quot;</span><span class="token plain"> -d /root/.certs -i /root/.certs/iandun.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/root/.mailrc</span><span class="token operator" style="color:#393A34">&lt;&lt;-</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">set from=zhanglaiqiang@iandundd.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">set smtp=smtps://mail.iandundd.cn:465</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">set smtp-auth-user=zhanglaiqiang@iandundd.cn</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">set smtp-auth-password=xxxxxxxxxx  #授权码 此处根据实际情况需要修改</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">set smtp-auth=login</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">set ssl-verify=ignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">set nss-config-dir=/root/.certs</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token variable" style="color:#36acaa">$COLOR</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;#######发送测试邮件到测试邮箱409003604@qq.com########&quot;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;FBI Warning &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> mail -v  -s hello   </span><span class="token number" style="color:#36acaa">409003604</span><span class="token plain">@qq.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$?</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token variable" style="color:#36acaa">$COLOR</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;#######smtps服务部署成功!########&quot;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token variable" style="color:#36acaa">$COLOR_ERROR</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;#######smtps服务部署失败!########&quot;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token variable" style="color:#36acaa">$COLOR_ERROR</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#######请检查~/.certs目录已经存在########&quot;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSTALL_SMTPS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>下面是配置163邮箱的</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -f .certs2/* </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> -n </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> openssl s_client -connect smtp.163.com:465 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -ne </span><span class="token string" style="color:#e3116c">&#x27;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ~/.certs2/163.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certutil -A -n </span><span class="token string" style="color:#e3116c">&quot;GeoTrust SSL CA&quot;</span><span class="token plain"> -t </span><span class="token string" style="color:#e3116c">&quot;C,,&quot;</span><span class="token plain"> -d ~/.certs2 -i ~/.certs2/163.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certutil -A -n </span><span class="token string" style="color:#e3116c">&quot;GeoTrust Global CA&quot;</span><span class="token plain"> -t </span><span class="token string" style="color:#e3116c">&quot;C,,&quot;</span><span class="token plain"> -d ~/.certs2 -i ~/.certs2/163.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certutil -L -d ./.certs2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">certutil -A -n </span><span class="token string" style="color:#e3116c">&quot;GeoTrust SSL CA - G3&quot;</span><span class="token plain"> -t </span><span class="token string" style="color:#e3116c">&quot;Pu,Pu,Pu&quot;</span><span class="token plain">  -d ./.certs2  -i  ./.certs2/163.crt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5iftop-查看网卡流量">5、iftop 查看网卡流量<a href="#5iftop-查看网卡流量" class="hash-link" aria-label="5、iftop 查看网卡流量的直接链接" title="5、iftop 查看网卡流量的直接链接">​</a></h3><p>2049端口是跟nfs相关的</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> iftop -i eth0  -P</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> iftop -i </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>像下面显示名称为名称的展示为服务端口<strong>按大N键</strong>
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_0bf0b5ce614a95462dbe02a787f4a241_r.png" class="img_ev3q"></p><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_9f440950ac288db18fda6be27ac83027_r.png" class="img_ev3q"></p><p>服务器查看进程 netstat -ltnp </p><p><a href="https://blog.csdn.net/icanflyingg/article/details/122618127" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/icanflyingg/article/details/122618127</a></p><p>根据报警处理
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_f1e5684549bcb3df81a80f0fccd80c73_r.png" class="img_ev3q">
在容器中，容器的虚拟网卡是成对出现的，比如下面</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@andun-server08 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -A </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> -B </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;vethdff0645&#x27;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       valid_lft forever preferred_lft forever</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">73</span><span class="token plain">: veth495b6ab@if72: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">BROADCAST,MULTICAST,UP,LOWER_UP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mtu </span><span class="token number" style="color:#36acaa">1500</span><span class="token plain"> qdisc noqueue master br-03a10779cc6c state UP group default </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    link/ether 8e:e1:eb:0a:5c:8b brd ff:ff:ff:ff:ff:ff link-netnsid </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1370</span><span class="token plain">: vethdff0645@if1369: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">BROADCAST,MULTICAST,UP,LOWER_UP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mtu </span><span class="token number" style="color:#36acaa">1500</span><span class="token plain"> qdisc noqueue master docker0 state UP group default </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    link/ether </span><span class="token number" style="color:#36acaa">66</span><span class="token plain">:5f:42:73:49:c0 brd ff:ff:ff:ff:ff:ff link-netnsid </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">862</span><span class="token plain">: veth6ce0423@if861: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">BROADCAST,MULTICAST,UP,LOWER_UP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mtu </span><span class="token number" style="color:#36acaa">1500</span><span class="token plain"> qdisc noqueue master br-a733af38ab32 state UP group default </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    link/ether </span><span class="token number" style="color:#36acaa">92</span><span class="token plain">:c6:0e:36:88:1c brd ff:ff:ff:ff:ff:ff link-netnsid </span><span class="token number" style="color:#36acaa">8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>1370 表示物理网卡的网卡序号，而if1369表示链接到容器当中的eth0网卡序号</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#通过下面的方式来查看容器中网卡的序号，也可以通过Ip a查看 ,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#需要安装 ip命令，执行apt-get install  iproute2进行安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@a51df0542708:/</span><span class="token comment" style="color:#999988;font-style:italic"># cat /sys/class/net/eth0/ifindex </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上告警为容器网卡，找到对应的容器  </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#找到网卡所在的物理机网卡序号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@andun-server08 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;vethdff0645&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> -F </span><span class="token string" style="color:#e3116c">&quot;:&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{print $1}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1370</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@andun-server08 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#通过找到容器中链接宿主机的网卡序号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@andun-server08 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">ps</span><span class="token variable" style="color:#36acaa">  </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $NF}&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> -v </span><span class="token variable string" style="color:#e3116c">&#x27;NAMES&#x27;</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token builtin class-name">exec</span><span class="token plain"> -it </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /sys/class/net/eth0/iflink </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1370&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iandun_cmsserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iandun_repertoryweb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iandun_repertoryserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iandun_cmsweb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">P_W</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1370</span><span class="token plain">                 </span><span class="token comment" style="color:#999988;font-style:italic">#找到对应的容器为P_W</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plg_promtail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drink_dl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ppg_auto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bloodsugar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ckwear</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extensionweb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">partnerweb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">customerweb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iandunlog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iandun-open-api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iandun-soul</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iandun-gateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">showweb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">implant</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2系统服务">2、系统服务<a href="#2系统服务" class="hash-link" aria-label="2、系统服务的直接链接" title="2、系统服务的直接链接">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-查看直接通过system启动的war包项目">1 、查看直接通过system启动的war包项目<a href="#1-查看直接通过system启动的war包项目" class="hash-link" aria-label="1 、查看直接通过system启动的war包项目的直接链接" title="1 、查看直接通过system启动的war包项目的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -ef </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -o  </span><span class="token string" style="color:#e3116c">&quot;.config.file=/usr/local/tomcat-[a-z,-]\+&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.config.file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/tomcat-app-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.config.file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/tomcat-cmsserver-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.config.file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/tomcat-customer-server-demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2日志切割">2、日志切割<a href="#2日志切割" class="hash-link" aria-label="2、日志切割的直接链接" title="2、日志切割的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java启动jar包基于运维系统层面的日志切割方式参考</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">``</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa"></span><span class="token variable function" style="color:#d73a49">nohup</span><span class="token variable" style="color:#36acaa"> java -jar common-api.jar </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> /usr/local/cronolog/sbin/cronolog logs/console-%Y-%m-%d.out </span><span class="token variable operator" style="color:#393A34">&amp;</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa"></span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">``</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3cpu暴涨--通过线程查找问题">3、cpu暴涨 -通过线程查找问题<a href="#3cpu暴涨--通过线程查找问题" class="hash-link" aria-label="3、cpu暴涨 -通过线程查找问题的直接链接" title="3、cpu暴涨 -通过线程查找问题的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#方式1： </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#第一步： 通过top找到资源使用率最大的那个进程，比如16108</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">、 </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -mp </span><span class="token number" style="color:#36acaa">16108</span><span class="token plain"> -o THREAD,tid,time </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> -rn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@watch-server01 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -mp </span><span class="token number" style="color:#36acaa">16108</span><span class="token plain">   -o THREAD,tid,time </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> -nr </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">head</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">     %CPU PRI SCNT WCHAN  </span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain"> SYSTEM   TID     TIME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root     </span><span class="token number" style="color:#36acaa">68.7</span><span class="token plain">   -    - -         -      -     - 00:07:42</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root      </span><span class="token number" style="color:#36acaa">5.9</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">19</span><span class="token plain">    - -         -      - </span><span class="token number" style="color:#36acaa">16137</span><span class="token plain"> 00:00:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root      </span><span class="token number" style="color:#36acaa">5.7</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">19</span><span class="token plain">    - -         -      - </span><span class="token number" style="color:#36acaa">16138</span><span class="token plain"> 00:00:38</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root      </span><span class="token number" style="color:#36acaa">5.3</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">19</span><span class="token plain">    - -         -      - </span><span class="token number" style="color:#36acaa">16136</span><span class="token plain"> 00:00:36</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root      </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">19</span><span class="token plain">    - -         -      - </span><span class="token number" style="color:#36acaa">16308</span><span class="token plain"> 00:00:13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root      </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">19</span><span class="token plain">    - -         -      - </span><span class="token number" style="color:#36acaa">16139</span><span class="token plain"> 00:00:13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root      </span><span class="token number" style="color:#36acaa">1.9</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">19</span><span class="token plain">    - -         -      - </span><span class="token number" style="color:#36acaa">16688</span><span class="token plain"> 00:00:12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root      </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">19</span><span class="token plain">    - -         -      - </span><span class="token number" style="color:#36acaa">16690</span><span class="token plain"> 00:00:12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root      </span><span class="token number" style="color:#36acaa">1.7</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">19</span><span class="token plain">    - -         -      - </span><span class="token number" style="color:#36acaa">16687</span><span class="token plain"> 00:00:10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#然后通过上面的主进程找到对应的资源使用率最大线程id，比如：  16137 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#转换为16进制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain">、printf </span><span class="token string" style="color:#e3116c">&quot;%x</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">16137</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3f09 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">定位到那个进程的代码片段</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3</span><span class="token plain">、jstack  </span><span class="token number" style="color:#36acaa">16108</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain">  3f09  -A </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@watch-server01 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain">  /andun_work/jdk1.8.0_144/bin/jstack  </span><span class="token number" style="color:#36acaa">16108</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain">  3f09  -A </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sudo</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> password </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> zhanglaiqiang: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;C2 CompilerThread1&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#7 daemon prio=9 os_prio=0 tid=0x00007f3c80515000 nid=0x3f09 waiting on condition [0x0000000000000000]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   java.lang.Thread.State: RUNNABLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;C2 CompilerThread0&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#6 daemon prio=9 os_prio=0 tid=0x00007f3c80513000 nid=0x3f08 waiting on condition [0x0000000000000000]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   java.lang.Thread.State: RUNNABLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;Signal Dispatcher&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#5 daemon prio=9 os_prio=0 tid=0x00007f3c80511000 nid=0x3f07 runnable [0x0000000000000000]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   java.lang.Thread.State: RUNNABLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;Surrogate Locker Thread (Concurrent GC)&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#4 daemon prio=9 os_prio=0 tid=0x00007f3c8050f800 nid=0x3f06 waiting on condition [0x0000000000000000]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   java.lang.Thread.State: RUNNABLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;Finalizer&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#3 daemon prio=8 os_prio=0 tid=0x00007f3c804dc800 nid=0x3f05 in Object.wait() [0x00007f3c1a816000]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   java.lang.Thread.State: WAITING </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">on object monitor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.Object.wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Native Method</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.ref.ReferenceQueue.remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ReferenceQueue.java:143</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - locked </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">0x00000006c090657</span><span class="token operator file-descriptor important" style="color:#393A34">8</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a java.lang.ref.ReferenceQueue</span><span class="token variable" style="color:#36acaa">$Lock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.ref.ReferenceQueue.remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ReferenceQueue.java:164</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.ref.Finalizer</span><span class="token variable" style="color:#36acaa">$FinalizerThread</span><span class="token plain">.run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Finalizer.java:209</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;Reference Handler&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#2 daemon prio=10 os_prio=0 tid=0x00007f3c804d7800 nid=0x3f04 in Object.wait() [0x00007f3c1a917000]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   java.lang.Thread.State: WAITING </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">on object monitor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.Object.wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Native Method</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.Object.wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Object.java:502</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.ref.Reference.tryHandlePending</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Reference.java:191</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - locked </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">0x00000006c09065b</span><span class="token operator file-descriptor important" style="color:#393A34">8</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a java.lang.ref.Reference</span><span class="token variable" style="color:#36acaa">$Lock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.lang.ref.Reference</span><span class="token variable" style="color:#36acaa">$ReferenceHandler</span><span class="token plain">.run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Reference.java:153</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;main&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#1 prio=5 os_prio=0 tid=0x00007f3c80009800 nid=0x3eee runnable [0x00007f3c88013000]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   java.lang.Thread.State: RUNNABLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at java.net.PlainSocketImpl.socketAccept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Native Method</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#方式2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">top</span><span class="token plain"> -H -p pid   </span><span class="token comment" style="color:#999988;font-style:italic">#pid指定cpu使用率最大的那个pid文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3系统负载计算">3、系统负载计算<a href="#3系统负载计算" class="hash-link" aria-label="3、系统负载计算的直接链接" title="3、系统负载计算的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@demo02 iandun-system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">top</span><span class="token plain"> -n </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  -b  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain">  average</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">top</span><span class="token plain"> - </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:59:30 up </span><span class="token number" style="color:#36acaa">17</span><span class="token plain"> days, </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">:54,  </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> users,  load average: </span><span class="token number" style="color:#36acaa">1.90</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">2.37</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">2.43</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#解释</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1.90</span><span class="token plain">表示系统1分钟负载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2.37</span><span class="token plain">表示系统5分钟负载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2.43</span><span class="token plain">表示系统15分钟负载</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>比如： 系统有8个cpu,系统负载不能超过8  </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4云服务器cpu核数统计">4、云服务器cpu核数统计<a href="#4云服务器cpu核数统计" class="hash-link" aria-label="4、云服务器cpu核数统计的直接链接" title="4、云服务器cpu核数统计的直接链接">​</a></h4><p>CPU总核数 = 物理CPU个数 <em> 每颗物理CPU的核数
总逻辑CPU数 = 物理CPU个数 </em> 每颗物理CPU的核数 * 超线程数</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#查看CPU信息（型号）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@demo02 iandun-system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /proc/cpuinfo</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cpu cores&quot;</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uniq</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cpu cores   </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## 查看物理CPU个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@demo02 iandun-system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$  </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /proc/cpuinfo </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cut</span><span class="token plain"> -f2 -d: </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uniq</span><span class="token plain"> -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">  Intel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">R</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Xeon</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">R</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Platinum 8269CY CPU @ </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">.50GHz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@demo02 iandun-system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /proc/cpuinfo</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;physical id&quot;</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sort</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uniq</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wc</span><span class="token plain"> -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看每个物理CPU中core的个数(即核数)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@demo02 iandun-system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /proc/cpuinfo</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cpu cores&quot;</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uniq</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cpu cores   </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看逻辑CPU的个数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@demo02 iandun-system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$  </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /proc/cpuinfo</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;processor&quot;</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wc</span><span class="token plain"> -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@demo02 iandun-system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这些都代表什么，那就请看CPU架构</p><p>多个物理CPU，CPU通过总线进行通信，效率比较低，如下：</p><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_9a8167c7c5c7ebe63461b36c4828b40a_r.png" class="img_ev3q"></p><p>多核CPU，不同的核通过L2 cache进行通信，存储和外设通过总线与CPU通信，如下：
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_9566b09a75e58847ce3c2b581a8643f9_r.png" class="img_ev3q"></p><p>多核超线程,每个核有两个逻辑的处理单元，两个核共同分享一个核的资源，如下：</p><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_83435ef66662d4c25b44aaa94c64fadb_r.png" class="img_ev3q"></p><p>从上面执行的结果来看，证明我使用的cpu有4* 2 = 8 核，每个核有2个超线程，所以有8个逻辑cpu。</p><p>从上面执行的结果来看，证明我使用的cpu有4* 2 = 8 核，每个核有2个超线程，所以有8个逻辑cpu。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5巡检脚本配置以及授权">5、巡检脚本配置以及授权<a href="#5巡检脚本配置以及授权" class="hash-link" aria-label="5、巡检脚本配置以及授权的直接链接" title="5、巡检脚本配置以及授权的直接链接">​</a></h4><p><strong>创建用户</strong></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">useradd</span><span class="token plain"> devops  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123456&quot;</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">passwd</span><span class="token plain">  --stdin devops</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>创建授权</strong></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@loaclhost ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># visudo  #或者 vim /etc/sudoers 两种方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">devops  </span><span class="token assign-left variable" style="color:#36acaa">ALL</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ALL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">      NOPASSWD:/usr/bin/netstat,/bin/bash,/bin/python3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="6iotop命令详解">6、Iotop命令详解<a href="#6iotop命令详解" class="hash-link" aria-label="6、Iotop命令详解的直接链接" title="6、Iotop命令详解的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#iotop命令是一个用来监视磁盘I/O使用状况的top类工具。iotop具有与top相似的UI，其中包括PID、用户、I/O、进程等相关信息。Linux下的IO统计工具如iostat，nmon等大多数是只能统计到per设备的读写情况，如果你想知道每个进程是如何使用IO的就比较麻烦，使用iotop命令可以很方便的查看</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#与iostat工具比较，iostat是系统级别的IO监控，而iotop是进程级别IO监控</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iotop的安装有前提条件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">：内核版本为2.6.20或更高版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain">：Python </span><span class="token number" style="color:#36acaa">2.7</span><span class="token plain">或更高的版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iotop参数： </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-o：只显示有io操作的进程</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-b：批量显示，无交互，主要用作记录到文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-n NUM：显示NUM次，主要用于非交互式模式。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-d SEC：间隔SEC秒显示一次。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p PID：监控的进程pid。接进程号，监视指定进程，只会输出该进程的统计信息。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-u </span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">：监控的进程用户。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-k 使用千字节而不是人类友好单位</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>iotop使用 iotop  -k 查看如下效果
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_5e2632884e13b169810ea17122898a2a_r.png" class="img_ev3q"></p><p>使用说明</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Total DISK READ：总磁盘读</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Actual DISK READ：实际磁盘读</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Total DISK WRITE ：总磁盘写入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Actual DISK WRITE：实际磁盘写入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TID列：进程PID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">：进程对应的用户</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>iotop快捷键</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">左右箭头：改变排序方式，默认是按IO排序。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    r：改变排序顺序。反向排序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    o：只显示有IO输出的进程。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p：进程/线程的显示方式的切换。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a：显示累积使用量。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    q：退出。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>iotop的例子</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iotop -o   </span><span class="token comment" style="color:#999988;font-style:italic">#可以清楚地知晓是什么程序在读写磁盘，速度以及命令行，pid 等信息</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用非交互模式将iotop命令输出信息写入日志</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#nohup iotop -b -o -n 10 -d 5 -t  &gt; /tmp/iotop.log &amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#借助iotop命令找到消耗I/O最高的进程</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iotop -oP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">监控系统I/O</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># iotop</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">监控用户root的I/O</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># iotop -u root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">监控进程号是1的I/O</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># iotop -p 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="7打印需要杀死的进程">7、打印需要杀死的进程<a href="#7打印需要杀死的进程" class="hash-link" aria-label="7、打印需要杀死的进程的直接链接" title="7、打印需要杀死的进程的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -ef</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> boco</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -v </span><span class="token function" style="color:#d73a49">grep</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{print &quot;kill -9 &quot;$2}&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#打印需要杀死进程</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="8清理journalctl日志">8、清理journalctl日志<a href="#8清理journalctl日志" class="hash-link" aria-label="8、清理journalctl日志的直接链接" title="8、清理journalctl日志的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看占用的磁盘</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">journalctl --disk-usage </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 设置占用的磁盘空间，日志量大于这些后自动删除旧的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">journalctl --vacuum-size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">512M </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2d之前的自动删除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">journalctl --vacuum-time</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">2d </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看系统内核日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">journalctl -k</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="9centos启动异常">9、centos启动异常<a href="#9centos启动异常" class="hash-link" aria-label="9、centos启动异常的直接链接" title="9、centos启动异常的直接链接">​</a></h4><p>1.报错：Entering emergency mode. Exit the shell to continue.
2.故障分析：不按规范挂机或重启导致文件系统故障。
3.故障状态：
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_8a4ba1934092b0c6cb3ca3554c760b2d_r.png" class="img_ev3q"></p><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_c37feb12bd3ee434f37c6a9ed64e0ea9_r.png" class="img_ev3q">
备注：注意中间读取的是sda3失败</p><p>4.故障解决：</p><p>输入命令：xfs_repair -v -L /dev/sda3</p><p>-L 选项指定强制日志清零，强制xfs_repair将日志归零，即使它包含脏数据（元数据更改）</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3磁盘挂载">3、磁盘挂载<a href="#3磁盘挂载" class="hash-link" aria-label="3、磁盘挂载的直接链接" title="3、磁盘挂载的直接链接">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1磁盘空间判断大于30">1、磁盘空间判断大于30%<a href="#1磁盘空间判断大于30" class="hash-link" aria-label="1、磁盘空间判断大于30%的直接链接" title="1、磁盘空间判断大于30%的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">df</span><span class="token plain"> -Ph </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{if(+$5&gt;20) print $5}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">df</span><span class="token plain"> -Ph </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{if(+$5&gt;20) print $(NF-1)}&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2挂载windows的共享">2、挂载windows的共享<a href="#2挂载windows的共享" class="hash-link" aria-label="2、挂载windows的共享的直接链接" title="2、挂载windows的共享的直接链接">​</a></h4><p>如果共享windows的目录，在linux上挂载： </p><p>centos8: </p><p>客户端更改： wordpress-博客案例 </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">插件安装，在windows中必须创建账号，并且授权目录共享目录可以使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> cifs-utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">方式1： </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">写入到fatab当中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token number" style="color:#36acaa">10.8</span><span class="token plain">.0.101</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">share /apps/wordpress/html/devops   cifs  user,uid</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">500</span><span class="token plain">,rw,suid,username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ilync,password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ifnvps8898.  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">方式2： 用命令执行-可能方式1不行的情况下使用方法2 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> -t cifs //10.8.0.101/share /apps -o </span><span class="token assign-left variable" style="color:#36acaa">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ilync,password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ifnvps8898.,vers</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>centos7.3配置；</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">手动执行挂载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> -t cifs -o </span><span class="token assign-left variable" style="color:#36acaa">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ilync,password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ifnvps8898.,vers</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">  //10.8.0.101/share  /apps/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">写入到/etc/fstab文件中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">\</span><span class="token number" style="color:#36acaa">10.8</span><span class="token plain">.0.101</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">share  /apps/   cifs   </span><span class="token assign-left variable" style="color:#36acaa">username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ilync,password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ifnvps8898.,vers</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3磁盘">3、磁盘<a href="#3磁盘" class="hash-link" aria-label="3、磁盘的直接链接" title="3、磁盘的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#disk_fq=$(df -Ph | awk &#x27;{if(+$5&gt;10) print &quot;分区:&quot;$1}&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">disk_fq</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">df</span><span class="token variable" style="color:#36acaa"> -m  </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{if(+$5&gt;10) print &quot;分区:&quot;$1&quot; &quot;$5&quot; &quot;$4}&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;BEGIN {max = 0} {if ($3+0 &gt;max+0) {max=$3; content=$0}} END {print content}&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $1}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#disk_to=$(df -Ph | awk &#x27;{if(+$5&gt;10) print &quot;总空间:&quot;$2}&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">disk_to</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">df</span><span class="token variable" style="color:#36acaa"> -m  </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{if(+$5&gt;10) print &quot;总空间:&quot; $2 }&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&quot;:&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;BEGIN {max = 0} {if ($2+0 &gt;max+0) {max=$2; content=$0}} END {print content}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#disk_us=$(df -Ph | awk &#x27;{if(+$5&gt;10) print &quot;使用空间:&quot;$3}&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">disk_use</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">df</span><span class="token variable" style="color:#36acaa"> -m </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{if(+$5&gt;10) print &quot;使用空间:&quot;$3}&#x27;</span><span class="token variable" style="color:#36acaa">  </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa">  </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&quot;:&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $NF}&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">sort</span><span class="token variable" style="color:#36acaa"> -nr </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> -n </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#disk_fe=$(df -Ph | awk &#x27;{if(+$5&gt;10) print &quot;可用空间:&quot;$4}&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">disk_fe</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">df</span><span class="token variable" style="color:#36acaa"> -m  </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{if(+$5&gt;10) print &quot;可用空间:&quot; $4 }&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&quot;:&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;BEGIN {max = 0} {if ($2+0 &gt;max+0) {max=$2; content=$0}} END {print content}&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $1}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#disk_ul=$(df -Ph | awk &#x27;{if(+$5&gt;20) print &quot;磁盘使用率:&quot;$5}&#x27;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">disk_ul</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">df</span><span class="token variable" style="color:#36acaa"> -m  </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{if(+$5&gt;10) print &quot;磁盘使用率:&quot; $5 }&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&quot;:&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;BEGIN {max = 0} {if ($2+0 &gt;max+0) {max=$2; content=$0}} END {print content}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4java和tomcat">4、Java和Tomcat<a href="#4java和tomcat" class="hash-link" aria-label="4、Java和Tomcat的直接链接" title="4、Java和Tomcat的直接链接">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-catalinash-java_opts配置">1、 catalina.sh Java_opts配置<a href="#1-catalinash-java_opts配置" class="hash-link" aria-label="1、 catalina.sh Java_opts配置的直接链接" title="1、 catalina.sh Java_opts配置的直接链接">​</a></h4><p>cattalina.sh中在下面位置添加，资源限制使用
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_d0e503279caf0052f9b5abdc89133144_r.png" class="img_ev3q"></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">JAVA_OPTS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;-server -Xms512m -Xmx1024m -XX:+UseG1GC -Dfile.encoding=UTF-8&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">添加jmx_exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">JAVA_OPTS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;-javaagent:/home/andun_devops/jmx_prometheus_javaagent/jmx_prometheus_javaagent-0.16.1.jar=38083:/home/andun_devops/jmx_prometheus_javaagent/config.yaml -server -Xms512m -Xmx1024m -XX:+UseG1GC -Dfile.encoding=UTF-8&quot;</span><span class="token plain">      </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>docker-compose资源限制</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  deploy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      limits:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cpus: </span><span class="token string" style="color:#e3116c">&#x27;1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        memory: 1000M</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>skywalking-agent对接，需要提前下载,jmx_exporter同理</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2tomcat">2、tomcat:<a href="#2tomcat" class="hash-link" aria-label="2、tomcat:的直接链接" title="2、tomcat:的直接链接">​</a></h4><p>在catalina.sh中找到JAVA_HOME中添加</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">JAVA_OPTS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;-javaagent:/home/andun_devops/skywalking_agent/skywalking-agent/skywalking-agent.jar -Dskywalking.agent.service_name=cmsserver_demo  -Dskywalking.collector.backend_service=172.17.224.52:11800   -jar xxx.jar&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-java">3、 java<a href="#3-java" class="hash-link" aria-label="3、 java的直接链接" title="3、 java的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java -javaagent:/home/andun_devops/skywalking_agent/skywalking-agent/skywalking-agent.jar -Dskywalking.agent.service_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">cmsserver_demo  -Dskywalking.collector.backend_service</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.224.52:11800   -jar xxx.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4容器">4、容器<a href="#4容器" class="hash-link" aria-label="4、容器的直接链接" title="4、容器的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@cms_project iandun-agent</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat Dockerfile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM  adoptopenjdk/openjdk8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN   </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain">  /opt/project </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /opt/projectADD   iandun-agent.jar   /opt/project/  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD   agent.tar.gz      /opt/project/  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE  </span><span class="token number" style="color:#36acaa">8090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;java&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;-javaagent:/opt/project/agent/skywalking-agent.jar&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;-Dskywalking.agent.service_name=andun-agent&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;-Dskywalking.collector.backend_service=122.51.39.181:11800&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;-jar&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;/opt/project/iandun-agent.jar&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5tomcat指定版本的jdk">5、tomcat指定版本的jdk<a href="#5tomcat指定版本的jdk" class="hash-link" aria-label="5、tomcat指定版本的jdk的直接链接" title="5、tomcat指定版本的jdk的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@andun-demo04 iandun-cmsserver-u9-demo</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> bin/catalina.sh  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">head</span><span class="token plain"> -n </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">JAVA_HOME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/usr/local/java/jdk1.8.0_144&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">JRE_HOME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/usr/local/java/jdk1.8.0_144/jre&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@andun-demo04 iandun-cmsserver-u9-demo</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> bin/setclasspath.sh  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">head</span><span class="token plain"> -n </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">JAVA_HOME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/usr/local/java/jdk1.8.0_144&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">JRE_HOME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/usr/local/java/jdk1.8.0_144/jre&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="6dockertomcat部署skywalking-agent">6、Docker(tomcat部署skywalking-agent)<a href="#6dockertomcat部署skywalking-agent" class="hash-link" aria-label="6、Docker(tomcat部署skywalking-agent)的直接链接" title="6、Docker(tomcat部署skywalking-agent)的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> bin/catalina.sh  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">head</span><span class="token plain"> -n </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#在前一行加入下面即可，调整文件位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CATALINA_OPTS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;-javaagent:/opt/skywalking-agent/skywalking-agent.jar -Dskywalking.agent.service_name=test_demo_002 -Dskywalking.collector.backend_service=10.51.8.110:11800&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token builtin class-name">export</span><span class="token plain"> CATALINA_OPTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="7tomcat性能优化">7、tomcat性能优化<a href="#7tomcat性能优化" class="hash-link" aria-label="7、tomcat性能优化的直接链接" title="7、tomcat性能优化的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">Connector </span><span class="token assign-left variable" style="color:#36acaa">port</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;9380&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">protocol</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;HTTP/1.1&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">minProcessors</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;10&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">maxProcessors</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;1024&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">acceptCount</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;1024&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token assign-left variable" style="color:#36acaa">connectionTimeout</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;20000&quot;</span><span class="token plain">  </span><span class="token assign-left variable" style="color:#36acaa">maxThreads</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;1000&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">minSpareThreads</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;100&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">maxSpareThreads</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;1000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token assign-left variable" style="color:#36acaa">redirectPort</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;9443&quot;</span><span class="token plain"> /</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#参考 https://blog.csdn.net/qq_40741855/article/details/116009877</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># https://blog.csdn.net/qq_23994787/article/details/79479686</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> acceptCount: 默认值100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 虽然tomcat同时可以处理的连接数目是maxConnections，但服务器中可以同时接收的连接数为maxConnections+acceptCount 。acceptCount的设置，与应用在连接过高情况下希望做出什么反应有关系。如果设置过大，后面进入的请求等待时间会很长；如果设置过小，后面进入的请求立马返回connection refused</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_1a286e4ba2305fd70d658e7fca435ff4_r.png" class="img_ev3q"></p><p>查看连接数： 假如端口为8380</p><p>[root@iandun-app-u9-demo tomcat]<!-- --># netstat  -nat | grep 8380
tcp        0      0 0.0.0.0:8380            0.0.0.0:*               LISTEN  </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="8tomcat连接数查看">8、tomcat连接数查看<a href="#8tomcat连接数查看" class="hash-link" aria-label="8、tomcat连接数查看的直接链接" title="8、tomcat连接数查看的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@timed-task-server02 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">netstat</span><span class="token plain"> -antp </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9380</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> ESTABLISHED </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Not all processes could be identified, non-owned process info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> will not be shown, you would have to be root to see it all.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp6       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.113.108:9380     </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.224.109:52400    ESTABLISHED -                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp6       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.113.108:9380     </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.224.118:43352    ESTABLISHED -                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp6       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.113.108:9380     </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.224.109:52436    ESTABLISHED -                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp6       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.113.108:9380     </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.224.118:43284    ESTABLISHED -                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp6       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.113.108:59380    </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.224.58:22229     ESTABLISHED -                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp6       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.113.108:9380     </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.224.109:52378    ESTABLISHED -                   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcp6       </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.113.108:9380     </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.224.118:43306    ESTABLISHED -   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#172.17.224.118  172.17.224.109表示nginx地址</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5jenkins">5、Jenkins<a href="#5jenkins" class="hash-link" aria-label="5、Jenkins的直接链接" title="5、Jenkins的直接链接">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1jenkins钉钉告警添加位置">1、jenkins钉钉告警添加位置<a href="#1jenkins钉钉告警添加位置" class="hash-link" aria-label="1、jenkins钉钉告警添加位置的直接链接" title="1、jenkins钉钉告警添加位置的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    post </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      always </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          wrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token variable" style="color:#36acaa">$class</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;BuildUser&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;curl </span><span class="token string" style="color:#e3116c">&#x27;https://oapi.dingtalk.com/robot/send?access_token=667531b61ff814f81270d3b1ab2586d6cb49a2a2beab03932794d7c3f7faee1&#x27;</span><span class="token plain">  -H </span><span class="token string" style="color:#e3116c">&#x27;Content-Type: application/json&#x27;</span><span class="token plain"> -d </span><span class="token string" style="color:#e3116c">&#x27;{&quot;msgtype&quot;:&quot;text&quot;,&quot;text&quot;:{&quot;content&quot;: &quot;部署服务：${JOB_NAME} \n构建分支: ${branch}\n构建ID: ${BUILD_ID}\n构建人: ${BUILD_USER}\n提交信息：${commit}构建状态：${currentBuild.currentResult}&quot;}}&#x27;</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_65ce013e29f8dddafc75cb2c2ceea500_r.png" class="img_ev3q"></p><p>2、jenkins dockerfile报错
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_613f8dfb61dfa35a69f852582e9eb030_r.png" class="img_ev3q">
正确写法1; </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;./opt/apache-tomcat-9.0.44/bin/startup.sh&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;run&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>正确写法2;</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/opt/apache-tomcat-9.0.44/bin/startup.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6容器">6、容器<a href="#6容器" class="hash-link" aria-label="6、容器的直接链接" title="6、容器的直接链接">​</a></h2><p>非常全面的文档参考</p><p><a href="https://haicoder.net/docker/docker-logs.html" target="_blank" rel="noopener noreferrer">https://haicoder.net/docker/docker-logs.html</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1docker-compose安装">1、docker-compose安装<a href="#1docker-compose安装" class="hash-link" aria-label="1、docker-compose安装的直接链接" title="1、docker-compose安装的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> -P /usr/local/bin/  --user</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">yunxiao --password</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Yun</span><span class="token comment" style="color:#999988;font-style:italic">#xia0  https://www.zlqit.com/devops/docker/docker-compose</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /usr/local/bin/docker-compose</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2docker相关">2、docker相关<a href="#2docker相关" class="hash-link" aria-label="2、docker相关的直接链接" title="2、docker相关的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">删除所有的容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -f </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">docker </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -qa</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">删除所有没有在使用的容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> image prune -a </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3java项目启动base-image-dockerfile">3、java项目启动base image Dockerfile<a href="#3java项目启动base-image-dockerfile" class="hash-link" aria-label="3、java项目启动base image Dockerfile的直接链接" title="3、java项目启动base image Dockerfile的直接链接">​</a></h4><p><strong>发送给研发的Dockerfile参考文件</strong></p><p>输送给研发的Dockerfile说明信息</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM  harbor.iandun.com/devops/java:v1.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># run表示需要执行的shell命令，如果没有可以忽略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN   </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain">  /opt/project                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#默认工作目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /opt/project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#拷贝打包文件到工作目录 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY  hudson.war  /opt/project/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#EXPOSE需要暴露服务的端口 ，如果有多个端口，可以使用EXPOSE暴露多个端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE  </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">                                         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE  </span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#需要执行的shell命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/opt/jdk1.8.0_281/bin/java&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#将启动的参数写入到cmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-jar&quot;</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token string" style="color:#e3116c">&quot;参数1&quot;</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token string" style="color:#e3116c">&quot;参数2&quot;</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token string" style="color:#e3116c">&quot;....&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>传递命令的两种方式： </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">方式1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/opt/jdk1.8.0_281/bin/java&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#将启动的参数写入到cmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-jar&quot;</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token string" style="color:#e3116c">&quot;参数1&quot;</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token string" style="color:#e3116c">&quot;参数2&quot;</span><span class="token plain">, </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token string" style="color:#e3116c">&quot;....&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">方式2                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;java&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;-Duser.timezone=GMT+08&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;-jar&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;/web.jar&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>tomcat 启动dockerfile ： </p><p>使用tomcat直接部署业务</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM  centos:centos7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MAINTAINER zhanglaiqiang</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN    </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /usr/local/tomcat-cmsserver-demo -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR  /usr/local/tomcat-cmsserver-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY  jdk-8u281-linux-x64.tar.gz       /usr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD   apache-tomcat-8.5.33.tar.gz     /usr/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN  </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> -R </span><span class="token number" style="color:#36acaa">777</span><span class="token plain"> /usr/*.tar.gz  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /var/</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">jenkins_home,webapps</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> -p  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Asia/Shanghai&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/etc/timezone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN  </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> -zxvf /usr/jdk-8u281-linux-x64.tar.gz   -C /opt  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf /usr/jdk-8u281-linux-x64.tar.gz </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> /usr/apache-tomcat-8.5.33/*  /usr/local/tomcat-cmsserver-demo/  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf /usr/apache-tomcat-8.5.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV  JAVA_HOME  /opt/jdk1.8.0_281</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV </span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token plain">:/</span><span class="token variable" style="color:#36acaa">$JAVA_HOME</span><span class="token plain">/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN  </span><span class="token builtin class-name">cd</span><span class="token plain"> /usr/local/tomcat-cmsserver-demo/bin  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain">  </span><span class="token builtin class-name">pwd</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY  hudson.war   /usr/local/tomcat-cmsserver-demo/webapps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#方式1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/usr/local/tomcat-cmsserver-demo/bin/catalina.sh&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;run&quot;</span><span class="token plain"> , </span><span class="token string" style="color:#e3116c">&quot;&amp;&amp;&quot;</span><span class="token plain"> , </span><span class="token string" style="color:#e3116c">&quot;tail&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;-f&quot;</span><span class="token plain">,  </span><span class="token string" style="color:#e3116c">&quot;/opt/apache-tomcat-9.0.44/logs/catalina.out&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#如果容器没有生成catalina.out日志，使用下面的方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT /usr/local/tomcat/bin/startup.sh </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tail</span><span class="token plain"> -f /usr/local/tomcat/logs/catalina.out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>tomcat容器： </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@loaclhost test</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat /root/jenkins/Dockerfile-tomcat </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM  centos:centos7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MAINTAINER zhanglaiqiang</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN    </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /usr/local/tomcat-cmsserver-demo -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR  /usr/local/tomcat-cmsserver-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY  jdk-8u281-linux-x64.tar.gz       /usr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD   apache-tomcat-8.5.33.tar.gz     /usr/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN  </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> -R </span><span class="token number" style="color:#36acaa">777</span><span class="token plain"> /usr/*.tar.gz  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /var/</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">jenkins_home,webapps</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> -p  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Asia/Shanghai&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/etc/timezone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN  </span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> -zxvf /usr/jdk-8u281-linux-x64.tar.gz   -C /opt  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf /usr/jdk-8u281-linux-x64.tar.gz </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> /usr/apache-tomcat-8.5.33/*  /usr/local/tomcat-cmsserver-demo/  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf /usr/apache-tomcat-8.5.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV  JAVA_HOME  /opt/jdk1.8.0_281</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV  </span><span class="token environment constant" style="color:#36acaa">PATH</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token plain">:/</span><span class="token variable" style="color:#36acaa">$JAVA_HOME</span><span class="token plain">/bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>tomcat-业务容器</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@loaclhost test</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat /test/Dockerfile-tomcat  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM    harbor.iandun.com/devops/tomcat:v8.5.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY  hudson.war  /usr/local/tomcat-cmsserver-demo/webapps/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE  </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE  </span><span class="token number" style="color:#36acaa">50000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/usr/local/tomcat-cmsserver-demo/bin/catalina.sh&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;run&quot;</span><span class="token plain"> , </span><span class="token string" style="color:#e3116c">&quot;&amp;&amp;&quot;</span><span class="token plain"> , </span><span class="token string" style="color:#e3116c">&quot;tail&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;-f&quot;</span><span class="token plain">,  </span><span class="token string" style="color:#e3116c">&quot;/usr/local/tomcat-cmsserver-demo/logs/catalina.out&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试命令</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run   -p </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain">:22  -v /etc/hosts:/etc/hosts  --name centos   --hostname centos-test  centos </span><span class="token function" style="color:#d73a49">tail</span><span class="token plain"> -f /var/log/message </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>java启动jar包方式:  cms重构(业务封装)</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM  harbor.iandun.com/devops/java:1.8.0_291</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN   </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain">  /opt/project </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /opt/project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD   iandun-log.jar   /opt/project/  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE  </span><span class="token number" style="color:#36acaa">8086</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#注重启动方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nohup&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;java&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;-jar&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;/opt/project/iandun-log.jar&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;&gt;/dev/null&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;2&gt;&amp;1&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;&amp;&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4dockerfile-拷贝目录下的文件到容器中">4、dockerfile 拷贝目录下的文件到容器中<a href="#4dockerfile-拷贝目录下的文件到容器中" class="hash-link" aria-label="4、dockerfile 拷贝目录下的文件到容器中的直接链接" title="4、dockerfile 拷贝目录下的文件到容器中的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">COPY   dist/   /data/nginx/html</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5nginx容器">5、nginx容器<a href="#5nginx容器" class="hash-link" aria-label="5、nginx容器的直接链接" title="5、nginx容器的直接链接">​</a></h4><p>说明： 部署完成之后需要在/data/nginx/html下放静态文件</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM  alpine:3.14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LABEL </span><span class="token assign-left variable" style="color:#36acaa">maintainer</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;andun&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY repositories /etc/apk/repositories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD nginx-1.19.1.tar.gz /usr/local/src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apk update </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain">  apk </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> tzdata  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /data/nginx/html </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain">  apk --no-cache </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> iotop gcc libgcc libc-dev libcurl libc-utils pcre-dev zlib-dev libnfs </span><span class="token function" style="color:#d73a49">make</span><span class="token plain">  pcre pcre2 </span><span class="token function" style="color:#d73a49">zip</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">unzip</span><span class="token plain"> net-tools pstree </span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> libevent libev </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain">  </span><span class="token builtin class-name">cd</span><span class="token plain"> /usr/local/src/nginx-1.19.1 </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> ./configure --prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/apps/nginx </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> -s /apps/nginx/sbin/nginx  /usr/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN addgroup -g </span><span class="token number" style="color:#36acaa">1001</span><span class="token plain"> -S nginx </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> adduser -s /sbin/nologin -S nginx -D -u </span><span class="token number" style="color:#36acaa">1001</span><span class="token plain"> -G nginx </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN </span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Asia/Shanghai&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/etc/timezone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY nginx.conf /apps/nginx/conf/nginx.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN </span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> -R nginx.nginx /data/nginx/html /apps/nginx/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE  </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV </span><span class="token assign-left variable" style="color:#36acaa">TZ</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Asia/Shanghai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="6容器清除">6、容器清除：<a href="#6容器清除" class="hash-link" aria-label="6、容器清除：的直接链接" title="6、容器清除：的直接链接">​</a></h4><p>清除所有的符合条件的</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@andun-jenkins iandun-system</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># docker rmi --force `docker images | grep harbor.iandun.com/andun-app/tomcat-app-demo | awk &#x27;{print $3}&#x27;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">删除没有名称的镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> rmi </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> images -f </span><span class="token variable string" style="color:#e3116c">&quot;dangling=true&quot;</span><span class="token variable" style="color:#36acaa"> -q</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">根据条件来删除镜像  //其中doss-api为关键字</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> rmi --force </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> images </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> doss-api </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $3}&#x27;</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">删除没有打标签的镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> rmi </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> images -q </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;/^&lt;none&gt;/ { print $3 }&#x27;</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">这是删除容器的命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">ps</span><span class="token variable" style="color:#36acaa"> -a -q</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">删除所有镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> rmi </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> images -q</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>docker prune命令</p><p>删除 所有未被 tag 标记和未被容器使用的镜像：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> image prune</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>删除 所有未被容器使用的镜像：常用</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> image prune -a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>删除 所有停止运行的容器：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> container prune</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>删除 所有未被挂载的卷：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> volume prune</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>删除 所有网络：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> network prune</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>删除 docker 所有资源：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> system prune</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="7docker配置加速器">7、docker配置加速器<a href="#7docker配置加速器" class="hash-link" aria-label="7、docker配置加速器的直接链接" title="7、docker配置加速器的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#配置加速器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/docker/daemon.json </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token string" style="color:#e3116c">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;https://ee5cxtxe.mirror.aliyuncs.com&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="8docker查看日志">8、docker查看日志<a href="#8docker查看日志" class="hash-link" aria-label="8、docker查看日志的直接链接" title="8、docker查看日志的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> logs --since</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2022-01-26T11:00:00&quot;</span><span class="token plain"> --until </span><span class="token string" style="color:#e3116c">&quot;2022-01-26T11:30:00&quot;</span><span class="token plain">  tomcat-app-demo </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain">file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> logs --since</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2022-01-28T9:35:00&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> logs -f -t --since</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2022-1-17&quot;</span><span class="token plain"> --tail</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain">   cms_v2_demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="9清除none镜像">9、清除none镜像<a href="#9清除none镜像" class="hash-link" aria-label="9、清除none镜像的直接链接" title="9、清除none镜像的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> images  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> none </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{print $3}&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">xargs</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> rmi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain">   --compatibility up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="10配置docker登录harbor">10、配置docker登录harbor<a href="#10配置docker登录harbor" class="hash-link" aria-label="10、配置docker登录harbor的直接链接" title="10、配置docker登录harbor的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@loaclhost ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat /lib/systemd/system/docker.service  | grep ExecStart=/usr/bin/dockerd ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --insecure-registry=harbor.iandun.com</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain">  systemctl  restart </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;172.17.113.105 harbor.iandun.com&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/hosts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="11docker安装二进制安装">11、docker安装<!-- -->[二进制安装]<a href="#11docker安装二进制安装" class="hash-link" aria-label="11docker安装二进制安装的直接链接" title="11docker安装二进制安装的直接链接">​</a></h4><p>centos7.9</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /etc/yum.repos.d/docker.repo </span><span class="token operator" style="color:#393A34">&lt;&lt;-</span><span class="token string" style="color:#e3116c">&#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[docker]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">name=docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">baseurl=https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/7.9/x86_64/stable/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">gpgcheck=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">enable=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain">  docker-ce-20.10.5-3.el7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl  start </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> systemctl  </span><span class="token builtin class-name">enable</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /etc/trojan/cert/ </span><span class="token comment" style="color:#999988;font-style:italic">#放入证书</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/trojan/config.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run --restart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">always -p </span><span class="token number" style="color:#36acaa">443</span><span class="token plain">:443 --net</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">host  --name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">trojan -v /etc/trojan:/etc/trojan -itd  zhanglaiqiang/trojan:3.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#docker-compose安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /etc/docker/daemon.json </span><span class="token operator" style="color:#393A34">&lt;&lt;-</span><span class="token string" style="color:#e3116c">&#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">     {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">       &quot;registry-mirrors&quot;: [&quot;https://ee5cxtxe.mirror.aliyuncs.com&quot;]  </span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain">       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl  start </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> systemctl  </span><span class="token builtin class-name">enable</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -L https://get.daocloud.io/docker/compose/releases/download/1.29.1/docker-compose-</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">uname</span><span class="token variable" style="color:#36acaa"> -s</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">-</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">uname</span><span class="token variable" style="color:#36acaa"> -m</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /usr/local/bin/docker-compose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /usr/local/bin/docker-compose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker二进制安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://download.docker.com/linux/static/stable/x86_64/docker-20.10.9.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@VM-0-14-centos ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># tar xf docker-20.10.9.tgz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@VM-0-14-centos ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cp -r docker/*  /usr/bin/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@VM-0-14-centos ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat /usr/lib/systemd/system/docker.service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Unit</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Description</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Docker Application Container Engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Documentation</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://docs.docker.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">After</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">network-online.target firewalld.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Wants</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">network-online.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">notify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ExecStart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/bin/dockerd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ExecReload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/bin/kill -s HUP </span><span class="token variable" style="color:#36acaa">$MAINPID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">LimitNOFILE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">LimitNPROC</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">TimeoutStartSec</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Delegate</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">KillMode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Restart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">on-failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">StartLimitBurst</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">StartLimitInterval</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Install</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">WantedBy</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">multi-user.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ubuntu安装</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#添加GPG key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -fsSL https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu/gpg </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> apt-key </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#验证指纹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> apt-key fingerprint 0EBFCD88</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#添加docker-ce的仓库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> add-apt-repository </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">   </span><span class="token string variable" style="color:#36acaa">$(</span><span class="token string variable" style="color:#36acaa">lsb_release -cs</span><span class="token string variable" style="color:#36acaa">)</span><span class="token string" style="color:#e3116c"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">   stable&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#查看可以安装的版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-cache</span><span class="token plain"> madison </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> docker-ce</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token plain">:20.10.10~3-0~ubuntu-focal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="相关命令安装">相关命令安装<a href="#相关命令安装" class="hash-link" aria-label="相关命令安装的直接链接" title="相关命令安装的直接链接">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> 命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">install</span><span class="token plain">  procps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Debian/Ubuntu/centos  安装ping命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> update </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> inetutils-ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> iputils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Debian/Ubuntu安装telnet命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> net-tools</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Debian GNU/Linux8 </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tee</span><span class="token plain">  /etc/apt/sources.list </span><span class="token operator" style="color:#393A34">&lt;&lt;-</span><span class="token string" style="color:#e3116c">&#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian/ jessie main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian/ jessie-proposed-updates main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian/ jessie main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian/ jessie-proposed-updates main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Debian GNU/Linux9</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tee</span><span class="token plain">  /etc/apt/sources.list </span><span class="token operator" style="color:#393A34">&lt;&lt;-</span><span class="token string" style="color:#e3116c">&#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian/ stretch main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian/ stretch main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian-security stretch/updates main</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian-security stretch/updates main</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian/ stretch-updates main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian/ stretch-updates main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#deb http://mirrors.aliyun.com/debian/ stretch-backports main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">#deb-src http://mirrors.aliyun.com/debian/ stretch-backports main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Debian GNU/Linux11</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tee</span><span class="token plain">  /etc/apt/sources.list </span><span class="token operator" style="color:#393A34">&lt;&lt;-</span><span class="token string" style="color:#e3116c">&#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian/ bullseye main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian/ bullseye main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian-security/ bullseye-security main</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian-security/ bullseye-security main</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian/ bullseye-updates main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian/ bullseye-updates main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian/ bullseye-backports main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian/ bullseye-backports main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Debian GNU/Linux10 </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tee</span><span class="token plain">  /etc/apt/sources.list </span><span class="token operator" style="color:#393A34">&lt;&lt;-</span><span class="token string" style="color:#e3116c">&#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian/ buster main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian/ buster main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian-security buster/updates main</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian-security buster/updates main</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian/ buster-updates main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">deb-src http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="12docker重载配置文件不重启容器">12、docker重载配置文件，不重启容器<a href="#12docker重载配置文件不重启容器" class="hash-link" aria-label="12、docker重载配置文件，不重启容器的直接链接" title="12、docker重载配置文件，不重启容器的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 方式1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># vim /etc/docker/daemon.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;insecure-registries&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;k8s.gcr.com&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;live-restore&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># systemctl reload docker # SIGHUP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#方式2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#dockerd reload 配置(不会重启 dockerd，直接修改配置)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> -SIGHUP </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">pidof dockerd</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 给 dockerd 发送 SIGHUP 信号，dockerd 收到信号后会 reload 配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> info </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -i 配置过滤关键字</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="13docker重载">13、docker重载<a href="#13docker重载" class="hash-link" aria-label="13、docker重载的直接链接" title="13、docker重载的直接链接">​</a></h4><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_5001693abb69be42c4c38cd464a02295_r.png" class="img_ev3q"></p><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_4c3f65f1b117c2cbc9f0e0bd0e763565_r.png" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="14docker-compose更新配置">14、docker-compose更新配置<a href="#14docker-compose更新配置" class="hash-link" aria-label="14、docker-compose更新配置的直接链接" title="14、docker-compose更新配置的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker-compose</span><span class="token plain">  up -d </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="15docker查看日志范围">15、Docker查看日志范围<a href="#15docker查看日志范围" class="hash-link" aria-label="15、Docker查看日志范围的直接链接" title="15、Docker查看日志范围的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tomcat-app-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> logs --since</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2022-01-26T11:00:00&quot;</span><span class="token plain"> --until </span><span class="token string" style="color:#e3116c">&quot;2022-01-26T11:30:00&quot;</span><span class="token plain">  tomcat-app-demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="16国外机器镜像同步脚本">16、国外机器镜像同步脚本<a href="#16国外机器镜像同步脚本" class="hash-link" aria-label="16、国外机器镜像同步脚本的直接链接" title="16、国外机器镜像同步脚本的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> login --username</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">zlq180*******@126.com registry.cn-hangzhou.aliyuncs.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@pro-zlq ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat image_download.sh </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull </span><span class="token variable" style="color:#36acaa">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">COLOR</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;echo -e \E[01;34m&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">null_dir</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;/dev/null&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">END</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;\E[0m&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">image</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">project_name</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable builtin class-name" style="color:#36acaa">echo</span><span class="token variable" style="color:#36acaa"> $image </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $NF}&#x27;</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">image_new</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;registry.cn-hangzhou.aliyuncs.com/zlq_registry/</span><span class="token string variable" style="color:#36acaa">${project_name}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull </span><span class="token variable" style="color:#36acaa">$1</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> tag </span><span class="token variable" style="color:#36acaa">$1</span><span class="token plain">  </span><span class="token variable" style="color:#36acaa">${image_new}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> rmi -f </span><span class="token variable" style="color:#36acaa">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> push </span><span class="token variable" style="color:#36acaa">$image_new</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$COLOR</span><span class="token string" style="color:#e3116c">&quot;image_new:&quot;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$image_new</span><span class="token plain">  </span><span class="token variable" style="color:#36acaa">$END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> rmi -f  </span><span class="token variable" style="color:#36acaa">$image_new</span><span class="token plain">   </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$null_dir</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="17个人镜像仓库秘钥">17、个人镜像仓库秘钥<a href="#17个人镜像仓库秘钥" class="hash-link" aria-label="17、个人镜像仓库秘钥的直接链接" title="17、个人镜像仓库秘钥的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;auths&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;https://index.docker.io/v1/&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token string" style="color:#e3116c">&quot;auth&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emhhbmdsYWlxaWFuZzp6bHExODAyOTA5OTkw&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;registry.cn-beijing.aliyuncs.com&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token string" style="color:#e3116c">&quot;auth&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eXVueGlhby1yYW5jaGVyOmFlZ2lzLXBhYXM=&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;registry.cn-shanghai.aliyuncs.com&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token string" style="color:#e3116c">&quot;auth&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;eXVueGlhby1yYW5jaGVyOmFlZ2lzLXBhYXM=&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;HttpHeaders&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;User-Agent&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Docker-Client/19.03.9 (linux)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="18在容器中修改时间">18、在容器中修改时间<a href="#18在容器中修改时间" class="hash-link" aria-label="18、在容器中修改时间的直接链接" title="18、在容器中修改时间的直接链接">​</a></h4><p>添加环境变量 /etc/profile</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">LD_PRELOAD</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/lib/faketime/libfaketime.so.1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">FAKETIME</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;2022-08-01 09:09:09&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">FAKETIME_DONT_FAKE_MONOTONIC</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>参考 <a href="https://blog.csdn.net/a910196454/article/details/108501685" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/a910196454/article/details/108501685</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="7python">7、Python<a href="#7python" class="hash-link" aria-label="7、Python的直接链接" title="7、Python的直接链接">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1常规方式">1、常规方式<a href="#1常规方式" class="hash-link" aria-label="1、常规方式的直接链接" title="1、常规方式的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">linux二进制下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://www.python.org/downloads/source/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain">  </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> gcc zlib-devel openssl-devel bzip2-devel ncurses-devel gdbm-devel readline-devel sqlite-devel libffi-devel libpcap-devel libdbi-dev tk-devel xz-devel sysstat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/python3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2方式2">2、方式2<a href="#2方式2" class="hash-link" aria-label="2、方式2的直接链接" title="2、方式2的直接链接">​</a></h4><p>下载文件包</p><p>wget <a href="https://www.python.org/ftp/python/3.7.13/Python-3.7.13.tgz" target="_blank" rel="noopener noreferrer">https://www.python.org/ftp/python/3.7.13/Python-3.7.13.tgz</a>
tar xf Python-3.7.13.tgz    /usr/local/</p><p>安装依赖</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel gcc g++ </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /usr/local/Python-3.7.13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure  --prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/python3.7/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>环境变量</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@beijing-k8s-master-001 Python-3.7.13</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat ~/.bash_profile </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># .bash_profile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Get the aliases and functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> -f ~/.bashrc </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin class-name">.</span><span class="token plain"> ~/.bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># User specific environment and startup programs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token builtin class-name">:</span><span class="token environment constant" style="color:#36acaa">$HOME</span><span class="token plain">/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token builtin class-name">:</span><span class="token environment constant" style="color:#36acaa">$HOME</span><span class="token plain">/bin:/usr/local/python3.7/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">PATH</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>[root@beijing-k8s-master-001 Python-3.7.13]<!-- --># source  ~/.bash_profile </p><p>通过yum安装</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#### pip3版本检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@beijing-k8s-master-001 Python-3.7.13</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># pip3.7  -V</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip </span><span class="token number" style="color:#36acaa">22.0</span><span class="token plain">.4 from /usr/local/python3.7/lib/python3.7/site-packages/pip </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">python </span><span class="token number" style="color:#36acaa">3.7</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>第三方pip单独安装参考方式 ####此处默认不需要操作</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">1</span><span class="token plain">、安装pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">命令如下：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> --no-check-certificate  https://pypi.python.org/packages/source/p/pip/pip-8.0.2.tar.gz</span><span class="token comment" style="color:#999988;font-style:italic">#md5=3a73c4188f8dbad6a1e6f6d44d117eeb</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> -zxvf pip-8.0.2.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> pip-8.0.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 setup.py build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 setup.py </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">如果没有意外的话，pip安装完成。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">如果没有搞好环境的话，会碰见亲切的报错：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">　　pip3 </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> paramiko</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">　　报这个错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">　　pip is configured with locations that require TLS/SSL, however the ssl module </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> Python is not available.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">　　然后开始进行如下操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">　　yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">　　yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> openssl-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">　　</span><span class="token builtin class-name">cd</span><span class="token plain"> python3.6.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">　　</span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3包导入导出">3、包导入导出<a href="#3包导入导出" class="hash-link" aria-label="3、包导入导出的直接链接" title="3、包导入导出的直接链接">​</a></h4><ol><li>查看当前环境的所有包
pip list 或 pip freeze</li><li>将当前环境的所有包存入文件中
pip freeze &gt; requirements.txt</li><li>安装文件里的包
pip install -r requirements.txt</li><li>生产python Dockerfile</li></ol><p>Dockerfile-base ##基础镜像</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM  python:3.8.15-bullseye</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV   requirements requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV   proxy pypi.douban.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD  ./</span><span class="token variable" style="color:#36acaa">$requirements</span><span class="token plain">  /opt/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN  pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain">   --index  https://</span><span class="token variable" style="color:#36acaa">$proxy</span><span class="token plain">/simple/  --trusted-host  </span><span class="token variable" style="color:#36acaa">$proxy</span><span class="token plain"> -r /opt/</span><span class="token variable" style="color:#36acaa">$requirements</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Dockerfile  ##业务镜像</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM  harbor.iandun.com/pro_algorithm/base_department_classify:v1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /opt/project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD   </span><span class="token variable" style="color:#36acaa">${build_file}</span><span class="token plain">   /opt/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE  </span><span class="token variable" style="color:#36acaa">${project_port}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR  /opt/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;python3.8&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;-u&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;main.py&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#如果有print打印，会影响日志输出，需要加-u</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="8git相关">8、git相关<a href="#8git相关" class="hash-link" aria-label="8、git相关的直接链接" title="8、git相关的直接链接">​</a></h2><p>拉取指定分支</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone -b develop XXX </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_4c0962eb6c3565bd8dfe8464b9140a99_r.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="9跨域问题">9、跨域问题<a href="#9跨域问题" class="hash-link" aria-label="9、跨域问题的直接链接" title="9、跨域问题的直接链接">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1错误告警">1、错误告警<a href="#1错误告警" class="hash-link" aria-label="1、错误告警的直接链接" title="1、错误告警的直接链接">​</a></h4><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_a92a812c3871ad10e83ad752cdf808d3_r.png" class="img_ev3q">
说明：此图在桌面文件架构图当中 </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2跨域的配置">2、跨域的配置<a href="#2跨域的配置" class="hash-link" aria-label="2、跨域的配置的直接链接" title="2、跨域的配置的直接链接">​</a></h4><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_3dd396d1379a4448c5aba339669e8cd8_r.png" class="img_ev3q"></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">location / </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  add_header Access-Control-Allow-Origin *</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>请求后端正常返回的接口</p><p>方式1验证： 通过slb代理访问
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_e4d80ec8fdc5ee934d985ee974768fdc_r.png" class="img_ev3q"></p><p>方式2验证： 通过直接访问代理端的机器
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_229024d09585bd38489db35df1799e00_r.png" class="img_ev3q"></p><p>以上验证结构都是一致的。</p><p>十二、 Xshell</p><p>ctrl + Tab  tab全屏之间的切换</p><p>alt +  enter    全屏</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="10skywalking">10、Skywalking<a href="#10skywalking" class="hash-link" aria-label="10、Skywalking的直接链接" title="10、Skywalking的直接链接">​</a></h2><p>skywalking自动启动</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#skywalking启动脚本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">andun_devops@andun-jenkins config</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain">   /home/andun_devops/skywalking/skywalking_restart.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/bin/bash </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#停止skywalking服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -ef </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/data/skywalking/apache-skywalking-apm-bin-es7/oap-libs/zstd-jni-1.4.3-1.jar&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> java </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{print $2}&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">xargs</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> -9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#启动skywalking服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> /data/skywalking/apache-skywalking-apm-bin-es7/bin/startup.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>skywalking配置文件： </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    recordDataTTL: </span><span class="token variable" style="color:#36acaa">${SW_CORE_RECORD_DATA_TTL</span><span class="token variable operator" style="color:#393A34">:</span><span class="token variable" style="color:#36acaa">4}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Unit is day</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metricsDataTTL: </span><span class="token variable" style="color:#36acaa">${SW_CORE_METRICS_DATA_TTL</span><span class="token variable operator" style="color:#393A34">:</span><span class="token variable" style="color:#36acaa">4}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Unit is day</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>es自动清理  创建andun_devops管理账号，授权数据目录账号为andun_devops账号，以及/data/skywalking目录属性s</p><p>es自动清理重启</p><p>0 3 <em>/4 </em> * bash   /home/andun_devops/skywalking/skywalking_restart.sh  &gt;/dev/null 2&gt;&amp;1</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">andun_devops@andun-ELK skywalking_elsticsearch</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain">  /home/andun_devops/skywalking_elsticsearch/elasticsearch_restart.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#***********************************************</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#company:        Andun</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#维护者Mail:    zhanglaiqiang@iandun.cn</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Date:          2022-03-30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#FileName:      elasticsearch_restart.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Description:   The test script</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#***********************************************</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#停止进程</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -ef </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;home=/data/skywalking/elasticsearch-7.2.0&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> java  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{print $2}&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">xargs</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> -9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> /share/elasticsearch_data/  </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> -rf nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#启动进程</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> /data/skywalking/elasticsearch-7.2.0/bin/elasticsearch -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="11tcpdump">11、tcpdump<a href="#11tcpdump" class="hash-link" aria-label="11、tcpdump的直接链接" title="11、tcpdump的直接链接">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="常用方法">常用方法<a href="#常用方法" class="hash-link" aria-label="常用方法的直接链接" title="常用方法的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain">  tcpdump  -i eth0 -vnn </span><span class="token function" style="color:#d73a49">host</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">117.133</span><span class="token plain">.17.238  and   port </span><span class="token number" style="color:#36acaa">50060</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>一般在做排错的时候会用到抓包工具，比如在动态感知收不到日志的时候，可以抓包看下数据有没有
正常发送到服务器，也可用于网络排错。</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tcpdump -i eht0 -nn src </span><span class="token number" style="color:#36acaa">10.0</span><span class="token plain">.8.1 and dst </span><span class="token number" style="color:#36acaa">10.8</span><span class="token plain">.0.1  and dst port </span><span class="token number" style="color:#36acaa">1124</span><span class="token plain"> and udp -w test.cap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-i 指定 指定抓包网卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-nn 不把主机的网络地址与协议转换成名字</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-w 把数据包数据写入到文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and  连接参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> 指明主机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port 指明端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">src  源地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dst  目标IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net  指明网段</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dst port 目标端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">!</span><span class="token plain"> 非，需要加空格</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">icmp  arp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">比较实用的一种方式</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_424f48244928babdd25893b400829a9e_r.png" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tcpdump介绍">tcpdump介绍<a href="#tcpdump介绍" class="hash-link" aria-label="tcpdump介绍的直接链接" title="tcpdump介绍的直接链接">​</a></h4><p>tcpdump 是一款强大的网络抓包工具，运行在 linux 平台上。熟悉 tcpdump 的使用能够帮助你分析、调试网络数据。
tcpdump语法
tcpdump <!-- -->[-adeflnNOpqStvx][-c&lt;数据包数目&gt;]<!-- -->[-dd][-ddd]<!-- -->[-F&lt;表达文件&gt;][-i&lt;网络界面&gt;]<!-- -->[-r&lt;数据包文件&gt;][-s&lt;数据包大小&gt;]<!-- -->[-tt][-T&lt;数据包类型&gt;]<!-- -->[-vv][-w&lt;数据包文件&gt;]<!-- -->[输出数据栏位]<!-- -->
tcpdump参数</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-a    将网络地址和广播地址转变成名字；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-d    将匹配信息包的代码以人们能够理解的汇编格式给出；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-dd    将匹配信息包的代码以c语言程序段的格式给出；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-ddd   将匹配信息包的代码以十进制的形式给出；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-e    在输出行打印出数据链路层的头部信息，包括源mac和目的mac，以及网络层的协议；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-f    将外部的Internet地址以数字的形式打印出来；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-l    使标准输出变为缓冲行形式；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-n    指定将每个监听到数据包中的域名转换成IP地址后显示，不把网络地址转换成名字；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-nn：   指定将每个监听到的数据包中的域名转换成IP、端口从应用名称转换成端口号后显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-t    在输出的每一行不打印时间戳；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-v    输出一个稍微详细的信息，例如在ip包中可以包括ttl和服务类型的信息；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-vv    输出详细的报文信息；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-c    在收到指定的包的数目后，tcpdump就会停止；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-F    从指定的文件中读取表达式,忽略其它的表达式；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-i    指定监听的网络接口；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p：    将网卡设置为非混杂模式，不能与host或broadcast一起使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-r    从指定的文件中读取包</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">这些包一般通过-w选项产生</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-w    直接将包写入文件中，并不分析和打印出来；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-s snaplen snaplen表示从一个包中截取的字节数。0表示包不截断，抓完整的数据包。默认的话 tcpdump 只显示部分数据包,默认68字节。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-T    将监听到的包直接解释为指定的类型的报文，常见的类型有rpc （远程过程调用）和snmp（简单网络管理协议；）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-X      告诉tcpdump命令，需要把协议头和包内容都原原本本的显示出来（tcpdump会以16进制和ASCII的形式显示），这在进行协议分析时是绝对的利器。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>监听所有端口，直接显示 ip 地址</p><blockquote><p>tcpdump -nS
显示更详细的数据报文，包括 tos, ttl, checksum 等。
tcpdump -nnvvS
显示数据报的全部数据信息，用 hex 和 ascii 两列对比输出。
tcpdump -nnvvXS
host: 过滤某个主机的数据报文
tcpdump host 1.2.3.4
src, dst: 过滤源地址和目的地址
tcpdump src 1.2.3.4
tcpdump dst 1.2.3.4
net: 过滤某个网段的数据
tcpdump net 1.2.3.0/24
过滤某个协议的数据，支持 tcp, udp 和 icmp
tcpdump icmp
过滤通过某个端口的数据报
tcpdump port 3306
src/dst, port, protocol: 结合三者
tcpdump src port 22 and tcp
tcpdump udp and src port 25
抓取指定范围的端口
tcpdump portrange 21-23
通过报文大小过滤请求,数据报大小，单位是字节
tcpdump less 32
tcpdump greater 128
tcpdump &gt; 32
tcpdump &lt;= 128
抓包输出到文件
tcpdump -w rumenz.pcap port 80
从文件读取报文显示到屏幕
tcpdump -nXr rumenz.pcap host web
源地址是 192.168.1.110，目的端口是3306的数据报
tcpdump -nnvS src 192.168.1.110 and dst port 3306
从 192.168 网段到 10 或者 172.31 网段的数据报
tcpdump -nvX src net 192.168.0.0/16 and dat net 10.0.0.0/8 or 172.31.0.0/16
tcpdump 的输出解读
21:27:06.995846 IP (tos 0x0, ttl 64, id 45646, offset 0, flags <!-- -->[DF]<!-- -->, proto TCP (6), length 64)
192.168.1.110.40411 &gt; 192.168.1.123.80: Flags <!-- -->[S]<!-- -->, cksum 0xa730 (correct), seq 992042666, win 65535, options <!-- -->[mss 1460,nop,wscale 4,nop,nop,TS val 663433143 ecr 0,sackOK,eol]<!-- -->, length 0</p></blockquote><p>21:27:07.030487 IP (tos 0x0, ttl 51, id 0, offset 0, flags <!-- -->[DF]<!-- -->, proto TCP (6), length 44)
192.168.1.123.80 &gt; 192.168.1.110.40411: Flags <!-- -->[S.]<!-- -->, cksum 0xedc0 (correct), seq 2147006684, ack 992042667, win 14600, options <!-- -->[mss 1440]<!-- -->, length 0</p><p>21:27:07.030527 IP (tos 0x0, ttl 64, id 59119, offset 0, flags <!-- -->[DF]<!-- -->, proto TCP (6), length 40)
192.168.1.110.40411 &gt; 192.168.1.123.80: Flags <!-- -->[.]<!-- -->, cksum 0x3e72 (correct), ack 2147006685, win 65535, length 0
最基本也是最重要的信息就是数据报的源地址/端口和目的地址/端口，上面的例子第一条数据报中，源地址 ip 是192.168.1.110，源端口是 40411，目的地址是 192.168.1.123，目的端口是 80。&gt; 符号代表数据的方向。
上面的三条数据还是 tcp 协议的三次握手过程,第一条就是 SYN 报文，这个可以通过 Flags <!-- -->[S]<!-- --> 看出。下面是常见的 TCP 报文的 Flags:
<!-- -->[S]<!-- -->：SYN（开始连接）
<!-- -->[.]<!-- -->: 没有 Flag</p><p>[F]<!-- -->: FIN （结束连接）</p><p>而第二条数据的 <!-- -->[S.]<!-- --> 表示 SYN-ACK，就是 SYN 报文的应答报文。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="12端口扫描">12、端口扫描<a href="#12端口扫描" class="hash-link" aria-label="12、端口扫描的直接链接" title="12、端口扫描的直接链接">​</a></h2><p>端口扫描</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">cat</span><span class="token variable" style="color:#36acaa"> port_host.txt</span><span class="token variable" style="color:#36acaa">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;##############主机</span><span class="token string variable" style="color:#36acaa">$i</span><span class="token string" style="color:#e3116c">端口扫描结果##############&quot;</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> result.txt </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> nmap -sS  -Pn -n --open -T4  </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain">  -p  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">-65535  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tail</span><span class="token plain"> -n +6 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$d&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$d&#x27;</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> result.txt </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>根据服务端口按照服务类型统计: java和docker </p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@watch-server05 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> port.sh </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#/bin/bash </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">COLOR</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;echo -e \E[01;32m&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">END</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;\E[0m&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CLORED</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;echo -e \E[1;31m&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">cat</span><span class="token variable" style="color:#36acaa"> port.txt  </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&quot;/&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $1}&#x27;</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#for i  in `cat port.txt`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token assign-left variable" style="color:#36acaa">pidtype</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">sudo</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">netstat</span><span class="token variable" style="color:#36acaa"> -ntlp </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">grep</span><span class="token variable" style="color:#36acaa"> -w  $i </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">tail</span><span class="token variable" style="color:#36acaa"> -n  </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa">  -F </span><span class="token variable string" style="color:#e3116c">&quot;LISTEN&quot;</span><span class="token variable" style="color:#36acaa">  </span><span class="token variable string" style="color:#e3116c">&#x27;{print $NF}&#x27;</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token assign-left variable" style="color:#36acaa">pid_num</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable builtin class-name" style="color:#36acaa">echo</span><span class="token variable" style="color:#36acaa"> $</span><span class="token variable punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">pidtype</span><span class="token variable punctuation" style="color:#393A34">}</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&quot;/&quot;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $1}&#x27;</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token variable" style="color:#36acaa">$COLOR</span><span class="token comment" style="color:#999988;font-style:italic">############&quot;端口$i详情&quot;##############$END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token builtin class-name">echo</span><span class="token plain"> 端口</span><span class="token variable" style="color:#36acaa">${i}</span><span class="token plain">进程号: </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable builtin class-name" style="color:#36acaa">echo</span><span class="token variable" style="color:#36acaa"> $</span><span class="token variable punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">pid_num</span><span class="token variable punctuation" style="color:#393A34">}</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${pidtype}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=~</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;java&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;项目类型: JAVA&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;详细信息如下: --------------------------&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -ef </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -w </span><span class="token variable" style="color:#36acaa">${pid_num}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -v </span><span class="token string" style="color:#e3116c">&#x27;grep&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${pidtype}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=~</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;docker&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;项目类型: Docker&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;详细信息如下: --------------------------&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${pid_num}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;-&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token variable" style="color:#36acaa">$CLORED</span><span class="token plain">*****进程号不存在*****</span><span class="token variable" style="color:#36acaa">$END</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;项目类型: Unknow&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> -z  </span><span class="token variable" style="color:#36acaa">${pidtype}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token variable" style="color:#36acaa">$CLORED</span><span class="token plain">*****端口不存在*****</span><span class="token variable" style="color:#36acaa">$END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;项目类型: Unknow&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;项目类型: Unknow&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;详细信息如下: --------------------------&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             </span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -ef </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -w  </span><span class="token variable" style="color:#36acaa">${pid_num}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> -v </span><span class="token string" style="color:#e3116c">&#x27;grep&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token variable" style="color:#36acaa">$COLOR</span><span class="token comment" style="color:#999988;font-style:italic">####################################$END</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>端口列表</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@watch-server05 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> port.txt </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">4089</span><span class="token plain">/tcp  </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  opencore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7082</span><span class="token plain">/tcp  </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8582</span><span class="token plain">/tcp  </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">9044</span><span class="token plain">/tcp  </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">9100</span><span class="token plain">/tcp  </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  jetdirect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">9609</span><span class="token plain">/tcp  </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">9680</span><span class="token plain">/tcp  </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">10489</span><span class="token plain">/tcp </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">20888</span><span class="token plain">/tcp </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">22225</span><span class="token plain">/tcp </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">22227</span><span class="token plain">/tcp </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">33312</span><span class="token plain">/tcp </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">40070</span><span class="token plain">/tcp </span><span class="token function" style="color:#d73a49">open</span><span class="token plain">  unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@watch-server05 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行  bash  port.sh</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="13debian相关">13、Debian相关<a href="#13debian相关" class="hash-link" aria-label="13、Debian相关的直接链接" title="13、Debian相关的直接链接">​</a></h2><p>debian安装命令</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> ---  iproute2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ping</span><span class="token plain"> --- iputils-ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">telnet --- telnet</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>数据库查询时间不能超过10s</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="14进程和相关命令">14、进程和相关命令<a href="#14进程和相关命令" class="hash-link" aria-label="14、进程和相关命令的直接链接" title="14、进程和相关命令的直接链接">​</a></h2><p>pid_max，ulimit -u和thread_max区别</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="典型的区别在于">典型的区别在于:<a href="#典型的区别在于" class="hash-link" aria-label="典型的区别在于:的直接链接" title="典型的区别在于:的直接链接">​</a></h4><ul><li>同一进程的线程共享内存空间。</li><li>而进程则在不同的内存空间中运行</li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="pid_max">pid_max<a href="#pid_max" class="hash-link" aria-label="pid_max的直接链接" title="pid_max的直接链接">​</a></h5><p>cat /proc/sys/kernel/pid_max
32768</p><p>所以上面的命令返回32768，这意味着我可以在我的系统中同时执行32768个进程，这些进程可以在不同的内存空间中运行。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="threads-max">threads-max<a href="#threads-max" class="hash-link" aria-label="threads-max的直接链接" title="threads-max的直接链接">​</a></h5><p>cat /proc/sys/kernel/threads-max
126406</p><p>上面的命令将输出返回为126406，这意味着我可以在共享内存空间中拥有126406个线程。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="ulimit--u">ulimit -u<a href="#ulimit--u" class="hash-link" aria-label="ulimit -u的直接链接" title="ulimit -u的直接链接">​</a></h5><p>ulimit -u
63203</p><p>现在，让我们使用第三个参数ulimit -u，它表示用户在特定时间可以拥有的总进程数。上面的命令将输出返回为63203。这意味着用户可以在某个时间点创建的所有进程都可以运行63203进程。</p><p>假设案例
假设2个用户同时运行2个进程，并且每个进程大量消耗内存，则这2个用户中的进程将有效地使用63203个线程（进程的限制）。因此，这种情况，那么2个用户将有效地用完整个 126406（threads-max）的大小。</p><p>现在，我需要确定用户可以在任何时间点运行的进程数。这可以从文件/etc/security/limits.conf中确定。因此，此文件中基本上有2个设置，如下所述。</p><p>软限制类似于警告，硬限制是实际最大限制。例如，以下内容将阻止学生组中的任何人拥有超过50个进程，并且将在30个进程中发出警告。</p><p>@student        hard    nproc           50
@student        soft    nproc           30</p><p>内核维护硬限制，而shell强制执行软限制。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="142-socks5网络代理">14.2 Socks5网络代理<a href="#142-socks5网络代理" class="hash-link" aria-label="14.2 Socks5网络代理的直接链接" title="14.2 Socks5网络代理的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="1首先编译安装ss5需要先安装一些依赖组件">1、首先，编译安装SS5需要先安装一些依赖组件<a href="#1首先编译安装ss5需要先安装一些依赖组件" class="hash-link" aria-label="1、首先，编译安装SS5需要先安装一些依赖组件的直接链接" title="1、首先，编译安装SS5需要先安装一些依赖组件的直接链接">​</a></h5><p>yum -y install gcc gcc-c++ automake make pam-devel openldap-devel cyrus-sasl-devel openssl-devel</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2去官网httpss5sourceforgenet-下载ss5最新版本的源代码">2、去官网<a href="http://ss5.sourceforge.net/" target="_blank" rel="noopener noreferrer">http://ss5.sourceforge.net/</a> 下载SS5最新版本的源代码<a href="#2去官网httpss5sourceforgenet-下载ss5最新版本的源代码" class="hash-link" aria-label="2去官网httpss5sourceforgenet-下载ss5最新版本的源代码的直接链接" title="2去官网httpss5sourceforgenet-下载ss5最新版本的源代码的直接链接">​</a></h5><p>　 wget <a href="https://sourceforge.net/projects/ss5/files/ss5/3.8.9-8/ss5-3.8.9-8.tar.gz" target="_blank" rel="noopener noreferrer">https://sourceforge.net/projects/ss5/files/ss5/3.8.9-8/ss5-3.8.9-8.tar.gz</a></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="3解压后开始编译安装">3、解压后开始编译安装：<a href="#3解压后开始编译安装" class="hash-link" aria-label="3、解压后开始编译安装：的直接链接" title="3、解压后开始编译安装：的直接链接">​</a></h5><p>tar zxvf ./ss5-3.8.9-8.tar.gz
cd ss5-3.8.9
./configure
make
make install</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="4让ss5随系统一起启动">4、让SS5随系统一起启动<a href="#4让ss5随系统一起启动" class="hash-link" aria-label="4、让SS5随系统一起启动的直接链接" title="4、让SS5随系统一起启动的直接链接">​</a></h5><p>chmod +x /etc/init.d/ss5
chkconfig --add ss5
chkconfig --level 345 ss5 on</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="5在ss5conf中找到auth和permit两行按照下面的格式进行修改">5、在ss5.conf中找到auth和permit两行，按照下面的格式进行修改<a href="#5在ss5conf中找到auth和permit两行按照下面的格式进行修改" class="hash-link" aria-label="5、在ss5.conf中找到auth和permit两行，按照下面的格式进行修改的直接链接" title="5、在ss5.conf中找到auth和permit两行，按照下面的格式进行修改的直接链接">​</a></h5><p>/etc/opt/ss5/ss5.conf
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_2ca182f7c916d490a1c1e09b1cc7e3a7_r.png" class="img_ev3q"></p><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_43952c46bbdf982da5460dd2a97fc598_r.png" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="6ss5-默认使用1080端口并允许任何人使用如果要修改默认端口请修改-vi-etcsysconfigss5">6、ss5 默认使用1080端口，并允许任何人使用，如果要修改默认端口，请修改 vi /etc/sysconfig/ss5<a href="#6ss5-默认使用1080端口并允许任何人使用如果要修改默认端口请修改-vi-etcsysconfigss5" class="hash-link" aria-label="6、ss5 默认使用1080端口，并允许任何人使用，如果要修改默认端口，请修改 vi /etc/sysconfig/ss5的直接链接" title="6、ss5 默认使用1080端口，并允许任何人使用，如果要修改默认端口，请修改 vi /etc/sysconfig/ss5的直接链接">​</a></h5><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">　　在/etc/sysconfig/ss5这个文件中，添加下面这一行命令，-b后面的参数代表监听的ip地址和端口号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">　　</span><span class="token comment" style="color:#999988;font-style:italic"># Add startup option here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">　　</span><span class="token assign-left variable" style="color:#36acaa">SS5_OPTS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot; -u root -b 0.0.0.0:8080&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="7启动ss5">7、启动ss5<a href="#7启动ss5" class="hash-link" aria-label="7、启动ss5的直接链接" title="7、启动ss5的直接链接">​</a></h5><p>service ss5 start</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="8一定要记得配置安全组开放ss5监听的端口">8、一定要记得配置安全组开放SS5监听的端口<a href="#8一定要记得配置安全组开放ss5监听的端口" class="hash-link" aria-label="8、一定要记得配置安全组开放SS5监听的端口的直接链接" title="8、一定要记得配置安全组开放SS5监听的端口的直接链接">​</a></h5><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_46471e1c82506feb1d707d5ef712ca94_r.png" class="img_ev3q"></p><ul><li>a、开启用户名密码验证机制 vi /etc/opt/ss5/ss5.conf</li></ul><p>在ss5.conf中找到auth和permit两行，按照下面的格式进行修改</p><p>auth 0.0.0.0/0 - u
permit u 0.0.0.0/0 - 0.0.0.0/0 - - - - -</p><ul><li>b 、设置用户名和密码 vi /etc/opt/ss5/ss5.passwd
一行一个账号，用户名和密码之间用空格间隔，例如：</li></ul><p>user1 123
user2 234</p><ul><li>c、重启服务生效</li></ul><p>service ss5 restart</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="143-openvpn">14.3 openvpn<a href="#143-openvpn" class="hash-link" aria-label="14.3 openvpn的直接链接" title="14.3 openvpn的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="1压测">1、压测<a href="#1压测" class="hash-link" aria-label="1、压测的直接链接" title="1、压测的直接链接">​</a></h5><p>yum install -y epel-release
yum install stress -y</p><p>$ sudo apt install stress
$ stress --version
<a href="http://t.zoukankan.com/jiftle-p-12904248.html" target="_blank" rel="noopener noreferrer">http://t.zoukankan.com/jiftle-p-12904248.html</a></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="nmap端口扫描">nmap端口扫描<a href="#nmap端口扫描" class="hash-link" aria-label="nmap端口扫描的直接链接" title="nmap端口扫描的直接链接">​</a></h5><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">cat</span><span class="token variable" style="color:#36acaa"> port_host.txt</span><span class="token variable" style="color:#36acaa">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;##############主机</span><span class="token string variable" style="color:#36acaa">$i</span><span class="token string" style="color:#e3116c">端口扫描结果##############&quot;</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> result.txt </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> nmap -sS  -Pn -n --open -T4  </span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain">  -p  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">-65535  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tail</span><span class="token plain"> -n +6 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$d&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$d&#x27;</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> result.txt </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2openvpn">2、openvpn<a href="#2openvpn" class="hash-link" aria-label="2、openvpn的直接链接" title="2、openvpn的直接链接">​</a></h5><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@beijing-k8s-master-001 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cd /etc/openvpn/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@beijing-k8s-master-001 openvpn</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># ls -l </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x--- </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> root openvpn  </span><span class="token number" style="color:#36acaa">92</span><span class="token plain"> Mar </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> 06:36 client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root    </span><span class="token number" style="color:#36acaa">522</span><span class="token plain"> Mar </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> 06:12 client.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-x--- </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> root openvpn   </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> Apr </span><span class="token number" style="color:#36acaa">21</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@beijing-k8s-master-001 openvpn</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># tree </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── andun.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── andun.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── ca.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── client.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── clinet.ovpn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── client.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@beijing-k8s-master-001 openvpn</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat client.conf </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev tun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proto tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote </span><span class="token number" style="color:#36acaa">42.193</span><span class="token plain">.116.59  </span><span class="token number" style="color:#36acaa">1194</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#指定服务器地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resolv-retry infinite</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nobind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persist-key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">persist-tun</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ca /etc/openvpn/client/ca.crt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auth-nocache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cert /etc/openvpn/client/andun.crt  </span><span class="token comment" style="color:#999988;font-style:italic">#此处需要修改为证书名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key /etc/openvpn/client/andun.key   </span><span class="token comment" style="color:#999988;font-style:italic">#此处需要修改为证书名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">remote-cert-tls server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#tls-auth ta.key 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script-security </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#cipher AES-256-CBC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#消除警告</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#route-nopull</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#data-ciphers AES-256-CBC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">verb </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#explicit-exit-notify</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tun-mtu </span><span class="token number" style="color:#36acaa">1500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log-append /var/log/openvpn.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="3vpn_client配置">3、vpn_client配置<a href="#3vpn_client配置" class="hash-link" aria-label="3、vpn_client配置的直接链接" title="3、vpn_client配置的直接链接">​</a></h5><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@beijing-k8s-master-001 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat /usr/lib/systemd/system/openvpn-client\@client.service </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Unit</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Description</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">OpenVPN tunnel </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> %I</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">After</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">syslog.target network-online.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Wants</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">network-online.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Documentation</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">man:openvpn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Documentation</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Documentation</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://community.openvpn.net/openvpn/wiki/HOWTO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">Type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">notify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">PrivateTmp</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">WorkingDirectory</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/openvpn/client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ExecStart</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/sbin/openvpn --suppress-timestamps --nobind --config %i.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">CapabilityBoundingSet</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">CAP_IPC_LOCK CAP_NET_ADMIN CAP_NET_RAW CAP_SETGID CAP_SETUID CAP_SYS_CHROOT CAP_DAC_OVERRIDE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">LimitNPROC</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DeviceAllow</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/dev/null rw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DeviceAllow</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/dev/net/tun rw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ProtectSystem</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ProtectHome</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">KillMode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Install</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">WantedBy</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">multi-user.target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>文档远程发送
scp  -P 65266 jmx_prometheus_skywalki_agent.tar.gz  <a href="mailto:zhanglaiqiang@x.x.x.x" target="_blank" rel="noopener noreferrer">zhanglaiqiang@x.x.x.x</a>:</p><p>进程杀死重启tomcat</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -ef</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> tomcat-app </span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> java</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">awk</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;{print $2}&#x27;</span><span class="token operator" style="color:#393A34">|</span><span class="token function" style="color:#d73a49">xargs</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> -9 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> /usr/local/tomcat-app/bin/startup.sh </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tail</span><span class="token plain"> -f /usr/local/tomcat-app/logs/catalina.out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="4openvpn网络问题-影响自动化发布">4、openvpn网络问题-影响自动化发布<a href="#4openvpn网络问题-影响自动化发布" class="hash-link" aria-label="4、openvpn网络问题-影响自动化发布的直接链接" title="4、openvpn网络问题-影响自动化发布的直接链接">​</a></h5><h5 class="anchor anchorWithStickyNavbar_LWe7" id="1测试丢包">1、测试丢包<a href="#1测试丢包" class="hash-link" aria-label="1、测试丢包的直接链接" title="1、测试丢包的直接链接">​</a></h5><p>yum -y install mtr #安装工具</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">zhanglaiqiang@andun-jenkins ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">$ </span><span class="token function" style="color:#d73a49">mtr</span><span class="token plain"> -r  </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">10.8</span><span class="token plain">.0.33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Start: Tue Sep </span><span class="token number" style="color:#36acaa">13</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:11:53 </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HOST: andun-jenkins               Loss%   Snt   Last   Avg  Best  Wrst StDev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">-- </span><span class="token number" style="color:#36acaa">10.8</span><span class="token plain">.0.33                 </span><span class="token number" style="color:#36acaa">50.0</span><span class="token plain">%    </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">10.2</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">9.9</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">9.2</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">10.2</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者 mtr -r -c 30 -s 1024  10.8.0.33
Loss 表示丢包百分比，注意观察此项就行</p><blockquote><p>在服务器中查看网卡ifconfig，明显有两个地址存在,问题就在于此</p></blockquote><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_f622401cba6ef30fca3c19c05b23a63b_r.png" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2处理方式">2、处理方式：<a href="#2处理方式" class="hash-link" aria-label="2、处理方式：的直接链接" title="2、处理方式：的直接链接">​</a></h5><p>1、ps -ef | grep openvpn
杀掉kill -9  openvpn_pid 服务
2、重新启动opevpn客户端即可</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="144-nfs部署">14.4 nfs部署<a href="#144-nfs部署" class="hash-link" aria-label="14.4 nfs部署的直接链接" title="14.4 nfs部署的直接链接">​</a></h4><p>ubuntu安装nfs-server以及nfs-client</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="ubuntu">ubuntu<a href="#ubuntu" class="hash-link" aria-label="ubuntu的直接链接" title="ubuntu的直接链接">​</a></h5><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">https://www.tecmint.com/install-nfs-server-on-ubuntu/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">、install  nfs-server </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> nfs-kernel-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain">、create </span><span class="token function" style="color:#d73a49">dir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /mnt/nfs_share</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3</span><span class="token plain">、 授权</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> -R nobody:nogroup /mnt/nfs_share/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">4</span><span class="token plain">、  授权</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">777</span><span class="token plain"> /mnt/nfs_share/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">5</span><span class="token plain">、 </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/exports</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/mnt/nfs_share  </span><span class="token number" style="color:#36acaa">10.51</span><span class="token plain">.8.0/24</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rw,sync,no_root_squash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">6</span><span class="token plain">、/mnt/nfs_share  </span><span class="token number" style="color:#36acaa">10.51</span><span class="token plain">.8.0/24</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rw,sync,no_root_squash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   rw: Stands </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> Read/Write.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   sync: Requires changes to be written to the disk before they are applied.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   No_subtree_check: Eliminates subtree checking.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    要授予对单个客户端的访问权限，请使用以下语法：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mnt/nfs_share client_IP_1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">re,sync,no_root_squash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    对于多个客户端，在单独的文件中指定每个客户端：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /mnt/nfs_share client_IP_1 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">re,sync,no_root_squash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /mnt/nfs_share client_IP_2 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">re,sync,no_root_squash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">no_root_squash：客户机用root访问该共享文件夹时，不映射root用户。（root_squash：客户机用root用户访问该共享文件夹时，将root用户映射成匿名用户）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">no_subtree_check：不检查父目录的权限。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7</span><span class="token plain">、start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> exportfs -a </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl restart nfs-kernel-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">9</span><span class="token plain">、client安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> nfs-common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /mnt/nfs_clientshare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">mount</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10.51</span><span class="token plain">.8.151:/mnt/nfs_share  /mnt/nfs_clientshare</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="centos">centos<a href="#centos" class="hash-link" aria-label="centos的直接链接" title="centos的直接链接">​</a></h5><p>yum -y install nfs-utils
<!-- -->[zhanglaiqiang@andun-harbor ~]<!-- -->$ cat /etc/fstab
UUID=795c9f31-f638-4308-8fab-4a7d5c606beb /                       ext4    defaults          1 1
172.17.224.119:/share/elasticsearch_data                    /skywalking-sticsearch   nfs  defaults        0 0</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="155-grep常用">15.5 grep常用<a href="#155-grep常用" class="hash-link" aria-label="15.5 grep常用的直接链接" title="15.5 grep常用的直接链接">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="比较两个文件是否相同">比较两个文件是否相同<a href="#比较两个文件是否相同" class="hash-link" aria-label="比较两个文件是否相同的直接链接" title="比较两个文件是否相同的直接链接">​</a></h5><p>1、统计两个文本文件的相同行</p><p>grep -Ff    file1   file2</p><p>2、统计file1中有，file2中没有的行</p><p>grep -vFf  file2 file1</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="156-磁盘挂载">15.6 磁盘挂载<a href="#156-磁盘挂载" class="hash-link" aria-label="15.6 磁盘挂载的直接链接" title="15.6 磁盘挂载的直接链接">​</a></h4><p>问题描述
正式环境出现了不能上传图片，图片不能浏览的问题，上正式环境进行排查，在使用df -h命令的时候卡住不动了，其他命令没问题。运行内存以及cpu都是正常的。
正式环境服务器 /data/xxx/upload的目录是进行了nfs挂载
df -TH
在取消挂载之前找出原挂载方式</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@node01 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># mount -l | grep /data/xxx/upload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.x.10:/data/upload on /data/xxx/upload </span><span class="token builtin class-name">type</span><span class="token plain"> nfs4 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rw,relatime,vers</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4.1</span><span class="token plain">,rsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1048576</span><span class="token plain">,wsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1048576</span><span class="token plain">,namlen</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">255</span><span class="token plain">,hard,proto</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tcp,port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,timeo</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">600</span><span class="token plain">,retrans</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">,sec</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sys,clientaddr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.x.4,local_lock</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">none,addr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.x.10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">或者通过</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@node01 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat /etc/mtab | grep /data/xxx/upload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.x.10:/data/upload /data/xxx/upload nfs4 rw,relatime,vers</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4.1</span><span class="token plain">,rsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1048576</span><span class="token plain">,wsize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1048576</span><span class="token plain">,namlen</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">255</span><span class="token plain">,hard,proto</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tcp,port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">,timeo</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">600</span><span class="token plain">,retrans</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">,sec</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sys,clientaddr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.x.4,local_lock</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">none,addr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.x.10 </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看出服务端与客户端的nfs挂载方式
问题解决
首先可以先跟踪df -h命令在哪里卡住了
使用strace命令</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">strace</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">df</span><span class="token plain"> -h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果服务器没这个命令，进行安装</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strace</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如下，就准确的知道df -h这个命令卡在了哪里，果然确实是nfs挂载的那个目录
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_8679fd475da6b9b889f7cf9dc0108be7_r.png" class="img_ev3q"></p><p>尝试使用umount取消挂载但是会卡住不动
当有别的程序正在访问挂载的文件时，也会提示卸载失败，通过 lsof /xxx 查看是哪个进程占用了/xxx,kill -9 $pid ,然后再卸载，进程少的时候这个方便一些，一旦进程量过大就不方便了
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_83c53144f27734518b5e7c1dda25fb26_r.png" class="img_ev3q">
加参数 -f 也会报错
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_6d4a1a90ae299a0e6f7574b8725ce74b_r.png" class="img_ev3q">
使用【umount -l /data/xxx/upload】命令可以解决挂载问题
使用：umount -l /xxx (-l : 卸载前检查占用该挂载文件的程序并迅速kill掉，以达到快速卸载的目的)
也可以umount -lf /xxx</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@node01 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># umount -l /data/xxx/upload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@node01 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># umount /data/xxx/upload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">umount: /data/xxx/upload: not mounted</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试df -h命令是否恢复正常
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_f517eeb6374fef1ee8de2f59032b0622_r.png" class="img_ev3q"></p><p>重新进行挂载
客户端：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">重启nfs：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop nfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start nfs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>服务器端：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">重启nfs、rpcbind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop nfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop rpcbind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#让nfs生效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exportfs -rv </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start nfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start rpcbind</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="15内存">15、内存<a href="#15内存" class="hash-link" aria-label="15、内存的直接链接" title="15、内存的直接链接">​</a></h2><p>buffer/cache内存占用过高
释放前最好sync
echo 3 &gt; /proc/sys/vm/drop_caches #清除pagecache和slab分配器中的缓存对象。</p><p><a href="https://developer.aliyun.com/article/749727?spm=5176.2020520104.0.0.12d3709aIw40I4" target="_blank" rel="noopener noreferrer">https://developer.aliyun.com/article/749727?spm=5176.2020520104.0.0.12d3709aIw40I4</a></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /proc/sys/vm/drop_caches </span><span class="token comment" style="color:#999988;font-style:italic">#清除pagecache。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /proc/sys/vm/drop_caches </span><span class="token comment" style="color:#999988;font-style:italic">#清除回收slab分配器中的对象（包括目录项缓存和inode缓存）。slab分配器是内核中管理内存的一种机制，其中很多缓存数据实现都是用的pagecache。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /proc/sys/vm/drop_caches </span><span class="token comment" style="color:#999988;font-style:italic">#清除pagecache和slab分配器中的缓存对象。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="16windows常用操作">16、Windows常用操作<a href="#16windows常用操作" class="hash-link" aria-label="16、Windows常用操作的直接链接" title="16、Windows常用操作的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="161-常用工具安装">16.1 常用工具安装<a href="#161-常用工具安装" class="hash-link" aria-label="16.1 常用工具安装的直接链接" title="16.1 常用工具安装的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1windows-中md5校验工具">1、windows 中md5校验工具<a href="#1windows-中md5校验工具" class="hash-link" aria-label="1、windows 中md5校验工具的直接链接" title="1、windows 中md5校验工具的直接链接">​</a></h4><p><a href="https://github.com/gurnec/HashCheck/releases/tag/v2.4.0" target="_blank" rel="noopener noreferrer">https://github.com/gurnec/HashCheck/releases/tag/v2.4.0</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2windows代理服务器">2、windows代理服务器<a href="#2windows代理服务器" class="hash-link" aria-label="2、windows代理服务器的直接链接" title="2、windows代理服务器的直接链接">​</a></h4><p>下载地址:
<a href="http://www.ccproxy.com/support.htm" target="_blank" rel="noopener noreferrer">http://www.ccproxy.com/support.htm</a></p><p>端口映射：</p><p>图1
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_4a2bc7458996621d99460dbc7f01b995_r.png" class="img_ev3q"></p><p>图2
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_11b5495547a7fe216a58e8249cc715a0_r.png" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3windows上安装jq">3、Windows上安装jq<a href="#3windows上安装jq" class="hash-link" aria-label="3、Windows上安装jq的直接链接" title="3、Windows上安装jq的直接链接">​</a></h4><div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- 如果要在Windows上顺利的使用jq，需要先安装chocolatey。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 以管理员身份待开cmd窗口，输入@&quot;%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe&quot; -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command &quot;iex ((New-Object System.Net.WebClient).DownloadString(&#x27;https://chocolatey.org/install.ps1&#x27;))&quot; &amp;&amp; SET &quot;PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin&quot;，回车。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 接着输入chocolatey install jq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>常用命令
choco search xxx，查找 xxx 安装包
choco info xxx，查看 xxx 安装包信息
choco install xxx，安装 xxx 软件
choco upgrade xxx，升级 xxx 软件
choco uninstall xxx， 卸载 xxx 软件</p><p>常用参数
–install-directory=VALUE，修改指定程序安装路径（只有pro版可用免费版无效）
–version=value 指定版本</p><p>官方程序仓库<a href="https://community.chocolatey.org/packages" target="_blank" rel="noopener noreferrer">https://community.chocolatey.org/packages</a></p><p>打开仓库地址搜索查看想要下载的程序（如MongoDB-compass即mongodb的可视化工具）</p><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_f385fd02c12ced0eaf114604730a2de0_r.png" class="img_ev3q"></p><p>输入命令下载安装choco install mongodb-compass</p><p>默认安装目录是C:\Program Files下打卡程序</p><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_b4d44aa6cf5c9a2727f56e175f2a4159_r.png" class="img_ev3q"></p><p>卸载choco uninstall mongodb-compass</p><p>###4. 磁盘测速
CrystalDiskMark</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="162-安全登录配置">16.2 安全登录配置<a href="#162-安全登录配置" class="hash-link" aria-label="16.2 安全登录配置的直接链接" title="16.2 安全登录配置的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-修改代理的默认地址">1. 修改代理的默认地址<a href="#1-修改代理的默认地址" class="hash-link" aria-label="1. 修改代理的默认地址的直接链接" title="1. 修改代理的默认地址的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">###注册表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">计算机</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">HKEY_CURRENT_USER</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">SOFTWARE</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Microsoft</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Windows</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">CurrentVersion</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Internet Settings</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后参考下面进行操作即可
<img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/m_4621882df1f186f334aea582a03c3943_r.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="163-windows中vmware通过nat直接访问">16.3 windows中vmware通过nat直接访问<a href="#163-windows中vmware通过nat直接访问" class="hash-link" aria-label="16.3 windows中vmware通过nat直接访问的直接链接" title="16.3 windows中vmware通过nat直接访问的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1调节nat的网段为105180-2552552550">1.调节NAT的网段为10.51.8.0 /255.255.255.0<a href="#1调节nat的网段为105180-2552552550" class="hash-link" aria-label="1.调节NAT的网段为10.51.8.0 /255.255.255.0的直接链接" title="1.调节NAT的网段为10.51.8.0 /255.255.255.0的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2虚拟机网卡信息配置">2.虚拟机网卡信息配置<a href="#2虚拟机网卡信息配置" class="hash-link" aria-label="2.虚拟机网卡信息配置的直接链接" title="2.虚拟机网卡信息配置的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># cat /etc/sysconfig/network-scripts/ifcfg-eth0  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DEVICE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">eth0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">NAME</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">eth0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">BOOTPROTO</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IPADDR</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.51</span><span class="token plain">.8.110</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">PREFIX</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">GATEWAY</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.51</span><span class="token plain">.8.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DNS1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">114.114</span><span class="token plain">.114.114</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DNS2</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.51</span><span class="token plain">.8.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 226.6.6.6 or 180.76.76.76</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DNS2</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10.51</span><span class="token plain">.8.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ONBOOT</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">yes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3调整虚拟机的网络模式为nat模式">3.调整虚拟机的网络模式为NAT模式<a href="#3调整虚拟机的网络模式为nat模式" class="hash-link" aria-label="3.调整虚拟机的网络模式为NAT模式的直接链接" title="3.调整虚拟机的网络模式为NAT模式的直接链接">​</a></h4><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4windows电脑添加永久路由信息">4.windows电脑添加永久路由信息<a href="#4windows电脑添加永久路由信息" class="hash-link" aria-label="4.windows电脑添加永久路由信息的直接链接" title="4.windows电脑添加永久路由信息的直接链接">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">route </span><span class="token function" style="color:#d73a49">add</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">10.51</span><span class="token plain">.8.0  mask </span><span class="token number" style="color:#36acaa">255.255</span><span class="token plain">.255.0 </span><span class="token number" style="color:#36acaa">10.51</span><span class="token plain">.8.1  -p</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>-p表示永久路由</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="17日志清理">17、日志清理<a href="#17日志清理" class="hash-link" aria-label="17、日志清理的直接链接" title="17、日志清理的直接链接">​</a></h2><p>清理日志,对于大于10M的进行清理，这里使用truncate</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">find</span><span class="token plain"> ./* -maxdepth </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> -type f -name </span><span class="token string" style="color:#e3116c">&quot;*-json.log&quot;</span><span class="token plain"> -size +10M  -exec truncate -s </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="18iptables">18、iptables<a href="#18iptables" class="hash-link" aria-label="18、iptables的直接链接" title="18、iptables的直接链接">​</a></h2><p>需求: 允许服务集群中所有的服务都能访问redis,限制局域网中其他机器访问</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="先计算掩码">先计算掩码<a href="#先计算掩码" class="hash-link" aria-label="先计算掩码的直接链接" title="先计算掩码的直接链接">​</a></h3><p><a href="https://www.sojson.com/convert/subnetmask.html" target="_blank" rel="noopener noreferrer">在线网络计算器 | TCP/IP子网掩码计算换算 —在线工具 (sojson.com)</a></p><p>只允许10.51.8.113和10.51.8.114两个地址访问</p><p><img loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231130183055043.png" alt="image-20231130183055043" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置规则">配置规则<a href="#配置规则" class="hash-link" aria-label="配置规则的直接链接" title="配置规则的直接链接">​</a></h3><p><strong>docker</strong>环境使用这种方式</p><p> 210.34.142.218操作记录</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I DOCKER-</span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">  -p tcp --dport </span><span class="token number" style="color:#36acaa">6379</span><span class="token plain">  -j DROP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I DOCKER-</span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain"> -p tcp --dport </span><span class="token number" style="color:#36acaa">6379</span><span class="token plain"> -s </span><span class="token number" style="color:#36acaa">210.34</span><span class="token plain">.142.208/28 -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I DOCKER-</span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">  -p tcp --dport </span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"> -j DROP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I DOCKER-</span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain"> -p tcp --dport </span><span class="token number" style="color:#36acaa">27017</span><span class="token plain">  -s </span><span class="token number" style="color:#36acaa">210.34</span><span class="token plain">.142.208/28 -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> 210.34.142.219操作记录</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@113 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># iptables -A INPUT -p tcp --dport 2181 -s 210.34.142.208/28  -j ACCEPT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@113 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># iptables -A INPUT -p tcp --dport 2181 -j DROP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#后续清理方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -F INPUT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  210.34.142.220操作记录</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT -p tcp --dport </span><span class="token number" style="color:#36acaa">25654</span><span class="token plain"> -s </span><span class="token number" style="color:#36acaa">210.34</span><span class="token plain">.142.208/28  -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT -p tcp --dport </span><span class="token number" style="color:#36acaa">25654</span><span class="token plain">  -j DROP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables-save  </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">  /opt/ky30.bak  </span><span class="token comment" style="color:#999988;font-style:italic">#备份iptables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables-restore  /opt/ky30.bak   </span><span class="token comment" style="color:#999988;font-style:italic">#还原</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I DOCKER-</span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain">  -p tcp -m multiport --sports </span><span class="token number" style="color:#36acaa">21731,25654</span><span class="token plain">,27766,31245  -j DROP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I DOCKER-</span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain"> -p tcp -m multiport --sports </span><span class="token number" style="color:#36acaa">21731,25654</span><span class="token plain">,27766,31245 -s </span><span class="token number" style="color:#36acaa">210.34</span><span class="token plain">.142.208/28 -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意: docker-user跟input链添加顺序是正好反的</p><p>二进制方式</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@113 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># iptables -A INPUT -p tcp --dport 6379 -s 10.51.8.113/30 -j ACCEPT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">root@113 ~</span><span class="token punctuation" style="color:#393A34">]</span><span class="token comment" style="color:#999988;font-style:italic"># iptables -A INPUT -p tcp --dport 6379 -j DROP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>删除规则</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -D DOCKER-</span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">#删除第一行的数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#第二种方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -D DOCKER-</span><span class="token environment constant" style="color:#36acaa">USER</span><span class="token plain"> -p tcp --dport </span><span class="token number" style="color:#36acaa">6379</span><span class="token plain"> -s </span><span class="token number" style="color:#36acaa">210.34</span><span class="token plain">.142.208/28 -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试命令</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I DOCKER -p tcp -m multiport --sports </span><span class="token number" style="color:#36acaa">21731,25654</span><span class="token plain">,27766,31245  -j DROP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I DOCKER -s </span><span class="token number" style="color:#36acaa">210.34</span><span class="token plain">.142.208/28 -p tcp -m multiport --sports </span><span class="token number" style="color:#36acaa">21731,25654</span><span class="token plain">,27766,31245   -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I DOCKER -s </span><span class="token number" style="color:#36acaa">210.34</span><span class="token plain">.142.219 -p tcp -m multiport --sports </span><span class="token number" style="color:#36acaa">21731,25654</span><span class="token plain">,27766,31245   -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -L -n</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Sre/1-日常运维/1.operator.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->由 <b>AMiner</b> <!-- -->于 <b><time datetime="2024-06-22T16:15:00.000Z">2024年6月22日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Sre/日常运维/镜像列表"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">镜像列表</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1网络" class="table-of-contents__link toc-highlight">1、网络</a><ul><li><a href="#1sys泛红以及ssh暴力破解" class="table-of-contents__link toc-highlight">1、sys泛红以及ssh暴力破解</a></li><li><a href="#2windows路由添加" class="table-of-contents__link toc-highlight">2、windows路由添加</a></li><li><a href="#3网卡问题" class="table-of-contents__link toc-highlight">3、网卡问题</a></li><li><a href="#4-spring-cloud服务在访问redis时出现连接失败服务注册" class="table-of-contents__link toc-highlight">4、 spring-cloud服务在访问redis时出现连接失败(服务注册)</a></li><li><a href="#5邮箱ssl配置" class="table-of-contents__link toc-highlight">5、邮箱ssl配置</a></li><li><a href="#5iftop-查看网卡流量" class="table-of-contents__link toc-highlight">5、iftop 查看网卡流量</a></li></ul></li><li><a href="#2系统服务" class="table-of-contents__link toc-highlight">2、系统服务</a></li><li><a href="#3磁盘挂载" class="table-of-contents__link toc-highlight">3、磁盘挂载</a></li><li><a href="#4java和tomcat" class="table-of-contents__link toc-highlight">4、Java和Tomcat</a></li><li><a href="#5jenkins" class="table-of-contents__link toc-highlight">5、Jenkins</a></li><li><a href="#6容器" class="table-of-contents__link toc-highlight">6、容器</a><ul><li><a href="#相关命令安装" class="table-of-contents__link toc-highlight">相关命令安装</a></li></ul></li><li><a href="#7python" class="table-of-contents__link toc-highlight">7、Python</a></li><li><a href="#8git相关" class="table-of-contents__link toc-highlight">8、git相关</a></li><li><a href="#9跨域问题" class="table-of-contents__link toc-highlight">9、跨域问题</a></li><li><a href="#10skywalking" class="table-of-contents__link toc-highlight">10、Skywalking</a></li><li><a href="#11tcpdump" class="table-of-contents__link toc-highlight">11、tcpdump</a></li><li><a href="#12端口扫描" class="table-of-contents__link toc-highlight">12、端口扫描</a></li><li><a href="#13debian相关" class="table-of-contents__link toc-highlight">13、Debian相关</a></li><li><a href="#14进程和相关命令" class="table-of-contents__link toc-highlight">14、进程和相关命令</a></li><li><a href="#15内存" class="table-of-contents__link toc-highlight">15、内存</a></li><li><a href="#16windows常用操作" class="table-of-contents__link toc-highlight">16、Windows常用操作</a><ul><li><a href="#161-常用工具安装" class="table-of-contents__link toc-highlight">16.1 常用工具安装</a></li><li><a href="#162-安全登录配置" class="table-of-contents__link toc-highlight">16.2 安全登录配置</a></li><li><a href="#163-windows中vmware通过nat直接访问" class="table-of-contents__link toc-highlight">16.3 windows中vmware通过nat直接访问</a></li></ul></li><li><a href="#17日志清理" class="table-of-contents__link toc-highlight">17、日志清理</a></li><li><a href="#18iptables" class="table-of-contents__link toc-highlight">18、iptables</a><ul><li><a href="#先计算掩码" class="table-of-contents__link toc-highlight">先计算掩码</a></li><li><a href="#配置规则" class="table-of-contents__link toc-highlight">配置规则</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://book.zlqit.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">LiteShell<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">kubernetes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://mindoc.zlqit.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">mindoc<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/shouji1128955" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Blog Project - LiteShell</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ae2aa7d1.js"></script>
<script src="/assets/js/main.46fa2b5c.js"></script>
</body>
</html>