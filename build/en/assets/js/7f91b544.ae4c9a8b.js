"use strict";(self.webpackChunkbookshell=self.webpackChunkbookshell||[]).push([[1406],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>b});var l=t(67294);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);a&&(l=l.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,l)}return t}function d(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function p(e,a){if(null==e)return{};var t,l,n=function(e,a){if(null==e)return{};var t,l,n={},s=Object.keys(e);for(l=0;l<s.length;l++)t=s[l],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(l=0;l<s.length;l++)t=s[l],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var r=l.createContext({}),o=function(e){var a=l.useContext(r),t=a;return e&&(t="function"==typeof e?e(a):d(d({},a),e)),t},c=function(e){var a=o(e.components);return l.createElement(r.Provider,{value:a},e.children)},i="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return l.createElement(l.Fragment,{},a)}},k=l.forwardRef((function(e,a){var t=e.components,n=e.mdxType,s=e.originalType,r=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),i=o(t),k=n,b=i["".concat(r,".").concat(k)]||i[k]||u[k]||s;return t?l.createElement(b,d(d({ref:a},c),{},{components:t})):l.createElement(b,d({ref:a},c))}));function b(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var s=t.length,d=new Array(s);d[0]=k;var p={};for(var r in a)hasOwnProperty.call(a,r)&&(p[r]=a[r]);p.originalType=e,p[i]="string"==typeof e?e:n,d[1]=p;for(var o=2;o<s;o++)d[o]=t[o];return l.createElement.apply(null,d)}return l.createElement.apply(null,t)}k.displayName="MDXCreateElement"},90380:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>r,contentTitle:()=>d,default:()=>u,frontMatter:()=>s,metadata:()=>p,toc:()=>o});var l=t(87462),n=(t(67294),t(3905));const s={},d=void 0,p={unversionedId:"Sre/\u4e2d\u95f4\u4ef6/databasebackup-restore",id:"Sre/\u4e2d\u95f4\u4ef6/databasebackup-restore",title:"databasebackup-restore",description:"1\u3001gitlab\u6570\u636e\u5e93",source:"@site/docs/Sre/2-\u4e2d\u95f4\u4ef6/7.databasebackup-restore.md",sourceDirName:"Sre/2-\u4e2d\u95f4\u4ef6",slug:"/Sre/\u4e2d\u95f4\u4ef6/databasebackup-restore",permalink:"/en/docs/Sre/\u4e2d\u95f4\u4ef6/databasebackup-restore",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Sre/2-\u4e2d\u95f4\u4ef6/7.databasebackup-restore.md",tags:[],version:"current",lastUpdatedBy:"zhanglaiqiang",lastUpdatedAt:1702988356,formattedLastUpdatedAt:"Dec 19, 2023",sidebarPosition:7,frontMatter:{},sidebar:"SreMiddleSoft",previous:{title:"YAPI",permalink:"/en/docs/Sre/\u4e2d\u95f4\u4ef6/YAPI"},next:{title:"Traefik",permalink:"/en/docs/Sre/\u4e2d\u95f4\u4ef6/Traefik"}},r={},o=[{value:"1\u3001gitlab\u6570\u636e\u5e93",id:"1gitlab\u6570\u636e\u5e93",level:2},{value:"\u5907\u4efd",id:"\u5907\u4efd",level:3},{value:"\u6062\u590d",id:"\u6062\u590d",level:3},{value:"\u57fa\u4e8e\u6e90\u7801\u5b89\u88c5\u7684\u6062\u590d",id:"\u57fa\u4e8e\u6e90\u7801\u5b89\u88c5\u7684\u6062\u590d",level:3},{value:"2.\u8fbe\u68a6\u6570\u636e\u5e93\u5907\u4efd",id:"2\u8fbe\u68a6\u6570\u636e\u5e93\u5907\u4efd",level:2},{value:"\u5907\u4efd",id:"\u5907\u4efd-1",level:3},{value:"\u6062\u590d",id:"\u6062\u590d-1",level:3},{value:"3\u3001pgsql\u6570\u636e\u5e93",id:"3pgsql\u6570\u636e\u5e93",level:2},{value:"\u5907\u4efd",id:"\u5907\u4efd-2",level:3},{value:"\u6062\u590d",id:"\u6062\u590d-2",level:3},{value:"4\u3001\u91d1\u4ed3\u6570\u636e\u5e93",id:"4\u91d1\u4ed3\u6570\u636e\u5e93",level:2},{value:"\u5907\u4efd",id:"\u5907\u4efd-3",level:3},{value:"\u6062\u590d",id:"\u6062\u590d-3",level:3},{value:"5\u3001Oracle",id:"5oracle",level:2},{value:"\u5907\u4efd",id:"\u5907\u4efd-4",level:3},{value:"\u6062\u590d",id:"\u6062\u590d-4",level:3},{value:"6\u3001\u7985\u9053\u5907\u4efd",id:"6\u7985\u9053\u5907\u4efd",level:2},{value:"\u5907\u4efd",id:"\u5907\u4efd-5",level:3},{value:"\u6062\u590d",id:"\u6062\u590d-5",level:3},{value:"7\u3001jenkins\u6570\u636e\u5907\u4efd",id:"7jenkins\u6570\u636e\u5907\u4efd",level:2},{value:"\u5907\u4efd",id:"\u5907\u4efd-6",level:3},{value:"8\u3001Kvm\u5907\u4efd",id:"8kvm\u5907\u4efd",level:2},{value:"9\u3001yapi",id:"9yapi",level:2},{value:"\u5907\u4efd",id:"\u5907\u4efd-7",level:3},{value:"\u6062\u590d",id:"\u6062\u590d-6",level:3}],c={toc:o},i="wrapper";function u(e){let{components:a,...s}=e;return(0,n.kt)(i,(0,l.Z)({},c,s,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"1gitlab\u6570\u636e\u5e93"},"1\u3001gitlab\u6570\u636e\u5e93"),(0,n.kt)("h3",{id:"\u5907\u4efd"},"\u5907\u4efd"),(0,n.kt)("p",null,"\u673a\u5668IP 192.168.1.203\n1.1 \u5bbf\u4e3b\u673a\u6570\u636e\u5e93\u76ee\u5f55\n/data/qt_gitlab_data/data/backups"),(0,n.kt)("p",null,"1.2 \u5b9a\u65f6\u5907\u4efd\u547d\u4ee4(\u5bbf\u4e3b\u673acrontab)\n00 21 * * * docker exec -i 9a7b5170b200  sh /root/gitlabbak.sh  (\u5207\u52ff\u968f\u610f\u6267\u884c) "),(0,n.kt)("p",null,"1.3  \u5bb9\u5668\u4e2d\u5907\u4efd\u7684\u811a\u672c: "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"[root@beijing-physicalsvr04 backup]# docker exec -i 9a7b5170b200  cat /root/gitlabbak.sh\ngitlab-rake gitlab:backup:create\n")),(0,n.kt)("p",null,(0,n.kt)("img",{src:t(66002).Z,width:"1280",height:"416"})),(0,n.kt)("p",null,"1.4 \u5f02\u5730\u5907\u4efd:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"cd  /data/qt_gitlab_data/data/backups\n")),(0,n.kt)("p",null,"\u5907\u4efd\u6700\u8fd1\u7684\u4e00\u5929\u7684\u6570\u636e\u5305\uff0c\u6bd4\u5982\u5907\u4efd\u50cf\u4e0a\u9762\u5927\u76842023_06_14\u8fd9\u5929\u7684tar\u5305\n\u8bf4\u660e\uff1a \u7531\u4e8e\u5907\u4efd\u6587\u4ef6\u6bd4\u8f83\u5927\uff0c\u9700\u8981\u4f7f\u7528xftp \u5de5\u5177\u5907\u4efd\u5373\u53ef"),(0,n.kt)("h3",{id:"\u6062\u590d"},"\u6062\u590d"),(0,n.kt)("p",null,"\u6570\u636e\u5907\u4efd\u6587\u4ef6:\n\u76d8\u9635\u670d\u52a1\u5668192.168.1.205:/backup/devops_backup/gitlab_backup\nbackups: \u57fa\u4e8e\u547d\u4ee4\u6062\u590d\u7684\u65b9\u5f0f\n{config,data,logs}: \u57fa\u4e8e\u5907\u4efd\u6587\u4ef6\u6062\u590d\u7684\u65b9\u5f0f-\u4f18\u5148\u63a8\u8350\u6b64\u65b9\u5f0f"),(0,n.kt)("p",null,"\u57fa\u7840\u955c\u50cf"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"\n192.168.1.207:51888/base/gitlab-ce:12.8.1-ce.0\n192.168.1.203:51888/base/gitlab-ce:12.8.1-ce.0\n")),(0,n.kt)("p",null,"\u521b\u5efa\u6587\u4ef6\u5939"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mkdir -p   /data/qt_gitlab_data/\n")),(0,n.kt)("p",null,"\u79fb\u52a8\u5907\u4efd\u6587\u4ef6"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mv  /backup/devops_backup/gitlab_backup/*   /data/qt_gitlab_data/\n")),(0,n.kt)("p",null,"\u90e8\u7f72\u670d\u52a1"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker service create \\\n--hostname git.zlqit.com \\\n--network devops \\\n--mount type=bind,src=/data/qt_gitlab_data/config,dst=/etc/gitlab \\\n--mount type=bind,src=/data/qt_gitlab_data/logs,dst=/var/log/gitlab \\\n--mount type=bind,src=/data/qt_gitlab_data/data,dst=/var/opt/gitlab \\\n--env GITLAB_OMNIBUS_CONFIG=\"external_url 'http://git.zlqit.com:22280'; gitlab_rails['lfs_enabled'] = true;\" \\\n--name qtgit \\\n--constraint 'node.labels.role == entry' \\\n--label traefik.enable=true \\\n--label traefik.http.routers.gitlab.rule=\"Host(\\`git.zlqit.com\\`)\" \\\n--label traefik.http.services.gitlab-service.loadbalancer.server.port=22280 \\\n 192.168.1.207:51888/base/gitlab-ce:12.8.1-ce.0\n")),(0,n.kt)("h3",{id:"\u57fa\u4e8e\u6e90\u7801\u5b89\u88c5\u7684\u6062\u590d"},"\u57fa\u4e8e\u6e90\u7801\u5b89\u88c5\u7684\u6062\u590d"),(0,n.kt)("p",null,"\u4fee\u6539\u670d\u52a1\u5668\u7684ssh\u7aef\u53e3\u4e3a2023"),(0,n.kt)("p",null,"\u521b\u5efa\u6587\u4ef6\u76ee\u5f55"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mkdir -p /data/web/conf.d\nmkdir -p  /data/web/html\nmkdir -p /data/web/cert\nmkdir -p /data/gitlab/redis\nmkdir -p /data/gitlab/postgresql\nmkdir -p /data/gitlab/data\n")),(0,n.kt)("p",null,"\u6302\u8f7d\u6570\u636e\u76d8\u5230/data "),(0,n.kt)("p",null,"\u6267\u884c\u542f\u52a8"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker-compose up\n")),(0,n.kt)("p",null,"\u62f7\u8d1d\u5907\u4efd\u6587\u4ef6\u5230\u5bb9\u5668"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"root@new-gitlab:/data# docker cp 1701552136_2023_12_02_11.11.3_gitlab_backup.tar  gitlab:/home/git/data/backups/\n")),(0,n.kt)("p",null,"\u8fdb\u5165\u5bb9\u5668\u6267\u884c"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"root@new-gitlab:/data# docker exec -it gitlab bash\ncd /home/git/gitlab/vendor\nsudo -u git -H bundle exec rake gitlab:backup:restore BACKUP=/home/git/data/backups/1701552136_2023_12_02_11.11.3    RAILS_ENV=production\n")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"image-20231210234638640",src:t(61062).Z,width:"789",height:"450"})),(0,n.kt)("p",null,"\u6062\u590d\u9047\u5230\u7684\u4e00\u4e9b\u9519\u8bef"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"image-20231210234024392",src:t(15992).Z,width:"1041",height:"724"})),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"sudo -u git -H bundle install --path vendor/bundle\n")),(0,n.kt)("h2",{id:"2\u8fbe\u68a6\u6570\u636e\u5e93\u5907\u4efd"},"2.\u8fbe\u68a6\u6570\u636e\u5e93\u5907\u4efd"),(0,n.kt)("h3",{id:"\u5907\u4efd-1"},"\u5907\u4efd"),(0,n.kt)("p",null,"2.1 \u5bbf\u4e3b\u673a\u6570\u636e\u5e93\u76ee\u5f55\n/data/dm8_data/backup"),(0,n.kt)("p",null,"2.2\u5b9a\u65f6\u5907\u4efd\u547d\u4ee4(\u5bbf\u4e3b\u673acrontab)"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"\u5bbf\u4e3b\u673a\u5b9a\u65f6\u547d\u4ee4:  00 20 * * * docker exec -i 66e3e7c87a32  sh /root/dm_crontab_bak.sh  (\u5207\u52ff\u968f\u610f\u6267\u884c) \n")),(0,n.kt)("p",null,"2.3  \u5bb9\u5668\u4e2d\u5907\u4efd\u7684\u811a\u672c: "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"[root@beijing-physicalsvr04 backup]# docker exec -i 66e3e7c87a32  cat  /root/dm_crontab_bak.sh\n#!/bin/bash\ncd /opt/dmdbms/bin/\nbackup_date=`date +%Y%m%d`\n./dexp xxxaaaa/xxxaaaa@localhost:5236 FILE=iteshelldev$backup_date.dmp LOG=iteshelldev$backup_date.log DIRECTORY=/opt/dmdbms/data/backup/ >/dev/null 2>&1\n./dexp xxxaaaa/xxxaaaa@localhost:5236 FILE=ilync$backup_date.dmp LOG=ilync$backup_date.log DIRECTORY=/opt/dmdbms/data/backup/ >/dev/null 2>&1\n./dexp xxxaaaa/xxxaaaa@localhost:5236 FILE=shdb$backup_date.dmp LOG=shdb$backup_date.log DIRECTORY=/opt/dmdbms/data/backup/ >/dev/null 2>&1\n./dexp xxxaaaa/xxxaaaa@localhost:5236 FILE=iteshelltest$backup_date.dmp LOG=iteshelltest$backup_date.log DIRECTORY=/opt/dmdbms/data/backup/ >/dev/null 2>&1\n./dexp xxxaaaaxxxaaaa@localhost:5236 FILE=jbjbjb$backup_date.dmp LOG=jbjbjb$backup_date.log DIRECTORY=/opt/dmdbms/data/backup/ >/dev/null 2>&1\n./dexp xxxaaaa/xxxaaaa@localhost:5236 FILE=alerac$backup_date.dmp LOG=alerac$backup_date.log DIRECTORY=/opt/dmdbms/data/backup/ >/dev/null 2>&1\n")),(0,n.kt)("p",null,"2.4 \u5f02\u5730\u5907\u4efd:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"1.\u5bfc\u51fa\u6700\u8fd1\u4e00\u6b21\u6570\u636e\u5907\u4efd\u6587\u4ef6\ncd /data/dm8_data/backup\nls -lrt | grep -E  \"iteshellde|ilync|shdb|iteshelltest|jbjbjb|alerac\" | awk '{print $NF}' | tail -n 14 > td.txt\n")),(0,n.kt)("p",null,"2.\u521b\u5efa\u4e34\u76ee\u5f55(\u7b2c\u4e00\u6b21\u9700\u8981\uff0c\u540e\u7eed\u53ef\u4ee5\u7701\u7565)\nmkdir tmp"),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"\u79fb\u52a8\u5907\u4efd\u6587\u4ef6\u5230\u4e34\u65f6\u76ee\u5f55")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"for i in `cat td.txt `; do mv $i ./tmp/ ; done\n")),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},"\u6253\u5f00ftp\u5907\u4efd\u4e0b\u9762\u76ee\u5f55\u7684\u6570\u636e")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"/data/pg_data/data/backup/tmp\n")),(0,n.kt)("p",null,"5.\u628a\u4e34\u65f6\u5907\u4efd\u6570\u636e\u8fd8\u539f\u5230\u539f\u6765\u7684\u6570\u636e\u76ee\u5f55"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mv ./tmp/*  .\n")),(0,n.kt)("h3",{id:"\u6062\u590d-1"},"\u6062\u590d"),(0,n.kt)("p",null,"2.1 \u5bb9\u5668\u6062\u590d\u9a8c\u8bc1\u65b9\u5f0f\n\u955c\u50cf\ndm8_single:v8.1.2.128_ent_x86_64_ctm_pack4\n192.168.1.203:51888/base/dm8_single:v8.1.2.128_ent_x86_64_ctm_pack4\n192.168.1.207:51888/base/dm8_single:v8.1.2.128_ent_x86_64_ctm_pack4"),(0,n.kt)("p",null,"\u521b\u5efa\u65b9\u5f0f-\u7814\u53d1\u73af\u5883\u90e8\u7f72\u65b9\u5f0f\n\u5c06\u5907\u4efd\u7684\u6570\u636e\u653e\u5230\u5bf9\u5e94\u7684\u76ee\u5f55\n\u670d\u52a1\u5668: 192.168.1.205:/backup/db_backup/dm8_backup/backup/daily"),(0,n.kt)("p",null,"6.1.1 \u5728\u9700\u8981\u6062\u590d\u7684\u670d\u52a1\u5668\u521b\u5efa\u6587\u4ef6\u5939"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mkdir -p  /data/dm8_data\n")),(0,n.kt)("p",null,"6.1.2 \u590d\u5236\u5907\u4efd\u6587\u4ef6\u5230\u5bf9\u5e94\u7684\u6570\u636e\u76ee\u5f55,\u5047\u5982 alerac20230709.dmp \u662f\u6700\u8fd1\u4e00\u6b21\u7684\u5907\u4efd\n\u4e0a\u4f20xxx.dmp\u6587\u4ef6\u5230   /root/"),(0,n.kt)("p",null,"6.1.3 \u4f7f\u7528docker\u90e8\u7f72\u670d\u52a1\n#\u521d\u59cb\u5316"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker run -d -p 5236:5236  --name dm8  -e CASE_SENSITIVE=0 -v /data/dm8_data/:/opt/dmdbms/data/  192.168.1.203:51888/base/dm8_single:v8.1.2.128_ent_x86_64_ctm_pack4\n#CASE_SENSITIVE\u4e0d\u533a\u5206\u5927\u5c0f\u5199\n")),(0,n.kt)("p",null,"6.1.4 \u5bfc\u5165\u6570\u636e-\u53d6\u6700\u8fd1\u4e00\u6b21\u6700\u65b0\u7684\u5907\u4efd\u6570\u636e\n\u670d\u52a1\u5668\n\u6570\u636e\u6240\u5728\u6587\u4ef6\u5939\n\u5907\u4efd\u6587\u4ef6-\u7c7b\u4f3c\u4ee5\u4e0b\u6587\u4ef6\n192.168.1.205\n/backup/db_backup/dm8_backup/backup/daily"),(0,n.kt)("p",null,(0,n.kt)("img",{src:t(94886).Z,width:"1254",height:"415"})),(0,n.kt)("p",null,"6.1.5 \u62f7\u8d1d\u6587\u4ef6\u5230\u5bb9\u5668"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker cp iteshelldev20230719.dmp    dm8:/dm8/dexp/\ndocker cp iteshelltest20230719.dmp  dm8:/dm8/dexp/\ndocker cp jbjbjb20230719.dmp     dm8:/dm8/dexp/\ndocker cp ilync20230719.dmp     dm8:/dm8/dexp/\ndocker cp alerac20230719.dmp   dm8:/dm8/dexp/\n")),(0,n.kt)("p",null,"6.1.6 \u914d\u7f6e\u53d8\u91cf"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker exec -it dm8 bash\nvi /etc/profile\n\nDM_HOME=/opt/dmdbms/\nexport PATH=$PATH:$DM_HOME/bin\nexport LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$DM_HOME/bin\nsource  /etc/profile \n")),(0,n.kt)("p",null,"6.1.7 \u901a\u8fc7dm\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\u636e\uff0c\u7136\u521b\u5efa\u76f8\u5173\u7528\u6237"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"create user iteshelldev  identified by test2023;\ngrant dba to iteshelldev;\n\ncreate user iteshelltest  identified by iteshelltest2023;\ngrant dba to iteshelltest;\n\ncreate user jbjbjb  identified by jbjbjb2023;\ngrant dba to jbjbjb;\n\ncreate user ilync  identified by ilync2023;\ngrant dba to ilync;\n\ncreate user alerac  identified by  alerac2023;\ngrant dba to alerac;\n")),(0,n.kt)("p",null,"6.1.8 \u7136\u540e\u5728\u5bb9\u5668\u4e2d\u5bfc\u5165\u6570\u636e\u5373\u53ef"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"dimp  iteshelldev/iteshelldev2023  directory=/dm8/dexp   file=iteshelldev20230719.dmp      full=y  log=iteshelldev.log \ndimp  iteshelltest/iteshelltest2023  directory=/dm8/dexp   file=iteshelltest20230719.dmp   full=y  log=iteshelltest.log\ndimp  jbjbjb/jbjbjb2023  directory=/dm8/dexp   file=jbjbjb20230719.dmp         full=y  log=jbjbjb.log\ndimp  ilync/ilync2023  directory=/dm8/dexp   file=ilync20230719.dmp         full=y  log=ilync.log\ndimp  alerac/alerac2023  directory=/dm8/dexp   file=alerac20230719.dmp   full=y  log=alerac.log\n")),(0,n.kt)("h2",{id:"3pgsql\u6570\u636e\u5e93"},"3\u3001pgsql\u6570\u636e\u5e93"),(0,n.kt)("h3",{id:"\u5907\u4efd-2"},"\u5907\u4efd"),(0,n.kt)("p",null,"3.1 \u5bbf\u4e3b\u673a\u5907\u4efd\u76ee\u5f55\n/data/pg_data/data/backup"),(0,n.kt)("p",null,"3.2 \u5b9a\u65f6\u5907\u4efd\u547d\u4ee4(\u5bbf\u4e3b\u673acrontab)\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"\u5bbf\u4e3b\u673a\u5b9a\u65f6\u547d\u4ee4:   \n10 2 * * * docker exec -i 31fdb4cbe63f  sh /root/pgsql_crontab_bak_day.sh\n00 2 * * 7 docker exec -i 31fdb4cbe63f  sh /root/pgsql_crontab_bak_week.sh\n50 2 30 * * docker exec -i 31fdb4cbe63f  sh /root/pgsql_crontab_bak_month.sh\n (\u5207\u52ff\u968f\u610f\u6267\u884c)\n")),(0,n.kt)("p",null,"3.3  \u5bb9\u5668\u4e2d\u5907\u4efd\u7684\u811a\u672c: "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"root@31fdb4cbe63f:~# cat pgsql_crontab_bak_day.sh \n#!/bin/bash\n#cd /opt/dmdbms/bin/\nbackup_date=`date +%Y%m%d`\npg_dump  -U postgres -c  crhc_iteshell -f   /var/lib/postgresql/data/backup/daily/crhc_iteshell$backup_date.sql\npg_dump  -U postgres -c maomei  -f   /var/lib/postgresql/data/backup/daily/maomei$backup_date.sql\nroot@31fdb4cbe63f:~# cat pgsql_crontab_bak_week.sh \n#!/bin/bash\n#cd /opt/dmdbms/bin/\nbackup_date=`date +%Y%m%d`\npg_dump  -U postgres -c dev_heabei_gasu  -f   /var/lib/postgresql/data/backup/weekly/dev_hebei_gasu$backup_date.sql\npg_dump  -U postgres -c dome_gyjftgasu  -f   /var/lib/postgresql/data/backup/weekly/dome_gyjtgasu$backup_date.sql\npg_dump  -U postgres -c test_itesshellgh  -f   /var/lib/postgresql/data/backup/weekly/test_iteshellgh$backup_date.sql\npg_dump  -U postgres -c test_hbsfz  -f   /var/lib/postgresql/data/backup/weekly/test_hbfz$backup_date.sql\npg_dump  -U postgres -c test_hednan_gasu  -f   /var/lib/postgresql/data/backup/weekly/test_henan_gasu$backup_date.sql\npg_dump  -U postgres -c test_hldjgasudb  -f   /var/lib/postgresql/data/backup/weekly/test_hljgasudb$backup_date.sql\npg_dump  -U postgres -c test_hnssdb  -f   /var/lib/postgresql/data/backup/weekly/test_hndb$backup_date.sql\npg_dump  -U postgres -c fanruanfReport  -f   /var/lib/postgresql/data/backup/weekly/fanruanReport$backup_date.sql\nroot@31fdb4cbe63f:~# cat pgsql_fcrontab_bak_month.sh \n#!/bin/bash\n#cd /opt/dmdbms/bin/\nbackup_date=`date +%Y%m%d`\npg_dump  -U postgres -c test_hebei_gasu  -f   /var/lib/postgresql/data/backup/monthly/test_hebei_gasu$backup_date.sql\npg_dump  -U postgres -c test_hlj_tz  -f   /var/lib/postgresql/data/backup/monthly/test_hlj_tz$backup_date.sql\npg_dump  -U postgres -c test_lngasu_gasu  -f   /var/lib/postgresql/data/backup/monthly/test_lngasu_gasu$backup_date.sql\n")),(0,n.kt)("p",null,"3.4 \u5f02\u5730\u5907\u4efd:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"\u5bfc\u51fa\u6700\u8fd1\u4e00\u6b21\u6570\u636e\u5907\u4efd\u6587\u4ef6")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"cd /data/pg_data/data/backup\nls -lrt | grep -E  \"aa|dev_hebeia_gasu|dev_hlj_tz|dev_hndb|dome_gyjtgasu|test_iteshellgh|test_hbfz|test_hebei_gasu|test_henan_gasu|test_hlj_tz|test_hljgasudb|test_hndb|maomei|fanruanReport\" | awk '{print $NF}' | tail -n 14 > db.txt\n")),(0,n.kt)("p",null,"2.\u521b\u5efa\u4e34\u76ee\u5f55(\u7b2c\u4e00\u6b21\u9700\u8981\uff0c\u540e\u7eed\u53ef\u4ee5\u7701\u7565)"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mkdir tmp\n")),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"\u79fb\u52a8\u5907\u4efd\u6587\u4ef6\u5230\u4e34\u65f6\u76ee\u5f55")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"for i in `cat td.txt `; do mv $i ./tmp/ ; done\n")),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},"\u6253\u5f00ftp\u5907\u4efd\u4e0b\u9762\u76ee\u5f55\u7684\u6570\u636e")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"/data/pg_data/data/backup/tmp\n")),(0,n.kt)("p",null,"5.\u628a\u4e34\u65f6\u5907\u4efd\u6570\u636e\u8fd8\u539f\u5230\u539f\u6765\u7684\u6570\u636e\u76ee\u5f55"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mv ./tmp/*  .\n")),(0,n.kt)("h3",{id:"\u6062\u590d-2"},"\u6062\u590d"),(0,n.kt)("p",null,"3.5 \u5bb9\u5668\u6062\u590d\u9a8c\u8bc1\u53ca\u6570\u636e\u6062\u590d\u9a8c\u8bc1\n/backup/db_backup/pgsql_backup/\u6b64\u76ee\u5f55\u4e3a\u6570\u636e\u6301\u4e45\u5316\u76ee\u5f55\u53ca\u6570\u636e\u5907\u4efd\u76ee\u5f55"),(0,n.kt)("p",null,"3.5.1\u3001\u62c9\u53d6postgresql\u7684\u955c\u50cf\u53ca\u670d\u52a1\u542f\u52a8\ndocker pull 192.168.1.203:51888/git/postgres:13.2"),(0,n.kt)("p",null,"#\u5c06\u6570\u636e\u6301\u4e45\u5316\u76ee\u5f55/backup/db_backup/pgsql_backup/\u5f80\u670d\u52a1\u5668\u4e0acp\u4e00\u4efd\u7136\u540e\u7528\u4e8e\u6570\u636e\u6301\u4e45\u5316\u76ee\u5f55\u8fdb\u884c\u542f\u52a8\u5bb9\u5668"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker run -dit -p 5432:5432 --restart=always -v /data/pgsql_data/data/:/var/lib/postgresql/data/ --name pgsql 192.168.1.203:51888/git/postgres:13.2\n")),(0,n.kt)("p",null,"3.5.2\u3001\u6570\u636e\u96c6\u6062\u590d\u547d\u4ee4\u5982\u4e0b"),(0,n.kt)("p",null,"1)\u3001\u521b\u5efa\u6570\u636e\u5e93\u5b9e\u4f8b"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"create database test_henan_gasu;\ncreate database test_hljgasudb;\ncreate database dev_hebei_gasu;\ncreate database test_hebei_gasu;\ncreate database test_hlj_tz;\ncreate database test_iteshellgh;\ncreate database dome_gyjtgasu;\ncreate database test_hndb;\ncreate database test_hbfz;\ncreate database test_lngasu_gasu;\ncreate database crhc_iteshell;\ncreate database fanruanReport;\ncreate database maomei;\n")),(0,n.kt)("p",null,"2)\u3001\u6570\u636e\u5bfc\u5165"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"psql  -d  test_henan_gasu -f  /var/lib/postgresql/backup/weekly/test_henan_gasu20230729.sql postgres\npsql  -d  test_hljgasudb -f  /var/lib/postgresql/backup/weekly/test_hljgasudb20230729.sql postgres\npsql  -d  dev_hebei_gasu -f  /var/lib/postgresql/backup/weekly/dev_hebei_gasu20230729.sql postgres\npsql  -d  test_hebei_gasu -f  /var/lib/postgresql/backup/monthly/test_hebei_gasu20230729.sql postgres\npsql  -d  test_hlj_tz -f  /var/lib/postgresql/backup/monthly/test_hlj_tz20230729.sql postgres\npsql  -d  test_iteshellgh -f  /var/lib/postgresql/backup/weekly/test_iteshellgh20230729.sql postgres\npsql  -d  dome_gyjtgasu -f  /var/lib/postgresql/backup/weekly/dome_gyjtgasu20230729.sql postgres\npsql  -d  test_hndb -f  /var/lib/postgresql/backup/weekly/test_hndb20230729.sql postgres\npsql  -d  test_hbfz -f  /var/lib/postgresql/backup/weekly/test_hhbfz20230729.sql postgres\npsql  -d  test_lngasu_gasu -f  /var/lib/postgresql/backup/monthly/test_lngasu_gasu20230729.sql postgres\npsql  -d  crhc_iteshell -f  /var/lib/postgresql/backup/daily/crhc_iteshell20230729.sql postgres\npsql  -d  fanruanReport -f  /var/lib/postgresql/backup/weekly/fanruanReport20230729.sql postgres\npsql  -d  maomei -f  /var/lib/postgresql/backup/daily/maomei20230729.sql postgres\n\n")),(0,n.kt)("p",null,"\u4f7f\u7528navicat\u767b\u5f55\u4e0a\u4e4b\u540e\u68c0\u67e5\u5404\u6570\u636e\u5e93\u670d\u52a1\u7684\u6570\u636e\u662f\u5426\u6b63\u5e38\u5373\u53ef;"),(0,n.kt)("h2",{id:"4\u91d1\u4ed3\u6570\u636e\u5e93"},"4\u3001\u91d1\u4ed3\u6570\u636e\u5e93"),(0,n.kt)("h3",{id:"\u5907\u4efd-3"},"\u5907\u4efd"),(0,n.kt)("p",null,"4.1 \u5bbf\u4e3b\u673a\u5907\u4efd\u76ee\u5f55\n/data/kingbase_data/backup"),(0,n.kt)("p",null,"4.2 \u5b9a\u65f6\u5907\u4efd\u547d\u4ee4(\u5bbf\u4e3b\u673acrontab)\uff1a\n\u5bbf\u4e3b\u673a\u5b9a\u65f6\u547d\u4ee4:   "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"30 20 * * * docker exec -i 238b7890f4ec  sh /root/kingbase_crontab_bak.sh   (\u5207\u52ff\u968f\u610f\u6267\u884c) \n")),(0,n.kt)("p",null,"4.3  \u5bb9\u5668\u4e2d\u5907\u4efd\u7684\u811a\u672c: "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"[root@beijing-physicalsvr04 backup]# docker exec -i 238b7890f4ec  cat /root/kingbase_crontab_bak.sh\n#!/bin/bash\ncd /home/test/KingbaseES/bin/\nbackup_date=`date +%Y%m%d`\n./sys_dump -h 127.0.0.1 -p 54321 -U iteshelldev -W iteshelldev2023 -F c -f /home/kingbase/ES/V8/data/backup/iteshelldev$backup_date.dmp iteshelldev\n./sys_dump -h 127.0.0.1 -p 54321 -U iteshelltest -W iteshelltest2023 -F c -f /home/kingbase/ES/V8/data/backup/iteshelltest$backup_date.dmp iteshelltest\n./sys_dump -h 127.0.0.1 -p 54321 -U jsiteshell -W jsiteshell2023 -F c -f /home/kingbase/ES/V8/data/backup/jsiteshell$backup_date.dmp jsgasuxt\n")),(0,n.kt)("p",null,"4.4 \u5f02\u5730\u5907\u4efd:\n1.\u5bfc\u51fa\u6700\u8fd1\u4e00\u6b21\u6570\u636e\u5907\u4efd\u6587\u4ef6"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"cd /data/kingbase_data/backup\nls -lrt | grep -E  \"iteshelldev2023|iteshelltest2023|jsiteshell2023\" | awk '{print $NF}' | tail -n 3 >td.txt\n")),(0,n.kt)("p",null,"2.\u521b\u5efa\u4e34\u76ee\u5f55(\u7b2c\u4e00\u6b21\u9700\u8981\uff0c\u540e\u7eed\u53ef\u4ee5\u7701\u7565)"),(0,n.kt)("p",null,"mkdir tmp"),(0,n.kt)("p",null,"3.\u79fb\u52a8\u5907\u4efd\u6587\u4ef6\u5230\u4e34\u65f6\u76ee\u5f55"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"for i in `cat td.txt `; do mv $i ./tmp/ ; done\n")),(0,n.kt)("p",null,"4.\u6253\u5f00ftp\u5907\u4efd\u6570\u636e"),(0,n.kt)("p",null,"5.\u628a\u4e34\u65f6\u5907\u4efd\u6570\u636e\u8fd8\u539f\u5230\u539f\u6765\u7684\u6570\u636e\u76ee\u5f55"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mv ./tmp/*  .\n")),(0,n.kt)("h3",{id:"\u6062\u590d-3"},"\u6062\u590d"),(0,n.kt)("p",null,"\u5bb9\u5668\u6062\u590d\u9a8c\u8bc1\u65b9\u5f0f"),(0,n.kt)("p",null,"\u8001\u955c\u50cf-\u4e0d\u63a8\u8350\u4f7f\u7528\nkdb_case_sensitive_centos7.5_x86_64_v8r3c02b0370:v1\n192.168.1.203:51888/base/kdb_case_sensitive_centos7.5_x86_64_v8r3c02b0370:v1\n192.168.1.207:51888/base/kdb_case_sensitive_centos7.5_x86_64_v8r3c02b0370:v1"),(0,n.kt)("p",null,"\u65b0\u521b\u5efa\u7684\u955c\u50cf-\u4f7f\u7528\u6b64\u955c\u50cf\n192.168.1.203:51888/base/kdb_case_sensitive_centos7.5_x86_64_v8r3c02b0370:v2\n192.168.1.207:51888/base/kdb_case_sensitive_centos7.5_x86_64_v8r3c02b0370:v2"),(0,n.kt)("p",null,"\u521b\u5efa\u65b9\u5f0f-\u7814\u53d1\u73af\u5883\u90e8\u7f72\u65b9\u5f0f\n\u5c06\u5907\u4efd\u7684\u6570\u636e\u653e\u5230\u5bf9\u5e94\u7684\u76ee\u5f55\n\u670d\u52a1\u5668: 192.168.1.205:/backup/db_backup/kingbase_backup/backup/daily"),(0,n.kt)("p",null,"4.1.1 \u5728\u9700\u8981\u6062\u590d\u7684\u670d\u52a1\u5668\u521b\u5efa\u6587\u4ef6\u5939\nmkdir -p  /data/kingbase_data\n4.1.2 \u590d\u5236\u5907\u4efd\u6587\u4ef6\u5230\u5bf9\u5e94\u7684\u6570\u636e\u76ee\u5f55,\u5047\u5982 alerac20230709.dmp \u662f\u6700\u8fd1\u4e00\u6b21\u7684\u5907\u4efd\n\u4e0a\u4f20xxx.dmp\u6587\u4ef6\u5230  /data/kingbase_data"),(0,n.kt)("p",null,"4.1.3 \u521b\u5efa\u5bb9\u5668\uff0c\u4f46\u4e0d\u9700\u8981\u6302\u8f7d\n#\u521d\u59cb\u5316\ndocker run  -p 54321:54321  --name kingbasev8r3 \\\n192.168.1.203:51888/base/kdb_case_sensitive_centos7.5_x86_64_v8r3c02b0370:v2\n#CASE_SENSITIVE\u4e0d\u533a\u5206\u5927\u5c0f\u5199"),(0,n.kt)("p",null,"4.1.4 \u5bfc\u5165\u6570\u636e-\u53d6\u6700\u8fd1\u4e00\u6b21\u6700\u65b0\u7684\u5907\u4efd\u6570\u636e\n\u670d\u52a1\u5668\n\u6570\u636e\u6240\u5728\u6587\u4ef6\u5939\n\u5907\u4efd\u6587\u4ef6-\u7c7b\u4f3c\u4ee5\u4e0b\u6587\u4ef6\n192.168.1.205\n\u6d89\u53ca\u5230\u6570\u636e\u5e93: iteshelldev,iteshelltest\n/backup/db_backup/kingbase_backup/backup/daily"),(0,n.kt)("p",null,(0,n.kt)("img",{src:t(13726).Z,width:"1332",height:"324"})),(0,n.kt)("p",null,"4.1.5 \u62f7\u8d1d\u6570\u636e\u5e93\u6587\u4ef6\u7cfb\u7edf\u5230\u5bbf\u4e3b\u673a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"cd   /data/kingbase_data\ndocker cp kingbasev8r3:/home/test/data .\nchmod -R 700 /data/kingbase_data/data\ndocker rm -f kingbasev8r3\n\ndocker run  -d -p 54321:54321  --name kingbasev8r3 \\\n-v  /data/kingbase_data/data:/home/test/data/ \\\n192.168.1.203:51888/base/kdb_case_sensitive_centos7.5_x86_64_v8r3c02b0370:v2\n")),(0,n.kt)("p",null,"4.1.6 \u67e5\u8be2\u662f\u5426\u4e0d\u533a\u5206\u5927\u5c0f\u5199"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker exec -it kingbasev8r3 bash\ncd /home/test/KingbaseES/bin\n./ksql -d TEST -U SYSTEM -W 123456\nTEST=# show case_sensitive;\n case_sensitive \n----------------\n off\n(1 row)\n\n")),(0,n.kt)("p",null,"4.1.7  \u767b\u5f55\u6570\u636e\u5e93-\u6062\u590d\u6570\u636e"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"\u9ed8\u8ba4\u7528\u6237/\u5bc6\u7801\uff1aSYSTEM/123456\ncd /home/test/KingbaseES/bin\n./ksql -d TEST -U SYSTEM -W 123456\n\n-- \u521b\u5efaiteshelldev\u7528\u6237\nCREATE USER iteshelldev  PASSWORD 'iteshelldev2023';\n-- \u521b\u5efaiteshelldev\u5e93\nCREATE DATABASE iteshelldev WITH OWNER = \"iteshelldev\" ENCODING UTF8;\n-- \u521b\u5efaschema\ncreate schema %s\n\n-- \u521b\u5efaiteshelltest\u7528\u6237\nCREATE USER iteshelltest  PASSWORD 'iteshelltest2023';\n-- \u521b\u5efaiteshelltest\u5e93\nCREATE DATABASE iteshelltest WITH OWNER = \"iteshelltest\" ENCODING UTF8;\n-- \u521b\u5efaschema\ncreate schema %s\n")),(0,n.kt)("p",null,"4.1.8 \u5c06\u903b\u8f91\u5907\u4efd\u6587\u4ef6\u5bfc\u5165\u5bb9\u5668\u4e2d\uff0c\u6307\u5b9a\u76ee\u5f55\u4e3a/root"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker cp iteshelldev20230719.dmp kingbasev8r3:/root/\ndocker cp iteshelltest20230719.dmp  kingbasev8r3:/root\n")),(0,n.kt)("p",null,"4.1.9 \u8fdb\u884c\u6570\u636e\u6062\u590d"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker exec -it kingbasev8r3 bash\ncd /home/test/KingbaseES/bin\n\u5bfc\u5165\u6570\u636e\uff0c\u8f93\u5165system\u7528\u6237\u540d\u5bc6\u7801\n[root@2a866ef87f59 bin]# ./sys_restore   -Fc /root/iteshelldev20230719.dmp  -Usystem  -diteshelldev\nPassword: \n[root@2a866ef87f59 bin]# ./sys_restore   -Fc /root/iteshelltest20230719.dmp   -Usystem  -diteshelltest\nPassword:\n")),(0,n.kt)("p",null,"\u767b\u5f55\u9a8c\u8bc1\uff0c \u4f7f\u7528\u5ba2\u6237\u7aef\u767b\u5f55\u9a8c\u8bc1\u5373\u53ef"),(0,n.kt)("h2",{id:"5oracle"},"5\u3001Oracle"),(0,n.kt)("h3",{id:"\u5907\u4efd-4"},"\u5907\u4efd"),(0,n.kt)("p",null,"5.1 \u5bbf\u4e3b\u673a\u5907\u4efd\u76ee\u5f55\n192.168.1.203:/data/oracle11g_data/helowin/backup"),(0,n.kt)("p",null,"5.2 \u5b9a\u65f6\u5907\u4efd\u547d\u4ee4(\u5bbf\u4e3b\u673acrontab)\uff1a\n\u5bbf\u4e3b\u673a\u5b9a\u65f6\u547d\u4ee4:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"45 20 * * * docker exec -i 320df33197e2  sh /home/oracle/oracle11g_crontab_bak.sh  (\u5207\u52ff\u968f\u610f\u6267\u884c) \n")),(0,n.kt)("p",null,"5.3  \u5bb9\u5668\u4e2d\u5907\u4efd\u7684\u811a\u672c: "),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"[root@beijing-physicalsvr04 backup]# docker exec -i 320df33197e2  cat /home/oracle/oracle11g_crontab_bak.sh\n#!/bin/bash\nsource /etc/profile\nbackup_date=`date +%Y%m%d`\nexpdp test_yx/test_yx_gasu2023_#@127.0.0.1:1521/helowin directory=datapump_bak dumpfile=yxgasu$backup_date.dmp\nexpdp test_salt/test_salt_tz2023_#@127.0.0.1:1521/helowin directory=datapump_bak dumpfile=salt$backup_date.dmp\nexpdp test_cnacg_iteshell/test_cnacg_iteshell_2023_#@127.0.0.1:1521/helowin directory=datapump_bak dumpfile=cnacg$backup_date.dmp\n")),(0,n.kt)("p",null,"5.4 \u5f02\u5730\u5907\u4efd:\n1.\u5bfc\u51fa\u6700\u8fd1\u4e00\u6b21\u6570\u636e\u5907\u4efd\u6587\u4ef6"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"cd /data/oracle11g_data/helowin/backup\nls -lrt | grep -E  \"yxgasu|salt|cnacg\" | awk '{print $NF}' | tail -n 3  > td.txt\n")),(0,n.kt)("p",null,"2.\u521b\u5efa\u4e34\u76ee\u5f55(\u7b2c\u4e00\u6b21\u9700\u8981\uff0c\u540e\u7eed\u53ef\u4ee5\u7701\u7565)\nmkdir tmp"),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"\u79fb\u52a8\u5907\u4efd\u6587\u4ef6\u5230\u4e34\u65f6\u76ee\u5f55")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"for i in `cat td.txt `; do mv $i ./tmp/ ; done\n")),(0,n.kt)("p",null,"4.\u6253\u5f00ftp\u5907\u4efd\u6570\u636e"),(0,n.kt)("p",null,"5.\u628a\u4e34\u65f6\u5907\u4efd\u6570\u636e\u8fd8\u539f\u5230\u539f\u6765\u7684\u6570\u636e\u76ee\u5f55"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mv ./tmp/*  .\n")),(0,n.kt)("p",null,"\u5907\u4efd\u955c\u50cf\u5730\u5740:",(0,n.kt)("br",{parentName:"p"}),"\n","192.168.1.203:18188/base/oracle_11g:latest\n192.168.1.207:18188/base/oracle_11g:latest"),(0,n.kt)("h3",{id:"\u6062\u590d-4"},"\u6062\u590d"),(0,n.kt)("h2",{id:"6\u7985\u9053\u5907\u4efd"},"6\u3001\u7985\u9053\u5907\u4efd"),(0,n.kt)("h3",{id:"\u5907\u4efd-5"},"\u5907\u4efd"),(0,n.kt)("p",null,"6.1 \u5bbf\u4e3b\u673a\u5907\u4efd\u76ee\u5f55\n\u521b\u5efa\u5bb9\u5668\u7ed1\u5b9a\u76ee\u5f55:\n",(0,n.kt)("img",{src:t(97422).Z,width:"1087",height:"185"})),(0,n.kt)("p",null,"\u6570\u636e\u5e93\u5907\u4efd\uff1a\n",(0,n.kt)("img",{src:t(44597).Z,width:"1223",height:"299"})),(0,n.kt)("p",null,"6.2 \u5b9a\u65f6\u5907\u4efd\u547d\u4ee4(\u5bbf\u4e3b\u673acrontab)\uff1a\n\u5bbf\u4e3b\u673a\u5b9a\u65f6\u547d\u4ee4:",(0,n.kt)("br",{parentName:"p"}),"\n","30 6 * * ",(0,n.kt)("em",{parentName:"p"}," docker exec -i a9e91a450b1d sh /root/zentao_db_bak.sh\n40 6 ")," * ",(0,n.kt)("em",{parentName:"p"}," docker exec -i a9e91a450b1d sh /root/clean_sql.sh\n41 6 ")," * * docker exec -i a9e91a450b1d sh /root/clean_upload.sh"),(0,n.kt)("p",null,"6.3  \u5bb9\u5668\u4e2d\u5907\u4efd\u7684\u811a\u672czentao_db_bak.sh"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'[root@beijing-physicalsvr04 data]# docker exec -i 7f71ec8126dc   cat /root/zentao_db_bak.sh\n#!/bin/bash\nsource /etc/profile\nbackup_date=`date +%Y%m%d`\nBACK_DIR="/opt/zbox/data/backup"\n/opt/zbox/run/mysql/mysqldump  -uroot -h127.0.0.1 -p$PASS  --databases zentao  > ${BACK_DIR}/zentao_db_bak_${backup_date}.sql\n/opt/zbox/run/mysql/mysqldump  -uroot -h127.0.0.1 -p$PASS  --databases zentaoep  >  ${BACK_DIR}/zentaoep_db_bak_${backup_date}.sql\n/opt/zbox/run/mysql/mysqldump  -uroot -h127.0.0.1 -p$PASS  --databases zentaopro  > ${BACK_DIR}/zentaopro_db_bak_${backup_date}.sql\n\n###upload backup\nbackup_date=`date +%Y%m%d%M`\nupload_dir="/opt/zbox/app/zentao/www/data/upload"\ncd ${upload_dir}\ntar -zcf  ./backup/upload_bak_${backup_date}.tar.gz  --exclude="backup"  ./*\n')),(0,n.kt)("p",null,'\u6570\u636e\u5e93\u5907\u4efd\u5386\u53f2\u7248\u672c\u548c\u9644\u4ef6\u4fdd\u7559\u811a\u672c\u6837\u4f8b:\nback_dir="/opt/zbox/data/backup/"     sql\u5907\u4efd\u76ee\u5f55\nback_dir="/opt/zbox/app/zentao/www/data/upload/backup"  upload\u5907\u4efd\u76ee\u5f55'),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'[root@a9e91a450b1d ~]# cat clean_backup.sh  \n#!/bin/bash \n#\u6b64\u811a\u672c\u7528\u6765\u5b9a\u65f6\u5907\u4efdjenkins_home\u6570\u636e \u5907\u4efd\u6570\u636e\u5b58\u653e\u5728/usr/local/jenkins_backup/\u4e0b\nFILE_NAME="zentao_backup"\nCOLOR=\'echo -e \\E[01;32m\'\nEND=\'\\E[0m\'\nback_dir="/opt/zbox/data/backup/"\nid_num="9"   ###\u5b9a\u4e49\u5f53\u524d\u4fdd\u7559\u7684\u7248\u672c\ncd $data_dir \nls -lt $back_dir/  | grep -v total | awk \'{print $9}\' | head -n 4\n\n\nall_file_num=`ls -lt $back_dir/  | grep -v total | awk \'{print $9}\' | wc | awk \'{print $1}\'`\nrm_list(){\nif [ $all_file_num -gt ${id_num} ]; then \n    a=0\n    b=0\n    c=0\n    t=0\n    flag=0\n    declare -a file_prune_list\n\n    for list in `ls -lt $back_dir/  | grep -v total | awk \'{print $9}\'` ; do\n      all_file_list[$a]=$list\n      a=$[a+1]\n    done    \n\n\n    #\u9700\u8981\u4fdd\u5b58\u7684\u5386\u53f2\u7248\u672c\n    for  list in `ls -lt $back_dir/  | grep -v total | awk \'{print $9}\' | head -n ${id_num}`; do\n      save_file_list[$b]=$list \n      b=$[b+1]\n    done \n\n    #\u5c06\u4e24\u7ec4\u6587\u4ef6\u5b58\u5165\u5230\u6570\u7ec4\n    arry_list1=${all_file_list[@]}\n    arry_list2=${save_file_list[@]}\n\n    for list1_num in "${all_file_list[@]}"\n    do \n       for list2_num in "${save_file_list[@]}"\n       do \n           if [[ "${list1_num}" == "${list2_num}" ]]; then \n               flag=1\n               break \n           fi\n       done \n       if [[ $flag -eq 0 ]]; then \n          file_prune_list[t]=$list1_num\n          t=$((t+1))\n       else\n          flag=0 \n       fi     \n    done  \n\n\n\nelse    \n  echo "################### \u5f53\u524d\u6587\u4ef6 ${FILE_NAME} \u5386\u53f2\u7248\u672c\u5c0f\u4e8e${id_num}\u4e2a  #####################"\n  exit\n\nfi\n\nfor i in "${file_prune_list[@]}"; do \n     rm -f $back_dir/$i   \n    echo "################## \u5220\u9664\u6587\u4ef6  ${FILE_NAME} \u5386\u53f2\u7248\u672c $i #####################"\ndone \n}\nrm_list\n\n')),(0,n.kt)("p",null,"6.4 \u5f02\u5730\u5907\u4efd-\u624b\u52a8:\n\u5bfc\u51fa\u9644\u4ef6\n1.\u5bfc\u51fa\u6700\u8fd1\u4e00\u6b21\u6570\u636e\u5907\u4efd\u6587\u4ef6"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"cd  /data/zentao_data/upload/backup\nls -lrt | grep -E  \"upload_bak\" | awk '{print $NF}' | tail -n 1  > td.txt\n")),(0,n.kt)("p",null,"2.\u521b\u5efa\u4e34\u76ee\u5f55(\u7b2c\u4e00\u6b21\u9700\u8981\uff0c\u540e\u7eed\u53ef\u4ee5\u7701\u7565)\nmkdir tmp"),(0,n.kt)("p",null,"3.\u79fb\u52a8\u5907\u4efd\u6587\u4ef6\u5230\u4e34\u65f6\u76ee\u5f55"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"for i in `cat td.txt `; do mv $i ./tmp/ ; done\n")),(0,n.kt)("p",null,"4.\u6253\u5f00ftp\u5907\u4efd\u6570\u636e"),(0,n.kt)("p",null,"5.\u628a\u4e34\u65f6\u5907\u4efd\u6570\u636e\u8fd8\u539f\u5230\u539f\u6765\u7684\u6570\u636e\u76ee\u5f55\nmv ./tmp/*  ."),(0,n.kt)("p",null,"\u5bfc\u51fa\u6570\u636e\u5e93\n1.\u5bfc\u51fa\u6700\u8fd1\u4e00\u6b21\u6570\u636e\u5907\u4efd\u6587\u4ef6"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"cd  /data/zentao_data/data/backup\nls -lrt | grep -E  \"zentao_db_bak\" | awk '{print $NF}' | tail -n 1  > td.txt\n")),(0,n.kt)("p",null,"2.\u521b\u5efa\u4e34\u76ee\u5f55(\u7b2c\u4e00\u6b21\u9700\u8981\uff0c\u540e\u7eed\u53ef\u4ee5\u7701\u7565)\nmkdir tmp"),(0,n.kt)("p",null,"3.\u79fb\u52a8\u5907\u4efd\u6587\u4ef6\u5230\u4e34\u65f6\u76ee\u5f55"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"for i in `cat td.txt `; do mv $i ./tmp/ ; done\n")),(0,n.kt)("p",null,"4.\u6253\u5f00ftp\u5907\u4efd\u6570\u636e"),(0,n.kt)("p",null,"5.\u628a\u4e34\u65f6\u5907\u4efd\u6570\u636e\u8fd8\u539f\u5230\u539f\u6765\u7684\u6570\u636e\u76ee\u5f55\nmv ./tmp/*  ."),(0,n.kt)("p",null,"6.5 \u6570\u636e\u540c\u6b65-rsync\u540c\u6b65\n\u4e3b\u673a\n\u539f\u6570\u636e\u76ee\u5f55\n\u76ee\u6807\u76ee\u5f55\n192.168.1.203\n/data/zentao_data/\n192.168.1.205\n/backup/devops_backup/zentao_backup/"),(0,n.kt)("h3",{id:"\u6062\u590d-5"},"\u6062\u590d"),(0,n.kt)("p",null,"6.1 \u5bb9\u5668\u6062\u590d\u9a8c\u8bc1\n\u955c\u50cf\nregistry.qt.atme.top:8200/zentao/zentao:v1.0\n192.168.1.203:18188/base/zentao:v1.0\n192.168.1.207:18188/base/zentao:v1.0"),(0,n.kt)("p",null,"\u521b\u5efa\u65b9\u5f0f-\u7814\u53d1\u73af\u5883\u90e8\u7f72\u65b9\u5f0f\n\u5c06\u5907\u4efd\u7684\u6570\u636e\u653e\u5230\u5bf9\u5e94\u7684\u76ee\u5f55\n\u670d\u52a1\u5668: 192.168.1.205:/backup/devops_backup/zentao_backup"),(0,n.kt)("p",null,"6.1.1 \u521b\u5efa\u6587\u4ef6\u5939"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mkdir -p  /data/zentao_data/data\nmkdir -p  /data/zentao_data/upload\n")),(0,n.kt)("p",null,"6.1.2 \u590d\u5236\u5907\u4efd\u6587\u4ef6\u5230\u5bf9\u5e94\u7684\u6570\u636e\u76ee\u5f55,upload_bak_2023062530.tar.gz\u662f\u6700\u8fd1\u4e00\u6b21\u7684\u5907\u4efd"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"tar xf  upload_bak_2023062530.tar.gz -C /data/zentao_data/upload\ntar xf  mysql.tar      /data/zentao_data/data   ##\u540e\u9762\u8fdb\u884c\u589e\u91cf\u6570\u636e\u5bfc\u5165\n")),(0,n.kt)("p",null,"6.1.3 \u4f7f\u7528service\u90e8\u7f72\u670d\u52a1"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker service create --name zentao \\\n--network devops \\ \n--constraint 'node.labels.role == entry' \\\n--mount type=bind,src=/etc/localtime,dst=/etc/localtime \\\n--mount type=bind,src=/data/zentao_data/data,dst=/opt/zbox/data \\\n--mount type=bind,src=/data/zentao_data/upload,dst=/opt/zbox/app/zentao/www/data/upload \\\nregistry.www.zlqit.com:8200/zentao/zentao:v1.0\n")),(0,n.kt)("p",null,"6.1.4 \u5bfc\u5165\u6570\u636e"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker exec -it  xxxxx bash\n/opt/zbox/run/mysql/mysql  -h127.0.0.1 -p123456\nMariaDB [zentao]> source /root/zentao_db_bak_20230718.sql\n")),(0,n.kt)("p",null,"\u5bb9\u5668\u65b9\u5f0f\n\u53c2\u8003\u4ee5\u4e0a6.1.1-6.1.2, 6.1.4"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"docker run  -p 1080:80 --name zentao \\\n--mount type=bind,src=/etc/localtime,dst=/etc/localtime \\\n--mount type=bind,src=/data/zentao_data/data,dst=/opt/zbox/data \\\n--mount type=bind,src=/data/zentao_data/upload,dst=/opt/zbox/app/zentao/www/data/upload \\\n192.168.1.203:51888/base/zentao:v1.0\n[root@demo112 data]# docker exec -it zentao bash\n")),(0,n.kt)("h2",{id:"7jenkins\u6570\u636e\u5907\u4efd"},"7\u3001jenkins\u6570\u636e\u5907\u4efd"),(0,n.kt)("h3",{id:"\u5907\u4efd-6"},"\u5907\u4efd"),(0,n.kt)("p",null,"\u8bf4\u660e\uff1a \u7531\u4e8e\u6570\u636e\u6bd4\u8f83\u5927\uff0c\u5927\u7ea640G\u5de6\u53f3\uff0c\u76ee\u524d\u53ea\u4fdd\u7559\u4e24\u4e2a\u5386\u53f2\u7248\u672c\uff0c\u6570\u636e\u5907\u4efd\u4e3a2\u5929\u5907\u4efd\u4e00\u6b21\n\u5907\u4efd\u65e5\u671f\u4e3a: \u5468\u4e00\uff0c\u5468\u4e09\uff0c\u5468\u4e94\uff0c\u5468\u65e5\u3002\u51cc\u666800:05\n\u670d\u52a1\u5668\u5730\u5740: 192.168.1.204\n","[root@beijing-virtualsvr01 script]","# crontab  -l\n5 00 * * 1,3,5,7 bash /opt/script/jenkins_home_backup.sh"),(0,n.kt)("p",null,"\u5907\u4efd\u811a\u672c"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'[root@beijing-virtualsvr01 script]# cat /opt/script/jenkins_home_backup.sh \n#!/usr/bin/bash\n#\u6b64\u811a\u672c\u7528\u6765\u5b9a\u65f6\u5907\u4efdjenkins_home\u6570\u636e \u5907\u4efd\u6570\u636e\u5b58\u653e\u5728/data/jenkins/jenkins_backup\u4e0b\nFILE_NAME="jenkins_home_databack"\ndatetime=`date \'+%Y%m%d%H%M%S\'`\ndata_dir="/data/jenkins/.jenkins"\nback_dir="/data/jenkins/jenkins_backup"\nlog_dir="/var/log"\nCOLOR=\'echo -e \\E[01;32m\'\nEND=\'\\E[0m\'\n$COLOR"########\u6b64\u811a\u672c\u7528\u6765\u5b9a\u65f6\u5907\u4efdjenkins_home\u6570\u636e \u5907\u4efd\u6570\u636e\u5b58\u653e\u5728${back_dir}\u4e0b########"  $END \necho "[INFO] ###############`date +%Y-%m-%d_%H:%M:%S`###############" >> ${log_dir}/logout.log\necho "[INFO] `date +%Y-%m-%d_%H:%M:%S` \u5907\u4efd\u6570\u636e\u5b58\u653e\u5728${back_dir}" >> ${log_dir}/logout.log\n$COLOR"\u8bf7\u7a0d\u540e......"  $END \necho "[INFO] `date +%Y-%m-%d_%H:%M:%S`  \u6b63\u5728\u5907\u4efd\u6570\u636e" >> ${log_dir}/logout.log\ncd $data_dir \ntar cf  $back_dir/${datetime}_jenkins_data.tar.gz  ./* \necho "[INFO] `date +%Y-%m-%d_%H:%M:%S` \u5907\u4efd\u5b8c\u6210\uff0c\u5907\u4efd\u6587\u4ef6\u4e3a--\x3e $back_dir/${datetime}_jenkins_data.tar.gz" >> ${log_dir}/logout.log\necho "[INFO] `date +%Y-%m-%d_%H:%M:%S` \u5f00\u59cb\u6e05\u7406\u5907\u4efd\u65e7\u6570\u636e" >> ${log_dir}/logout.log\nls -lt $back_dir/  | grep -v total | awk \'{print $9}\' | head -n 4\n\n\n###\u5bf9\u5386\u53f2\u7248\u672c\u8fdb\u884c\u5220\u9664\nall_file_num=`ls -lt $back_dir/  | grep -v total | awk \'{print $9}\' | wc | awk \'{print $1}\'`\nrm_list(){\nif [ $all_file_num -gt 3 ]; then \n    a=0\n    b=0\n    c=0\n    t=0\n    flag=0\n    declare -a file_prune_list\n\n    #\u6240\u6709\u7684\u5386\u53f2\u5907\u4efd\u6587\u4ef6\n    for list in `ls -lt $back_dir/  | grep -v total | awk \'{print $9}\'` ; do\n      all_file_list[$a]=$list\n      a=$[a+1]\n    done    \n\n\n    #\u9700\u8981\u4fdd\u5b58\u7684\u5386\u53f2\u7248\u672c\n    for  list in `ls -lt $back_dir/  | grep -v total | awk \'{print $9}\' | head -n 3`; do\n      save_file_list[$b]=$list \n      b=$[b+1]\n    done \n\n    #\u5c06\u4e24\u7ec4\u6587\u4ef6\u5b58\u5165\u5230\u6570\u7ec4\n    arry_list1=${all_file_list[@]}\n    arry_list2=${save_file_list[@]}\n\n    for list1_num in "${all_file_list[@]}"\n    do \n       for list2_num in "${save_file_list[@]}"\n       do \n           if [[ "${list1_num}" == "${list2_num}" ]]; then \n               flag=1\n               break \n           fi\n       done \n       if [[ $flag -eq 0 ]]; then \n          file_prune_list[t]=$list1_num\n          t=$((t+1))\n       else\n          flag=0 \n       fi     \n    done  \n\n\n\nelse    \n  echo "################### \u5f53\u524d\u6587\u4ef6 ${FILE_NAME} \u5386\u53f2\u7248\u672c\u5c0f\u4e8e3\u4e2a  #####################"\n  echo "[INFO] `date +%Y-%m-%d_%H:%M:%S`  \u5f53\u524d\u6587\u4ef6 ${FILE_NAME} \u5386\u53f2\u7248\u672c\u5c0f\u4e8e3\u4e2a " >> ${log_dir}/logout.log\n  exit\n  echo "[INFO] `date +%Y-%m-%d_%H:%M:%S` \u5f53\u524d\u4efb\u52a1\u5df2\u7ed3\u675f" >> ${log_dir}/logout.log\nfi\n\nfor i in "${file_prune_list[@]}"; do \n    echo [INFO]\u6b63\u5728\u5220\u9664\u6587\u4ef6  $back_dir/$i\n    echo "[INFO] `date +%Y-%m-%d_%H:%M:%S` \u6b63\u5728\u5220\u9664\u6587\u4ef6 $back_dir/$i " >>${log_dir}/logout.log\n    rm -f $back_dir/$i\n    echo "################## \u5220\u9664\u6587\u4ef6  ${FILE_NAME} \u5386\u53f2\u7248\u672c $i #####################"\n    echo "[INFO] `date +%Y-%m-%d_%H:%M:%S` \u5f53\u524d\u4efb\u52a1\u5df2\u7ed3\u675f" >> ${log_dir}/logout.log\ndone \n}\nrm_list\n')),(0,n.kt)("h2",{id:"8kvm\u5907\u4efd"},"8\u3001Kvm\u5907\u4efd"),(0,n.kt)("p",null,"30 2 * * 1-5  sh /data/script/kvm_snapshot.sh"),(0,n.kt)("p",null,"####\u5feb\u7167\u547d\u4ee4"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'[root@beijing-physicalsvr04 ~]# cat /data/script/kvm_snapshot.sh \nvirsh snapshot-create-as QTCICD  --name  QTCICD_`date +%Y-%m-%d-%H-%M` --description "QTCICD snapshot"\n')),(0,n.kt)("h2",{id:"9yapi"},"9\u3001yapi"),(0,n.kt)("h3",{id:"\u5907\u4efd-7"},"\u5907\u4efd"),(0,n.kt)("p",null,"yapi\u5907\u4efd\n\u673a\u5668: 192.168.1.203\nmongodb\u6570\u636e\u5e93\u5907\u4efd\u521b\u5efa\u6587\u4ef6"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"[root@beijing-physicalsvr04 mongodb]# pwd\n/data/yapi_data/mongodb\n[root@beijing-physicalsvr04 mongodb]# cat day.sh \ndatedir=`date '+%Y%m%d%H'`\nmkdir -p /data/db/backup/day/${datedir} -p || true\nmongodump -h 127.0.0.1 -u yapi -p yapi1819  --port 27017 --authenticationDatabase admin  -d yapi -o /data/db/backup/day/${datedir}\n")),(0,n.kt)("p",null,"\u5907\u4efd\u7b56\u7565:\n\u6bcf\u96941\u5929\u5907\u4efd\u4e00\u6b21\uff0c 23\uff1a10\u5f00\u59cb\u5907\u4efd\n#yapi\u5907\u4efd"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"10 23 * * * docker exec -i mongodb-yapi  sh /root/day.sh && sleep 20 && mv /data/yapi_data/mongodb/data/backup/day/*   /backup/devops_backup/yapi_backup/day/\n")),(0,n.kt)("p",null,"\u6570\u636e\u5e93\u521b\u5efa\u65b9\u5f0f\n\u76ee\u5f55\uff1a /data/yapi_data/mongodb"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"[root@beijing-physicalsvr04 mongodb]# cat start.sh \n#!/bin/bash\nMONGODB_DIR=/data/yapi_data/mongodb\ndocker stop mongodb-yapi\ndocker rm mongodb-yapi\ndocker run -d \\\n  --name mongodb-yapi \\\n  --restart always \\\n  --privileged \\\n  -p 27717:27117 \\\n  -v ${MONGODB_DIR}/data:/data/db \\\n  -e MONGO_INITDB_ROOT_USERNAME=root \\\n  -e MONGO_INITDB_ROOT_PASSWORD=aaaaaaaaaa  \\\n  192.168.1.203:51888/base/mongo:6.0.6  mongod --auth\n\n")),(0,n.kt)("h3",{id:"\u6062\u590d-6"},"\u6062\u590d"),(0,n.kt)("p",null,"10.1 \u5bb9\u5668\u6062\u590d\u9a8c\u8bc1\n\u955c\u50cf\n192.168.1.203:18188/base/mongo:6.0.6\n192.168.1.207:1818/base/mongo:6.0.6"),(0,n.kt)("p",null,"\u521b\u5efa\u65b9\u5f0f-\u7814\u53d1\u73af\u5883\u90e8\u7f72\u65b9\u5f0f\n\u5c06\u5907\u4efd\u7684\u6570\u636e\u653e\u5230\u5bf9\u5e94\u7684\u76ee\u5f55\n\u670d\u52a1\u5668: 192.168.1.205:/backup/devops_backup/yapi_backup/day"),(0,n.kt)("p",null,"6.1.1 \u521b\u5efa\u6587\u4ef6\u5939\nmkdir -p  /data/yapi_data/mongodb"),(0,n.kt)("p",null,"6.1.2 \u590d\u5236\u5907\u4efd\u6570\u636e\u4e0a\u4f20\u6253\u5230\u6062\u590d\u7684\u670d\u52a1\u5668,\u9700\u8981\u6253\u5305\u6574\u4e2a\u6587\u4ef6\u5939\n#\u5728\u4ee5\u4e0b\u670d\u52a1\u5668\u53d6\u6570\u636e"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"192.168.1.205:/backup/devops_backup/yapi_backup/day\ntar zcvf 20230731.tar.gz ./20230732xx\n")),(0,n.kt)("p",null,"#\u4f20\u5230\u9700\u8981\u6062\u590d\u7684\u673a\u5668\nscp 20230731.tar.gz root@xxxxxx:/tmp"),(0,n.kt)("p",null,"##\u8bf4\u660e: 20230731.tar.gz \u662f\u4e3e\u4e2a\u4f8b\u5b50\n6.1.3 \u4f7f\u7528docker\u90e8\u7f72\u670d\u52a1"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"[root@beijing-physicalsvr04 mongodb]# cat start.sh \n#!/bin/bash\nMONGODB_DIR=/data/yapi_data/mongodb\ndocker stop mongodb-yapi\ndocker rm mongodb-yapi\ndocker run -d \\\n  --name mongodb-yapi \\\n  --restart always \\\n  --privileged \\\n  -p 27017:27017 \\\n  -v ${MONGODB_DIR}/data:/data/db \\\n  -e MONGO_INITDB_ROOT_USERNAME=admin \\\n  -e MONGO_INITDB_ROOT_PASSWORD=yapi1819  \\\n  192.168.1.203:18188/base/mongo:6.0.6  mongod --auth\n")),(0,n.kt)("p",null,"6.1.4 \u5bfc\u5165\u6570\u636e"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"cd  /tmp\ntar xf 20230731.tar.gz\ndocker cp  20230731  mongodb-yapi:/root/\ndocker exec -it mongodb-yapi  bash \nmongorestore -u yapi -p yapi1819 --port 27017 --drop --authenticationDatabase admin -d yapi  /root/20230731/yapi\n")),(0,n.kt)("p",null,"\u76f8\u5173\u64cd\u4f5c"),(0,n.kt)("p",null,"\u67e5\u770b\u6570\u636e\u5e93\nshow collections"),(0,n.kt)("p",null,'\u5bfc\u51fa\u6307\u5b9a\u5b57\u6bb5\u7684\u6570\u636e\n\u5bfc\u51fa\u5b57\u6bb5"excetion": "\u9884\u8b66\u5f02\u5e38" \u6240\u6709\u7684\u6570\u636e'),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'mongoexport  --host 127.0.0.1  --port 27017 --db sensorcmd --collection new_alarm --query \'{"excetion": "\u9884\u8b66\u5f02\u5e38"}\' --out mongod-new-well-structured-data20231222.json  --type json\n')),(0,n.kt)("p",null,"\u5bfc\u5165\u6570\u636e"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"mongoimport --host localhost --port 27017 --db demo --collection col --file mongod-new-well-structured-data20231222.json\n")),(0,n.kt)("p",null,"\u67e5\u770b\u96c6\u5408\u4e2d\u603b\u7684\u884c\u6570"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"use your_database_name\ndb.your_collection_name.count()\n")),(0,n.kt)("p",null,"\u5bfc\u51fa\u6307\u5b9a\u6761\u4ef6\u7684\u6570\u636e\n\u5982\u679c\u9700\u8981\u5bfc\u51fa\u6ee1\u8db3\u7279\u5b9a\u6761\u4ef6\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528--query\u53c2\u6570\u3002\u4ee5\u4e0b\u793a\u4f8b\u5c06\u53ea\u5bfc\u51fa\u5e74\u9f84\u5927\u4e8e30\u7684\u7528\u6237\u6570\u636e\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},"mongoexport --host localhost --port 27017 --db mydb --collection users --out users.json --jsonArray --query '{ age: { $gt: 30 } }'\n")),(0,n.kt)("p",null,'mongo\u5220\u9664\u6307\u5b9a\u7684\u5217\ndb.your_collection.updateMany({}, { $unset: { "target_field": 1 } });'),(0,n.kt)("p",null,"mongo\u5220\u9664\u591a\u4e2a\u5217"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'db.your_collection.updateMany({}, { $unset: { "push_desc": 1, "push_person": 1, "push_phone": 1 , "push_time": 1, "record": 1 , "chuzhi_person": 1, "chuzhi_phone": 1, "chuzhi_ts": 1 , "deal_info": 1, "deal_desc": 1, "deal_person": 1, "deal_phone": 1} });\n')))}u.isMDXComponent=!0},15992:(e,a,t)=>{t.d(a,{Z:()=>l});const l=t.p+"assets/images/image-20231210234024392-37b01e4e13ed75237574f1aadec70508.png"},61062:(e,a,t)=>{t.d(a,{Z:()=>l});const l=t.p+"assets/images/image-20231210234638640-03fdb764c163a1969f83904b100a01c0.png"},97422:(e,a,t)=>{t.d(a,{Z:()=>l});const l=t.p+"assets/images/m_161682817279c826fd90705da4c05132_r-6a051b88c155c3caafa19d9970017b98.png"},13726:(e,a,t)=>{t.d(a,{Z:()=>l});const l=t.p+"assets/images/m_895c4d2444fa2ea35429907f453e2a83_r-49a2d6ed3ef244932b45c701a2fce728.png"},44597:(e,a,t)=>{t.d(a,{Z:()=>l});const l=t.p+"assets/images/m_a18b37615b2441ea6fb842eefa0259e2_r-c75d5f07c0eb1baae5631759240489e8.png"},94886:(e,a,t)=>{t.d(a,{Z:()=>l});const l=t.p+"assets/images/m_bddfd1b36ad998d7c14015fe5551c431_r-ea92e78c9fbb48ca0952cd6637b8b28e.png"},66002:(e,a,t)=>{t.d(a,{Z:()=>l});const l=t.p+"assets/images/m_ec20494d5ce1f5a87a4ba85313d2f40c_r-56f9e8a5585d89942a6d3e4179a1f78d.png"}}]);