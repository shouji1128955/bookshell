"use strict";(self.webpackChunkbookshell=self.webpackChunkbookshell||[]).push([[3564],{3905:(e,t,r)=>{r.d(t,{Zo:()=>m,kt:()=>h});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var a=n.createContext({}),l=function(e){var t=n.useContext(a),r=t;return e&&(r="function"==typeof e?e(t):c(c({},t),e)),r},m=function(e){var t=l(e.components);return n.createElement(a.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,a=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),p=l(r),d=o,h=p["".concat(a,".").concat(d)]||p[d]||u[d]||i;return r?n.createElement(h,c(c({ref:t},m),{},{components:r})):n.createElement(h,c({ref:t},m))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,c=new Array(i);c[0]=d;var s={};for(var a in t)hasOwnProperty.call(t,a)&&(s[a]=t[a]);s.originalType=e,s[p]="string"==typeof e?e:o,c[1]=s;for(var l=2;l<i;l++)c[l]=r[l];return n.createElement.apply(null,c)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},1093:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var n=r(7462),o=(r(7294),r(3905));const i={},c=void 0,s={unversionedId:"Prometheus/prometheus/ServiceMoinitor",id:"Prometheus/prometheus/ServiceMoinitor",title:"ServiceMoinitor",description:"ServiceMonitor",source:"@site/docs/Prometheus/prometheus/3-ServiceMoinitor.md",sourceDirName:"Prometheus/prometheus",slug:"/Prometheus/prometheus/ServiceMoinitor",permalink:"/en/docs/Prometheus/prometheus/ServiceMoinitor",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Prometheus/prometheus/3-ServiceMoinitor.md",tags:[],version:"current",lastUpdatedBy:"zhanglaiqiang",lastUpdatedAt:1723466362,formattedLastUpdatedAt:"Aug 12, 2024",sidebarPosition:3,frontMatter:{},sidebar:"PrometheusServer",previous:{title:"prometheus\u6307\u6807",permalink:"/en/docs/Prometheus/prometheus/prometheus\u6307\u6807"}},a={},l=[{value:"ServiceMonitor",id:"servicemonitor",level:3},{value:"1\u3001\u901a\u8fc7ServiceMoinitor\u76d1\u63a7\u670d\u52a1",id:"1\u901a\u8fc7servicemoinitor\u76d1\u63a7\u670d\u52a1",level:3},{value:"1\u3001secret\u6587\u4ef6",id:"1secret\u6587\u4ef6",level:4},{value:"2\u3001\u521b\u5efa\u7aef\u70b9",id:"2\u521b\u5efa\u7aef\u70b9",level:4},{value:"3\u3001\u521b\u5efaServiceMonitor",id:"3\u521b\u5efaservicemonitor",level:4},{value:"4\u3001\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u6ca1\u6709\u751f\u6210target",id:"4\u521b\u5efa\u5b8c\u6210\u540e\u6ca1\u6709\u751f\u6210target",level:4}],m={toc:l},p="wrapper";function u(e){let{components:t,...r}=e;return(0,o.kt)(p,(0,n.Z)({},m,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h3",{id:"servicemonitor"},"ServiceMonitor"),(0,o.kt)("h3",{id:"1\u901a\u8fc7servicemoinitor\u76d1\u63a7\u670d\u52a1"},"1\u3001\u901a\u8fc7ServiceMoinitor\u76d1\u63a7\u670d\u52a1"),(0,o.kt)("p",null,"\u76ee\u7684\uff1a \u5b9e\u73b0etcd\u7684\u76d1\u63a7"),(0,o.kt)("h4",{id:"1secret\u6587\u4ef6"},"1\u3001secret\u6587\u4ef6"),(0,o.kt)("p",null,"\u5728master\u8282\u70b9,\u9700\u8981\u521b\u5efa\u8fde\u63a5etcd\u7684secret\u6587\u4ef6"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl -n monitoring create secret generic etcd-certs --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.crt --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.key --from-file=/etc/kubernetes/pki/etcd/ca.crt\n")),(0,o.kt)("h4",{id:"2\u521b\u5efa\u7aef\u70b9"},"2\u3001\u521b\u5efa\u7aef\u70b9"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Service\nmetadata:\n  name: etcd-k8s\n  namespace: kube-system\n  labels:\n    k8s-app: etcd\nspec:\n  type: ClusterIP\n  clusterIP: None\n  ports:\n    - name: port\n      port: 2379\n      protocol: TCP\n\n---\napiVersion: v1\nkind: Endpoints\nmetadata:\n  name: etcd-k8s\n  namespace: kube-system\n  labels:\n    k8s-app: etcd\nsubsets:\n  - addresses:\n      - ip: 10.51.10.61\n    ports:\n      - name: port\n        port: 2379\n        protocol: TCP\n")),(0,o.kt)("p",null,"\u786e\u8ba4\u670d\u52a1\u662f\u5426\u5b58\u5728 "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"root@bj-master01-61:/apps/prometheus# kubectl get ep  -l k8s-app=etcd -n   kube-system --show-labels\nNAME       ENDPOINTS          AGE   LABELS\netcd-k8s   10.51.10.61:2379   47h   k8s-app=etcd\n")),(0,o.kt)("h4",{id:"3\u521b\u5efaservicemonitor"},"3\u3001\u521b\u5efaServiceMonitor"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"root@bj-master01-61:/apps/prometheus# cat etcd-k8s.yaml\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  annotations:\n    meta.helm.sh/release-name: prometheus\n    meta.helm.sh/release-namespace: monitoring\n  name: etcd-k8s\n  namespace: monitoring\n  labels:\n    release: prometheus\nspec:\n  jobLabel: k8s-app\n  endpoints:\n    - port: port\n      interval: 30s\n      scheme: https\n      tlsConfig:\n        caFile: /etc/prometheus/secrets/etcd-certs/ca.crt\n        certFile: /etc/prometheus/secrets/etcd-certs/healthcheck-client.crt\n        keyFile: /etc/prometheus/secrets/etcd-certs/healthcheck-client.key\n        insecureSkipVerify: true\n  selector:\n    matchLabels:\n      k8s-app: etcd\n  namespaceSelector:\n    matchNames:\n      - kube-system\n")),(0,o.kt)("h4",{id:"4\u521b\u5efa\u5b8c\u6210\u540e\u6ca1\u6709\u751f\u6210target"},"4\u3001\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u6ca1\u6709\u751f\u6210target"),(0,o.kt)("p",null,"\u95ee\u9898\u6392\u67e5\uff0c\u56e0\u4e3a\u662fkube-prometheus-stack\u90e8\u7f72\u7684prometheus,\u6240\u4ee5\u9700\u8981\u786e\u8ba4prometheus\u662f\u5982\u4f55\u53d1\u73b0Servicemonitor"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"root@bj-master01-61:/apps/prometheus# kubectl  get crd\nNAME                                         CREATED AT\nalertmanagerconfigs.monitoring.coreos.com    2024-08-09T17:16:53Z\nalertmanagers.monitoring.coreos.com          2024-08-09T17:16:53Z\nciliumcidrgroups.cilium.io                   2024-07-13T16:29:38Z\nciliumclusterwidenetworkpolicies.cilium.io   2024-07-13T16:29:39Z\nciliumendpoints.cilium.io                    2024-07-13T16:29:38Z\nciliumexternalworkloads.cilium.io            2024-07-13T16:29:38Z\nciliumidentities.cilium.io                   2024-07-13T16:29:38Z\nciliuml2announcementpolicies.cilium.io       2024-07-13T16:29:38Z\nciliumloadbalancerippools.cilium.io          2024-07-13T16:29:38Z\nciliumnetworkpolicies.cilium.io              2024-07-13T16:29:39Z\nciliumnodeconfigs.cilium.io                  2024-07-13T16:29:38Z\nciliumnodes.cilium.io                        2024-07-13T16:29:38Z\nciliumpodippools.cilium.io                   2024-07-13T16:29:38Z\npodmonitors.monitoring.coreos.com            2024-08-09T17:16:53Z\nprobes.monitoring.coreos.com                 2024-08-09T17:16:53Z\nprometheusagents.monitoring.coreos.com       2024-08-09T17:16:53Z\nprometheuses.monitoring.coreos.com           2024-08-09T17:16:53Z\nprometheusrules.monitoring.coreos.com        2024-08-09T17:16:53Z\nscrapeconfigs.monitoring.coreos.com          2024-08-09T17:16:53Z\nservicemonitors.monitoring.coreos.com        2024-08-09T17:16:53Z\nthanosrulers.monitoring.coreos.com           2024-08-09T17:16:54Z\n")),(0,o.kt)("p",null,"\u67e5\u770b\u786e\u8ba4"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"root@bj-master01-61:/apps/prometheus# kubectl  get  prometheuses.monitoring.coreos.com/prometheus-kube-prometheus-prometheus -n monitoring -o yaml\n")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/202408122026209.png",alt:"image-20240812202611853"})),(0,o.kt)("p",null,"\u5176\u4ed6\u7684\u8d44\u6e90\u7c7b\u4f3c\u7684\u64cd\u4f5c"))}u.isMDXComponent=!0}}]);