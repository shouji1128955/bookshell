"use strict";(self.webpackChunkbookshell=self.webpackChunkbookshell||[]).push([[9344],{5680:(n,e,t)=>{t.d(e,{xA:()=>p,yg:()=>u});var a=t(6540);function o(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function r(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function i(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?r(Object(t),!0).forEach((function(e){o(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function s(n,e){if(null==n)return{};var t,a,o=function(n,e){if(null==n)return{};var t,a,o={},r=Object.keys(n);for(a=0;a<r.length;a++)t=r[a],e.indexOf(t)>=0||(o[t]=n[t]);return o}(n,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(a=0;a<r.length;a++)t=r[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}var l=a.createContext({}),g=function(n){var e=a.useContext(l),t=e;return n&&(t="function"==typeof n?n(e):i(i({},e),n)),t},p=function(n){var e=g(n.components);return a.createElement(l.Provider,{value:e},n.children)},c="mdxType",m={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},d=a.forwardRef((function(n,e){var t=n.components,o=n.mdxType,r=n.originalType,l=n.parentName,p=s(n,["components","mdxType","originalType","parentName"]),c=g(t),d=o,u=c["".concat(l,".").concat(d)]||c[d]||m[d]||r;return t?a.createElement(u,i(i({ref:e},p),{},{components:t})):a.createElement(u,i({ref:e},p))}));function u(n,e){var t=arguments,o=e&&e.mdxType;if("string"==typeof n||o){var r=t.length,i=new Array(r);i[0]=d;var s={};for(var l in e)hasOwnProperty.call(e,l)&&(s[l]=e[l]);s.originalType=n,s[c]="string"==typeof n?n:o,i[1]=s;for(var g=2;g<r;g++)i[g]=t[g];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},7997:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>g});var a=t(8168),o=(t(6540),t(5680));const r={},i="Bingo",s={unversionedId:"Golang/golang\u8fd0\u7ef4/\u9879\u76ee1-Bingo/Bingo",id:"Golang/golang\u8fd0\u7ef4/\u9879\u76ee1-Bingo/Bingo",title:"Bingo",description:"\u30101\u3011 Node.js\u7684\u5b89\u88c5",source:"@site/docs/Golang/golang\u8fd0\u7ef4/\u9879\u76ee1-Bingo/Bingo.md",sourceDirName:"Golang/golang\u8fd0\u7ef4/\u9879\u76ee1-Bingo",slug:"/Golang/golang\u8fd0\u7ef4/\u9879\u76ee1-Bingo/Bingo",permalink:"/bookshell/docs/Golang/golang\u8fd0\u7ef4/\u9879\u76ee1-Bingo/Bingo",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Golang/golang\u8fd0\u7ef4/\u9879\u76ee1-Bingo/Bingo.md",tags:[],version:"current",lastUpdatedBy:"zhanglaiqiang",lastUpdatedAt:1727763610,formattedLastUpdatedAt:"2024\u5e7410\u67081\u65e5",frontMatter:{},sidebar:"GoalngOper"},l={},g=[{value:"\u30101\u3011 Node.js\u7684\u5b89\u88c5",id:"1-nodejs\u7684\u5b89\u88c5",level:2},{value:"\u30102\u3011vite\u521b\u5efa\u9879\u76ee111",id:"2vite\u521b\u5efa\u9879\u76ee111",level:2},{value:"2.1\u3001\u9879\u76ee\u642d\u5efa",id:"21\u9879\u76ee\u642d\u5efa",level:3},{value:"2.2\u3001\u9879\u76ee\u76ee\u5f55\u7ed3\u6784\u4ecb\u7ecd",id:"22\u9879\u76ee\u76ee\u5f55\u7ed3\u6784\u4ecb\u7ecd",level:3},{value:"2.3\u3001\u9879\u76ee\u6267\u884c\u6d41\u7a0b\u56fe",id:"23\u9879\u76ee\u6267\u884c\u6d41\u7a0b\u56fe",level:3},{value:"2.4\u3001 css\u6837\u5f0f\u6e05\u9664",id:"24-css\u6837\u5f0f\u6e05\u9664",level:3},{value:"2.5\u3001\u4e3b\u9875\u9762\u677f\u7ec4\u4ef6",id:"25\u4e3b\u9875\u9762\u677f\u7ec4\u4ef6",level:3},{value:"\u30103\u3011ant-design\u63d2\u4ef6",id:"3ant-design\u63d2\u4ef6",level:2},{value:"3.1\u3001Antd\u7ec4\u4ef6\u5e93",id:"31antd\u7ec4\u4ef6\u5e93",level:3},{value:"2.2.1 \u5b89\u88c5\u4f7f\u7528",id:"221-\u5b89\u88c5\u4f7f\u7528",level:4},{value:"2.2.2 \u56fe\u8868\u7ec4\u4ef6",id:"222-\u56fe\u8868\u7ec4\u4ef6",level:4},{value:"3.2\u3001\u9875\u9762\u5c55\u793a",id:"32\u9875\u9762\u5c55\u793a",level:3},{value:"3.2.1 \u9996\u9875\u9762\u677f",id:"321-\u9996\u9875\u9762\u677f",level:4},{value:"3.2.2 \u516c\u5171\u9875\u9762",id:"322-\u516c\u5171\u9875\u9762",level:4},{value:"3.2.3 \u767b\u9646\u754c\u9762",id:"323-\u767b\u9646\u754c\u9762",level:4},{value:"2.1\u3001\u642d\u5efa\u9879\u76ee",id:"21\u642d\u5efa\u9879\u76ee",level:2},{value:"2.2\u3001\u76ee\u5f55\u7ed3\u6784",id:"22\u76ee\u5f55\u7ed3\u6784",level:2},{value:"2.3\u3001\u8def\u7531\u521d\u59cb\u5316",id:"23\u8def\u7531\u521d\u59cb\u5316",level:2},{value:"2.4\u3001\u914d\u7f6e\u521d\u59cb\u5316",id:"24\u914d\u7f6e\u521d\u59cb\u5316",level:2},{value:"2.5\u3001\u65e5\u5fd7\u521d\u59cb\u5316",id:"25\u65e5\u5fd7\u521d\u59cb\u5316",level:2},{value:"\u30101\u3011\u65e5\u5fd7\u7b49\u7ea7",id:"1\u65e5\u5fd7\u7b49\u7ea7",level:3},{value:"\u30102\u3011\u57fa\u672c\u4f7f\u7528",id:"2\u57fa\u672c\u4f7f\u7528",level:3},{value:"\u30103\u3011\u65e5\u5fd7\u914d\u7f6e",id:"3\u65e5\u5fd7\u914d\u7f6e",level:3},{value:"2.6\u3001\u5168\u5c40\u5f02\u5e38\u5904\u7406",id:"26\u5168\u5c40\u5f02\u5e38\u5904\u7406",level:2},{value:"2.7\u3001\u6570\u636e\u5e93\u521d\u59cb\u5316",id:"27\u6570\u636e\u5e93\u521d\u59cb\u5316",level:2},{value:"\u30101\u3011mysql\u7684\u521d\u59cb\u5316",id:"1mysql\u7684\u521d\u59cb\u5316",level:3},{value:"1. \u521b\u5efa\u6570\u636e\u5e93",id:"1-\u521b\u5efa\u6570\u636e\u5e93",level:4},{value:"2. MySQL\u521d\u59cb\u5316",id:"2-mysql\u521d\u59cb\u5316",level:4},{value:"2.8\u3001\u70ed\u81ea\u542f",id:"28\u70ed\u81ea\u542f",level:2},{value:"2.9\u3001axios&amp;\u8de8\u57df\u652f\u6301",id:"29axios\u8de8\u57df\u652f\u6301",level:2},{value:"2.9.1\u3001\u5b89\u88c5\u914d\u7f6eaxios",id:"291\u5b89\u88c5\u914d\u7f6eaxios",level:3},{value:"2.9.2\u3001\u8de8\u57df\u652f\u6301",id:"292\u8de8\u57df\u652f\u6301",level:3},{value:"\u30101\u3011\u670d\u52a1\u7aef\u5b9e\u73b0\u8de8\u57df\u652f\u6301",id:"1\u670d\u52a1\u7aef\u5b9e\u73b0\u8de8\u57df\u652f\u6301",level:3},{value:"\u30102\u3011\u5ba2\u6237\u7aef\u5b9e\u73b0\u8de8\u57df\u652f\u6301",id:"2\u5ba2\u6237\u7aef\u5b9e\u73b0\u8de8\u57df\u652f\u6301",level:3},{value:"3.1\u3001\u7528\u6237\u6a21\u578b",id:"31\u7528\u6237\u6a21\u578b",level:2},{value:"3.2\u3001\u521b\u5efa\u8d26\u6237\u7684API\u63a5\u53e3",id:"32\u521b\u5efa\u8d26\u6237\u7684api\u63a5\u53e3",level:2},{value:"3.3\u3001validator User",id:"33validator-user",level:2},{value:"3.4\u3001JWT",id:"34jwt",level:2},{value:"3.5\u3001go-jwt\u57fa\u672c\u4f7f\u7528",id:"35go-jwt\u57fa\u672c\u4f7f\u7528",level:2},{value:"\uff081\uff09go-jwt\u7684\u57fa\u672c\u529f\u80fd\u6d4b\u8bd5",id:"1go-jwt\u7684\u57fa\u672c\u529f\u80fd\u6d4b\u8bd5",level:3},{value:"\uff082\uff09\u57fa\u4e8ego-jwt\u7684jwt\u5305\u5c01\u88c5",id:"2\u57fa\u4e8ego-jwt\u7684jwt\u5305\u5c01\u88c5",level:3},{value:"3.6\u3001token\u672c\u5730\u5b58\u50a8",id:"36token\u672c\u5730\u5b58\u50a8",level:2},{value:"3.7\u3001\u5c01\u88c5token\u7ba1\u7406\u6587\u4ef6",id:"37\u5c01\u88c5token\u7ba1\u7406\u6587\u4ef6",level:2},{value:"3.8\u3001\u8def\u7531\u5b88\u536b",id:"38\u8def\u7531\u5b88\u536b",level:2},{value:"3.9\u3001\u5ba2\u6237\u7aef\u6ce8\u9500\u767b\u9646",id:"39\u5ba2\u6237\u7aef\u6ce8\u9500\u767b\u9646",level:2},{value:"4.1\u3001\u4e3b\u673a\u7ba1\u7406",id:"41\u4e3b\u673a\u7ba1\u7406",level:2},{value:"1. \u4e3b\u673a\u524d\u7aef\u9875\u9762",id:"1-\u4e3b\u673a\u524d\u7aef\u9875\u9762",level:3},{value:"2. \u4e3b\u673a\u6a21\u578b",id:"2-\u4e3b\u673a\u6a21\u578b",level:3},{value:"3\u3001\u4e3b\u673a\u76f8\u5173API\u5f00\u53d1",id:"3\u4e3b\u673a\u76f8\u5173api\u5f00\u53d1",level:3},{value:"\u30101\u3011\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b",id:"1\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b",level:4},{value:"\u30102\u3011\u67e5\u770b\u4e3b\u673a\u7c7b\u522b",id:"2\u67e5\u770b\u4e3b\u673a\u7c7b\u522b",level:4},{value:"\u30103\u3011\u6dfb\u52a0\u4e3b\u673a",id:"3\u6dfb\u52a0\u4e3b\u673a",level:4},{value:"\u30104\u3011\u67e5\u770b\u4e3b\u673a",id:"4\u67e5\u770b\u4e3b\u673a",level:4},{value:"\u30105\u3011\u5220\u9664\u4e3b\u673a\u63a5\u53e3",id:"5\u5220\u9664\u4e3b\u673a\u63a5\u53e3",level:4},{value:"4\u3001\u5ba2\u6237\u7aef\u4e0eapi\u8054\u8c03",id:"4\u5ba2\u6237\u7aef\u4e0eapi\u8054\u8c03",level:3},{value:"4.2\u3001\u57fa\u4e8essh\u7684\u4e3b\u673a\u9a8c\u8bc1",id:"42\u57fa\u4e8essh\u7684\u4e3b\u673a\u9a8c\u8bc1",level:2},{value:"4.2.1\u3001ssh\u547d\u4ee4",id:"421ssh\u547d\u4ee4",level:3},{value:"4.2.2\u3001go\u8bed\u8a00\u7684ssh\u5305",id:"422go\u8bed\u8a00\u7684ssh\u5305",level:3},{value:"4.2.3\u3001\u57fa\u4e8essh\u7684\u4e3b\u673a\u9a8c\u8bc1",id:"423\u57fa\u4e8essh\u7684\u4e3b\u673a\u9a8c\u8bc1",level:3},{value:"\u30101\u3011\u8bbe\u7f6e\u5168\u5c40\u516c\u79c1\u94a5",id:"1\u8bbe\u7f6e\u5168\u5c40\u516c\u79c1\u94a5",level:4},{value:"\u30102\u3011\u4e3b\u673a\u7ba1\u7406\u5b9e\u73b0\u514d\u5bc6\u767b\u5f55",id:"2\u4e3b\u673a\u7ba1\u7406\u5b9e\u73b0\u514d\u5bc6\u767b\u5f55",level:4},{value:"\u30103\u3011postman\u6d4b\u8bd5\u63a5\u53e3",id:"3postman\u6d4b\u8bd5\u63a5\u53e3",level:4},{value:"\u30104\u3011\u524d\u7aef\u8054\u8c03",id:"4\u524d\u7aef\u8054\u8c03",level:4},{value:"4.3\u3001\u57fa\u4e8ews\u5b9e\u73b0Console",id:"43\u57fa\u4e8ews\u5b9e\u73b0console",level:2},{value:"4.3.1\u3001Websocket\u4ecb\u7ecd",id:"431websocket\u4ecb\u7ecd",level:3},{value:"4.3.2\u3001\u57fa\u4e8ews\u7684websocket\u6d4b\u8bd5",id:"432\u57fa\u4e8ews\u7684websocket\u6d4b\u8bd5",level:3},{value:"4.3.3\u3001Console\u529f\u80fd",id:"433console\u529f\u80fd",level:3},{value:"<strong>\u3010\u524d\u7aef\u5b9e\u73b0\u3011</strong>",id:"\u524d\u7aef\u5b9e\u73b0",level:4},{value:"<strong>\u3010\u540e\u7aef\u5b9e\u73b0\u3011</strong>",id:"\u540e\u7aef\u5b9e\u73b0",level:4},{value:"5.1 \u5c55\u793a\u4e3b\u673a\u4fe1\u606f",id:"51-\u5c55\u793a\u4e3b\u673a\u4fe1\u606f",level:2},{value:"5.2 \u6307\u4ee4\u8f93\u5165\u6846",id:"52-\u6307\u4ee4\u8f93\u5165\u6846",level:2},{value:"5.2.1\u3001Ace-editor \u7f16\u8f91\u5668",id:"521ace-editor-\u7f16\u8f91\u5668",level:3},{value:"5.2.2\u3001\u53d1\u9001\u6267\u884c\u6307\u4ee4\u8bf7\u6c42",id:"522\u53d1\u9001\u6267\u884c\u6307\u4ee4\u8bf7\u6c42",level:3},{value:"5.2.3\u3001\u670d\u52a1\u7aef\u6279\u91cf\u5904\u7406\u6307\u4ee4",id:"523\u670d\u52a1\u7aef\u6279\u91cf\u5904\u7406\u6307\u4ee4",level:3},{value:"5.3 \u6307\u4ee4\u6a21\u677f",id:"53-\u6307\u4ee4\u6a21\u677f",level:2},{value:"5.3.1 \u670d\u52a1\u7aef\u5b9e\u73b0\u6307\u4ee4\u6a21\u677f\u7ba1\u7406",id:"531-\u670d\u52a1\u7aef\u5b9e\u73b0\u6307\u4ee4\u6a21\u677f\u7ba1\u7406",level:3},{value:"5.3.2\u3001\u5ba2\u6237\u7aef\u5c55\u793a\u6307\u4ee4\u6a21\u677f\u754c\u9762\u4e0e\u529f\u80fd\u7684\u5b9e\u73b0",id:"532\u5ba2\u6237\u7aef\u5c55\u793a\u6307\u4ee4\u6a21\u677f\u754c\u9762\u4e0e\u529f\u80fd\u7684\u5b9e\u73b0",level:3},{value:"5.3.3\u3001\u6267\u884c\u5df2\u6709\u7684\u6307\u4ee4",id:"533\u6267\u884c\u5df2\u6709\u7684\u6307\u4ee4",level:3}],p={toc:g},c="wrapper";function m(n){let{components:e,...t}=n;return(0,o.yg)(c,(0,a.A)({},p,t,{components:e,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"bingo"},"Bingo"),(0,o.yg)("h1",{id:"\u4e00\u524d\u7aef\u521d\u59cb\u5316"},"\u4e00\u3001\u524d\u7aef\u521d\u59cb\u5316"),(0,o.yg)("h2",{id:"1-nodejs\u7684\u5b89\u88c5"},"\u30101\u3011 Node.js\u7684\u5b89\u88c5"),(0,o.yg)("p",null,"Node.js\u662f\u4e00\u4e2a\u670d\u52a1\u7aef\u8bed\u8a00\uff0c\u5b83\u7684\u8bed\u6cd5\u548cJavaScript\u7c7b\u4f3c\uff0c\u6240\u4ee5\u53ef\u4ee5\u8bf4\u5b83\u662f\u5c5e\u4e8e\u524d\u7aef\u7684\u540e\u7aef\u8bed\u8a00\uff0c\u540e\u7aef\u8bed\u8a00\u548c\u524d\u7aef\u8bed\u8a00\u7684\u533a\u522b\uff1a"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},"\u8fd0\u884c\u73af\u5883\uff1a\u540e\u7aef\u8bed\u8a00\u4e00\u822c\u8fd0\u884c\u5728\u670d\u52a1\u5668\u7aef\uff0c\u524d\u7aef\u8bed\u8a00\u8fd0\u884c\u5728\u5ba2\u6237\u7aef\u7684\u6d4f\u89c8\u5668\u4e0a")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},"\u529f\u80fd\uff1a\u540e\u7aef\u8bed\u8a00\u53ef\u4ee5\u64cd\u4f5c\u6587\u4ef6\uff0c\u53ef\u4ee5\u8bfb\u5199\u6570\u636e\u5e93\uff0c\u524d\u7aef\u8bed\u8a00\u4e0d\u80fd\u64cd\u4f5c\u6587\u4ef6\uff0c\u4e0d\u80fd\u8bfb\u5199\u6570\u636e\u5e93\u3002"),(0,o.yg)("p",{parentName:"li"},"\u6211\u4eec\u4e00\u822c\u5b89\u88c5LTS(\u957f\u7ebf\u652f\u6301\u7248\u672c)\uff1a"),(0,o.yg)("p",{parentName:"li"},"\u4e0b\u8f7d\u5730\u5740\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://nodejs.org/en/download/%E3%80%90%E4%B8%8A%E9%9D%A2%E5%B7%B2%E7%BB%8F%E5%AE%89%E8%A3%85%E4%BA%86nvm%EF%BC%8C%E9%82%A3%E4%B9%88%E8%BF%99%E9%87%8C%E4%B8%8D%E7%94%A8%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85%E4%BA%86%E3%80%91"},"https://nodejs.org/en/download/\u3010\u4e0a\u9762\u5df2\u7ecf\u5b89\u88c5\u4e86nvm\uff0c\u90a3\u4e48\u8fd9\u91cc\u4e0d\u7528\u624b\u52a8\u5b89\u88c5\u4e86\u3011")),(0,o.yg)("p",{parentName:"li"},"\u4e0b\u8f7d\u4e4b\u540e\u53cc\u51fb\u5b89\u88c5\uff0c\u4e00\u8def\u70b9\u51fb\u4e0b\u4e00\u6b65\u5c31\u53ef\u4ee5\u4e86\u3002"))),(0,o.yg)("p",null,"node.js\u7684\u7248\u672c\u6709\u4e24\u5927\u5206\u652f\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"\u5b98\u65b9\u53d1\u5e03\u7684node.js\u7248\u672c\uff1a0.xx.xx \u8fd9\u79cd\u7248\u672c\u53f7\u5c31\u662f\u5b98\u65b9\u53d1\u5e03\u7684\u7248\u672c\n\u793e\u533a\u53d1\u5e03\u7684node.js\u7248\u672c\uff1axx.xx.x  \u5c31\u662f\u793e\u533a\u5f00\u53d1\u7684\u7248\u672c\n")),(0,o.yg)("p",null,"Node.js\u5982\u679c\u5b89\u88c5\u6210\u529f\uff0c\u53ef\u4ee5\u67e5\u770bNode.js\u7684\u7248\u672c,\u5728\u7ec8\u7aef\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"node -v\nnpm  -v   # pip\n")),(0,o.yg)("p",null,"\u5728\u5b89\u88c5node.js\u5b8c\u6210\u540e\uff0c\u5728node.js\u4e2d\u4f1a\u540c\u65f6\u5e2e\u6211\u4eec\u5b89\u88c5\u4e00\u4e2a\u5305\u7ba1\u7406\u5668npm\u3002\u6211\u4eec\u53ef\u4ee5\u501f\u52a9npm\u547d\u4ee4\u6765\u5b89\u88c5node.js\u7684\u7b2c\u4e09\u65b9\u5305\u3002\u8fd9\u4e2a\u5de5\u5177\u76f8\u5f53\u4e8epython\u7684pip\u7ba1\u7406\u5668\uff0cphp\u7684composer\uff0cgo\u8bed\u8a00\u7684go get\uff0cjava\u7684maven\u3002"),(0,o.yg)("h2",{id:"2vite\u521b\u5efa\u9879\u76ee111"},"\u30102\u3011vite\u521b\u5efa\u9879\u76ee111"),(0,o.yg)("h3",{id:"21\u9879\u76ee\u642d\u5efa"},"2.1\u3001\u9879\u76ee\u642d\u5efa"),(0,o.yg)("p",null,"\u4f7f\u7528vue\u81ea\u52a8\u5316\u5de5\u5177\u53ef\u4ee5\u5feb\u901f\u642d\u5efa\u5355\u9875\u5e94\u7528\u9879\u76ee\u76ee\u5f55\uff0cvite\u4e3a\u73b0\u4ee3\u5316\u7684\u524d\u7aef\u5f00\u53d1\u5de5\u4f5c\u6d41\u63d0\u4f9b\u4e86\u5f00\u7bb1\u5373\u7528\u7684\u6784\u5efa\u914d\u7f6e\u3002\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u8981\u51e0\u5206\u949f\u5373\u53ef\u521b\u5efa\u5e76\u542f\u52a8\u4e00\u4e2a\u5e26\u70ed\u91cd\u8f7d\u3001\u4fdd\u5b58\u65f6\u9759\u6001\u68c0\u67e5\u4ee5\u53ca\u53ef\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u7684\u6784\u5efa\u914d\u7f6e\u7684\u9879\u76ee\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cd  C:\\Users\\Administrator\\Desktop\\bingo\nyarn create vite\n\n# \uff1fProject name: \u203a bingo_web\n# ? Select a framework: \u203a - Use arrow-keys. Return to submit.\n# Vue\n# ? Select a variant: \u203a - Use arrow-keys. Return to submit.\n# JavaScript\ncd bingo_web\nyarn && yarn dev\n")),(0,o.yg)("p",null,"\u6267\u884c\u4e0a\u9762\u547d\u4ee4\u6700\u7ec8\u6548\u679c\u5982\u4e0b\uff1a"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230319154804003.png",alt:"image-20230319154804003"})),(0,o.yg)("p",null,"\u90a3\u4e48\u8bbf\u95ee\u4e00\u4e0b\u547d\u4ee4\u6267\u884c\u5b8c\u6210\u540e\u63d0\u793a\u51fa\u6765\u7684\u7f51\u5740\u5c31\u53ef\u4ee5\u770b\u5230\u7f51\u7ad9\u4e86\uff1ahttp://localhost:5173/"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230809144120246.png",alt:"image-20230809144120246"})),(0,o.yg)("p",null,"\u57fa\u4e8egoland\u8bbe\u7f6e\u542f\u52a8\u9879\u76ee\u6309\u94ae"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230809144632604-1563593.png",alt:"image-20230809144632604"})),(0,o.yg)("h3",{id:"22\u9879\u76ee\u76ee\u5f55\u7ed3\u6784\u4ecb\u7ecd"},"2.2\u3001\u9879\u76ee\u76ee\u5f55\u7ed3\u6784\u4ecb\u7ecd"),(0,o.yg)("p",null,"\u9879\u76ee\u521b\u5efa\u5b8c\u6210\u4e4b\u540e\uff0c\u6211\u4eec\u4f1a\u770b\u5230bingo_web\u9879\u76ee\u5176\u5b9e\u662f\u4e00\u4e2a\u6587\u4ef6\u5939\uff0c\u6211\u4eec\u8fdb\u5165\u5230\u6587\u4ef6\u5939\u5185\u90e8\u5c31\u4f1a\u53d1\u73b0\u4e00\u4e9b\u76ee\u5f55\u548c\u6587\u4ef6\uff0c\u6211\u4eec\u7b80\u5355\u56de\u987e\u4e00\u4e0b\u91cc\u9762\u7684\u90e8\u5206\u6838\u5fc3\u76ee\u5f55\u4e0e\u6587\u4ef6\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"\u251c\u2500node_modules/   # node\u7684\u5305\u76ee\u5f55\uff0c\u9879\u76ee\u8fd0\u884c\u7684\u4f9d\u8d56\u5305\u5b58\u50a8\u76ee\u5f55\uff0cpackage.json\u548cpackage-lock.json\u6587\u4ef6\u4e2d\u4f1a\u81ea\u52a8\u8bb0\u5f55\u4e86\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u6240\u6709\u7684\u5305\u4ee5\u53ca\u5305\u7684\u7248\u672c\u4fe1\u606f\uff0c\n\u251c\u2500public/  # \u9759\u6001\u8d44\u6e90\u76ee\u5f55\uff0c\u9879\u76ee\u4e2d\u7684\u9759\u6001\u8d44\u6e90(css\uff0cjs\uff0c\u56fe\u7247\u7b49\u6587\u4ef6)\u653e\u5728\u8fd9\u4e2a\u6587\u4ef6\u5939\n\u251c\u2500src/       # \u4e3b\u5f00\u53d1\u76ee\u5f55\uff0c\u8981\u5f00\u53d1\u7684\u5ba2\u6237\u7aef\u4ee3\u7801\u6587\u4ef6\uff08\u5355\u6587\u4ef6\u7ec4\u4ef6\uff0ccss\u6837\u5f0f\u3001\u5de5\u5177\u51fd\u6570\u7b49\u7b49\uff09\u5168\u90e8\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\n    \u251c\u2500assets/  # \u9759\u6001\u8d44\u6e90\u5b58\u50a8\u76ee\u5f55\uff0c\u4e0epublic\u76ee\u5f55\u4f5c\u7528\u7c7b\u4f3c\u3002\n    \u251c\u2500router/  # \u8def\u7531\u5b58\u50a8\u76ee\u5f55\uff0c\u662f\u6211\u4eec\u521b\u5efa\u9879\u76ee\u7684\u65f6\u5019\uff0c\u5982\u679c\u9009\u62e9\u5b89\u88c5vue-router\uff0c\u5c31\u81ea\u52a8\u4f1a\u751f\u6210\u8fd9\u4e2a\u76ee\u5f55\u3002\n    \u251c\u2500views/   # \u7ec4\u4ef6\u9875\u9762\u5b58\u50a8\u76ee\u5f55\uff0c\u5c31\u662f\u6d4f\u89c8\u5668\u4e2d\u7528\u6237\u770b\u5230\u7684\u9875\u9762\u5185\u5bb9\uff0cviews\u5f80\u5f80\u4f1a\u52a0\u8f7d\u5e76\u5305\u542bcomponents\u4e2d\u7684\u7ec4\u4ef6\u8fdb\u6765\n    \u251c\u2500components/  # \u7ec4\u4ef6\u5b58\u50a8\u76ee\u5f55\uff0c\u5c31\u662f\u6d4f\u89c8\u5668\u4e2d\u7528\u6237\u770b\u5230\u7684\u9875\u9762\u7684\u4e00\u90e8\u5206\u5185\u5bb9\u3002\n    \u251c\u2500App.vue\n    \u251c\u2500main.js\n    \u2514\u2500style.css\n\u251c\u2500index.html\n\u2514\u2500package.json   #  \u5982\u679cnode_modules\u6ca1\u6709\uff0c\u4f46\u662f\u6709package.json\uff0c\u5219\u53ef\u4ee5\u5728\u7ec8\u7aef\u4e0b\uff0c\u901a\u8fc7npm install\u8fdb\u884c\u6062\u590dnode_modules\u6240\u6709\u5185\u5bb9\u3002\n")),(0,o.yg)("h3",{id:"23\u9879\u76ee\u6267\u884c\u6d41\u7a0b\u56fe"},"2.3\u3001\u9879\u76ee\u6267\u884c\u6d41\u7a0b\u56fe"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/1625305034687-1563796.png",alt:"1625305034687"})),(0,o.yg)("h3",{id:"24-css\u6837\u5f0f\u6e05\u9664"},"2.4\u3001 css\u6837\u5f0f\u6e05\u9664"),(0,o.yg)("p",null,"\u6e05\u7a7asrc/App.vue\u7684\u4ee3\u7801\u5185\u5bb9\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},"<template>\n\n</template>\n\n<script setup>\n\n<\/script>\n\n<style>\n\n</style>\n")),(0,o.yg)("p",null,"\u6e05\u7a7asrc/style.css\u7684\u6837\u5f0f\u5185\u5bb9\uff0c\u5e76\u6839\u636e",(0,o.yg)("inlineCode",{parentName:"p"},"https://github.com/necolas/normalize.css"),"\uff0c\u8865\u5145css\u6837\u5f0f\u521d\u59cb\u5316\u4ee3\u7801\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-css"},'/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */\n\n/* Document\n   ========================================================================== */\n\n/**\n * 1. Correct the line height in all browsers.\n * 2. Prevent adjustments of font size after orientation changes in iOS.\n */\n\nhtml {\n  line-height: 1.15; /* 1 */\n  -webkit-text-size-adjust: 100%; /* 2 */\n}\n\n/* Sections\n   ========================================================================== */\n\n/**\n * Remove the margin in all browsers.\n */\n\nbody {\n  margin: 0;\n}\n\n/**\n * Render the `main` element consistently in IE.\n */\n\nmain {\n  display: block;\n}\n\n/**\n * Correct the font size and margin on `h1` elements within `section` and\n * `article` contexts in Chrome, Firefox, and Safari.\n */\n\nh1 {\n  font-size: 2em;\n  margin: 0.67em 0;\n}\n\n/* Grouping content\n   ========================================================================== */\n\n/**\n * 1. Add the correct box sizing in Firefox.\n * 2. Show the overflow in Edge and IE.\n */\n\nhr {\n  box-sizing: content-box; /* 1 */\n  height: 0; /* 1 */\n  overflow: visible; /* 2 */\n}\n\n/**\n * 1. Correct the inheritance and scaling of font size in all browsers.\n * 2. Correct the odd `em` font sizing in all browsers.\n */\n\npre {\n  font-family: monospace, monospace; /* 1 */\n  font-size: 1em; /* 2 */\n}\n\n/* Text-level semantics\n   ========================================================================== */\n\n/**\n * Remove the gray background on active links in IE 10.\n */\n\na {\n  background-color: transparent;\n}\n\n/**\n * 1. Remove the bottom border in Chrome 57-\n * 2. Add the correct text decoration in Chrome, Edge, IE, Opera, and Safari.\n */\n\nabbr[title] {\n  border-bottom: none; /* 1 */\n  text-decoration: underline; /* 2 */\n  text-decoration: underline dotted; /* 2 */\n}\n\n/**\n * Add the correct font weight in Chrome, Edge, and Safari.\n */\n\nb,\nstrong {\n  font-weight: bolder;\n}\n\n/**\n * 1. Correct the inheritance and scaling of font size in all browsers.\n * 2. Correct the odd `em` font sizing in all browsers.\n */\n\ncode,\nkbd,\nsamp {\n  font-family: monospace, monospace; /* 1 */\n  font-size: 1em; /* 2 */\n}\n\n/**\n * Add the correct font size in all browsers.\n */\n\nsmall {\n  font-size: 80%;\n}\n\n/**\n * Prevent `sub` and `sup` elements from affecting the line height in\n * all browsers.\n */\n\nsub,\nsup {\n  font-size: 75%;\n  line-height: 0;\n  position: relative;\n  vertical-align: baseline;\n}\n\nsub {\n  bottom: -0.25em;\n}\n\nsup {\n  top: -0.5em;\n}\n\n/* Embedded content\n   ========================================================================== */\n\n/**\n * Remove the border on images inside links in IE 10.\n */\n\nimg {\n  border-style: none;\n}\n\n/* Forms\n   ========================================================================== */\n\n/**\n * 1. Change the font styles in all browsers.\n * 2. Remove the margin in Firefox and Safari.\n */\n\nbutton,\ninput,\noptgroup,\nselect,\ntextarea {\n  font-family: inherit; /* 1 */\n  font-size: 100%; /* 1 */\n  line-height: 1.15; /* 1 */\n  margin: 0; /* 2 */\n}\n\n/**\n * Show the overflow in IE.\n * 1. Show the overflow in Edge.\n */\n\nbutton,\ninput { /* 1 */\n  overflow: visible;\n}\n\n/**\n * Remove the inheritance of text transform in Edge, Firefox, and IE.\n * 1. Remove the inheritance of text transform in Firefox.\n */\n\nbutton,\nselect { /* 1 */\n  text-transform: none;\n}\n\n/**\n * Correct the inability to style clickable types in iOS and Safari.\n */\n\nbutton,\n[type="button"],\n[type="reset"],\n[type="submit"] {\n  -webkit-appearance: button;\n}\n\n/**\n * Remove the inner border and padding in Firefox.\n */\n\nbutton::-moz-focus-inner,\n[type="button"]::-moz-focus-inner,\n[type="reset"]::-moz-focus-inner,\n[type="submit"]::-moz-focus-inner {\n  border-style: none;\n  padding: 0;\n}\n\n/**\n * Restore the focus styles unset by the previous rule.\n */\n\nbutton:-moz-focusring,\n[type="button"]:-moz-focusring,\n[type="reset"]:-moz-focusring,\n[type="submit"]:-moz-focusring {\n  outline: 1px dotted ButtonText;\n}\n\n/**\n * Correct the padding in Firefox.\n */\n\nfieldset {\n  padding: 0.35em 0.75em 0.625em;\n}\n\n/**\n * 1. Correct the text wrapping in Edge and IE.\n * 2. Correct the color inheritance from `fieldset` elements in IE.\n * 3. Remove the padding so developers are not caught out when they zero out\n *    `fieldset` elements in all browsers.\n */\n\nlegend {\n  box-sizing: border-box; /* 1 */\n  color: inherit; /* 2 */\n  display: table; /* 1 */\n  max-width: 100%; /* 1 */\n  padding: 0; /* 3 */\n  white-space: normal; /* 1 */\n}\n\n/**\n * Add the correct vertical alignment in Chrome, Firefox, and Opera.\n */\n\nprogress {\n  vertical-align: baseline;\n}\n\n/**\n * Remove the default vertical scrollbar in IE 10+.\n */\n\ntextarea {\n  overflow: auto;\n}\n\n/**\n * 1. Add the correct box sizing in IE 10.\n * 2. Remove the padding in IE 10.\n */\n\n[type="checkbox"],\n[type="radio"] {\n  box-sizing: border-box; /* 1 */\n  padding: 0; /* 2 */\n}\n\n/**\n * Correct the cursor style of increment and decrement buttons in Chrome.\n */\n\n[type="number"]::-webkit-inner-spin-button,\n[type="number"]::-webkit-outer-spin-button {\n  height: auto;\n}\n\n/**\n * 1. Correct the odd appearance in Chrome and Safari.\n * 2. Correct the outline style in Safari.\n */\n\n[type="search"] {\n  -webkit-appearance: textfield; /* 1 */\n  outline-offset: -2px; /* 2 */\n}\n\n/**\n * Remove the inner padding in Chrome and Safari on macOS.\n */\n\n[type="search"]::-webkit-search-decoration {\n  -webkit-appearance: none;\n}\n\n/**\n * 1. Correct the inability to style clickable types in iOS and Safari.\n * 2. Change font properties to `inherit` in Safari.\n */\n\n::-webkit-file-upload-button {\n  -webkit-appearance: button; /* 1 */\n  font: inherit; /* 2 */\n}\n\n/* Interactive\n   ========================================================================== */\n\n/*\n * Add the correct display in Edge, IE 10+, and Firefox.\n */\n\ndetails {\n  display: block;\n}\n\n/*\n * Add the correct display in all browsers.\n */\n\nsummary {\n  display: list-item;\n}\n\n/* Misc\n   ========================================================================== */\n\n/**\n * Add the correct display in IE 10+.\n */\n\ntemplate {\n  display: none;\n}\n\n/**\n * Add the correct display in IE 10.\n */\n\n[hidden] {\n  display: none;\n}\n\n/* \u58f0\u660e\u5168\u5c40\u6837\u5f0f\u548c\u9879\u76ee\u7684\u521d\u59cb\u5316\u6837\u5f0f */\nbody,h1,h2,h3,h4,p,table,tr,td,ul,li,a,form,input,select,option,textarea{\n  margin:0;\n  padding: 0;\n  font-size: 15px;\n}\na{\n  text-decoration: none;\n  color: #333;\n  cursor: pointer;\n}\nul,li{\n  list-style: none;\n}\ntable{\n  border-collapse: collapse; /* \u5408\u5e76\u8fb9\u6846 */\n}\nimg{\n  max-width: 100%;\n  max-height: 100%;\n}\ninput{\n  outline: none;\n}\n\n')),(0,o.yg)("h3",{id:"25\u4e3b\u9875\u9762\u677f\u7ec4\u4ef6"},"2.5\u3001\u4e3b\u9875\u9762\u677f\u7ec4\u4ef6"),(0,o.yg)("p",null,"\u7ec8\u7aef\u4e0b\u5b89\u88c5router\u8def\u7531\u6a21\u5757\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cd bingo_web  # \u6ce8\u610f\uff0c\u5ba2\u6237\u7aef\u5b89\u88c5\u6a21\u5757\u7684\u6240\u6709\u547d\u4ee4\uff0c\u52a1\u5fc5\u5728package.json\u6240\u5728\u76ee\u5f55\u4e0b\u64cd\u4f5c\u3002\nyarn add vue-router@4.0.13   --registry https://registry.npm.taobao.org\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"src/router/index.js"),"\uff0c\u8def\u7531\u5bf9\u8c61\u521d\u59cb\u5316\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"import { createRouter, createWebHistory } from 'vue-router'\n\n\nconst routes = [\n  { path: '/', name: 'bingo', component: ()=>import(\"../views/bingo.vue\")},  // \u4e3b\u9875\u9762\u677f\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\n\n\nexport default router;\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"src/main.js"),"\uff0c\u52a0\u8f7d\u8def\u7531\u5bf9\u8c61\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"import { createApp } from 'vue'\nimport './style.css'\nimport App from './App.vue'\nimport router from './router'\n\ncreateApp(App).use(router).mount('#app')\n\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"src/App.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},"<template>\n  <router-view/>\n</template>\n\n<script setup>\n\n<\/script>\n\n<style scoped>\n\n</style>\n")),(0,o.yg)("p",null,"src\u76ee\u5f55\u4e0b\u521b\u5efaviews\u9875\u9762\u7ec4\u4ef6\u76ee\u5f55\u5e76\u65b0\u5efabingo.vue\u7ec4\u4ef6\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/views/Bingo.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n<h3>Bingo\u4e3b\u9875\u9762\u677f</h3>\n</template>\n\n<script>\nexport default {\n  name: "Bingo"\n}\n<\/script>\n\n<style scoped>\n\n</style>\n')),(0,o.yg)("p",null,"\u8bbf\u95eehttp://localhost:5173/ \u5c31\u770b\u5230\u4e86\u6211\u4eec\u7684\u4e3b\u9875\u9762\u677f\u9875\u9762\u3002"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230809152937230-1566178.png",alt:"image-20230809152937230"})),(0,o.yg)("h2",{id:"3ant-design\u63d2\u4ef6"},"\u30103\u3011ant-design\u63d2\u4ef6"),(0,o.yg)("h3",{id:"31antd\u7ec4\u4ef6\u5e93"},"3.1\u3001Antd\u7ec4\u4ef6\u5e93"),(0,o.yg)("p",null,"Ant Design\u662f\u8682\u8681\u91d1\u670d\u51fa\u54c1\u57fa\u4e8e React \u5b9e\u73b0\u7684\u4e00\u5957\u7ec4\u4ef6\u5e93\u5f00\u6e90\u6846\u67b6\uff0c\u6700\u65e9\u662f\u57282015\u5e74\u53d1\u5e03\u7684\uff0c\u53ef\u4ee5\u8bf4\u662f\u76ee\u524d\u56fd\u5185\u4f7f\u7528\u7387\u6700\u9ad8\u7684UI\u7ec4\u4ef6\u5e93\uff0c\u5728\u56fd\u9645\u4e0a\u4e5f\u6709\u5f88\u5927\u7684\u77e5\u540d\u5ea6\u3002\u6211\u4eec\u73b0\u5728\u5b66\u4e60\u7684\u662fvue\u6846\u67b6\uff0c\u5b98\u65b9\u5df2\u7ecf\u5f00\u6e90\u51fa\u4e86\u4e00\u5957ant-design for vue\u7248\u672c\u3002"),(0,o.yg)("p",null,'Ant Design \u5b98\u65b9\u4ecb\u7ecd\uff1a "\u5728\u4e2d\u53f0\u4ea7\u54c1\u7684\u7814\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u51fa\u73b0\u4e0d\u540c\u7684\u8bbe\u8ba1\u89c4\u8303\u548c\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4f46\u5176\u4e2d\u5f80\u5f80\u5b58\u5728\u5f88\u591a\u7c7b\u4f3c\u7684\u9875\u9762\u548c\u7ec4\u4ef6\uff0c\u7ed9\u8bbe\u8ba1\u5e08\u548c\u5de5\u7a0b\u5e08\u5e26\u6765\u5f88\u591a\u56f0\u6270\u548c\u91cd\u590d\u5efa\u8bbe\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u4ea7\u54c1\u7684\u7814\u53d1\u6548\u7387\u3002"'),(0,o.yg)("p",null,"\u7279\u70b9\uff1a"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"\u4e13\u4e3aWeb\u5e94\u7528\u7a0b\u5e8f\u8bbe\u8ba1\u7684\u4f01\u4e1a\u7ea7UI\u3002"),(0,o.yg)("li",{parentName:"ul"},"\u5f00\u7bb1\u5373\u7528\u7684\u4e00\u7ec4\u9ad8\u8d28\u91cf\u7ec4\u4ef6\u3002"),(0,o.yg)("li",{parentName:"ul"},"\u7528\u5177\u6709\u53ef\u9884\u6d4b\u7684\u9759\u6001\u7c7b\u578b\u7684TypeScript\u7f16\u5199\u3002"),(0,o.yg)("li",{parentName:"ul"},"\u6574\u5957\u8bbe\u8ba1\u8d44\u6e90\u548c\u5f00\u53d1\u5de5\u5177\u3002"),(0,o.yg)("li",{parentName:"ul"},"\u652f\u6301\u6570\u5341\u79cd\u8bed\u8a00\u7684\u56fd\u9645\u5316\u3002"),(0,o.yg)("li",{parentName:"ul"},"\u5f3a\u5927\u7684\u4e3b\u9898\u81ea\u5b9a\u4e49\u7ec6\u8282\u3002")),(0,o.yg)("p",null,"\u5e38\u7528\u7f51\u5740\uff1a"),(0,o.yg)("p",null,"Ant Design for React \u5b98\u7f51\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://ant.design/"},"https://ant.design/")," "),(0,o.yg)("p",null,"Ant Design of Vue \u5b98\u7f51\u5730\u5740\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://www.antdv.com/components/overview-cn/"},"https://www.antdv.com/components/overview-cn/")),(0,o.yg)("h4",{id:"221-\u5b89\u88c5\u4f7f\u7528"},"2.2.1 \u5b89\u88c5\u4f7f\u7528"),(0,o.yg)("p",null,"\u7ec8\u7aef\u4e0b\u5b89\u88c5antd\u7ec4\u4ef6\u5e93\uff0c\u6587\u6863\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://next.antdv.com/docs/vue/getting-started-cn"},"https://next.antdv.com/docs/vue/getting-started-cn")),(0,o.yg)("p",null,"\u547d\u4ee4\u5982\u4e0b\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cd bingo_web  # \u6ce8\u610f\uff0c\u5ba2\u6237\u7aef\u5b89\u88c5\u6a21\u5757\u7684\u6240\u6709\u547d\u4ee4\uff0c\u52a1\u5fc5\u5728package.json\u6240\u5728\u76ee\u5f55\u4e0b\u64cd\u4f5c\u3002\nyarn add ant-design-vue@next  --registry https://registry.npm.taobao.org\n")),(0,o.yg)("p",null,"\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"src/main.js"),"\u6587\u4ef6\u4e2d\u5f15\u5165Antd\u6846\u67b6\u3002\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"import { createApp } from 'vue'\nimport './style.css'\nimport App from './App.vue'\nimport router from './router'\nimport Antd from 'ant-design-vue';\nimport 'ant-design-vue/dist/antd.css'; // \u5728\u65b0\u7248\u672c\u7684Antd\u4e2d\uff0c\u5df2\u7ecf\u88ab\u8e22\u51fa\uff0c\u5982\u679c\u63d0\u793acss\u65e0\u6cd5\u52a0\u8f7d\u5bfc\u81f4\u51fa\u9519\uff0c\u5219\u5220\u9664\u6389\u8fd9\u884c\u4ee3\u7801\n\ncreateApp(App).use(router).use(Antd).mount('#app')\n\n")),(0,o.yg)("p",null,"\u4e0b\u9762\u6211\u4eec\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"src/views/Bingo.vue"),"\u9875\u9762\u7ec4\u4ef6\u4e2d\u5f15\u5165\u4e00\u4e2aant-design\u7684button\u6309\u94ae\uff0c\u67e5\u770b\u662f\u5426\u6210\u529f\u5b89\u88c5\u5e76\u5f15\u5165\u3002"),(0,o.yg)("p",null,"\u6587\u6863\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://next.antdv.com/components/button-cn"},"https://next.antdv.com/components/button-cn")),(0,o.yg)("p",null,"\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div>\u7ad9\u70b9\u9996\u9875</div>\n  <a-button type="primary">Primary Button</a-button>\n</template>\n\n<script setup>\n\n<\/script>\n\n<style scoped>\n/* \u5b50\u7ec4\u4ef6\u4e2d\u6240\u6709\u7684css\u6837\u5f0f\uff0c\u90fd\u5e94\u8be5\u662f\u5c40\u90e8\u7684\uff0c\u53ea\u4f5c\u7528\u4e8e\u5f53\u524d\u7ec4\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u8bbe\u7f6escoped\u5c5e\u6027 */\n\n</style>\n')),(0,o.yg)("h4",{id:"222-\u56fe\u8868\u7ec4\u4ef6"},"2.2.2 \u56fe\u8868\u7ec4\u4ef6"),(0,o.yg)("p",null,"\u4f5c\u4e3a\u4e00\u4e2a\u8fd0\u7ef4\u9879\u76ee\uff0c\u5f88\u591a\u65f6\u5019\u9700\u8981\u57fa\u4e8e\u56fe\u8868\u53ef\u89c6\u5316\u5c55\u793a\u670d\u52a1\u5668\u76f8\u5173\u6570\u636e\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u501f\u52a9\u56fe\u8868\u5f00\u6e90\u63d2\u4ef6\uff0c\u6bd4\u5982echarts\u548cHighcharts\uff0c\u6211\u4eec\u672c\u6b21\u91c7\u7528\u7684\u662f\u767e\u5ea6\u5f00\u6e90\u7684echarts\u3002"),(0,o.yg)("p",null,"Echarts\u5b98\u65b9\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://echarts.apache.org/zh/index.html"},"https://echarts.apache.org/zh/index.html")),(0,o.yg)("p",null,"\u547d\u4ee4\u5982\u4e0b\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cd bingo_web  # \u6ce8\u610f\uff0c\u5ba2\u6237\u7aef\u5b89\u88c5\u6a21\u5757\u7684\u6240\u6709\u547d\u4ee4\uff0c\u52a1\u5fc5\u5728package.json\u6240\u5728\u76ee\u5f55\u4e0b\u64cd\u4f5c\u3002\nyarn add echarts   --registry https://registry.npm.taobao.org\n")),(0,o.yg)("p",null,"\u5b89\u88c5\u5b8c\u6210\u4ee5\u540e\uff0c\u76f4\u63a5\u53ef\u4ee5\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"src/views/Bingo.vue"),"\u9875\u9762\u7ec4\u4ef6\u4e2d\u8fdb\u884c\u4f7f\u7528Echarts\u57fa\u672c\u793a\u4f8b\u67e5\u770b\u6548\u679c\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},"<template>\n  <div>\u7ad9\u70b9\u9996\u9875</div>\n  <a-button type=\"primary\">Primary Button</a-button>\n  <div class=\"chart\" ref=\"chart\"></div>\n</template>\n\n<script setup>\nimport {onMounted, ref} from 'vue';\nimport * as echarts from 'echarts';\n\nconst chart = ref();\nconst option = {\n  title: {\n    text: 'Referer of a Website',\n    subtext: 'Fake Data',\n    left: 'center'\n  },\n  tooltip: {\n    trigger: 'item'\n  },\n  legend: {\n    orient: 'vertical',\n    left: 'left'\n  },\n  series: [\n    {\n      name: 'Access From',\n      type: 'pie',\n      radius: '50%',\n      data: [\n        {value: 1048, name: 'Search Engine'},\n        {value: 735, name: 'Direct'},\n        {value: 580, name: 'Email'},\n        {value: 484, name: 'Union Ads'},\n        {value: 300, name: 'Video Ads'}\n      ],\n      emphasis: {\n        itemStyle: {\n          shadowBlur: 10,\n          shadowOffsetX: 0,\n          shadowColor: 'rgba(0, 0, 0, 0.5)'\n        }\n      }\n    }\n  ]\n};\nonMounted(() => {\n\n  console.log(\":::\", chart.value)\n  let myChart = echarts.init(chart.value);\n  myChart.setOption(option);\n})\n<\/script>\n\n<style scoped>\n/* \u5b50\u7ec4\u4ef6\u4e2d\u6240\u6709\u7684css\u6837\u5f0f\uff0c\u90fd\u5e94\u8be5\u662f\u5c40\u90e8\u7684\uff0c\u53ea\u4f5c\u7528\u4e8e\u5f53\u524d\u7ec4\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u8bbe\u7f6escoped\u5c5e\u6027 */\n.chart {\n  width: 500px;\n  height: 500px;\n  float: left;\n  margin: 0 auto 0 100px;\n}\n</style>\n")),(0,o.yg)("p",null,"\u7b49\u5f85\u9879\u76ee\u91cd\u542f\uff0c\u67e5\u770b\u6d4f\u89c8\u5668\u6548\u679c\u5982\u4e0b\uff1a"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230809170114165-1571675.png",alt:"image-20230809170114165"})),(0,o.yg)("h3",{id:"32\u9875\u9762\u5c55\u793a"},"3.2\u3001\u9875\u9762\u5c55\u793a"),(0,o.yg)("h4",{id:"321-\u9996\u9875\u9762\u677f"},"3.2.1 \u9996\u9875\u9762\u677f"),(0,o.yg)("p",null,"\u4e0a\u9762\u7684\u4e3b\u9875\u9762\u677f\u4ee3\u7801\u592a\u4e71\u4e86\uff0c\u6211\u4eec\u6362\u4e2a\u9762\u677f\uff0c\u8ba9\u4f7f\u7528\u8005\u6e05\u6670\u6574\u4e2a\u7ad9\u70b9\u7684\u91cd\u8981\u6570\u636e\u3002\u56e0\u4e3a\u6d89\u53ca\u5230\u90e8\u5206\u56fe\u6807\u7684\u5c55\u793a\uff0c\u6240\u4ee5\u6211\u4eec\u5b89\u88c5\u4e0bAntd\u7684\u56fe\u6807\u7ec4\u4ef6\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cd bingo_web  # \u6ce8\u610f\uff0c\u5ba2\u6237\u7aef\u5b89\u88c5\u6a21\u5757\u7684\u6240\u6709\u547d\u4ee4\uff0c\u52a1\u5fc5\u5728package.json\u6240\u5728\u76ee\u5f55\u4e0b\u64cd\u4f5c\u3002\nyarn add @ant-design/icons-vue --registry https://registry.npm.taobao.org\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"src/views/Bingo.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <a-row class="top">\n    <a-col class="item" :span="6">\n      <div class="item-box">\n        <usergroup-add-outlined class="icon-style" />\n        <p>\u7528\u6237\u7ba1\u7406</p>\n      </div>\n    </a-col>\n    <a-col class="item" :span="6">\n      <div class="item-box">\n        <fund-outlined class="icon-style" />\n        <p>\u8d44\u4ea7\u7ba1\u7406</p>\n      </div>\n    </a-col>\n    <a-col class="item" :span="6">\n      <div class="item-box">\n        <clock-circle-outlined class="icon-style" />\n        <p>\u4efb\u52a1\u4e2d\u5fc3</p>\n      </div>\n    </a-col>\n    <a-col class="item" :span="6">\n      <div class="item-box">\n        <alert-outlined class="icon-style" />\n        <p>\u544a\u8b66\u901a\u77e5</p>\n      </div>\n    </a-col>\n  </a-row>\n  \x3c!-- \u9884\u8b66\u56fe\u8868\u4e0e\u4e3b\u673a\u4fe1\u606f\u56fe\u8868 --\x3e\n  <a-row class="data-list">\n    <a-col :span="12" class="item">\n      <div class="item-box">\n        <div class="alert-chart" ref="alert"></div>\n      </div>\n    </a-col>\n    <a-col :span="12" class="item">\n      <div class="item-box">\n        <div class="host-chart" ref="host"></div>\n      </div>\n    </a-col>\n    <a-col :span="14" class="task-data item">\n      <div class="item-box">\n        <a-table :columns="taskColumns" :data-source="taskData" :pagination="false">\n          <template #headerCell="{ column }">\n            <template v-if="column.key === \'title\'">\n              <span>\n                <clock-circle-outlined />\n                {{column.title}}\n              </span>\n            </template>\n          </template>\n\n          <template #bodyCell="{ column, record }">\n            <template v-if="column.key === \'user\'">\n              <a>\n                {{ record.user }}\n              </a>\n            </template>\n            <template v-else-if="column.key === \'status\'">\n              <a-tag :color="[\'blue\',\'green\',\'orange\',\'red\'][record.status]">\n                {{[\'\u6682\u505c\', \'\u8fd0\u884c\', \'\u8b66\u544a\',\'\u9519\u8bef\'][record.status]}}\n              </a-tag>\n            </template>\n          </template>\n        </a-table>\n      </div>\n    </a-col>\n    <a-col :span="8" class="item">\n      <div class="item-box timeline">\n          <a-timeline>\n            <a-timeline-item>2015-09-01 08:03:23 \u738b\u6653\u541b\u767b\u9646</a-timeline-item>\n            <a-timeline-item>2015-09-01 09:30:01 \u8d75\u5ddd\u767b\u9646</a-timeline-item>\n            <a-timeline-item>2015-09-01 09:59:41 \u8d75\u5ddd\u767b\u9646</a-timeline-item>\n            <a-timeline-item>2015-09-01 15:03:06 \u738b\u6653\u541b\u767b\u9646</a-timeline-item>\n          </a-timeline>\n      </div>\n    </a-col>\n  </a-row>\n</template>\n\n<script setup>\nimport {UsergroupAddOutlined, FundOutlined,ClockCircleOutlined, AlertOutlined, SmileOutlined, DownOutlined} from \'@ant-design/icons-vue\';\nimport { ref, onMounted } from \'vue\';\nimport * as echarts from \'echarts\';\nimport {AlertChartOption, HostChartOption} from "../charts/bingo.js";\n\n// \u9884\u8b66\u56fe\u8868\nconst alert = ref()\n// \u4e3b\u673a\u56fe\u8868\nconst host = ref()\n\nonMounted(()=>{\n  echarts.init(alert.value).setOption(AlertChartOption);\n  echarts.init(host.value).setOption(HostChartOption);\n})\n\nconst taskColumns = [{\n  title: \'\u4efb\u52a1ID\',\n  dataIndex: \'id\',\n  key: \'id\',\n}, {\n  title: \'\u4efb\u52a1\u540d\',\n  dataIndex: \'title\',\n  key: \'title\',\n}, {\n  title: \'\u7528\u6237\',\n  dataIndex: \'user\',\n  key: \'user\',\n}, {\n  title: \'Status\',\n  dataIndex: \'status\',\n  key: \'status\',\n}];\n\nconst taskData = [{\n  key: \'1\',\n  id: 1,\n  title: \'\u5de1\u68c0\u6d4b\u8bd5\u670d\u52a1\u5668\',\n  user: \'\u738b\u6653\u541b\',\n  status: 1,\n}, {\n  key: \'2\',\n  id: 2,\n  title: \'\u5b9a\u65f6\u5907\u4efd\',\n  user: \'\u738b\u6653\u541b\',\n  status: 0,\n}, {\n  key: \'3\',\n  id: 3,\n  title: \'\u53d1\u5e03xxx\u9879\u76ee\',\n  user: \'\u738b\u6653\u541b\',\n  status: 2,\n}, {\n  key: \'4\',\n  id: 4,\n  title: \'xxxxxx\',\n  user: \'\u738b\u6653\u541b\',\n  status: 3,\n}];\n\n<\/script>\n\n<style scoped>\n/* \u5b50\u7ec4\u4ef6\u4e2d\u6240\u6709\u7684css\u6837\u5f0f\uff0c\u90fd\u5e94\u8be5\u662f\u5c40\u90e8\u7684\uff0c\u53ea\u4f5c\u7528\u4e8e\u5f53\u524d\u7ec4\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u8bbe\u7f6escoped\u5c5e\u6027 */\n.top {\n  margin: 10px 20px;\n  box-shadow: 0 0 2px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);\n}\n.top .item {\n  width: 60px;\n  text-align: center;\n  padding: 10px 0;\n  cursor: pointer;\n}\n.item-box{\n  border-radius: 5px;\n  background: #fff;\n  transition: all .5s linear;\n}\n.top .item-box:hover{\n  background: #ff5500;\n}\n.top .item-box:hover .icon-style{\n  color: #f0f0f0;\n}\n.top .item-box:hover p {\n  color: #f0f0f0;\n}\n.icon-style{\n  font-size: 32px;\n  color: #ff5500;\n}\n.top .item p{\n  margin-top: 10px;\n}\n.data-list{\n  margin: 10px 20px;\n  box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);\n}\n.alert-chart{\n  width: 100%;\n  height: 300px;\n}\n\n.host-chart{\n  width: 100%;\n  height: 300px;\n}\n.item-box{\n  margin: 10px;\n  padding-top: 20px;\n  padding-bottom: 20px;\n}\n\n.timeline{\n  padding-left: 20px;\n}\n</style>\n')),(0,o.yg)("p",null,"\u56e0\u4e3a\u56fe\u8868\u76f8\u5173\u7684\u53c2\u6570\u4ee3\u7801\u76f8\u5bf9\u6bd4\u8f83\u591a\uff0c\u800c\u4e14\u5b58\u5728\u590d\u7528\u7684\u53ef\u80fd\u6027\uff0c\u6240\u4ee5\u6211\u4eec\u5728src\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2acharts\u76ee\u5f55\uff0c\u6309bingo.vue\u7684\u9875\u9762\u7ec4\u4ef6\u540d\u6765\u521b\u5efa\u4e00\u4e2a\u72ec\u7acb\u7684js\u6587\u4ef6bingo.js\u6765\u4fdd\u5b58\u56fe\u8868\u76f8\u5173\u4ee3\u7801\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/charts/bingo.js"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"export const AlertChartOption = {\n    title: {\n    text: '\u672c\u5468\u9884\u8b66\u6b21\u6570',\n    left: 'center'\n  },\n  tooltip: {\n    trigger: 'axis',\n    axisPointer: {\n      type: 'shadow'\n    }\n  },\n  toolbox: {\n    show: true,\n    feature: {\n      mark: { show: true },\n      dataView: { show: true, readOnly: false },\n      restore: { show: true },\n      saveAsImage: { show: true }\n    }\n  },\n  grid: {\n    left: '2%',\n    right: '2%',\n    bottom: '1%',\n    containLabel: true\n  },\n  xAxis: [\n    {\n      type: 'category',\n      data: ['\u661f\u671f\u4e00', '\u661f\u671f\u4e8c', '\u661f\u671f\u4e09', '\u661f\u671f\u56db', '\u661f\u671f\u4e94', '\u661f\u671f\u516d', '\u661f\u671f\u5929'],\n      axisTick: {\n        alignWithLabel: true\n      }\n    }\n  ],\n  yAxis: [\n    {\n      type: 'value'\n    }\n  ],\n  series: [\n    {\n      name: '\u6ce8\u610f',\n      type: 'bar',\n      barWidth: '10%',\n      data: [13, 12, 8, 16, 22, 20, 11]\n    },\n    {\n      name: '\u8b66\u544a',\n      type: 'bar',\n      barWidth: '10%',\n      data: [5, 5, 12, 4, 0, 11, 2]\n    },\n    {\n      name: '\u6545\u969c',\n      type: 'bar',\n      barWidth: '10%',\n      data: [0, 1, 0, 2, 3, 1, 4]\n    },\n    {\n      name: '\u4e25\u91cd',\n      type: 'bar',\n      barWidth: '10%',\n      data: [2, 0, 1, 0, 0, 1, 2]\n    }\n  ]\n};\n\n\nexport const HostChartOption = {\n  title: {\n    text: '\u4e3b\u673a\u4fe1\u606f',\n    left: 'center'\n  },\n  tooltip: {\n    trigger: 'item'\n  },\n  toolbox: {\n    show: true,\n    feature: {\n      mark: { show: true },\n      dataView: { show: true, readOnly: false },\n      restore: { show: true },\n      saveAsImage: { show: true }\n    }\n  },\n  legend: {\n    top: 'bottom'\n  },\n  series: [\n    {\n      name: '\u4e3b\u673a\u4fe1\u606f',\n      type: 'pie',\n      radius: '60%',\n      data: [\n        { value: 45, name: '\u6d4b\u8bd5\u670d\u52a1\u5668' },\n        { value: 25, name: 'web\u670d\u52a1\u5668' },\n        { value: 15, name: '\u4ee3\u7406\u670d\u52a1\u5668' },\n        { value: 14, name: '\u6570\u636e\u5e93\u670d\u52a1\u5668' },\n        { value: 79, name: '\u672a\u5206\u7c7b' }\n      ],\n      emphasis: {\n        itemStyle: {\n          shadowBlur: 10,\n          shadowOffsetX: 0,\n          shadowColor: 'rgba(0, 0, 0, 0.5)'\n        }\n      }\n    }\n  ]\n};\n")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230809170340889-1571822.png",alt:"image-20230809170340889"})),(0,o.yg)("h4",{id:"322-\u516c\u5171\u9875\u9762"},"3.2.2 \u516c\u5171\u9875\u9762"),(0,o.yg)("p",null,"\u7531\u4e8e\u9664\u4e86\u767b\u5f55\u9875\u9762\u4e4b\u5916\u6211\u4eec\u540e\u9762\u6240\u6709\u7684\u7ec4\u4ef6\u90fd\u5177\u5907\u9876\u90e8\u5bfc\u822a\u680f\u548c\u5de6\u4fa7\u83dc\u5355\u680f\u7684\u6548\u679c\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06\u516c\u5171\u90e8\u5206\u9875\u9762\u5185\u5bb9\u653e\u5230\u4e86\u4e00\u4e2aBase.vue\u7ec4\u4ef6\u4e2d\uff0c\u91cc\u9762\u901a\u8fc7 ant design vue\u4e2d\u7684\u5e03\u5c40\u7ec4\u4ef6\u6765\u7ec4\u7ec7\u9875\u9762\u6392\u7248\u3002"),(0,o.yg)("p",null,"\u5e03\u5c40\u7ec4\u4ef6\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://next.antdv.com/components/layout-cn"},"https://next.antdv.com/components/layout-cn")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"src/views/Base.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <a-layout style="min-height: 100vh">\n    <a-layout-sider v-model:collapsed="collapsed" collapsible>\n      <div class="logo" />\n      <a-menu v-model:selectedKeys="selectedKeys" theme="dark" mode="inline">\n        <a-menu-item key="1">\n          <pie-chart-outlined />\n          <span>Option 1</span>\n        </a-menu-item>\n        <a-menu-item key="2">\n          <desktop-outlined />\n          <span>Option 2</span>\n        </a-menu-item>\n        <a-sub-menu key="sub1">\n          <template #title>\n            <span>\n              <user-outlined />\n              <span>User</span>\n            </span>\n          </template>\n          <a-menu-item key="3">Tom</a-menu-item>\n          <a-menu-item key="4">Bill</a-menu-item>\n          <a-menu-item key="5">Alex</a-menu-item>\n        </a-sub-menu>\n        <a-sub-menu key="sub2">\n          <template #title>\n            <span>\n              <team-outlined />\n              <span>Team</span>\n            </span>\n          </template>\n          <a-menu-item key="6">Team 1</a-menu-item>\n          <a-menu-item key="8">Team 2</a-menu-item>\n        </a-sub-menu>\n        <a-menu-item key="9">\n          <file-outlined />\n          <span>File</span>\n        </a-menu-item>\n      </a-menu>\n    </a-layout-sider>\n    <a-layout>\n      <a-layout-header style="background: #fff; padding: 0" />\n      <a-layout-content style="margin: 0 16px">\n        <a-breadcrumb style="margin: 16px 0">\n          <a-breadcrumb-item>User</a-breadcrumb-item>\n          <a-breadcrumb-item>Bill</a-breadcrumb-item>\n        </a-breadcrumb>\n        <div :style="{ padding: \'24px\', background: \'#fff\', minHeight: \'360px\' }">\n          Bill is a cat.\n        </div>\n      </a-layout-content>\n      <a-layout-footer style="text-align: center">\n        Ant Design \xa92018 Created by Ant UED\n      </a-layout-footer>\n    </a-layout>\n  </a-layout>\n</template>\n<script setup>\nimport { PieChartOutlined, DesktopOutlined, UserOutlined, TeamOutlined, FileOutlined } from \'@ant-design/icons-vue\';\nimport { ref } from \'vue\';\n\nconst collapsed = ref(false);\nconst selectedKeys = ref([\'1\']);\n<\/script>\n\n<style>\n#components-layout-demo-side .logo {\n  height: 32px;\n  margin: 16px;\n  background: rgba(255, 255, 255, 0.3);\n}\n\n.site-layout .site-layout-background {\n  background: #fff;\n}\n[data-theme=\'dark\'] .site-layout .site-layout-background {\n  background: #141414;\n}\n</style>\n')),(0,o.yg)("p",null,"\u5148\u6ce8\u91ca\u6389\u539f\u6765\u7684Bingo.vue\u7ec4\u4ef6\u7684\u8def\u7531\u4fe1\u606f\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/rouer/index.js"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"import { createRouter, createWebHistory } from 'vue-router'\n\nconst routes = [\n  // { path: '/bingo', meta: {title: \"\u4e3b\u9875\u9762\u677f\"}, name: 'bingo', component: ()=>import(\"../views/bingo.vue\")},\n  { path: '/bingo', meta: {title: \"\"}, name: 'Base', component: ()=>import(\"../views/Base.vue\")},\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\n\nrouter.beforeEach((to, from, next) => {\n  if(to.meta.title){\n    // \u4fee\u6539\u9875\u9762\u539f\u6709\u6807\u9898\n    document.title = to.meta.title\n  }\n  next();\n});\n\nexport default router;\n")),(0,o.yg)("p",null,"\u5b9e\u73b0\u9875\u9762\u5d4c\u5957"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"src/views/Base.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},"<template>\n  <a-layout style=\"min-height: 100vh\">\n    <a-layout-sider v-model:collapsed=\"collapsed\" collapsible>\n      <div class=\"logo\">\n        <span>bingo</span>\n      </div>\n      <a-menu v-for=\"menu in menu_list\" v-model:selectedKeys=\"selectedKeys\" theme=\"dark\" mode=\"inline\">\n        <a-menu-item v-if=\"menu.children.length===0\" :key=\"menu.id\">\n          <router-link :to=\"menu.menu_url\">\n            <desktop-outlined/>\n            <span> {{ menu.title }}</span>\n          </router-link>\n        </a-menu-item>\n        <a-sub-menu v-else :key=\"menu.id\">\n          <template #title>\n            <span>\n              <user-outlined/>\n              <span>{{ menu.title }}</span>\n            </span>\n          </template>\n          <a-menu-item v-for=\"child_menu in menu.children\" :key=\"child_menu.id\">\n            <router-link :to=\"child_menu.menu_url\">{{ child_menu.title }}</router-link>\n          </a-menu-item>\n        </a-sub-menu>\n      </a-menu>\n    </a-layout-sider>\n    <a-layout>\n      <a-layout-header style=\"background: #fff;text-align: center\">\n        <a-row>\n          <a-col :span=\"2\" :offset=\"22\">\n            <a-dropdown placement=\"bottom\">\n              <p class=\"user\"><UserOutlined /> root</p>\n              <template #overlay>\n                <a-menu>\n                  <a-menu-item><LockOutlined/> \u4fee\u6539\u5bc6\u7801</a-menu-item>\n                  <a-menu-item><LogoutOutlined/> \u9000\u51fa\u767b\u9646</a-menu-item>\n                </a-menu>\n              </template>\n            </a-dropdown>\n          </a-col>\n        </a-row>\n      </a-layout-header>\n      <a-layout-content style=\"margin: 0 16px\">\n        <a-breadcrumb style=\"margin: 16px 0\">\n          <a-breadcrumb-item><a href=\"\">\u9996\u9875</a></a-breadcrumb-item>\n          <a-breadcrumb-item>\u4fe1\u606f\u9762\u677f</a-breadcrumb-item>\n        </a-breadcrumb>\n        <div :style=\"{ padding: '24px', background: '#fff', minHeight: '550px'}\">\n          <router-view></router-view>\n        </div>\n      </a-layout-content>\n      <a-layout-footer style=\"text-align: center\">\n        <p>Copyright \xa9 2023 bingo</p>\n        Power By <a href=\"\">LinMo Jiang &amp; Bazinga Yuan</a>\n      </a-layout-footer>\n    </a-layout>\n  </a-layout>\n</template>\n<script setup>\nimport { LogoutOutlined, LockOutlined, DesktopOutlined, UserOutlined} from '@ant-design/icons-vue';\nimport { ref } from 'vue';\n\nconst collapsed = ref(false);\nconst selectedKeys = ref(['1']);\n\nconst menu_list = ref([\n  {\n    id: 1, icon: 'mail', title: '\u4fe1\u606f\u9762\u677f', menu_url: '/bingo/', children: []\n  },\n  {\n    id: 2, icon: 'mail', title: '\u8d44\u4ea7\u7ba1\u7406', menu_url: '/bingo/manage', children: [\n      {id: 9, icon: 'mail', title: '\u4e3b\u673a\u7ba1\u7406', menu_url: '/bingo/manage/host'},\n      {id: 10, icon: 'mail', title: 'DB\u7ba1\u7406', menu_url: '/bingo/manage/db'},\n      {id: 11, icon: 'mail', title: 'IDC\u673a\u623f', menu_url: '/bingo/manage/idc'},\n      {id: 12, icon: 'mail', title: '\u8d44\u4ea7\u914d\u7f6e', menu_url: '/bingo/manage/config'},\n    ]\n  },\n  {\n    \"id\": 3, icon: 'bold', title: '\u4f5c\u4e1a\u7ba1\u7406', menu_url: '/bingo/work', children: [\n      {id: 13, icon: 'mail', title: '\u6279\u91cf\u4efb\u52a1', menu_url: '/bingo/work/tasks'},\n      {id: 14, icon: 'mail', title: '\u8ba1\u5212\u4efb\u52a1', menu_url: '/bingo/work/cron', children: []},\n      {id: 15, icon: 'mail', title: '\u4efb\u52a1\u6a21\u677f', menu_url: '/bingo/work/template'},\n    ]\n  },\n  {\n    id: 4, icon: 'highlight', title: '\u4ee3\u7801\u7ba1\u7406', menu_url: '/bingo/code', children: [\n      {id: 16, icon: 'mail', title: '\u5e94\u7528\u7ba1\u7406', menu_url: '/bingo/code/app'},\n      {id: 17, icon: 'mail', title: '\u53d1\u5e03\u7533\u8bf7', menu_url: '/bingo/code/release'},\n      {id: 18, icon: 'mail', title: '\u4ee3\u7801\u4ed3\u5e93', menu_url: '/bingo/code/repo'},\n      {id: 19, icon: 'mail', title: '\u955c\u50cf\u4ed3\u5e93', menu_url: '/bingo/code/image'},\n    ]\n  },\n  {\n    id: 5, icon: 'mail', title: '\u914d\u7f6e\u7ba1\u7406', menu_url: '/bingo/config', children: [\n      {id: 20, title: '\u73af\u5883\u7ba1\u7406', menu_url: '/bingo/config/env'},\n      {id: 21, title: '\u670d\u52a1\u914d\u7f6e', menu_url: '/bingo/config/services'},\n      {id: 22, title: '\u5e94\u7528\u914d\u7f6e', menu_url: '/bingo/config/app'}\n    ]\n  },\n  {\n    id: 6, icon: 'mail', title: '\u76d1\u63a7\u9884\u8b66', menu_url: '/bingo/monitor', children: [\n      {id: 23, title: '\u62a5\u8b66\u5386\u53f2', menu_url: '/bingo/monitor/history'},\n      {id: 24, title: '\u62a5\u8b66\u8054\u7cfb\u4eba', menu_url: '/bingo/monitor/user'},\n      {id: 25, title: '\u62a5\u8b66\u8054\u7cfb\u7ec4', menu_url: '/bingo/monitor/group'}\n    ]\n  },\n  {\n    id: 7, icon: 'mail', title: '\u7528\u6237\u7ba1\u7406', menu_url: '/bingo/auth', children: [\n      {id: 26, title: '\u8d26\u6237\u7ba1\u7406', menu_url: '/bingo/auth/user'},\n      {id: 27, title: '\u89d2\u8272\u7ba1\u7406', menu_url: '/bingo/auth/role'},\n      {id: 28, title: '\u6743\u9650\u7ba1\u7406', menu_url: '/bingo/auth/permission'},\n      {id: 29, title: '\u83dc\u5355\u7ba1\u7406', menu_url: '/bingo/auth/menu'},\n    ]\n  },\n  {\n    id: 8, icon: 'mail', title: '\u7cfb\u7edf\u8bbe\u7f6e', menu_url: '/bingo/sys', children: []\n  },\n])\n\n<\/script>\n\n<style>\n.logo {\n  font-style: italic;\n  text-align: center;\n  font-size: 20px;\n  color:#fff;\n  margin: 0 0 10px;\n  line-height: 42px;\n  height: 42px;\n  background: rgba(255, 255, 255, 0.1);\n}\n.user{\n  position: relative;\n}\n.user:after{\n  content: \"\";\n  border: 4px solid transparent;\n  border-top: 4px solid #000;\n  position: absolute;\n  width: 0;\n  height: 0;\n  top: 30px;\n  right: 12px;\n  margin: auto;\n}\n\n</style>\n")),(0,o.yg)("p",null,"\u57fa\u4e8erouter\u7684\u5d4c\u5957\u5b50\u8def\u7531\u5b9e\u73b0\u9875\u9762\u5d4c\u5957\u6548\u679c\uff0c\u6240\u4ee5\u5728\u4e0a\u976256\u884c\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86",(0,o.yg)("inlineCode",{parentName:"p"},"<router-view></router-view>"),"\u7528\u4e8e\u63d0\u4f9b\u7ed9\u8def\u7531\u7ec4\u4ef6\u5c06\u6765\u66ff\u6362\u5b50\u6a21\u677f\u5185\u5bb9\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4fee\u6539\u4e0b\u8def\u7531\u914d\u7f6e\u624d\u80fd\u770b\u5230\u771f\u6b63\u6548\u679c\u3002",(0,o.yg)("inlineCode",{parentName:"p"},"src/router/index.js"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"import { createRouter, createWebHistory } from 'vue-router'\n\nconst routes = [\n  { path: '/bingo', meta: {title: \"\"}, name: 'Base', component: ()=>import(\"../views/Base.vue\"), children: [\n      { path: '', meta: {title: \"\u4e3b\u9875\u9762\u677f\"}, name: 'bingo', component: ()=>import(\"../views/Bingo.vue\")},\n    ]},\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\n\nrouter.beforeEach((to, from, next) => {\n  if(to.meta.title){\n    // \u4fee\u6539\u9875\u9762\u539f\u6709\u6807\u9898\n    document.title = to.meta.title\n  }\n  next();\n});\n\nexport default router;\n")),(0,o.yg)("p",null,"\u7b49\u5f85\u9879\u76ee\u91cd\u542f\uff0c\u6548\u679c\u5982\u4e0b\uff1a"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230809173707907-1573828-1574000.png",alt:"image-20230809173707907"})),(0,o.yg)("p",null,"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u518d\u6b21\u521b\u5efa\u4e00\u4e2a\u9875\u9762\u7ec4\u4ef6\uff0c\u7528\u4e8e\u5c06\u6765\u7ba1\u7406\u516c\u53f8\u7684\u4e3b\u673a\u8d44\u4ea7\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/views/Host.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="host">\n    <h1>host\u9875\u9762</h1>\n  </div>\n</template>\n\n<script setup>\n\n<\/script>\n\n<style scoped>\n\n</style>\n\n')),(0,o.yg)("p",null,"\u7ed1\u5b9a\u8def\u7531\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/router/index.js"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"import { createRouter, createWebHistory } from 'vue-router'\n\nconst routes = [\n  { path: '/bingo', meta: {title: \"\"}, name: 'Base', component: ()=>import(\"../views/Base.vue\"), children: [\n      { path: '', meta: {title: \"\u4e3b\u9875\u9762\u677f\"}, name: 'bingo', component: ()=>import(\"../views/bingo.vue\")},\n      { path: 'manage/host', meta: {title: \"\u4e3b\u673a\u7ba1\u7406\"}, name: 'Host', component: ()=>import(\"../views/Host.vue\")},\n    ]},\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\n\nrouter.beforeEach((to, from, next) => {\n  if(to.meta.title){\n    // \u4fee\u6539\u9875\u9762\u539f\u6709\u6807\u9898\n    document.title = to.meta.title\n  }\n  next();\n});\n\nexport default router;\n")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230809174530483.png",alt:"image-20230809174530483"})),(0,o.yg)("h4",{id:"323-\u767b\u9646\u754c\u9762"},"3.2.3 \u767b\u9646\u754c\u9762"),(0,o.yg)("p",null,"src/views/Login.vue\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="login box">\n    <img src=".https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/login.jpg" alt="">\n    <div class="login">\n      <div class="login-title">\n        <p class="hi">Hello,Bingo!</p>\n      </div>\n      <div class="login_box">\n        <div class="title">\n          <span>\u767b\u5f55</span>\n        </div>\n        <div class="inp">\n          <a-input v-model:value="username" type="text" placeholder="\u7528\u6237\u540d" class="user"></a-input>\n          <a-input v-model:value="password" type="password" class="pwd" placeholder="\u5bc6\u7801"></a-input>\n          <div class="remember">\n            <a-checkbox type="checkbox" v-model:checked="remember">\u8bb0\u4f4f\u5bc6\u7801</a-checkbox>\n          </div>\n          <button class="login_btn" @click="login">\u767b\u5f55</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport {ref} from "vue";\n\nconst username = ref(\'\');\nconst password = ref(\'\');\nconst remember = ref(true);\n\nconst login = () => {\n\n}\n<\/script>\n\n<style scoped>\n.login.box {\n  overflow: hidden;\n  height: 100vh;\n}\n\n.login .hi {\n  font-size: 20px;\n  font-style: italic;\n}\n\n.box {\n  width: 100%;\n  height: 100%;\n  position: relative;\n  overflow: hidden;\n}\n\n.box img {\n  width: 100%;\n  min-height: 100%;\n}\n\n.box .login {\n  position: absolute;\n  width: 500px;\n  height: 400px;\n  left: 0;\n  margin: auto;\n  right: 0;\n  bottom: 0;\n  top: -338px;\n}\n\n.login .login-title {\n  width: 100%;\n  text-align: center;\n}\n\n.login-title img {\n  width: 190px;\n  height: auto;\n}\n\n.login-title p {\n  font-size: 18px;\n  color: #fff;\n  letter-spacing: .29px;\n  padding-top: 10px;\n  padding-bottom: 50px;\n}\n\n.login_box {\n  width: 400px;\n  height: auto;\n  background: rgba(255, 255, 255, 0.3);\n  box-shadow: 0 2px 4px 0 rgba(0, 0, 0, .5);\n  border-radius: 4px;\n  margin: 0 auto;\n  padding-bottom: 40px;\n}\n\n.login_box .title {\n  font-size: 20px;\n  color: #9b9b9b;\n  letter-spacing: .32px;\n  border-bottom: 1px solid #e6e6e6;\n  display: flex;\n  justify-content: space-around;\n  padding: 50px 60px 0 60px;\n  margin-bottom: 20px;\n  cursor: pointer;\n}\n\n.login_box .title span:nth-of-type(1) {\n  color: #4a4a4a;\n  border-bottom: 2px solid #396fcc;\n}\n\n.inp {\n  width: 350px;\n  margin: 0 auto;\n}\n\n.inp input {\n  outline: 0;\n  width: 100%;\n  height: 45px;\n  border-radius: 4px;\n  border: 1px solid #d9d9d9;\n  text-indent: 20px;\n  font-size: 14px;\n  background: #fff !important;\n}\n\n.inp .user {\n  margin-bottom: 16px;\n}\n\n.login_btn {\n  width: 100%;\n  height: 45px;\n  background: #396fcc;\n  border-radius: 5px;\n  font-size: 16px;\n  color: #fff;\n  letter-spacing: .26px;\n  margin-top: 30px;\n}\n\n.remember {\n  margin-top: 10px;\n}\n</style>\n')),(0,o.yg)("p",null,"\u767b\u9646\u9875\u9762\u4e0d\u5b58\u5728\u83dc\u5355\u7b49\u516c\u5171\u90e8\u5206\u9875\u9762\uff0c\u6240\u4ee5\u6211\u4eec\u5355\u72ec\u6ce8\u518c\u8def\u7531\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/router/index.js"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"import { createRouter, createWebHistory } from 'vue-router'\n\nconst routes = [\n  { path: '/bingo', meta: {title: \"\"}, name: 'Base', component: ()=>import(\"../views/Base.vue\"), children: [\n      { path: '', meta: {title: \"\u4e3b\u9875\u9762\u677f\"}, name: 'bingo', component: ()=>import(\"../views/bingo.vue\")},\n      { path: 'manage/host', meta: {title: \"\u4e3b\u673a\u7ba1\u7406\"}, name: 'Host', component: ()=>import(\"../views/Host.vue\")},\n    ]},\n\n  { path: '/', meta: {title: \"\u7528\u6237\u767b\u5f55\"}, name: 'Login', component: ()=>import(\"../views/Login.vue\")},\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n});\n\nrouter.beforeEach((to, from, next) => {\n  if(to.meta.title){\n    // \u4fee\u6539\u9875\u9762\u539f\u6709\u6807\u9898\n    document.title = to.meta.title\n  }\n  next();\n});\n\nexport default router;\n")),(0,o.yg)("p",null,"\u767b\u9646\u754c\u9762\u6548\u679c\u5982\u4e0b\uff1a"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230809174654313-1574415.png",alt:"image-20230809174654313"})),(0,o.yg)("h1",{id:"\u4e8c\u540e\u7aef\u521d\u59cb\u5316"},"\u4e8c\u3001\u540e\u7aef\u521d\u59cb\u5316"),(0,o.yg)("h2",{id:"21\u642d\u5efa\u9879\u76ee"},"2.1\u3001\u642d\u5efa\u9879\u76ee"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"mkdir bingo_api\ncd bingo_api\ngo mod init bingo_api\n")),(0,o.yg)("p",null,"\u521b\u5efa\u597d\u9879\u76ee\u4e4b\u540e\uff0c\u901a\u8fc7goland\u6253\u5f00\uff0c\u5728\u7f16\u8f91\u5668\u7684\u914d\u7f6e\u4e2d\uff0c\u5207\u6362\u6e90\u4ee3\u7406GOPROXY"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20210421131905290.png",alt:"image-20210421131905290"})),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20210421132219232.png",alt:"image-20210421132219232"})),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20210421132332339.png",alt:"image-20210421132332339"})),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"GOPROXY https://proxy.golang.org,direct\n# \u963f\u91cc\u4e91\nexport GOPROXY=https://mirrors.aliyun.com/goproxy/\n# \u4e03\u725b\u4e91\nexport GOPROXY= https://goproxy.cn\n")),(0,o.yg)("p",null,"\u5982\u679c\u6ca1\u6709goland\u7684\u540c\u5b66\uff0c\u53ef\u4ee5\u81ea\u5df1\u4e70\u4e2a\u6fc0\u6d3b\u7801\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u7684\u7f16\u8f91\u5668\u3002"),(0,o.yg)("h2",{id:"22\u76ee\u5f55\u7ed3\u6784"},"2.2\u3001\u76ee\u5f55\u7ed3\u6784"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"\u2514\u2500\u2500 bingo_api/\n     \u251c\u2500\u2500 logs/          # \u9879\u76ee\u8fd0\u884c\u65f6/\u5f00\u53d1\u65f6\u65e5\u5fd7\u76ee\u5f55\n     \u2514\u2500\u2500 application/   # \u5f00\u53d1\u4e3b\u5e94\u7528\u76ee\u5f55\n          \u251c\u2500\u2500 api/        # \u63a5\u53e3\u5c42\u76ee\u5f55\n          \u251c\u2500\u2500 config/     # \u914d\u7f6e\u76ee\u5f55\n          \u251c\u2500\u2500 constants/  # \u5168\u5c40\u5e38\u91cf\u76ee\u5f55\n          \u251c\u2500\u2500 initialize/ # \u9879\u76ee\u521d\u59cb\u5316\u76ee\u5f55\n          \u251c\u2500\u2500 middleware/ # \u4e2d\u95f4\u4ef6\u5c42\u76ee\u5f55\n          \u251c\u2500\u2500 model/      # \u6a21\u578b\u5c42\u76ee\u5f55\n          \u251c\u2500\u2500 router/     # \u8def\u7531\u76ee\u5f55\n          \u251c\u2500\u2500 services/   # \u4e1a\u52a1\u5c42\u76ee\u5f55\n          \u251c\u2500\u2500 utils/      # \u5de5\u5177\u5e93\u76ee\u5f55\n          \u251c\u2500\u2500 validator/  # \u9a8c\u8bc1\u903b\u8f91\u76ee\u5f55\n          \u2514\u2500\u2500 main.go     # \u9879\u76ee\u5165\u53e3\u6587\u4ef6\n")),(0,o.yg)("p",null,"\u4e0a\u9762\u7684\u76ee\u5f55\u7ed3\u6784\u56fe\u53ef\u4ee5\u5728\u7ec8\u7aef\u4e0b\u4f7f\u7528tree\u8f93\u51fa\u3002\u5982\u679c\u6ca1\u6709\u5b89\u88c5tree\uff0c\u5b89\u88c5\u4e0b\u5c31\u6709\u4e86\u3002"),(0,o.yg)("p",null,"\u5b89\u88c5gin\u6846\u67b6"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"go get -u github.com/gin-gonic/gin\n")),(0,o.yg)("p",null,"application/main.go\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "github.com/gin-gonic/gin"\n    "net/http"\n)\n\nfunc main() {\n    // 1.\u521b\u5efa\u8def\u7531\n    router := gin.Default()\n    // 2.\u7ed1\u5b9a\u8def\u7531\u89c4\u5219\uff0c\u6267\u884c\u7684\u51fd\u6570\n    // gin.Context\uff0c\u5c01\u88c5\u4e86request\u548cresponse\n    router.GET("/", func(c *gin.Context) {\n        // panic(&middleware.Api{Code: http.StatusInternalServerError, Message: "\u6d4b\u8bd5\u9519\u8bef\uff01"})\n        c.String(http.StatusOK, "Hello Bingo!")\n    })\n    // 3.\u76d1\u542c\u7aef\u53e3\uff0c\u9ed8\u8ba4\u57288080\uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u7684vue\u5df2\u7ecf\u8fd0\u884c\u5360\u7528\u4e868080\u4e86\uff0c\u6240\u4ee5\u6539\u62108000\n    router.Run(":8080")\n}\n\n')),(0,o.yg)("h2",{id:"23\u8def\u7531\u521d\u59cb\u5316"},"2.3\u3001\u8def\u7531\u521d\u59cb\u5316"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/main.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "bingo_api/application/initialize"\n)\n\nfunc main() {\n    // 1. \u8def\u7531\u521d\u59cb\u5316\n    Router := initialize.InitRouter()\n    // 2.\u76d1\u542c\u7aef\u53e3\uff0c\u9ed8\u8ba4\u57288080\n    Router.Run(":8080")\n}\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/initialize/router.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package initialize\n\nimport (\n    "github.com/gin-gonic/gin"\n)\n\nfunc InitRouter() *gin.Engine {\n\n    // 1. \u521b\u5efa\u8def\u7531\n    Router := gin.Default()\n    // 2. Api\u8def\u7531\u5206\u7ec4\n    ApiGroup := Router.Group("/test")\n    ApiGroup.GET("/", func(context *gin.Context) {\n        context.String(200, "Bingo Start")\n    })\n\n    return Router\n}\n')),(0,o.yg)("h2",{id:"24\u914d\u7f6e\u521d\u59cb\u5316"},"2.4\u3001\u914d\u7f6e\u521d\u59cb\u5316"),(0,o.yg)("p",null,"\u521d\u59cb\u5316\u914d\u7f6e\u6a21\u5757\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"application/config/config.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package config\n\nimport (\n    "encoding/json"\n    "io/ioutil"\n)\n\n// \u5916\u754cgo\u5f00\u53d1\u9879\u76ee\uff1a \u914d\u7f6e\u6587\u4ef6\u90fd\u662f json\u3001yaml\u3001ini\n\n// Config \u6574\u4e2a\u9879\u76ee\u7684\u914d\u7f6e\ntype Config struct {  \n    Mode string `json:"mode"`\n  Host string `json:"host"`\n    Port int    `json:"port"`\n}\n\n// Conf \u5168\u5c40\u914d\u7f6e\u53d8\u91cf\nvar Conf = new(Config)\n\n// Init \u521d\u59cb\u5316\u914d\u7f6e\uff1b\u4ece\u6307\u5b9a\u6587\u4ef6\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\nfunc Init(filePath string) error {\n    /**\n    filePath \u914d\u7f6e\u6587\u4ef6json\u6587\u4ef6\u7684\u8def\u5f84\n    */\n    b, err := ioutil.ReadFile(filePath)\n    if err != nil {\n        return err\n    }\n    return json.Unmarshal(b, Conf)\n}\n\n')),(0,o.yg)("p",null,"\u51c6\u5907\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u521b\u5efa",(0,o.yg)("inlineCode",{parentName:"p"},"config.json"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "host": "api.bingo.cn",\n  "mode": "debug",\n  "port": 8000\n}\n')),(0,o.yg)("p",null,"\u8c03\u7528\u914d\u7f6e\u521d\u59cb\u5316\u51fd\u6570\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"applicaton/main.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "bingo_api/application/config"\n    "bingo_api/application/initialize"\n    "fmt"\n    "github.com/gin-gonic/gin"\n    "path/filepath"\n)\n\nfunc main() {\n    // 1. filepath.Dir(".") \u662f\u4e00\u4e2a Go \u8bed\u8a00\u4e2d\u7684\u51fd\u6570\u8c03\u7528\uff0c\u7528\u4e8e\u83b7\u53d6\u5f53\u524d\u76ee\u5f55\u7684\u7236\u76ee\u5f55\u3002\n    dir, err := filepath.Abs(filepath.Dir("."))\n    if err != nil {\n        panic(err.Error())\n    }\n\n    fmt.Println("dir", dir)\n\n    // 2. \u914d\u7f6e\u521d\u59cb\u5316\n    if err := config.Init(fmt.Sprintf("%s/config.json", dir)); err != nil {\n        panic(err.Error())\n    }\n\n    // 3. \u8bbe\u7f6e\u8c03\u8bd5\u6a21\u5f0f\n    gin.SetMode(config.Conf.Mode)\n\n    // 4. \u521b\u5efa\u8def\u7531\n    Router := initialize.InitRouter()\n\n    // \u76d1\u542c\u7aef\u53e3\n    Router.Run(fmt.Sprintf("%s:%d", config.Conf.Host, config.Conf.Port))\n}\n\n')),(0,o.yg)("h2",{id:"25\u65e5\u5fd7\u521d\u59cb\u5316"},"2.5\u3001\u65e5\u5fd7\u521d\u59cb\u5316"),(0,o.yg)("p",null,"zap\u662fUber\u5f00\u53d1\u7684\u975e\u5e38\u5feb\u7684\u3001\u7ed3\u6784\u5316\u7684\uff0c\u5206\u65e5\u5fd7\u7ea7\u522b\u7684Go\u65e5\u5fd7\u5e93\u3002\u6839\u636eUber-go Zap\u7684\u6587\u6863\uff0c\u5b83\u7684\u6027\u80fd\u6bd4\u7c7b\u4f3c\u7684\u7ed3\u6784\u5316\u65e5\u5fd7\u5305\u66f4\u597d\uff0c\u4e5f\u6bd4\u6807\u51c6\u5e93\u66f4\u5feb\u3002"),(0,o.yg)("p",null,"github\u5730\u5740\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://github.com/uber-go/zap"},"https://github.com/uber-go/zap")),(0,o.yg)("p",null,"\u5b89\u88c5"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"go get -u go.uber.org/zap\ngo get -u go.uber.org/zap/zapcore\ngo get -u github.com/natefinch/lumberjack\n")),(0,o.yg)("h3",{id:"1\u65e5\u5fd7\u7b49\u7ea7"},"\u30101\u3011\u65e5\u5fd7\u7b49\u7ea7"),(0,o.yg)("p",null,"\u4ece\u4e0a\u5f80\u4e0b\uff0c\u7b49\u7ea7\u8d8a\u9ad8\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-golang"},"DebugLevel   zap.S().Debug  // \u8c03\u8bd5\uff0c\u5f00\u53d1\u4eba\u5458\u81ea\u5df1\u8c03\u8bd5\u7a0b\u5e8f\u65f6\u8f93\u5165\u7684\u4fe1\u606f\nInfoLevel    zap.S().Info   // \u4fe1\u606f\uff0c\u7a0b\u5e8f\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u8f93\u5165\u7684\u7ec6\u8282\u4fe1\u606f\nWarnLevel    zap.S().Warn   // \u8b66\u544a\uff0c\u7a0b\u5e8f\u9047\u5230\u4e00\u4e9b\u80fd\u8fd0\u884c\uff0c\u4f46\u662f\u6709\u53ef\u80fd\u5728\u8fd0\u884c\u4ee5\u540e\u51fa\u73b0\u4e0d\u9884\u671f\u7684\u7ed3\u679c\u3002                                    \nErrorLevel   zap.S().Error  // \u9519\u8bef\uff0c\u7a0b\u5e8f\u9047\u5230\u4e86\u4e00\u4e9b\u529f\u80fd\u6027\u4e0a\uff0c\u7a0b\u5e8f\u5728\u5224\u65ad\u4e0a\uff0c\u51fa\u73b0\u4e86\u9884\u671f\u7684\u9519\u8bef\u3002\nPanicLevel   zap.S().Panic  // \u5f02\u5e38\uff0c\u7a0b\u5e8f\u9047\u5230\u4e86\u4e00\u4e9b\u529f\u80fd\u6027\u4e0a\uff0c\u7a0b\u5e8f\u5728\u5224\u65ad\u4e0a\uff0c\u51fa\u73b0\u4e86\u4e0d\u9884\u671f\u7684\u9519\u8bef\u3002\nFatalLevel   zap.S().Fatal  // \u81f4\u547d\uff0c\u7a0b\u5e8f\u9047\u5230\u4e86\u81f4\u547d\u8bed\u6cd5\u7ea7\u522b\u9519\u8bef\uff0c\u6839\u672c\u53ef\u80fd\u4e0d\u80fd\u8fd0\u884c\u7684\uff0c\u6216\u8005\u8fd0\u884c\u4ee5\u540e\uff0c\u65e0\u6cd5\u6267\u884c\u7684\u3002\n")),(0,o.yg)("h3",{id:"2\u57fa\u672c\u4f7f\u7528"},"\u30102\u3011\u57fa\u672c\u4f7f\u7528"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/initialize/logger.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package initialize\n\nimport "go.uber.org/zap"\n\nfunc InitLogger() {\n    // \u65e5\u5fd7\u521d\u59cb\u5316\n    // logger, _ := zap.NewProduction()  // \u7528\u4e8e\u9879\u76ee\u751f\u4ea7\u9636\u6bb5\uff0c\u683c\u5f0f: json\u3010\u9002\u5408\u7528\u4e8e\u96c6\u6210\u5230\u7b2c\u4e09\u65b9\u65e5\u5fd7\u5206\u6790\u7cfb\u7edf\u4e2d\u7684\u3011\n    logger, _ := zap.NewDevelopment()    // \u7528\u4e8e\u9879\u76ee\u5f00\u53d1\u9636\u6bb5\uff0c\u683c\u5f0f: \u666e\u901a\u6587\u672c\u683c\u5f0f\u3010\u9002\u5408\u5728\u7ec8\u7aef\u67e5\u770b\u3011\n    // \u66ff\u6362\u4e86zap\u7684\u5168\u5c40\u65e5\u5fd7\u914d\u7f6e\n    zap.ReplaceGlobals(logger)\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"main.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "bingo_api/application/config"\n    "bingo_api/application/initialize"\n    "fmt"\n    "github.com/gin-gonic/gin"\n    "go.uber.org/zap"\n    "path/filepath"\n)\n\nfunc main() {\n    // \u83b7\u53d6\u4e00\u4e2a\u57fa\u4e8e\u6574\u4e2a\u76ee\u5f55\u5165\u53e3\u6240\u5728\u7684\u8def\u5f84\n    dir, err := filepath.Abs(filepath.Dir("."))\n    if err != nil {\n        panic(err.Error())\n    }\n\n    // \u914d\u7f6e\u521d\u59cb\u5316\n    if err := config.Init(fmt.Sprintf("%s/config.json", dir)); err != nil {\n        panic(err.Error())\n    }\n\n    // \u8bbe\u7f6e\u8c03\u8bd5\u6a21\u5f0f\n    gin.SetMode(config.Conf.Mode)\n\n    // \u521b\u5efa\u8def\u7531\n    Router := initialize.InitRouter()\n\n    // \u65e5\u5fd7\u521d\u59cb\u5316\n    initialize.InitLogger()\n    // zap \u63d0\u4f9b\u4e86\u4e00\u4e2aS\u51fd\u6570\u548cL\u51fd\u6570\u7ed9\u6211\u4eec\u5f00\u53d1\u8005\u4f7f\u7528\uff0c\u8c03\u7528S\u51fd\u6570\u6216L\u51fd\u6570\uff0c\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u5168\u5c40\u7684\u7ebf\u7a0b\u5b89\u5168\u7684logger\u5bf9\u8c61\n    zap.S().Infof("\u670d\u52a1\u7aef\u542f\u52a8...\u7aef\u53e3\uff1a%d", config.Conf.Port)\n\n    // \u76d1\u542c\u7aef\u53e3\n    if err := Router.Run(fmt.Sprintf("%s:%d", config.Conf.Host, config.Conf.Port)); err != nil {\n        zap.S().Panic("\u670d\u52a1\u7aef\u542f\u52a8\u5931\u8d25\uff1a", err.Error())\n    }\n}\n\n')),(0,o.yg)("h3",{id:"3\u65e5\u5fd7\u914d\u7f6e"},"\u30103\u3011\u65e5\u5fd7\u914d\u7f6e"),(0,o.yg)("p",null,"\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u65e5\u5fd7\u8f93\u51fa\u7684\u6587\u4ef6\u540d\uff0c\u5355\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u5468\u671f\uff0c\u4ee5\u53ca\u65e5\u5fd7\u6587\u4ef6\u7684\u5907\u4efd\u6570\u91cf\u3002"),(0,o.yg)("p",null,"\u65b0\u589e\u65e5\u5fd7\u76f8\u5173\u7684\u914d\u7f6e\u9879\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"application/config/config.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package config\n\nimport (\n    "encoding/json"\n    "io/ioutil"\n)\n\n// Config \u6574\u4e2a\u9879\u76ee\u7684\u914d\u7f6e\ntype Config struct {\n    Mode       string `json:"mode"`\n  Host       string `json:"host"`\n    Port       int    `json:"port"`\n    *LogConfig `json:"log"`\n}\n\n// LogConfig \u65e5\u5fd7\u914d\u7f6e\ntype LogConfig struct {\n    Level      string `json:"level"`\n    Filename   string `json:"filename"`\n    MaxSize    int    `json:"maxsize"`\n    MaxAge     int    `json:"max_age"`\n    MaxBackups int    `json:"max_backups"`\n}\n\n// Conf \u5168\u5c40\u914d\u7f6e\u53d8\u91cf\nvar Conf = new(Config)\n\n// Init \u521d\u59cb\u5316\u914d\u7f6e\uff1b\u4ece\u6307\u5b9a\u6587\u4ef6\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\nfunc Init(filePath string) error {\n    b, err := ioutil.ReadFile(filePath)\n    if err != nil {\n        return err\n    }\n    return json.Unmarshal(b, Conf)\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"config.json"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "mode": "debug",\n  "host": "api.bingo.cn",\n  "port": 8080,\n  "log": {\n    "level": "debug",\n    "filename": "logs/bingo.log",\n    "maxsize": 300,\n    "max_age": 7,\n    "max_backups": 10\n  }\n}\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/initialize/logger.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package initialize\n\nimport (\n    "github.com/natefinch/lumberjack"\n    "go.uber.org/zap"\n    "go.uber.org/zap/zapcore"\n    "bingo_api/application/config"\n)\n\nvar Logger *zap.Logger\n\nfunc InitLogger(cfg *config.LogConfig) (err error) {\n    // \u65e5\u5fd7\u521d\u59cb\u5316\n    // \u5b9a\u5236\u65e5\u5fd7\u7684\u683c\u5f0f\n    writeSyncer := getLogWriter(cfg.Filename, cfg.MaxSize, cfg.MaxBackups, cfg.MaxAge)\n    encoder := getEncoder()\n    var l = new(zapcore.Level)\n    if err = l.UnmarshalText([]byte(cfg.Level)); err != nil {\n        return\n    }\n    core := zapcore.NewCore(encoder, writeSyncer, l)\n    Logger = zap.New(core, zap.AddCaller())\n    // logger, _ := zap.NewProduction()  // \u7528\u4e8e\u9879\u76ee\u751f\u4ea7\u9636\u6bb5\uff0c\u683c\u5f0f: json\u3010\u9002\u5408\u7528\u4e8e\u96c6\u6210\u5230\u7b2c\u4e09\u65b9\u65e5\u5fd7\u5206\u6790\u7cfb\u7edf\u4e2d\u7684\u3011\n    // logger, _ := zap.NewDevelopment()    // \u7528\u4e8e\u9879\u76ee\u5f00\u53d1\u9636\u6bb5\uff0c\u683c\u5f0f: \u666e\u901a\u6587\u672c\u683c\u5f0f\u3010\u9002\u5408\u5728\u7ec8\u7aef\u67e5\u770b\u3011\n    // \u66ff\u6362\u4e86zap\u7684\u5168\u5c40\u65e5\u5fd7\u914d\u7f6e\n    zap.ReplaceGlobals(Logger)\n    return\n}\n\nfunc getEncoder() zapcore.Encoder {\n    encoderConfig := zap.NewProductionEncoderConfig()\n    encoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder\n    encoderConfig.TimeKey = "time"\n    encoderConfig.EncodeLevel = zapcore.CapitalLevelEncoder\n    encoderConfig.EncodeDuration = zapcore.SecondsDurationEncoder\n    encoderConfig.EncodeCaller = zapcore.ShortCallerEncoder\n    return zapcore.NewJSONEncoder(encoderConfig)\n}\n\nfunc getLogWriter(filename string, maxSize, maxBackup, maxAge int) zapcore.WriteSyncer {\n    lumberJackLogger := &lumberjack.Logger{\n        Filename:   filename,\n        MaxSize:    maxSize,\n        MaxBackups: maxBackup,\n        MaxAge:     maxAge,\n    }\n    return zapcore.AddSync(lumberJackLogger)\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/main.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "fmt"\n    "github.com/gin-gonic/gin"\n    "go.uber.org/zap"\n    "path/filepath"\n    "bingo_api/application/config"\n    "bingo_api/application/initialize"\n)\n\nfunc main() {\n    // 1. \u83b7\u53d6\u4e00\u4e2a\u57fa\u4e8e\u6574\u4e2a\u76ee\u5f55\u5165\u53e3\u6240\u5728\u7684\u8def\u5f84\n    dir, err := filepath.Abs(filepath.Dir("."))\n    if err != nil {\n        panic(err.Error())\n    }\n\n    // 2. \u914d\u7f6e\u521d\u59cb\u5316\n    if err := config.Init(fmt.Sprintf("%s/config.json", dir)); err != nil {\n        panic(err.Error())\n    }\n\n    // \u8bbe\u7f6e\u8c03\u8bd5\u6a21\u5f0f\n    gin.SetMode(config.Conf.Mode)\n\n    // 3. \u65e5\u5fd7\u521d\u59cb\u5316\n    if err := initialize.InitLogger(config.Conf.LogConfig); err != nil {\n        fmt.Printf("init logger failed, err:%v\\n", err)\n        return\n    }\n\n    zap.S().Debugf("\u8c03\u8bd5\u4fe1\u606f:%d", config.Conf.Port)\n\n    // 4.\u521b\u5efa\u8def\u7531\n    Router := initialize.InitRouter()\n\n    // 5. zap \u63d0\u4f9b\u4e86\u4e00\u4e2aS\u51fd\u6570\u548cL\u51fd\u6570\u7ed9\u6211\u4eec\u5f00\u53d1\u8005\u4f7f\u7528\uff0c\u8c03\u7528S\u51fd\u6570\u6216L\u51fd\u6570\uff0c\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u5168\u5c40\u7684\u7ebf\u7a0b\u5b89\u5168\u7684logger\u5bf9\u8c61\n    zap.S().Infof("\u670d\u52a1\u7aef\u542f\u52a8...\u7aef\u53e3\uff1a%d", config.Conf.Port)\n\n    // \u76d1\u542c\u7aef\u53e3\n    if err := Router.Run(fmt.Sprintf("%s:%d", config.Conf.Host, config.Conf.Port)); err != nil {\n        zap.S().Panic("\u670d\u52a1\u7aef\u542f\u52a8\u5931\u8d25\uff1a", err.Error())\n    }\n}\n\n')),(0,o.yg)("p",null,"\u4e2d\u95f4\u4ef6\u4e2d\u5bf9\u6bcf\u6b21\u7684\u8bf7\u6c42\u54cd\u5e94\u8fdb\u884c\u65e5\u5fd7\u8bb0\u5f55\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"application/middleware/logger.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package middleware\n\nimport (\n    "github.com/gin-gonic/gin"\n    "go.uber.org/zap"\n    "net"\n    "net/http"\n    "net/http/httputil"\n    "os"\n    "runtime/debug"\n    "strings"\n    "time"\n)\n\n// GinLogger \u63a5\u6536gin\u6846\u67b6\u9ed8\u8ba4\u7684\u65e5\u5fd7\nfunc GinLogger() gin.HandlerFunc {\n    // \u9700\u8981\u8bb0\u5f55\u7684\u662f\u6bcf\u6b21\u5ba2\u6237\u7aef\u8bbf\u95ee\u65f6\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u6240\u4ee5\u6b64\u5904\u8fd4\u56de\u4e00\u4e2a\u533f\u540d\u51fd\u6570\uff0c\u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u65f6\uff0c\u89e6\u53d1\u4e2d\u95f4\u4ef6\u7684\u65f6\u5019\uff0c\u81ea\u52a8\u6267\u884c\u8fd9\u4e2a\u533f\u540d\u51fd\u6570\n    return func(c *gin.Context) {\n        start := time.Now()\n        path := c.Request.URL.Path\n        c.Next()\n        cost := time.Since(start)\n        // \u8bb0\u5f55\u65e5\u5fd7\n        zap.S().Info(path,\n            zap.Int("status", c.Writer.Status()),\n            zap.String("method", c.Request.Method),\n            zap.String("ip", c.ClientIP()),\n            zap.String("user-agent", c.Request.UserAgent()),\n            zap.Duration("cost timer", cost),\n        )\n    }\n}\n\n')),(0,o.yg)("p",null,"\u6ce8\u518c\u4e2d\u95f4\u4ef6\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"application/initialize/router.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package initialize\n\nimport (\n    "bingo_api/application/middleware"\n    "github.com/gin-gonic/gin"\n)\n\nfunc InitRouter() *gin.Engine {\n\n    // 1. \u521b\u5efa\u8def\u7531\n    Router := gin.Default()\n    Router.Use(middleware.GinLogger())\n\n    // 2. Api\u8def\u7531\u5206\u7ec4\n    ApiGroup := Router.Group("/test")\n\n    ApiGroup.GET("/", func(context *gin.Context) {\n        context.String(200, "Bingo Start")\n    })\n\n    return Router\n}\n')),(0,o.yg)("h2",{id:"26\u5168\u5c40\u5f02\u5e38\u5904\u7406"},"2.6\u3001\u5168\u5c40\u5f02\u5e38\u5904\u7406"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"applicaton/middleware/exceptions.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package middleware\n\nimport (\n    "github.com/gin-gonic/gin"\n    "go.uber.org/zap"\n    "net/http"\n)\n\ntype Api struct {\n    Code    int\n    Message string\n}\n\nfunc ExceptionMiddleware(c *gin.Context) {\n     /**\n     \u5f02\u5e38\u5904\u7406\n     */\n    defer func() {\n        if r := recover(); r != nil {\n            switch t := r.(type) {\n            case *Api:\n                zap.S().Error(t.Message)\n                c.JSON(t.Code, gin.H{\n                    "message": t.Message,\n                })\n            default:\n                zap.S().Error("\u670d\u52a1\u5668\u5185\u90e8\u5f02\u5e38")\n                c.JSON(http.StatusInternalServerError, gin.H{\n                    "message": "\u670d\u52a1\u5668\u5185\u90e8\u5f02\u5e38",\n                })\n            }\n            c.Abort()\n        }\n    }()\n\n    c.Next()\n}\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"initialize/router.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"Router.Use(middleware.ExceptionMiddleware)\n")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230808120421012-1467462.png",alt:"image-20230808120421012"})),(0,o.yg)("h2",{id:"27\u6570\u636e\u5e93\u521d\u59cb\u5316"},"2.7\u3001\u6570\u636e\u5e93\u521d\u59cb\u5316"),(0,o.yg)("h3",{id:"1mysql\u7684\u521d\u59cb\u5316"},"\u30101\u3011mysql\u7684\u521d\u59cb\u5316"),(0,o.yg)("h4",{id:"1-\u521b\u5efa\u6570\u636e\u5e93"},"1. \u521b\u5efa\u6570\u636e\u5e93"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-mysql"},"create database bingo default charset=utf8mb4;\n-- mysql5.5\u4ee5\u540e\u63a8\u51fa\u7684utf8mb4\uff0c\u8fd9\u4e2a\u662f\u771f\u6b63\u7684utf8\uff0c\u80fd\u591f\u5bb9\u7eb3\u6240\u6709\u7684\u4e2d\u6587\uff0c\u4ee5\u524d\u7684utf-8\u4f1a\u51fa\u73b0\u9519\u4e71\u7684\u4e2d\u6587\u7f16\u7801\u3002\n")),(0,o.yg)("p",null,"\u4e3a\u5f53\u524d\u9879\u76ee\u521b\u5efa\u6570\u636e\u5e93\u7528\u6237","[\u8fd9\u4e2a\u7528\u6237\u53ea\u80fd\u770b\u5230bingo\u8fd9\u4e2a\u6570\u636e\u5e93]"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-mysql"},"# \u521b\u5efa\u7528\u6237\uff1acreate user '\u7528\u6237\u540d'@'\u4e3b\u673a\u5730\u5740' identified by '\u5bc6\u7801';\ncreate user 'bingo_user'@'%' identified by 'bingo';  # %\u8868\u793a\u4efb\u610f\u4e3b\u673a\u90fd\u53ef\u4ee5\u901a\u8fc7\u5f53\u524d\u8d26\u6237\u767b\u5f55\u5230mysql\n# \u5206\u914d\u6743\u9650\uff1agrant \u6743\u9650\u9009\u9879 on \u6570\u636e\u5e93\u540d.\u6570\u636e\u8868 to '\u7528\u6237\u540d'@'\u4e3b\u673a\u5730\u5740' with grant option;\ngrant all privileges on bingo.* to 'bingo_user'@'%' with grant option;\n")),(0,o.yg)("h4",{id:"2-mysql\u521d\u59cb\u5316"},"2. MySQL\u521d\u59cb\u5316"),(0,o.yg)("p",null,"\u6587\u6863\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://gorm.io/zh_CN/docs/"},"https://gorm.io/zh_CN/docs/")),(0,o.yg)("p",null,"\u589e\u52a0\u6570\u636e\u5e93\u8fde\u63a5\u7684\u914d\u7f6e\u9879\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"config/config.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package config\n\nimport (\n    "encoding/json"\n    "io/ioutil"\n)\n\n// \u5916\u754cgo\u5f00\u53d1\u9879\u76ee\uff1a \u914d\u7f6e\u6587\u4ef6\u90fd\u662f json\u3001yaml\u3001ini\n\n// LogConfig \u65e5\u5fd7\u914d\u7f6e\ntype LogConfig struct {\n    Level      string `json:"level"`\n    Filename   string `json:"filename"`\n    MaxSize    int    `json:"maxsize"`\n    MaxAge     int    `json:"max_age"`\n    MaxBackups int    `json:"max_backups"`\n}\n\n// DatabaseConfig \u6570\u636e\u5e93\u914d\u7f6e\ntype DatabaseConfig struct {\n    Driver          string `json:"driver"`\n    Host            string `json:"host"`\n    Port            string `json:"port"`\n    Database        string `json:"database"`\n    Username        string `json:"username"`\n    Password        string `json:"password"`\n    Charset         string `json:"charset"`\n    MaximumConn     int    `json:"maximum_connection"`\n    MaximumFreeConn int    `json:"maximum_free_connection"`\n    TimeOut         int    `json:"timeout"`\n}\n\n// Config \u6574\u4e2a\u9879\u76ee\u7684\u914d\u7f6e\ntype Config struct {\n    Mode            string `json:"mode"`\n  Host            string `json:"host"`\n    Port            int    `json:"port"`\n    *LogConfig      `json:"log"`\n    *DatabaseConfig `json:"database"`\n}\n\n// Conf \u5168\u5c40\u914d\u7f6e\u53d8\u91cf\nvar Conf = new(Config)\n\n// Init \u521d\u59cb\u5316\u914d\u7f6e\uff1b\u4ece\u6307\u5b9a\u6587\u4ef6\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\nfunc Init(filePath string) error {\n    /**\n    filePath \u914d\u7f6e\u6587\u4ef6json\u6587\u4ef6\u7684\u8def\u5f84\n    */\n    b, err := ioutil.ReadFile(filePath)\n    if err != nil {\n        return err\n    }\n    return json.Unmarshal(b, Conf)\n}\n')),(0,o.yg)("p",null,"\u589e\u52a0\u6570\u636e\u5e93\u8fde\u63a5\u7684\u914d\u7f6e\u9879\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"applicetion/config.json"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "mode": "debug",\n  "host": "api.bingo.cn",\n  "port": 8080,\n  "log": {\n    "level": "debug",\n    "filename": "logs/bingo.log",\n    "maxsize": 300,\n    "max_age": 7,\n    "max_backups": 10\n  },\n  "database": {\n    "driver": "mysql",\n    "host": "127.0.0.1",\n    "port": "3306",\n    "database": "bingo",\n    "username": "bingo_user",\n    "password": "bingo",\n    "charset": "utf8mb4",\n    "maximum_connection": 10,\n    "maximum_free_connection": 50,\n    "timeout": -1\n  }\n}\n')),(0,o.yg)("p",null,"\u5c01\u88c5\u521d\u59cb\u5316\u6570\u636e\u5e93\u8fde\u63a5\u5de5\u5177\u51fd\u6570\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"applicetion/database/mysql.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package database\n\nimport (\n    "bingo_api/application/config"\n    "fmt"\n    "github.com/jinzhu/gorm"\n    _ "github.com/jinzhu/gorm/dialects/mysql"\n    "go.uber.org/zap"\n    "time"\n)\n\nvar Orm *gorm.DB\n\nfunc GetOrm(cfg *config.DatabaseConfig) *gorm.DB {\n    dsn := fmt.Sprintf("%s:%s@tcp(%s:%s)/%s?charset=%s&parseTime=true&loc=Local",\n        cfg.Username,\n        cfg.Password,\n        cfg.Host,\n        cfg.Port,\n        cfg.Database,\n        cfg.Charset)\n    var err error\n    Orm, err = gorm.Open(cfg.Driver, dsn)\n    if err != nil {\n        zap.S().Errorf("database connection fail: %v", err.Error())\n        panic(err.Error())\n    }\n    // \u6700\u5927\u94fe\u63a5\u6570\n    Orm.DB().SetMaxOpenConns(cfg.MaximumConn)\n    // \u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\n    Orm.DB().SetMaxIdleConns(cfg.MaximumFreeConn)\n    // \u6bcf\u4e2a\u94fe\u63a5\u7684\u6700\u5927\u751f\u547d\u5468\u671f\n    Orm.DB().SetConnMaxLifetime(time.Duration(cfg.TimeOut))\n    if Orm.Error != nil {\n        zap.S().Errorf("database error: %v", Orm.Error)\n        panic(Orm.Error)\n    }\n\n    zap.S().Infof("mysql\u8fde\u63a5\u6210\u529f: %v", dsn)\n\n    return Orm\n}\n\n/*\n\u6700\u5927\u8fde\u63a5\u6570\uff08MaxOpenConns\uff09\uff1a\u5b83\u9650\u5236\u4e86\u8fde\u63a5\u6c60\u4e2d\u53ef\u4ee5\u540c\u65f6\u6253\u5f00\u7684\u8fde\u63a5\u6570\u91cf\u3002\n\u901a\u8fc7\u8bbe\u7f6e\u6700\u5927\u8fde\u63a5\u6570\uff0c\u53ef\u4ee5\u9632\u6b62\u8fc7\u591a\u7684\u8fde\u63a5\u540c\u65f6\u88ab\u521b\u5efa\uff0c\u4ece\u800c\u907f\u514d\u6570\u636e\u5e93\u670d\u52a1\u5668\u8fc7\u8f7d\u6216\u8d44\u6e90\u8017\u5c3d\u7684\u60c5\u51b5\u3002\n\u5982\u679c\u8fbe\u5230\u6700\u5927\u8fde\u63a5\u6570\u9650\u5236\uff0c\u65b0\u7684\u6570\u636e\u5e93\u8fde\u63a5\u8bf7\u6c42\u5c06\u88ab\u963b\u585e\uff0c\u76f4\u5230\u6709\u8fde\u63a5\u88ab\u91ca\u653e\u56de\u8fde\u63a5\u6c60\u3002\n\n\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\uff08MaxIdleConns\uff09\uff1a\u5b83\u9650\u5236\u4e86\u8fde\u63a5\u6c60\u4e2d\u53ef\u4ee5\u4fdd\u6301\u7a7a\u95f2\u7684\u8fde\u63a5\u6570\u91cf\u3002\n\u8fde\u63a5\u6c60\u4e2d\u7684\u7a7a\u95f2\u8fde\u63a5\u53ef\u4ee5\u907f\u514d\u9891\u7e41\u5730\u521b\u5efa\u548c\u9500\u6bc1\u8fde\u63a5\uff0c\u4ece\u800c\u63d0\u9ad8\u6027\u80fd\u3002\n\u8bbe\u7f6e\u9002\u5f53\u7684\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\u53ef\u4ee5\u6839\u636e\u5e94\u7528\u7a0b\u5e8f\u7684\u8d1f\u8f7d\u60c5\u51b5\u5e73\u8861\u8fde\u63a5\u7684\u521b\u5efa\u548c\u9500\u6bc1\u6210\u672c\uff0c\u786e\u4fdd\u8fde\u63a5\u6c60\u4e2d\u59cb\u7ec8\u6709\u8db3\u591f\u7684\u8fde\u63a5\u4f9b\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u3002\n\n\u8bbe\u7f6e\u8fde\u63a5\u7684\u6700\u5927\u751f\u547d\u5468\u671f\u53ef\u4ee5\u786e\u4fdd\u8fde\u63a5\u5728\u4e00\u6bb5\u65f6\u95f4\u540e\u88ab\u91ca\u653e\uff0c\u4ee5\u9632\u6b62\u8fde\u63a5\u957f\u65f6\u95f4\u4fdd\u6301\u6253\u5f00\u72b6\u6001\u800c\u5bfc\u81f4\u8d44\u6e90\u8017\u5c3d\u3002\n*/\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"applicetion/initialize/db.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package initialize\n\nimport (\n    "bingo_api/application/config"\n    "bingo_api/application/database"\n    "bingo_api/application/model"\n)\n\nfunc InitDB(cfg *config.DatabaseConfig) {\n    Orm := database.GetOrm(cfg)\n    Orm.AutoMigrate(&model.User{})\n    // \u7981\u7528\u590d\u6570\n    Orm.SingularTable(true)\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"main.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"// \u6570\u636e\u5e93\u521d\u59cb\u5316\ninitialize.InitDB(config.Conf.DatabaseConfig)\n")),(0,o.yg)("h2",{id:"28\u70ed\u81ea\u542f"},"2.8\u3001\u70ed\u81ea\u542f"),(0,o.yg)("p",null,"\u8981\u5728 Go Gin \u9879\u76ee\u4e2d\u5b9e\u73b0\u70ed\u91cd\u542f\uff08Hot Reload\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e09\u65b9\u5de5\u5177 ",(0,o.yg)("inlineCode",{parentName:"p"},"fresh"),"\u3002",(0,o.yg)("inlineCode",{parentName:"p"},"fresh")," \u662f\u4e00\u4e2a Go \u5e94\u7528\u7a0b\u5e8f\u7684\u81ea\u52a8\u91cd\u542f\u5de5\u5177\uff0c\u5b83\u80fd\u591f\u5728\u4ee3\u7801\u53d1\u751f\u53d8\u5316\u65f6\u91cd\u65b0\u7f16\u8bd1\u5e76\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"go get -u github.com/pilu/fresh\n")),(0,o.yg)("p",null,"\u4fee\u6539dir\u7684\u503c\u5373\u53ef\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/main.go")),(0,o.yg)("p",null,"\u7ec8\u7aef\u4e0b\u8981\u5728main.go\u5165\u95e8\u7a0b\u5e8f\u6240\u5728\u4f4d\u7f6e\uff0c\u8fd0\u884c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"fresh\n")),(0,o.yg)("h2",{id:"29axios\u8de8\u57df\u652f\u6301"},"2.9\u3001axios&\u8de8\u57df\u652f\u6301"),(0,o.yg)("h3",{id:"291\u5b89\u88c5\u914d\u7f6eaxios"},"2.9.1\u3001\u5b89\u88c5\u914d\u7f6eaxios"),(0,o.yg)("p",null,"\u540e\u9762\u9700\u8981\u83b7\u53d6\u670d\u52a1\u7aef\u7684api\u63a5\u53e3\u6570\u636e\uff0c\u610f\u5473\u7740\u8981\u53d1\u9001http\u8bf7\u6c42\uff0c\u6211\u4eec\u4f7f\u7528axios\u6a21\u5757\u6765\u8bf7\u6c42\u670d\u52a1\u7aef\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cd bingo_web  # \u6ce8\u610f\uff0c\u5ba2\u6237\u7aef\u5b89\u88c5\u6a21\u5757\u7684\u6240\u6709\u547d\u4ee4\uff0c\u52a1\u5fc5\u5728package.json\u6240\u5728\u76ee\u5f55\u4e0b\u64cd\u4f5c\u3002\nyarn add axios@1.2.1  --registry https://registry.npm.taobao.org\n")),(0,o.yg)("p",null,"\u521b\u5efa",(0,o.yg)("inlineCode",{parentName:"p"},"src/http/index.js"),"\uff0c\u7f16\u5199axos\u5bf9\u8c61\u521d\u59cb\u5316\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},'import axios from "axios";\nimport settings from "../settings";\n\nconst http =  axios.create({\n  baseURL: settings.host,\n  withCredentials: false,\n})\n\n// \u8bf7\u6c42\u62e6\u622a\u5668\nhttp.interceptors.request.use((config)=>{\n    console.log("http\u8bf7\u6c42\u4e4b\u524d\u8fdb\u884c\u8bf7\u6c42\u5934\u7ec4\u88c5\uff0c\u4f1a\u81ea\u52a8\u6267\u884c\u8bf7\u6c42\u62e6\u622a\u5668");\n    return config;\n}, (error)=>{\n    console.log("http\u8bf7\u6c42\u4e4b\u540e\u53d1\u751f\u9519\u8bef\uff0c\u4f1a\u81ea\u52a8\u6267\u884c\u8bf7\u6c42\u62e6\u622a\u5668");\n    return Promise.reject(error);\n});\n\n\n// \u54cd\u5e94\u62e6\u622a\u5668\nhttp.interceptors.response.use((response)=>{\n    console.log("\u670d\u52a1\u7aef\u54cd\u5e94\u6570\u636e\u4ee5\u540e\u5728\u6267\u884cthen\u4e4b\u524d\uff0c\u4f1a\u81ea\u52a8\u6267\u884c\u54cd\u5e94\u62e6\u622a\u5668");\n    return response;\n}, (error)=>{\n    console.log("\u670d\u52a1\u7aef\u54cd\u5e94\u9519\u8bef\u4ee5\u540e\u5728\u6267\u884ccatch\u4e4b\u524d\uff0c\u4f1a\u81ea\u52a8\u6267\u884c\u54cd\u5e94\u62e6\u622a\u5668");\n    return Promise.reject(error);\n});\n\nexport default http;\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"src/settings/index.js"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},'const settings = {\n    host: "http://api.bingo.cn:8000/",\n}\n\nexport default settings;\n')),(0,o.yg)("p",null,"\u4ece\u4e0a\u9762\u6548\u679c\uff0c\u53ef\u4ee5\u770b\u5230\u5f53\u524d\u5ba2\u6237\u7aef\u5df2\u7ecf\u5b89\u88c5\u914d\u7f6e\u597d\u4e86router\u8def\u7531\u6a21\u5757\u4ee5\u53caaxios\u8bf7\u6c42\u6a21\u5757\uff0c\u5e76\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u7684\u3002"),(0,o.yg)("h3",{id:"292\u8de8\u57df\u652f\u6301"},"2.9.2\u3001\u8de8\u57df\u652f\u6301"),(0,o.yg)("p",null,"\u5148\u7528postman\u53d1\u9001\u8bf7\u6c42\u6d4b\u8bd5\u4e00\u4e0b\u63a5\u53e3\u662f\u5426\u6b63\u5e38\uff1a"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230810115828508-1639909.png",alt:"image-20230810115828508"})),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"src/http/requests.js"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},'import http from "./index.js";\n\n// \u83b7\u53d6\u7ad9\u70b9\u914d\u7f6e\u4fe1\u606f\nexport const get_api_test = (params, headers) => {\n    return http.get("test/", {params, headers})\n};\n')),(0,o.yg)("p",null,"\u7136\u540e\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"views\\Host.vue"),"\u53d1\u9001ajax\u8bf7\u6c42\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="host">\n    <h1>host\u9875\u9762</h1>\n  </div>\n</template>\n\n<script setup>\nimport {get_api_test} from "../http/requests.js";\n\nget_api_test().then(response => {\n  console.log("response:::", response)\n})\n\n<\/script>\n\n<style scoped>\n\n</style>\n\n')),(0,o.yg)("p",null,"\u9047\u5230\u8de8\u57df\u8bf7\u6c42\u5931\u8d25"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230902215057047-3662658.png",alt:"image-20230902215057047"})),(0,o.yg)("h3",{id:"1\u670d\u52a1\u7aef\u5b9e\u73b0\u8de8\u57df\u652f\u6301"},"\u30101\u3011\u670d\u52a1\u7aef\u5b9e\u73b0\u8de8\u57df\u652f\u6301"),(0,o.yg)("p",null,"\u57fa\u4e8egin\u7684\u5b98\u65b9CORS\u4e2d\u95f4\u4ef6\u5b9e\u73b0\u8de8\u57df\u8d44\u6e90\u5171\u4eab\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/applicaton/middleware/cors.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package middleware\n\nimport (\n    "github.com/gin-contrib/cors"\n    "time"\n)\n\nvar CORS = cors.New(cors.Config{\n    //\u51c6\u8bb8\u8de8\u57df\u8bf7\u6c42\u7f51\u7ad9,\u591a\u4e2a\u4f7f\u7528,\u5206\u5f00,\u9650\u5236\u4f7f\u7528*\n    AllowOrigins: []string{"*"},\n    //\u51c6\u8bb8\u4f7f\u7528\u7684\u8bf7\u6c42\u65b9\u5f0f\n    AllowMethods: []string{"PUT", "PATCH", "POST", "GET", "DELETE"},\n    //\u51c6\u8bb8\u4f7f\u7528\u7684\u8bf7\u6c42\u8868\u5934\n    AllowHeaders: []string{"Origin", "Authorization", "Content-Type"},\n    //\u663e\u793a\u7684\u8bf7\u6c42\u8868\u5934\n    ExposeHeaders: []string{"Content-Type"},\n    //\u51ed\u8bc1\u5171\u4eab,\u786e\u5b9a\u5171\u4eab\n    AllowCredentials: true,\n    //\u5bb9\u8bb8\u8de8\u57df\u7684\u539f\u70b9\u7f51\u7ad9,\u53ef\u4ee5\u76f4\u63a5return true\u5c31\u4e07\u4e8b\u5927\u5409\u4e86\n    AllowOriginFunc: func(origin string) bool {\n        return true\n    },\n    //\u8d85\u65f6\u65f6\u95f4\u8bbe\u5b9a\n    MaxAge: 24 * time.Hour,\n})\n\n')),(0,o.yg)("p",null,"\u8c03\u7528\u4e2d\u95f4\u4ef6\uff0c\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/initialize/router.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"Router.Use(middleware.CORS)\n")),(0,o.yg)("p",null,"\u5b8c\u6210\u4e86\u4e0a\u9762\u7684\u6b65\u9aa4\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u518d\u8bbf\u95eehost\uff0c\u901a\u8fc7\u540e\u7aef\u63d0\u4f9b\u6570\u636e\u7ed9\u524d\u7aef\u4f7f\u7528ajax\u8bbf\u95ee\u4e86\u3002"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230810114550550-1639151.png",alt:"image-20230810114550550"})),(0,o.yg)("h3",{id:"2\u5ba2\u6237\u7aef\u5b9e\u73b0\u8de8\u57df\u652f\u6301"},"\u30102\u3011\u5ba2\u6237\u7aef\u5b9e\u73b0\u8de8\u57df\u652f\u6301"),(0,o.yg)("p",null,"\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"vue.config.js"),"\u4e2d"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'/* \u8de8\u57df\u4ee3\u7406 */\nproxy: {\n    "/api": {\n        /* \u76ee\u6807\u4ee3\u7406\u670d\u52a1\u5668\u5730\u5740 */\n        target: "http://api.bingo_api.cn:8080/api", //\n        /* \u5141\u8bb8\u8de8\u57df */\n        changeOrigin: true,\n        ws: true,\n        pathRewrite: {\n            "^/api": ""   // \u3000/api\u8868\u793a\u9700\u8981\u53bb\u5339\u914d\u8bf7\u6c42\u65f6\u7684url\uff0c\u7136\u540e\u66ff\u6362\u6210target\u7684\u503c\uff0c\u7531node.js\u53d1\u51fa\u8bf7\u6c42\n        }\n    }\n}\n')),(0,o.yg)("h1",{id:"\u4e09\u7528\u6237\u4e2d\u5fc3"},"\u4e09\u3001\u7528\u6237\u4e2d\u5fc3"),(0,o.yg)("h2",{id:"31\u7528\u6237\u6a21\u578b"},"3.1\u3001\u7528\u6237\u6a21\u578b"),(0,o.yg)("p",null,"\u521b\u5efa\u7528\u6237\u6a21\u578b\uff0c\u6d4b\u8bd5\u6570\u636e\u5e93\u521d\u59cb\u5316\u662f\u5426\u6b63\u5e38\u4f7f\u7528",(0,o.yg)("inlineCode",{parentName:"p"},"/application/model/user.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package model\n\nimport (\n    . "bingo_api/application/database"\n    "gorm.io/gorm"\n)\n\n/**\n\u7528\u6237\u5b9e\u4f53\n*/\n\ntype User struct {\n    gorm.Model\n    Username     string `gorm:"unique_index;size:255;comment:\'\u8d26\u6237\u540d\'" json:"username" sql:"index"`\n    HashPassword string `gorm:"not null;size:255;comment:\'\u5bc6\u7801\'" json:"-"`\n    Password     string `gorm:"-" json:"password,omitempty"`\n    Nickname     string `gorm:"size:255;comment:\'\u6635\u79f0\'" json:"nickname" sql:"index"`\n    Mobile       string `gorm:"index;size:15;comment:\'\u624b\u673a\';" json:"mobile"`\n    Email        string `valid:"email" gorm:"index;size:255;comment:\'\u90ae\u7bb1\';" json:"email"`\n    Avatar       string `gorm:"size:255;comment:\'\u5934\u50cf\'" json:"avatar"`\n    Sex          bool   `gorm:"type:boolean;default:true;comment:\'\u6027\u522b\'" json:"sex"`\n    Ip           string `valid:"ip" gorm:"size:255;comment:\'IP\u5730\u5740\';" json:"ip"`\n    Status       bool   `gorm:"type:boolean;default:true;comment:\'\u72b6\u6001\'" json:"status"`\n}\n\n/**\n\u8bbe\u7f6e\u8868\u540d\n*/\n\nfunc (User) TableName() string {\n    return "user_info"\n}\n\n/**\n\u521b\u5efa\u7528\u6237\n*/\n\nfunc (user User) Insert() (id uint, err error) {\n    //\u6dfb\u52a0\u6570\u636e\n    result := Orm.Create(&user)\n    return user.ID, result.Error\n}\n\n/**\n\u6839\u636e\u6307\u5b9aID\u83b7\u53d6\u7528\u6237\n*/\n\nfunc (user *User) GetOneById(id uint) {\n    Orm.First(&user, id)\n}\n\n/**\n\u6839\u636e\u8d26\u6237\u4fe1\u606f(\u7528\u6237\u540d\u3001\u624b\u673a\u3001\u90ae\u7bb1)\u83b7\u53d6\u7528\u6237\n*/\n\nfunc (user *User) GetOneByAccount(account string) {\n    Orm.First(&user, "username = ? or mobile = ? or email= ?", account, account, account)\n}\n\n/**\n\u83b7\u53d6\u6240\u6709\u7528\u6237\n*/\n\nfunc (user User) GetAll() []User {\n    var users []User\n    Orm.Find(&users)\n    return users\n}\n\n/**\n\u66f4\u65b0\u5bc6\u7801\n*/\n\nfunc (user User) ChangePassword(HashPasswrd string) {\n    user.HashPassword = HashPasswrd\n    Orm.Save(&user)\n}\n\n')),(0,o.yg)("p",null,"\u9879\u76ee\u521d\u59cb\u5316\u5e76\u6570\u636e\u8fc1\u79fb\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"initialize/db.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-python"},'package initialize\n\nimport (\n    "bingo_api/application/config"\n    "bingo_api/application/database"\n    "bingo_api/application/model"\n    "fmt"\n)\n\nfunc InitDB(cfg *config.DatabaseConfig) {\n    fmt.Println("hello ...")\n    Orm := database.GetOrm(cfg)\n    // \u7981\u7528\u590d\u6570\n    Orm.SingularTable(true)\n    // \u6570\u636e\u8fc1\u79fb\n    Orm.AutoMigrate(&model.User{})\n}\n\n')),(0,o.yg)("h2",{id:"32\u521b\u5efa\u8d26\u6237\u7684api\u63a5\u53e3"},"3.2\u3001\u521b\u5efa\u8d26\u6237\u7684API\u63a5\u53e3"),(0,o.yg)("p",null,"\u8be5\u63a5\u53e3\u76ee\u524d\u4ec5\u7528\u4e8e\u6d4b\u8bd5\u6dfb\u52a0\u8d85\u7ea7\u7528\u6237\uff0c\u5c06\u6765\u9700\u8981\u8865\u5145\u4e0a\u6743\u9650\u3002"),(0,o.yg)("p",null,"\u4e1a\u52a1\u5c42\u4ee3\u7801\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/services/user.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package services\n\nimport (\n    . "bingo_api/application/model"\n    . "bingo_api/application/utils"\n    "github.com/gin-gonic/gin"\n)\n\n/**\n\u521b\u5efa\u7528\u6237\n*/\n\nfunc CreateUser(ctx *gin.Context) (uint, error) {\n    user := User{}\n    var err error\n    if err = ctx.ShouldBindJSON(&user); err != nil {\n        return 0, err\n    }\n\n    user.HashPassword, err = MakeHashPassword(user.Password)\n    if err != nil {\n        return 0, err\n    }\n\n    return user.Insert()\n}\n\n/**\n\u83b7\u53d6\u6307\u5b9aID\u7684\u7528\u6237\n*/\n\nfunc GetUserById(id uint) (user User) {\n    user = User{}\n    user.GetOneById(id)\n    return user\n}\n\n/**\n\u6839\u636e\u8d26\u6237\u4fe1\u606f(\u7528\u6237\u540d\u3001\u624b\u673a\u3001\u90ae\u7bb1)\u83b7\u53d6\u7528\u6237\n*/\n\nfunc GetUserByAccount(account string) (user User) {\n    user = User{}\n    user.GetOneByAccount(account)\n    return user\n}\n\n/**\n\u83b7\u53d6\u6240\u6709\u7528\u6237\n*/\n\nfunc GetAllUser() []User {\n    user := User{}\n    return user.GetAll()\n}\n\n/**\n\u66f4\u65b0\u5bc6\u7801\n*/\n\nfunc ChangeUserPassword(user User, RawPassword string) {\n    password, _ := MakeHashPassword(RawPassword)\n    user.ChangePassword(password)\n}\n\n')),(0,o.yg)("p",null,"\u5de5\u5177\u65b9\u6cd5\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/utils/string.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package utils\n\nimport (\n    . "bingo_api/application/constants"\n    "golang.org/x/crypto/bcrypt"\n    "math/rand"\n    "time"\n)\n\nfunc Random(n int, chars string) string {\n    if n <= 0 {\n        return ""\n    }\n    r := rand.New(rand.NewSource(time.Now().UnixNano()))\n    bytes := make([]byte, n, n)\n    l := len(chars)\n    for i := 0; i < n; i++ {\n        bytes[i] = chars[r.Intn(l)]\n    }\n    return string(bytes)\n}\n\nfunc RandomLetters(n int) string {\n    /**\n    \u751f\u6210\u6307\u5b9a\u957f\u5ea6\u7684\u5b57\u7b26\u4e32(\u5b57\u6bcd)\n    */\n    return Random(n, LETTERS)\n}\n\nfunc RandomNumeric(n int) string {\n    /**\n    \u751f\u6210\u6307\u5b9a\u957f\u5ea6\u7684\u5b57\u7b26\u4e32(\u6570\u5b57)\n    */\n    return Random(n, NUMBERS)\n}\n\nfunc RandomLettersNumeric(n int) string {\n    /**\n    \u751f\u6210\u6307\u5b9a\u957f\u5ea6\u7684\u5b57\u7b26\u4e32(\u6570\u5b57+\u5b57\u6bcd)\n    */\n    return Random(n, LETTERS_NUMBERIC)\n}\n\nfunc RandomAscii(n int) string {\n    /**\n    \u751f\u6210\u6307\u5b9a\u957f\u5ea6\u7684\u5b57\u7b26\u4e32(\u5b57\u6bcd+\u6570\u5b57+\u7279\u6b8a\u5b57\u7b26)\n    */\n    return Random(n, ASCII)\n}\n\n/*\n \u52a0\u5bc6\u5bc6\u7801\n*/\n\nfunc MakeHashPassword(RawPassword string) (HashPasswrd string, err error) {\n    pwd := []byte(RawPassword)\n    hash, err := bcrypt.GenerateFromPassword(pwd, bcrypt.MinCost)\n    if err != nil {\n        return\n    }\n    HashPasswrd = string(hash)\n    return\n}\n\n/**\n\u9a8c\u8bc1\u5bc6\u7801\n*/\n\nfunc CheckPassword(HashPassword string, RawPassword string) bool {\n    ByteHash := []byte(HashPassword)\n    BytePwd := []byte(RawPassword)\n    err := bcrypt.CompareHashAndPassword(ByteHash, BytePwd)\n    if err != nil {\n        return false\n    }\n    return true\n}\n\n')),(0,o.yg)("p",null,"\u5e38\u91cf\u6587\u4ef6\u4e2d\u521b\u5efa\u5e38\u7528\u5b57\u7b26\u96c6\u5408\u7684\u5e38\u91cf\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/constants/common.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package constants\n\n/**\n\u5e38\u7528\u5b57\u7b26\u96c6\u5408\n*/\n\nconst NUMBERS string = "0123456789"\nconst LETTERS string = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"\nconst SPECIALS string = "~!@#$%^*()_+-=[]{}|;:,./<>?"\nconst LETTERS_NUMBERIC string = LETTERS + NUMBERS\nconst ASCII string = LETTERS_NUMBERIC + SPECIALS\n\n')),(0,o.yg)("p",null,"\u63a5\u53e3\u5c42\uff0cbingo_api/application/api/user.go\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package api\n\nimport (\n    "bingo_api/application/constants"\n    . "bingo_api/application/services"\n    "github.com/gin-gonic/gin"\n    "net/http"\n)\n\n/**\n\u7528\u6237\u8ba4\u8bc1\u767b\u9646\n*/\n\nfunc UserAuthenticate(ctx *gin.Context) {\n    var data map[string]string = map[string]string{\n        "userame": "xiaoming",\n        "age":     "16",\n    }\n    ctx.JSON(http.StatusOK, data)\n}\n\n/**\n\u521b\u5efa\u7528\u6237\n*/\n\nfunc UserCreate(ctx *gin.Context) {\n\n    id, err := CreateUser(ctx)\n    if err != nil || id < 1 {\n        ctx.JSON(http.StatusOK, gin.H{\n            "code":    constants.CodeCreateUserFail,\n            "message": constants.CreateUserFail,\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusCreated, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.CreateUserSuccess,\n        "data":    id,\n    })\n}\n\n')),(0,o.yg)("p",null,"\u6d88\u606f\u63d0\u793a\u5e38\u91cf\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/constants/message.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package constants\n\nconst (\n    CreateUserSuccess = "\u521b\u5efa\u7528\u6237\u6210\u529f\uff01"\n    CreateUserFail    = "\u521b\u5efa\u7528\u6237\u5931\u8d25\uff01"\n)\n\n')),(0,o.yg)("p",null,"\u6d88\u606fID\u5e38\u91cf\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/constants/code.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"package constants\n\nconst (\n    CodeSuccess = 0 // \u6210\u529f\uff01\n    CodeCreateUserFail = 1001  // \u521b\u5efa\u7528\u6237\u5931\u8d25\uff01\n)\n")),(0,o.yg)("p",null,"\u8def\u7531\u5c42\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/router/user.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package router\n\nimport (\n    "bingo_api/application/api"\n    "bingo_api/application/utils"\n    "github.com/gin-gonic/gin"\n)\n\nfunc InitUserRouter(Router *gin.RouterGroup) {\n    /**\n    \u7528\u6237\u76f8\u5173\u7684\u8def\u7531\u7ec4\n    */\n    UserRouter := Router.Group("user")\n    {\n        // \u7528\u6237\u8ba4\u8bc1\u767b\u9646\n        utils.Register(UserRouter, []string{"GET", "POST"}, "authenticate", api.UserAuthenticate)\n        // \u7528\u6237\u521b\u5efa\n        utils.Register(UserRouter, []string{"POST"}, "", api.UserCreate)\n    }\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/utils/router"),"\uff0c"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package utils\n\nimport "github.com/gin-gonic/gin"\n\nfunc Register(r *gin.RouterGroup, httpMethods []string, relativePath string, handlers ...gin.HandlerFunc) gin.IRoutes {\n    /**\n    \u8def\u7531\u6ce8\u518c\u51fd\u6570[\u4e00\u6b21\u6027\u7ed9\u540c\u4e00\u4e2a\u89c6\u56fe\u7ed1\u5b9a\u591a\u4e2a\u4e0d\u540c\u7684HTTP\u8bf7\u6c42\u65b9\u6cd5]\n    */\n    var routes gin.IRoutes\n    for _, httpMethod := range httpMethods {\n        routes = r.Handle(httpMethod, relativePath, handlers...)\n    }\n    return routes\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/initialize/router"),"\uff0c"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package initialize\n\nimport (\n    "bingo_api/application/middleware"\n    . "bingo_api/application/router"\n    "github.com/gin-gonic/gin"\n)\n\nfunc InitRouter() *gin.Engine {\n\n    // 1. \u521b\u5efa\u8def\u7531\n    Router := gin.Default()\n    Router.Use(middleware.GinLogger())\n    Router.Use(middleware.ExceptionMiddleware)\n    Router.Use(middleware.CORS)\n\n    // 2. Api\u8def\u7531\u5206\u7ec4\n    ApiGroup := Router.Group("/test")\n\n    ApiGroup.GET("/", func(context *gin.Context) {\n        //panic("raise an error!!!")\n        context.String(200, "Bingo Start")\n    })\n\n    InitUserRouter(ApiGroup)\n\n    return Router\n}\n\n')),(0,o.yg)("h2",{id:"33validator-user"},"3.3\u3001validator User"),(0,o.yg)("p",null,"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u80af\u5b9a\u662f\u9700\u8981\u9a8c\u8bc1\u5ba2\u6237\u7aef\u63d0\u4ea4\u7684\u6570\u636e\u662f\u5426\u5408\u6cd5\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5b89\u88c5\u4e00\u4e2a\u63d2\u4ef6\uff1avalidator\u3002validator\u672c\u8eab\u63d0\u4f9b\u4e86\u57fa\u4e8estruct\u7ed3\u6784\u4f53\u7684tag\u6807\u7b7e\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u7684\u9a8c\u8bc1\u89c4\u5219\u548c\u63d0\u4f9b\u4e86\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u89c4\u8303\u7684\u65b9\u5f0f\u7ed9\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u7684\u5b8c\u6210\u5ba2\u6237\u7aef\u6570\u636e\u7684\u6821\u9a8c\u5de5\u4f5c\u3002\u4f46\u662f\uff0cvalidator\u9ed8\u8ba4\u8fd4\u56de\u7684\u9519\u8bef\u4fe1\u606f\u662f\u82f1\u6587\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd8\u8981\u7ffb\u8bd1\u4e0b\u9519\u8bef\u4fe1\u606f\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"# \u9a8c\u8bc1\u6a21\u5757\ngo get -u github.com/go-playground/validator/v10\n# \u7ffb\u8bd1\u6a21\u5757\ngo get -u github.com/go-playground/locales/zh\ngo get -u github.com/go-playground/universal-translator\ngo get -u github.com/go-playground/validator/v10/translations/zh\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"model/user.go"),"\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'/**\n\u7528\u6237\u5b9e\u4f53\n*/\n\ntype User struct {\n    gorm.Model\n    Username      string `validate:"required,gte=5" label:"\u8d26\u6237\u540d" gorm:"unique_index;size:255;comment:\'\u8d26\u6237\u540d\'" json:"username"`\n    HashPassword  string `gorm:"not null;size:255;comment:\'\u5bc6\u7801\'" json:"-"`\n    Password      string `validate:"required" label:"\u767b\u9646\u5bc6\u7801" gorm:"-" json:"password,omitempty"`\n    Nickname      string `label:"\u6635\u79f0" gorm:"size:255;comment:\'\u6635\u79f0\'" json:"nickname" sql:"index"`\n    Mobile        string `gorm:"index;size:15;comment:\'\u624b\u673a\';" json:"mobile"`\n    Email         string `validate:"omitempty,email" gorm:"index;size:255;comment:\'\u90ae\u7bb1\';" json:"email"`\n    Avatar        string `gorm:"size:255;comment:\'\u5934\u50cf\'" json:"avatar"`\n    Sex           bool   `gorm:"type:boolean;default:true;comment:\'\u6027\u522b\'" json:"sex"`\n    Ip            string `validate:"omitempty,ipv4" gorm:"size:255;comment:\'IP\u5730\u5740\';" json:"ip"`\n    Status        bool   `gorm:"type:boolean;default:true;comment:\'\u72b6\u6001\'" json:"status"`\n}\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/utils/vaidator.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package utils\n\nimport (\n    "github.com/go-playground/locales/zh"\n    ut "github.com/go-playground/universal-translator"\n    "github.com/go-playground/validator/v10"\n    . "github.com/go-playground/validator/v10/translations/zh"\n    "reflect"\n)\n\n/**\n\u751f\u6210\u9a8c\u8bc1\u5668\n*/\n\nfunc GenValidate() (*validator.Validate, ut.Translator) {\n    zhCh := zh.New()\n    validate := validator.New()\n    //\u6ce8\u518c\u4e00\u4e2a\u51fd\u6570\uff0c\u83b7\u53d6struct tag\u91cc\u81ea\u5b9a\u4e49\u7684label\u4f5c\u4e3a\u5b57\u6bb5\u540d\n    validate.RegisterTagNameFunc(func(fld reflect.StructField) string {\n        name := fld.Tag.Get("label")\n        return name\n    })\n\n    UniversalTranslator := ut.New(zhCh)\n    trans, _ := UniversalTranslator.GetTranslator("zh")\n    _ = RegisterDefaultTranslations(validate, trans)\n    return validate, trans\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/validator/user.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package validator\n\nimport (\n    . "bingo_api/application/model"\n    . "bingo_api/application/utils"\n    "errors"\n    "github.com/go-playground/validator/v10"\n)\n\n/**\n\u767b\u5f55\u9a8c\u8bc1\u5668\n*/\n\nfunc UserValidator(user *User) error {\n    validate, trans := GenValidate()\n    err := validate.Struct(user)\n    if err != nil {\n        for _, err := range err.(validator.ValidationErrors) {\n            return errors.New(err.Translate(trans))\n        }\n    }\n    return nil\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"services/user.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package services\n\nimport (\n    "bingo_api/application/constants"\n    . "bingo_api/application/model"\n    . "bingo_api/application/utils"\n    "bingo_api/application/validator"\n    "errors"\n    "fmt"\n    "github.com/gin-gonic/gin"\n)\n\n/**\n\u7528\u6237\u767b\u5f55\u8ba4\u8bc1\n*/\n\nfunc UserLogin(ctx *gin.Context) (user User, err error) {\n    user = User{}\n    if err = ctx.ShouldBindJSON(&user); err != nil {\n        return user, err\n    }\n\n    // \u6821\u9a8c\u8f93\u5165\u5b57\u6bb5\n    if err = validator.UserValidator(&user); err != nil {\n        return user, err\n    }\n\n    user.GetOneByAccount(user.Username)\n    if user.ID < 1 {\n        return user, errors.New(constants.NoSuchUser)\n    }\n\n    ret := CheckPassword(user.HashPassword, user.Password)\n\n    if !ret {\n        err = errors.New(constants.PasswordError)\n        return\n    }\n\n    return\n}\n\n/**\n\u521b\u5efa\u7528\u6237\n*/\n\nfunc CreateUser(ctx *gin.Context) (uint, error) {\n    user := User{}\n    var err error\n    if err = ctx.ShouldBindJSON(&user); err != nil {\n        return 0, err\n    }\n\n    // \u6821\u9a8c\u8f93\u5165\u5b57\u6bb5\n    if err = validator.UserValidator(&user); err != nil {\n        fmt.Println("err:::", err)\n        return 0, err\n    }\n\n    user.HashPassword, err = MakeHashPassword(user.Password)\n    if err != nil {\n        return 0, err\n    }\n\n    return user.Insert()\n}\n\n/**\n\u83b7\u53d6\u6307\u5b9aID\u7684\u7528\u6237\n*/\n\nfunc GetUserById(id uint) (user User) {\n    user = User{}\n    user.GetOneById(id)\n    return user\n}\n\n/**\n\u6839\u636e\u8d26\u6237\u4fe1\u606f(\u7528\u6237\u540d\u3001\u624b\u673a\u3001\u90ae\u7bb1)\u83b7\u53d6\u7528\u6237\n*/\n\nfunc GetUserByAccount(account string) (user User) {\n    user = User{}\n    user.GetOneByAccount(account)\n    return user\n}\n\n/**\n\u83b7\u53d6\u6240\u6709\u7528\u6237\n*/\n\nfunc GetAllUser() []User {\n    user := User{}\n    return user.GetAll()\n}\n\n/**\n\u66f4\u65b0\u5bc6\u7801\n*/\n\nfunc ChangeUserPassword(user User, RawPassword string) {\n    password, _ := MakeHashPassword(RawPassword)\n    user.ChangePassword(password)\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"api/user.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package api\n\nimport (\n    "bingo_api/application/constants"\n    . "bingo_api/application/services"\n    "github.com/gin-gonic/gin"\n    "net/http"\n)\n\n/**\n\u7528\u6237\u8ba4\u8bc1\u767b\u9646\n*/\n\nfunc UserAuthenticate(ctx *gin.Context) {\n    user, err := UserLogin(ctx)\n\n    if err != nil || user.ID < 1 {\n        ctx.JSON(http.StatusOK, gin.H{\n            "code":    constants.CodeNoSuchUser,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusCreated, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n        "data":    user,\n    })\n}\n\n/**\n\u521b\u5efa\u7528\u6237\n*/\n\nfunc UserCreate(ctx *gin.Context) {\n\n    id, err := CreateUser(ctx)\n\n    if err != nil || id < 1 {\n        ctx.JSON(http.StatusOK, gin.H{\n            "code":    constants.CodeCreateUserFail,\n            "message": constants.CreateUserFail + err.Error(),\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusCreated, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.CreateUserSuccess,\n        "data":    id,\n    })\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"constants/message.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package constants\n\nconst (\n    Success           = "\u6210\u529f\uff01"\n    CreateUserFail    = "\u521b\u5efa\u7528\u6237\u5931\u8d25\uff01"\n    CreateUserSuccess = "\u521b\u5efa\u7528\u6237\u6210\u529f\uff01"\n    NoSuchUser        = "\u7528\u6237\u4e0d\u5b58\u5728\uff01"\n    PasswordError     = "\u5bc6\u7801\u9519\u8bef\uff01"\n)\n\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"constants/code.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"package constants\n\nconst (\n    CodeSuccess = 0 // \u6210\u529f\uff01\n    CodeCreateUserFail = 1001  // \u521b\u5efa\u7528\u6237\u5931\u8d25\uff01\n    CodeNoSuchUser = 1002  // \u5f53\u524d\u7528\u6237\u4e0d\u5b58\u5728\uff01\n)\n\n")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230903081526657-3700128.png",alt:"image-20230903081526657"})),(0,o.yg)("h2",{id:"34jwt"},"3.4\u3001JWT"),(0,o.yg)("p",null,"\u5728\u7528\u6237\u6ce8\u518c\u6216\u767b\u5f55\u540e\uff0c\u6211\u4eec\u60f3\u8bb0\u5f55\u7528\u6237\u7684\u767b\u5f55\u72b6\u6001\uff0c\u6216\u8005\u4e3a\u7528\u6237\u521b\u5efa\u8eab\u4efd\u8ba4\u8bc1\u7684\u51ed\u8bc1\u3002\u6211\u4eec\u4f7f\u7528Json Web Token\u8ba4\u8bc1\u673a\u5236\u3002"),(0,o.yg)("p",null,"\u5f88\u591a\u516c\u53f8\u5f00\u53d1\u7684\u4e00\u4e9b\u79fb\u52a8\u7aef\u53ef\u80fd\u4e0d\u652f\u6301cookie\uff0c\u5e76\u4e14\u6211\u4eec\u901a\u8fc7cookie\u548csession\u505a\u63a5\u53e3\u767b\u5f55\u8ba4\u8bc1\u7684\u8bdd\uff0c\u6548\u7387\u5176\u5b9e\u5e76\u4e0d\u662f\u5f88\u9ad8\uff0c\u6211\u4eec\u7684\u63a5\u53e3\u53ef\u80fd\u63d0\u4f9b\u7ed9\u591a\u4e2a\u5ba2\u6237\u7aef\uff0csession\u6570\u636e\u4fdd\u5b58\u5728\u670d\u52a1\u7aef\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6bcf\u6b21\u90fd\u8c03\u7528session\u6570\u636e\u8fdb\u884c\u9a8c\u8bc1\uff0c\u6bd4\u8f83\u8017\u65f6\uff0c\u6240\u4ee5\u5f15\u5165\u4e86token\u8ba4\u8bc1\u7684\u6982\u5ff5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7jwt\u6765\u5b8c\u6210\u539f\u6765cookie\u6216\u8005session\u7684\u8ba4\u8bc1\u6548\u679c\uff0c\u63a5\u4e0b\u6765\u770b\u770bjwt\u662f\u600e\u4e48\u5b9e\u73b0\u7684\u3002"),(0,o.yg)("blockquote",null,(0,o.yg)("p",{parentName:"blockquote"},"Json web token (JWT), \u662f\u4e3a\u4e86\u5728\u7f51\u7edc\u5e94\u7528\u73af\u5883\u95f4\u4f20\u9012\u58f0\u660e(token\uff0c\u4e00\u6bb5\u5b57\u7b26\u4e32)\u800c\u6267\u884c\u7684\u4e00\u79cd\u57fa\u4e8eJSON\u7684\u5f00\u653e\u6807\u51c6\uff08(RFC 7519).\u8be5token\u88ab\u8bbe\u8ba1\u4e3a\u7d27\u51d1\u4e14\u5b89\u5168\u7684\uff0c\u7279\u522b\u9002\u7528\u4e8e\u5206\u5e03\u5f0f\u7ad9\u70b9\u7684\u5355\u70b9\u767b\u5f55\uff08SSO\uff09\u573a\u666f\u3002JWT\u7684\u58f0\u660e(token\uff0c\u4e00\u6bb5\u5b57\u7b26\u4e32)\u4e00\u822c\u88ab\u7528\u6765\u5728\u8eab\u4efd\u63d0\u4f9b\u8005\u548c\u670d\u52a1\u63d0\u4f9b\u8005\u95f4\u4f20\u9012\u88ab\u8ba4\u8bc1\u7684\u7528\u6237\u8eab\u4efd\u4fe1\u606f\uff0c\u4ee5\u4fbf\u4e8e\u4ece\u8d44\u6e90\u670d\u52a1\u5668\u83b7\u53d6\u8d44\u6e90\uff0c\u4e5f\u53ef\u4ee5\u589e\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u5176\u5b83\u4e1a\u52a1\u903b\u8f91\u6240\u5fc5\u987b\u7684\u58f0\u660e\u4fe1\u606f\uff0c\u8be5token\u4e5f\u53ef\u76f4\u63a5\u88ab\u7528\u4e8e\u8eab\u4efd\u8ba4\u8bc1\uff0c\u4e5f\u53ef\u88ab\u6570\u636e\u52a0\u5bc6\u3002")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230903082116327-3700477.png",alt:"image-20230903082116327"})),(0,o.yg)("p",null,"JWT\u5c31\u4e00\u6bb5\u5b57\u7b26\u4e32\uff0c\u7531\u4e09\u6bb5\u4fe1\u606f\u6784\u6210\u7684\uff0c\u5c06\u8fd9\u4e09\u6bb5\u4fe1\u606f\u6587\u672c\u7528",(0,o.yg)("inlineCode",{parentName:"p"},"."),"\u62fc\u63a5\u4e00\u8d77\u5c31\u6784\u6210\u4e86Jwt\u5b57\u7b26\u4e32\u3002\u5c31\u50cf\u8fd9\u6837\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-htaccess"},"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ\n")),(0,o.yg)("p",null,"\u7b2c\u4e00\u90e8\u5206\u6211\u4eec\u79f0\u5b83\u4e3a\u5934\u90e8\uff08header)\uff0c\u7b2c\u4e8c\u90e8\u5206\u6211\u4eec\u79f0\u5176\u4e3a\u8f7d\u8377\uff08payload, \u7c7b\u4f3c\u4e8e\u98de\u673a\u4e0a\u627f\u8f7d\u7684\u7269\u54c1)\uff0c\u7b2c\u4e09\u90e8\u5206\u662f\u7b7e\u8bc1\uff08signature)."),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"header")),(0,o.yg)("p",null,"jwt\u7684\u5934\u90e8\u627f\u8f7d\u4e24\u90e8\u5206\u4fe1\u606f\uff1a"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"\u58f0\u660etoken\u7c7b\u578b\uff0c\u8fd9\u91cc\u662fjwt\uff0c\u9664\u4e86jwt\u5c31\u662fBearer"),(0,o.yg)("li",{parentName:"ul"},"\u58f0\u660e\u7b7e\u540d\u52a0\u5bc6\u7684\u7b97\u6cd5 \u901a\u5e38\u76f4\u63a5\u4f7f\u7528 HMAC SHA256")),(0,o.yg)("p",null,"\u5b8c\u6574\u7684\u5934\u90e8\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\u7684JSON/map\uff1a "),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},'map[string]string{\n  "typ": "JWT",\n  "alg": "HS256"\n}\n')),(0,o.yg)("p",null,"\u7136\u540e\u5c06\u5934\u90e8\u8fdb\u884cbase64.StdEncoding.EncodeToString\u7f16\u7801\uff0c\u6784\u6210\u4e86\u7b2c\u4e00\u90e8\u5206."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-htaccess"},"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\n")),(0,o.yg)("p",null,"Test:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-golang"},'package main\n\nimport (\n    "encoding/base64"\n    "encoding/json"\n    "fmt"\n    "strings"\n)\n\nfunc main() {\n    // \u5934\u90e8\u4fe1\u606f\n    headerData := map[string]string{\n        "typ": "JWT",\n        "alg": "HS256",\n    }\n\n    headerJson, _ := json.Marshal(headerData)\n    headerBytes := []byte(string(headerJson))\n    // base64\u7f16\u7801\n    headerString := strings.TrimRight(base64.URLEncoding.EncodeToString(headerBytes), "=")\n    fmt.Println(headerString)\n\n    // base64\u89e3\u7801\n    headerBytes, _ = base64.URLEncoding.DecodeString(headerString)\n    fmt.Println(string(headerBytes)) // {"alg":"HS256","typ":"JWT"}\n\n    type Header struct {\n        Alg string `json:"alg"`\n        Typ string `json:"typ"`\n    }\n\n    header := Header{}\n    json.Unmarshal([]byte(headerBytes), &header)\n    fmt.Printf("%#v", header)\n}\n\n// \u5404\u4e2a\u8bed\u8a00\u4e2d\u90fd\u6709base64\u7f16\u7801\u548c\u89e3\u7801\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u6211\u4eecjwt\u4e3a\u4e86\u5b89\u5168\uff0c\u9700\u8981\u914d\u5408\u7b2c\u4e09\u6bb5\u7b7e\u8bc1\u52a0\u5bc6\n\n')),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"payload")),(0,o.yg)("p",null,"\u8f7d\u8377\u5c31\u662f\u5b58\u653e\u6709\u6548\u4fe1\u606f\u7684\u5730\u65b9\u3002\u8fd9\u4e2a\u540d\u5b57\u50cf\u662f\u7279\u6307\u98de\u673a\u4e0a\u627f\u8f7d\u7684\u8d27\u54c1\uff0c\u8fd9\u4e9b\u6709\u6548\u4fe1\u606f\u53ef\u4ee5\u5b58\u653e\u4e0b\u9762\u4e09\u4e2a\u90e8\u5206\u4fe1\u606f\u3002"),(0,o.yg)("blockquote",null,(0,o.yg)("ul",{parentName:"blockquote"},(0,o.yg)("li",{parentName:"ul"},"\u6807\u51c6\u58f0\u660e\uff08\u6ce8\u518c\u58f0\u660e\u3001\u9884\u5b9a\u4e49\u58f0\u660e\uff0cregistered claims\uff09"),(0,o.yg)("li",{parentName:"ul"},"\u516c\u5171\u58f0\u660e\uff08public claims\uff09"),(0,o.yg)("li",{parentName:"ul"},"\u79c1\u6709\u58f0\u660e\uff08private claims\uff09"))),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"\u6807\u51c6\u58f0\u660e")," (\u5b98\u65b9\u89c4\u8303\uff0c\u662f\u5efa\u8bae\u4f46\u4e0d\u5f3a\u5236\u4f7f\u7528) \uff1a"),(0,o.yg)("blockquote",null,(0,o.yg)("ul",{parentName:"blockquote"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"iss"),": jwt\u7b7e\u53d1\u8005")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"sub"),": jwt\u6240\u9762\u5411\u7684\u7528\u6237")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"aud"),": \u63a5\u6536jwt\u7684\u4e00\u65b9")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"exp"),": jwt\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u4e2a\u8fc7\u671f\u65f6\u95f4\u5fc5\u987b\u8981\u5927\u4e8e\u7b7e\u53d1\u65f6\u95f4")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"nbf"),": \u5b9a\u4e49\u5728\u4ec0\u4e48\u65f6\u95f4\u4e4b\u524d\uff0c\u8be5jwt\u90fd\u662f\u4e0d\u53ef\u7528\u7684.")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"iat"),": jwt\u7684\u7b7e\u53d1\u65f6\u95f4")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"jti"),": jwt\u7684\u552f\u4e00\u8eab\u4efd\u6807\u8bc6\uff0c\u4e3b\u8981\u7528\u6765\u4f5c\u4e3a\u4e00\u6b21\u6027token,\u4ece\u800c\u56de\u907f\u91cd\u653e\u653b\u51fb\u3002"),(0,o.yg)("p",{parentName:"li"},"\u4ee5\u4e0a\u662fJWT \u89c4\u5b9a\u76847\u4e2a\u5b98\u65b9\u5b57\u6bb5\uff0c\u4f9b\u9009\u7528")))),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"\u516c\u5171\u58f0\u660e")," \uff1a \u516c\u5171\u7684\u58f0\u660e\u53ef\u4ee5\u6dfb\u52a0\u4efb\u4f55\u7684\u4fe1\u606f\uff0c\u4e00\u822c\u6dfb\u52a0\u7528\u6237\u7684\u76f8\u5173\u4fe1\u606f\u6216\u5176\u4ed6\u4e1a\u52a1\u9700\u8981\u7684\u5fc5\u8981\u4fe1\u606f.\u4f46\u4e0d\u5efa\u8bae\u6dfb\u52a0\u654f\u611f\u4fe1\u606f\uff0c\u56e0\u4e3a\u8be5\u90e8\u5206\u5728\u5ba2\u6237\u7aef\u76f4\u63a5\u53ef\u4ee5\u67e5\u770b."),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"\u79c1\u6709\u58f0\u660e")," \uff1a \u79c1\u6709\u58f0\u660e\u662f\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u6240\u5171\u540c\u5b9a\u4e49\u7684\u58f0\u660e\uff0c\u4e00\u822c\u4f7f\u7528\u4e86ace\u7b97\u6cd5\u8fdb\u884c\u5bf9\u79f0\u52a0\u5bc6\u548c\u89e3\u5bc6\u7684\uff0c\u610f\u5473\u7740\u8be5\u90e8\u5206\u4fe1\u606f\u53ef\u4ee5\u5f52\u7c7b\u4e3a\u660e\u6587\u4fe1\u606f\u3002"),(0,o.yg)("p",null,"\u5b9a\u4e49\u4e00\u4e2apayload\uff0cjson\u683c\u5f0f\u7684\u6570\u636e:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'map[string]string{\n    "sub":   "1234567890",\n        "exp":   "3422335555",\n        "name":  "yuan",\n        "admin": "1",\n        "info":  "123abc456",\n}\n')),(0,o.yg)("p",null,"\u7136\u540e\u5c06\u5176\u8fdb\u884cbase64.StdEncoding.EncodeToString\u7f16\u7801\uff0c\u5f97\u5230JWT\u7684\u7b2c\u4e8c\u90e8\u5206\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-htaccess"},"eyJhZG1pbiI6IjEiLCJleHAiOiIzNDIyMzM1NTU1IiwiaW5mbyI6IjEyM2FiYzQ1NiIsIm5hbWUiOiJ5dWFuIiwic3ViIjoiMTIzNDU2Nzg5MCJ9\n")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "encoding/base64"\n    "encoding/json"\n    "fmt"\n    "strings"\n)\n\nfunc main() {\n\n    payloadData := map[string]string{\n        "sub":   "1234567890",\n        "exp":   "3422335555",\n        "name":  "yuan",\n        "admin": "1",\n        "info":  "123abc456",\n    }\n    payloadBytes, _ := json.Marshal(payloadData)\n\n    // base64\u7f16\u7801\n    payloadString := strings.TrimRight(base64.URLEncoding.EncodeToString(payloadBytes), "=")\n    fmt.Println(payloadString)\n\n    // base64\u89e3\u7801\n    payloadBytes, _ = base64.URLEncoding.DecodeString(payloadString)\n    fmt.Println(string(payloadBytes))\n\n    type Payload struct {\n        Sub   string `json:"sub"`\n        Exp   string `json:"exp"`\n        Name  string `json:"name"`\n        Admin string `json:"admin"`\n        Info  string `json:"info"`\n    }\n\n    payload := Payload{}\n    json.Unmarshal([]byte(payloadBytes), &payload)\n    fmt.Printf("%#v", payload)\n\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"signature")),(0,o.yg)("p",null,"JWT\u7684\u7b2c\u4e09\u90e8\u5206\u662f\u4e00\u4e2a\u7b7e\u8bc1\u4fe1\u606f\uff0c\u8fd9\u4e2a\u7b7e\u8bc1\u4fe1\u606f\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"header (base64\u7f16\u7801\u540e\u7684)"),(0,o.yg)("li",{parentName:"ul"},"payload (base64\u7f16\u7801\u540e\u7684)"),(0,o.yg)("li",{parentName:"ul"},"secret \u5bc6\u94a5")),(0,o.yg)("p",null,"\u8fd9\u4e2a\u90e8\u5206\u9700\u8981base64\u52a0\u5bc6\u540e\u7684header\u548cbase64\u52a0\u5bc6\u540e\u7684payload\u4f7f\u7528",(0,o.yg)("inlineCode",{parentName:"p"},"."),"\u8fde\u63a5\u7ec4\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u7136\u540e\u901a\u8fc7header\u4e2d\u58f0\u660e\u7684\u52a0\u5bc6\u7b97\u6cd5\u8fdb\u884c\u52a0\u76d0",(0,o.yg)("inlineCode",{parentName:"p"},"secret"),"\u7ec4\u5408\u52a0\u5bc6\uff0c\u7136\u540e\u5c31\u6784\u6210\u4e86jwt\u7684\u7b2c\u4e09\u90e8\u5206\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "crypto/hmac"\n    "crypto/sha256"\n    "encoding/base64"\n    "encoding/hex"\n    "encoding/json"\n    "fmt"\n    "strings"\n)\n\nfunc main() {\n\n    // \u5934\u90e8\n    header := map[string]string{\n        "typ": "JWT",\n        "alg": "HS256",\n    }\n    ret, _ := json.Marshal(header)\n    headerString := base64.URLEncoding.EncodeToString(ret)\n    fmt.Println(headerString)\n\n    // \u8f7d\u8377\n    payload := map[string]string{\n        "sub":   "1234567890",\n        "exp":   "3422335555",\n        "name":  "yuan",\n        "admin": "1",\n        "info":  "123abc456",\n    }\n    ret, _ = json.Marshal(payload)\n\n    // base64\u7f16\u7801\n    payloadString := strings.TrimRight(base64.URLEncoding.EncodeToString(ret), "=")\n    fmt.Println(payloadString)\n\n    // \u7b7e\u8bc1\n    // HMACSHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload), secret)\n    secret := "secret"\n    sign := fmt.Sprintf("%s.%s", headerString, payloadString)\n    key := []byte(secret)\n    h := hmac.New(sha256.New, key)\n    h.Write([]byte(sign))\n    signature := hex.EncodeToString(h.Sum(nil))\n\n    fmt.Printf("%s.%s.%s", headerString, payloadString, signature)\n}\n\n')),(0,o.yg)("p",null,"\u5c06\u8fd9\u4e09\u90e8\u5206\u7528",(0,o.yg)("inlineCode",{parentName:"p"},"."),"\u8fde\u63a5\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u5b57\u7b26\u4e32,\u6784\u6210\u4e86\u6700\u7ec8\u7684jwt:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-htaccess"},"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6IjEiLCJleHAiOiIzNDIyMzM1NTU1IiwiaW5mbyI6IjEyM2FiYzQ1NiIsIm5hbWUiOiJ5dWFuIiwic3ViIjoiMTIzNDU2Nzg5MCJ9.d7346bb5a519703477f400fc5e2eb5c341c79acce75b699f0aed0cbaf0e2fcfb\n")),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"\u6ce8\u610f\uff1asecret\u662f\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u7aef\u7684\uff0cjwt\u7684\u7b7e\u53d1\u751f\u6210\u4e5f\u662f\u5728\u670d\u52a1\u5668\u7aef\u7684\uff0csecret\u5c31\u662f\u7528\u6765\u8fdb\u884cjwt\u7684\u7b7e\u53d1\u548cjwt\u7684\u9a8c\u8bc1\uff0c\u6240\u4ee5\uff0c\u5b83\u5c31\u662f\u4f60\u670d\u52a1\u7aef\u7684\u79c1\u94a5\uff0c\u5728\u4efb\u4f55\u573a\u666f\u90fd\u4e0d\u5e94\u8be5\u6d41\u9732\u51fa\u53bb\u3002\u4e00\u65e6\u5ba2\u6237\u7aef\u5f97\u77e5\u8fd9\u4e2asecret, \u90a3\u5c31\u610f\u5473\u7740\u5ba2\u6237\u7aef\u662f\u53ef\u4ee5\u81ea\u6211\u7b7e\u53d1jwt\u4e86\u3002")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-gfm"},"jwt\u7684\u4f18\u70b9\uff1a\n1. \u5b9e\u73b0\u5206\u5e03\u5f0f\u7684\u5355\u70b9\u767b\u9646\u975e\u5e38\u65b9\u4fbf\n2. \u6570\u636e\u5b9e\u9645\u4fdd\u5b58\u5728\u5ba2\u6237\u7aef\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5206\u62c5\u670d\u52a1\u7aef\u7684\u5b58\u50a8\u538b\u529b\n3. JWT\u4e0d\u4ec5\u53ef\u7528\u4e8e\u8ba4\u8bc1\uff0c\u8fd8\u53ef\u7528\u4e8e\u4fe1\u606f\u4ea4\u6362\u3002\u5584\u7528JWT\u6709\u52a9\u4e8e\u51cf\u5c11\u670d\u52a1\u5668\u8bf7\u6c42\u6570\u636e\u5e93\u7684\u6b21\u6570\uff0cjwt\u7684\u6784\u6210\u975e\u5e38\u7b80\u5355\uff0c\u5b57\u8282\u5360\u7528\u5f88\u5c0f\uff0c\u6240\u4ee5\u5b83\u662f\u975e\u5e38\u4fbf\u4e8e\u4f20\u8f93\u7684\u3002\n\njwt\u7684\u7f3a\u70b9\uff1a\n1. \u6570\u636e\u4fdd\u5b58\u5728\u4e86\u5ba2\u6237\u7aef\uff0c\u6211\u4eec\u670d\u52a1\u7aef\u53ea\u8ba4jwt\uff0c\u4e0d\u8bc6\u522b\u5ba2\u6237\u7aef\u3002\n2. jwt\u53ef\u4ee5\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4f46\u662f\u56e0\u4e3a\u6570\u636e\u4fdd\u5b58\u5728\u4e86\u5ba2\u6237\u7aef\uff0c\u6240\u4ee5\u5bf9\u4e8e\u8fc7\u671f\u65f6\u95f4\u4e0d\u597d\u8c03\u6574\u3002\n3. \u56e0\u4e3ajwt\u53d1\u653e\u4ee5\u540e\u4fdd\u5b58\u5728\u4e86\u5ba2\u6237\u7aef\uff0c\u800c\u4e14\u9a8c\u8bc1\u8fc7\u7a0b\u4e2d\u5e76\u6ca1\u6709\u5230\u6570\u636e\u5e93\u67e5\u9a8c\u7528\u6237\u7684\u72b6\u6001\uff0c\u6240\u4ee5\u4f1a\u51fa\u73b0\u7528\u6237\u88ab\u5220\u9664\u4e86/\u88ab\u62c9\u9ed1\uff0c\u4f9d\u7136\u53ef\u4ee5\u901a\u8fc7token\u8bbf\u95ee\u8fdb\u6765\u3002\n\n# secret_key\u8f7b\u6613\u4e0d\u8981\u6539\uff0c\u4e00\u6539\u6240\u6709\u5ba2\u6237\u7aef\u90fd\u8981\u91cd\u65b0\u767b\u5f55\n")),(0,o.yg)("h2",{id:"35go-jwt\u57fa\u672c\u4f7f\u7528"},"3.5\u3001go-jwt\u57fa\u672c\u4f7f\u7528"),(0,o.yg)("h3",{id:"1go-jwt\u7684\u57fa\u672c\u529f\u80fd\u6d4b\u8bd5"},"\uff081\uff09go-jwt\u7684\u57fa\u672c\u529f\u80fd\u6d4b\u8bd5"),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"\u5173\u4e8e\u7b7e\u53d1\u548c\u6838\u9a8cJWT\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528go-jwt\u5305\u6765\u5b8c\u6210\u3002")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"go get -u github.com/dgrijalva/jwt-go\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"Test/jwt/main.go"),"\uff0c\u6d4b\u8bd5\u4ee3\u7801\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "errors"\n    "fmt"\n    "github.com/dgrijalva/jwt-go"\n    "time"\n)\n\n// \u6d88\u606f\u63d0\u793a\u5e38\u91cf\nconst (\n    TokenExpired     = "\u8ba4\u8bc1\u4ee4\u724c\u8fc7\u671f\uff01"\n    TokenNotValidYet = "\u4ee4\u724c\u5c1a\u672a\u6fc0\u6d3b\uff01"\n    TokenMalformed   = "\u8ba4\u8bc1\u4ee4\u724c\u683c\u5f0f\u6709\u8bef\uff01"\n    TokenInvalid     = "\u65e0\u6548\u7684\u8ba4\u8bc1\u4ee4\u724c\uff01"\n)\n\n// SecretKey \u79d8\u94a5\nvar (\n    SecretKey string = "secret"\n)\n\n/**\nJWT\n*/\n\ntype JWT struct {\n    SigningKey []byte\n}\n\n/**\n\u8f7d\u8377\n*/\n\ntype PublicClaims struct {\n    ID       string `json:"id"`\n    Username string `json:"username"`\n    jwt.StandardClaims\n}\n\n/**\n\u65b0\u5efa\u4e00\u4e2ajwt\u5b9e\u4f8b\n*/\n\nfunc NewJWT() *JWT {\n    return &JWT{\n        []byte(GetSecretKey()),\n    }\n}\n\n/**\n\u83b7\u53d6SecretKey\n*/\n\nfunc GetSecretKey() string {\n    return SecretKey\n}\n\n/**\n\u751f\u6210\u4e00\u4e2aAccessToken\n*/\n\nfunc (j *JWT) AccessToken(claims PublicClaims) (string, error) {\n    token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)\n    return token.SignedString(j.SigningKey)\n}\n\n/**\n\u4eceToken\u4e2d\u63d0\u53d6\u8f7d\u8377\n*/\n\nfunc (j *JWT) GetPayloadByToken(tokenString string) (*PublicClaims, error) {\n    token, err := jwt.ParseWithClaims(tokenString, &PublicClaims{}, func(token *jwt.Token) (interface{}, error) {\n        return j.SigningKey, nil\n    })\n    if err != nil {\n        if ve, ok := err.(*jwt.ValidationError); ok {\n            if ve.Errors&jwt.ValidationErrorMalformed != 0 {\n                return nil, errors.New(TokenMalformed)\n            } else if ve.Errors&jwt.ValidationErrorExpired != 0 {\n                return nil, errors.New(TokenExpired)\n            } else if ve.Errors&jwt.ValidationErrorNotValidYet != 0 {\n                return nil, errors.New(TokenNotValidYet)\n            } else {\n                return nil, errors.New(TokenInvalid)\n            }\n        }\n    }\n    if claims, ok := token.Claims.(*PublicClaims); ok && token.Valid {\n        return claims, nil\n    }\n    return nil, errors.New(TokenInvalid)\n}\n\n/**\n\u66f4\u65b0token\n*/\n\nfunc (j *JWT) RefreshToken(tokenString string) (string, error) {\n    jwt.TimeFunc = func() time.Time {\n        return time.Unix(0, 0)\n    }\n    token, err := jwt.ParseWithClaims(tokenString, &PublicClaims{}, func(token *jwt.Token) (interface{}, error) {\n        return j.SigningKey, nil\n    })\n    if err != nil {\n        return "", err\n    }\n    if claims, ok := token.Claims.(*PublicClaims); ok && token.Valid {\n        jwt.TimeFunc = time.Now\n        println(time.Now().Add(1 * time.Hour).Unix())\n        claims.StandardClaims.ExpiresAt = time.Now().Add(1 * time.Hour).Unix()\n        return j.AccessToken(*claims)\n    }\n    return "", errors.New(TokenInvalid)\n}\n\nfunc main() {\n    publicClaims := PublicClaims{\n        ID:       "1",\n        Username: "yuan",\n    }\n    newJwt := NewJWT()\n    token, _ := newJwt.AccessToken(publicClaims)\n    println(token)\n\n    refreshToken, _ := newJwt.RefreshToken(token)\n    fmt.Println("refresh token:", refreshToken)\n\n}\n\n')),(0,o.yg)("p",null,"\u63a5\u4e0b\u6765\uff0c\u628ajwt\u96c6\u6210\u5230\u9879\u76ee\u4e2d\u5373\u53ef\u5728\u7528\u6237\u6ce8\u518c\u6216\u767b\u5f55\u6210\u529f\u540e\uff0c\u8fd4\u56detoken\u5373\u53ef\u3002"),(0,o.yg)("h3",{id:"2\u57fa\u4e8ego-jwt\u7684jwt\u5305\u5c01\u88c5"},"\uff082\uff09\u57fa\u4e8ego-jwt\u7684jwt\u5305\u5c01\u88c5"),(0,o.yg)("p",null,"\u65b0\u589e\u914d\u7f6e\u9879\uff0c\u628a\u79d8\u94a5\u8bbe\u7f6e\u4e3a\u914d\u7f6e\u4fe1\u606f\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/config/config.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package config\n\nimport (\n    "encoding/json"\n    "github.com/dgrijalva/jwt-go"\n    "io/ioutil"\n)\n\n// ... \u4ee3\u7801\u7701\u7565\n// ... \u4ee3\u7801\u7701\u7565\n// ... \u4ee3\u7801\u7701\u7565\n\n// Config \u6574\u4e2a\u9879\u76ee\u7684\u914d\u7f6e\ntype Config struct {\n    Mode                string `json:"mode"`\n    Port                int    `json:"port"`\n    SecretKey           string `json:"secret_key"`\n    *LogConfig          `json:"log"`\n    *DatabaseConfig     `json:"database"`\n    *jwt.StandardClaims `json:"jwt"`\n}\n// ... \u4ee3\u7801\u7701\u7565\n// ... \u4ee3\u7801\u7701\u7565\n// ... \u4ee3\u7801\u7701\u7565\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/config.json"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "mode": "debug",\n  "port": 8000,\n  // \u4ee3\u7801\u7701\u7565...\n  "secret_key": "Ub=~sV,U1QXmvHObh_My6#6-O9>}zK{8",\n  "jwt": {\n    "exp": 1800\n  }\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/utils/jwt.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package utils\n\nimport (\n    "errors"\n    "github.com/dgrijalva/jwt-go"\n    "time"\n    "bingo_api/application/config"\n    . "bingo_api/application/constants"\n)\n\n\n/**\nJWT\u57fa\u672c\u7ed3\u6784\u4f53\n*/\n\ntype JWT struct {\n    SigningKey []byte\n}\n\n\n/**\n \u8f7d\u8377\n */\n\ntype PublicClaims struct {\n    ID         string `json:"id"`\n    Username   string `json:"username"`\n    Nickname   string `json:"nickname"`\n    Avatar     string `json:"avatar"`\n    jwt.StandardClaims\n}\n\n\n/**\n\u65b0\u5efa\u4e00\u4e2ajwt\u5b9e\u4f8b\n*/\n\nfunc NewJWT() *JWT {\n    return &JWT{\n        []byte(config.Conf.SecretKey),\n    }\n}\n\n\n/**\n\u751f\u6210\u4e00\u4e2aAccessToken\n*/\n\nfunc (j *JWT) AccessToken(claims PublicClaims) (string, error) {\n    // \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\n    now := time.Now()\n    // \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u7684Unix\u65f6\u95f4\u6233\n    nowAt := now.Unix()\n    // \u8bbe\u7f6etoken\u7684\u7b7e\u53d1\u65f6\u95f4\n    claims.IssuedAt = nowAt\n    // \u8bbe\u7f6ejwt\u7684\u552f\u4e00\u8eab\u4efd\u6807\u8bc6\uff0c\u4e3b\u8981\u7528\u6765\u4f5c\u4e3a\u4e00\u6b21\u6027token,\u4ece\u800c\u56de\u907f\u91cd\u653e\u653b\u51fb\u3002\n    claims.Id = uuid4()\n    // \u5224\u65ad\uff1a\u5982\u679c\u914d\u7f6e\u9879\u4e2d\u6709\u8bbe\u7f6etoken\u7684\u8fc7\u671f\u65f6\u95f4\n    if config.Conf.ExpiresAt > 0 {\n        // \u5219\u5728token\u7684\u8f7d\u8377\u4fe1\u606f\u4e2d\u8bb0\u5f55\uff0c\u5f53\u524dtoken\u7684\u8d77\u7528\u65f6\u95f4\u548c\u8fc7\u671f\u65f6\u95f4\n        expAt := now.Add(time.Duration(config.Conf.ExpiresAt) * time.Second).Unix()\n        claims.ExpiresAt = expAt\n        claims.NotBefore = nowAt\n    }\n    // \u5224\u65ad\uff1a\u5982\u679c\u914d\u7f6e\u4e2d\u6709\u8bbe\u7f6etoken\u7684\u8d77\u7528\u65f6\u95f4\n    if config.Conf.NotBefore > 0 {\n        // \u5219\u5728token\u7684\u8f7d\u8377\u4fe1\u606f\u4e2d\u8bb0\u5f55\uff0c\u5f53\u524dtoken\u7684\u8d77\u7528\u65f6\u95f4\n        nbfAt := now.Add(time.Duration(config.Conf.NotBefore) * time.Second).Unix()\n        claims.NotBefore = nbfAt\n    }\n\n    token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)\n    return token.SignedString(j.SigningKey)\n}\n\n\n/**\n\u4eceToken\u4e2d\u63d0\u53d6\u8f7d\u8377\n*/\n\nfunc (j *JWT) GetPayloadByToken(tokenString string) (*PublicClaims, error) {\n    token, err := jwt.ParseWithClaims(tokenString, &PublicClaims{}, func(token *jwt.Token) (interface{}, error) {\n        return j.SigningKey, nil\n    })\n    if err != nil {\n        if ve, ok := err.(*jwt.ValidationError); ok {\n            if ve.Errors&jwt.ValidationErrorMalformed != 0 {\n                return nil, errors.New(TokenIsMalformed)\n            } else if ve.Errors&jwt.ValidationErrorExpired != 0 {\n                return nil, errors.New(TokenIsExpired)\n            } else if ve.Errors&jwt.ValidationErrorNotValidYet != 0 {\n                return nil, errors.New(TokenIsNotValidYet)\n            } else {\n                return nil, errors.New(TokenIsInvalid)\n            }\n        }\n    }\n    if claims, ok := token.Claims.(*PublicClaims); ok && token.Valid {\n        return claims, nil\n    }\n    return nil, errors.New(TokenIsInvalid)\n}\n\n\n/**\n\u66f4\u65b0token\n*/\n\nfunc (j *JWT) RefreshToken(tokenString string) (string, error) {\n    jwt.TimeFunc = func() time.Time {\n        return time.Unix(0, 0)\n    }\n    token, err := jwt.ParseWithClaims(tokenString, &PublicClaims{}, func(token *jwt.Token) (interface{}, error) {\n        return j.SigningKey, nil\n    })\n    if err != nil {\n        return "", err\n    }\n    if claims, ok := token.Claims.(*PublicClaims); ok && token.Valid {\n        jwt.TimeFunc = time.Now\n        println(time.Now().Add(1 * time.Hour).Unix())\n        claims.StandardClaims.ExpiresAt = time.Now().Add(1 * time.Hour).Unix()\n        return j.AccessToken(*claims)\n    }\n    return "", errors.New(TokenIsInvalid)\n}\n\n')),(0,o.yg)("p",null,"\u58f0\u660e\u9519\u8bef\u63d0\u793a\u7684\u5e38\u91cf\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/constants/message.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package constants\n\nconst (\n    Success           = "\u6210\u529f\uff01"\n    CreateUserFail    = "\u521b\u5efa\u7528\u6237\u5931\u8d25\uff01"\n    CreateUserSuccess = "\u521b\u5efa\u7528\u6237\u6210\u529f\uff01"\n    NoSuchUser        = "\u7528\u6237\u4e0d\u5b58\u5728\uff01"\n    PasswordError     = "\u5bc6\u7801\u9519\u8bef\uff01"\n\n    TokenIsExpired     = "\u8ba4\u8bc1\u4ee4\u724c\u8fc7\u671f\uff01"\n    TokenIsNotValidYet = "\u4ee4\u724c\u5c1a\u672a\u6fc0\u6d3b\uff01"\n    TokenIsMalformed   = "\u8ba4\u8bc1\u4ee4\u724c\u683c\u5f0f\u6709\u8bef\uff01"\n    TokenIsInvalid     = "\u65e0\u6548\u7684\u8ba4\u8bc1\u4ee4\u724c\uff01"\n)\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/constants/code.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"package constants\n\nconst (\n    CodeSuccess        = 0    // \u6210\u529f\uff01\n    CodeFail           = -1   // \u5931\u8d25\uff01\n    CodeAuthticateFail = -2   // \u8ba4\u8bc1\u5931\u8d25\uff01\n    CodeCreateUserFail = 1001 // \u521b\u5efa\u7528\u6237\u5931\u8d25\uff01\n    CodeNoSuchUser     = 1002 // \u5f53\u524d\u7528\u6237\u4e0d\u5b58\u5728\n)\n")),(0,o.yg)("p",null,"\u58f0\u660e\u4e00\u4e2a\u8f85\u52a9\u51fd\u6570\uff0c\u7528\u4e8e\u751f\u6210UUID\u683c\u5f0f\u5b57\u7b26\u4e32\uff0c\u63d0\u4f9b\u7ed9jwt\u7684\u8f7d\u8377\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"go get -u github.com/satori/go.uuid\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/utils/string.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package utils\n\nimport (\n    "fmt"\n    uuid "github.com/satori/go.uuid"\n    "golang.org/x/crypto/bcrypt"\n    "math/rand"\n    "time"\n    . "bingo_api/application/constants"\n)\n\n// \u4ee3\u7801\u7701\u7565...\n// \u4ee3\u7801\u7701\u7565...\n// \u4ee3\u7801\u7701\u7565...\n\n/**\n \u751f\u6210UUID4\n */\n\nfunc uuid4() string {\n    return fmt.Sprintf("%s", uuid.NewV4())\n}\n')),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"\u751f\u6210token\u63a5\u53e3\u6d4b\u8bd5")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"services/user.go")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"func UserLogin(ctx *gin.Context) (user User, err error) {\n    user = User{}\n    if err = ctx.ShouldBindJSON(&user); err != nil {\n        return user, err\n    }\n\n    if err = validator.UserValidator(&user); err != nil {\n        return user, err\n    }\n\n    user.GetOneByAccount(user.Username)\n    if user.ID < 1 {\n        return user, errors.New(constants.NoSuchUser)\n    }\n\n    ret := CheckPassword(user.HashPassword, user.Password)\n\n    if !ret {\n        err = errors.New(constants.PasswordError)\n        return\n    }\n\n    return\n}\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/api/user.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package api\n\nimport (\n    "github.com/gin-gonic/gin"\n    "net/http"\n    "strconv"\n    "bingo_api/application/constants"\n    . "bingo_api/application/services"\n    . "bingo_api/application/utils"\n)\n\n\n/**\n\u7528\u6237\u8ba4\u8bc1\u767b\u9646\n*/\n\nfunc UserAuthenticate(ctx *gin.Context){\n\n    // \u7528\u6237\u767b\u9646\u8ba4\u8bc1\u4e1a\u52a1\n    user, err := UserLogin(ctx)\n\n    if err != nil || user.ID < 1 {\n        ctx.JSON(http.StatusOK, gin.H{\n            "code":    constants.CodeNoSuchUser,\n            "message": constants.NoSuchUser+err.Error(),\n        })\n        return\n    }\n\n    // \u751f\u6210token\n    newJwt := NewJWT()\n    publicClaims := PublicClaims {\n        ID: strconv.Itoa(int(user.ID)),\n        Username: user.Username,\n        Nickname: user.Nickname,\n        Avatar  : user.Avatar,\n    }\n\n    token, err := newJwt.AccessToken(publicClaims)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    ctx.JSON(http.StatusCreated, gin.H{\n        "code": constants.CodeSuccess,\n        "message": constants.Success,\n        "data": map[string]interface{}{\n            "token": token,\n        },\n    })\n}\n\n\n// \u4ee3\u7801\u7701\u7565...\n// \u4ee3\u7801\u7701\u7565...\n// \u4ee3\u7801\u7701\u7565...\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230903135521988-3720523.png",alt:"image-20230903135521988"})),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"\u9a8c\u8bc1token")),(0,o.yg)("p",null,"\u58f0\u660e\u4e2d\u95f4\u4ef6\u7528\u4e8e\u9a8c\u8bc1JWT token \u7684\u5408\u6cd5\u6027\uff08\u6709\u6548\u671f\u3001\u683c\u5f0f\uff09\u3002"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/middleware/jwt.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package middleware\n\nimport (\n"github.com/gin-gonic/gin"\n"go.uber.org/zap"\n"net/http"\n"bingo_api/application/constants"\n. "bingo_api/application/utils"\n)\n\n// JWTAuthorization \u9a8c\u8bc1token\nfunc JWTAuthorization() gin.HandlerFunc {\n    return func(c *gin.Context) {\n        token := c.Request.Header.Get("Authorization")\n        if token == "" {\n            c.JSON(http.StatusOK, gin.H{\n                "code": constants.CodeAuthticateFail,\n                "message": constants.TokenIsInvalid,\n            })\n            c.Abort()\n            return\n        }\n\n        zap.S().Debugf("get token: %#v", token)\n\n        j := NewJWT()\n        // parseToken \u89e3\u6790token\u5305\u542b\u7684\u4fe1\u606f\n        claims, err := j.GetPayloadByToken(token)\n        if err != nil {\n            c.JSON(http.StatusOK, gin.H{\n                "code": constants.CodeAuthticateFail,\n                "message": err.Error(),\n            })\n            c.Abort()\n            return\n        }\n\n        // \u5b58\u50a8\u8ba4\u8bc1\u7684\u8f7d\u8377\u4fe1\u606f\u548ctoken\uff0c\u4fdd\u7559\u81f3\u540e\u9762\u4f7f\u7528\u3002\n        c.Set("claims", claims)\n        c.Set("access_token", token)\n        c.Next()\n    }\n}\n\n')),(0,o.yg)("p",null,"\u6d4b\u8bd5\uff0c\u7ed9\u4e4b\u524d\u58f0\u660e\u7684\u521b\u5efa\u7528\u6237\u7684\u63a5\u53e3\uff0c\u52a0\u4e0atoken\u9a8c\u8bc1\u4e2d\u95f4\u4ef6\u3002"),(0,o.yg)("p",null,"\u5728 ",(0,o.yg)("inlineCode",{parentName:"p"},"initialize/router.go"),"\u4e2d\u8bbe\u7f6ejwt\u9a8c\u8bc1\u4e2d\u95f4\u4ef6"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"// \u6ce8\u518c\u4e2d\u95f4\u4ef6\nRouter.Use(middleware.JWTAuthorization(), middleware.GinLogger(), middleware.GinRecovery(true))\n")),(0,o.yg)("blockquote",null,(0,o.yg)("p",{parentName:"blockquote"},"\u8fd9\u662f\u5168\u5c40\u4e2d\u95f4\u4ef6\uff0c\u50cf\u767b\u5f55\u8fd9\u6837\u7684\u8bf7\u6c42\u4e0d\u53ef\u80fd\u6709token\u7684\uff0c\u6240\u4ee5\u4e0d\u8981\u8bbe\u7f6e\u5168\u5c40")),(0,o.yg)("p",null,"\u6bd4\u5982\u6211\u4eec\u7ed9\u521b\u5efa\u7528\u6237\u65f6\u6dfb\u52a0token\u9a8c\u8bc1\uff0c\u5728bingo_api/application/router/user.go\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package router\n\nimport (\n    "github.com/gin-gonic/gin"\n    "bingo_api/application/middleware"\n    "bingo_api/application/utils"\n\n    "bingo_api/application/api"\n)\n\nfunc InitUserRouter(Router *gin.RouterGroup) {\n    /**\n    \u7528\u6237\u76f8\u5173\u7684\u8def\u7531\u7ec4\n    */\n    UserRouter := Router.Group("user")\n  // UserRouter.Use(middleware.JWTAuthorization())\n    {\n        // \u7528\u6237\u8ba4\u8bc1\u767b\u9646\n        utils.Register(UserRouter, []string{"GET", "POST"}, "authenticate", api.UserAuthenticate)\n        // \u7528\u6237\u521b\u5efa\n        // utils.Register(UserRouter, []string{"POST"}, "", api.UserCreate)\n        utils.Register(UserRouter, []string{"POST"}, "", middleware.JWTAuthorization(), api.UserCreate)\n    }\n\n}\n\n')),(0,o.yg)("p",null,"\u901a\u8fc7postman\u6d4b\u8bd5\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0cToken\u8ba4\u8bc1\u4e2d\u95f4\u4ef6\u6b63\u5e38\u5de5\u4f5c\u3002"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20221217225956923-5475165.png",alt:"image-20221217225956923"})),(0,o.yg)("h2",{id:"36token\u672c\u5730\u5b58\u50a8"},"3.6\u3001token\u672c\u5730\u5b58\u50a8"),(0,o.yg)("p",null,"\u5982\u679c\u8981\u5728\u9879\u76ee\u4e2d\u4f7f\u7528axios\u8fdb\u884cajax\u8bf7\u6c42\uff0c\u80af\u5b9a\u9700\u8981\u5728\u65b0\u5efa\u4e00\u4e2aaxios\u7684\u521d\u59cb\u5316\u811a\u672c\u6587\u4ef6",(0,o.yg)("inlineCode",{parentName:"p"},"src/utils/http.js"),"\u4e2d\u8fdb\u884c\u521d\u59cb\u5316\u914d\u7f6e\u3002"),(0,o.yg)("p",null,"axios\u7684\u521d\u59cb\u5316\u914d\u7f6e\u4e00\u822c\u5305\u62ec\u4ee5\u4e0b3\u90e8\u5206\uff1a"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},"\u521b\u5efaaxios\u8bf7\u6c42\u5b9e\u4f8b\u5bf9\u8c61"),(0,o.yg)("li",{parentName:"ol"},"\u914d\u7f6ebaseURL\u8bbe\u7f6e\u6574\u4e2a\u7ad9\u70b9ajax\u8bf7\u6c42\u7684api\u670d\u52a1\u7aef\u7ad9\u70b9\u516c\u5171\u5730\u5740"),(0,o.yg)("li",{parentName:"ol"},"\u914d\u7f6eaxios\u8bf7\u6c42\u62e6\u622a\u5668\u548c\u54cd\u5e94\u62e6\u622a\u5668\u3002")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"src/utils/http.js"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'import axios from "axios"\n\nconst http = axios.create({\n    // timeout: 2500,                          // \u8bf7\u6c42\u8d85\u65f6\uff0c\u6709\u5927\u6587\u4ef6\u4e0a\u4f20\u9700\u8981\u5173\u95ed\u8fd9\u4e2a\u914d\u7f6e\n    baseURL: "http://api.bingo.cn:8080/api",     // \u8bbe\u7f6eapi\u670d\u52a1\u7aef\u7684\u9ed8\u8ba4\u5730\u5740[\u5982\u679c\u57fa\u4e8e\u670d\u52a1\u7aef\u5b9e\u73b0\u7684\u8de8\u57df\uff0c\u8fd9\u91cc\u53ef\u4ee5\u586b\u5199api\u670d\u52a1\u7aef\u7684\u5730\u5740\uff0c\u5982\u679c\u57fa\u4e8enodejs\u5ba2\u6237\u7aef\u6d4b\u8bd5\u670d\u52a1\u5668\u5b9e\u73b0\u7684\u8de8\u57df\uff0c\u5219\u8fd9\u91cc\u4e0d\u80fd\u586b\u5199api\u670d\u52a1\u7aef\u5730\u5740]\n    withCredentials: false,                    // \u662f\u5426\u5141\u8bb8\u5ba2\u6237\u7aefajax\u8bf7\u6c42\u65f6\u643a\u5e26cookie\n})\n\n// \u8bf7\u6c42\u62e6\u622a\u5668\nhttp.interceptors.request.use((config) => {\n    console.log("http\u8bf7\u6c42\u4e4b\u524d");\n    return config;\n}, (error) => {\n    console.log("http\u8bf7\u6c42\u9519\u8bef");\n    return Promise.reject(error);\n});\n\n// \u54cd\u5e94\u62e6\u622a\u5668\nhttp.interceptors.response.use((response) => {\n    console.log("\u670d\u52a1\u7aef\u54cd\u5e94\u6570\u636e\u6210\u529f\u4ee5\u540e\uff0c\u8fd4\u56de\u7ed3\u679c\u7ed9\u5ba2\u6237\u7aef\u7684\u7b2c\u4e00\u65f6\u95f4\uff0c\u6267\u884cthen\u4e4b\u524d");\n    if (response.data.code === -2) {\n        router.push("/login")\n    }\n    return response;\n}, (error) => {\n    console.log("\u670d\u52a1\u7aef\u54cd\u5e94\u9519\u8bef\u5185\u5bb9\u7684\u65f6\u5019\u3002...");\n    return Promise.reject(error);\n});\n\nexport default http;\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"Login.vue")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="login box">\n    <img src=".https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/login.jpg" alt="">\n    <div class="login">\n      <div class="login-title">\n        <p class="hi">Hello,bingo!</p>\n      </div>\n      <div class="login_box">\n        <div class="title">\n          <span>\u767b\u5f55</span>\n        </div>\n        <div class="inp">\n          <a-input v-model:value="user.account" type="text" placeholder="\u7528\u6237\u540d" class="user"></a-input>\n          <a-input v-model:value="user.password" type="password" class="pwd" placeholder="\u5bc6\u7801"></a-input>\n          <div class="rember">\n            <p>\n              <a-checkbox v-model:checked="user.remember">\u8bb0\u4f4f\u5bc6\u7801</a-checkbox>\n            </p>\n          </div>\n          <button class="login_btn" @click="loginHandler">\u767b\u5f55</button>\n\n        </div>\n\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport http from "../http"\nimport {reactive} from "vue"\nimport {message} from \'ant-design-vue\';\nimport router from \'../router/index.js\'\n\n\nconst user = reactive({\n  account: "",  // \u767b\u5f55\u8d26\u53f7/\u624b\u673a\u53f7/\u90ae\u7bb1\n  password: "", // \u767b\u5f55\u5bc6\u7801\n  remember: false, // \u662f\u5426\u8bb0\u4f4f\u767b\u5f55\u72b6\u6001\n  login() {\n    // \u7528\u6237\u767b\u5f55\n    return http.post("/user/authenticate", {\n      "username": this.account,\n      "password": this.password,\n    })\n  }\n})\n\nconst loginHandler = () => {\n  user.login().then((response) => {\n    // \u5148\u6e05\u7a7a\u539f\u6709\u7684token\n    localStorage.removeItem("token");\n    sessionStorage.removeItem("token");\n\n    if (response.data.code === 0) {\n      if (user.remember) {\n        // \u8bb0\u4f4f\u767b\u5f55\n        localStorage.token = response.data.data.token;\n      } else {\n        sessionStorage.token = response.data.data.token;\n      }\n      // \u8df3\u8f6c\u5230\u9996\u9875\n\n      message.success({\n        duration: 0.8,\n        content: `\u767b\u5f55\u6210\u529f\uff01`,\n        onClose() {\n          router.push("/bingo/")\n        }\n      })\n    } else {\n      message.error(\'\u7528\u6237\u540d\u6216\u8005\u5bc6\u7801\u6709\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01\');\n    }\n\n  })\n}\n\n<\/script>\n\n<style scoped>\n.login .hi {\n  font-size: 20px;\n  font-family: "Times New Roman";\n  font-style: italic;\n}\n\n.box {\n  width: 100%;\n  height: 100%;\n  position: relative;\n  overflow: hidden;\n}\n\n.box img {\n  width: 100%;\n  min-height: 100%;\n}\n\n.box .login {\n  position: absolute;\n  width: 500px;\n  height: 400px;\n  left: 0;\n  margin: auto;\n  right: 0;\n  bottom: 0;\n  top: -338px;\n}\n\n.login .login-title {\n  width: 100%;\n  text-align: center;\n}\n\n.login-title img {\n  width: 190px;\n  height: auto;\n}\n\n.login-title p {\n  font-size: 18px;\n  color: #fff;\n  letter-spacing: .29px;\n  padding-top: 10px;\n  padding-bottom: 50px;\n}\n\n.login_box {\n  width: 400px;\n  height: auto;\n  background: rgba(255, 255, 255, 0.3);\n  box-shadow: 0 2px 4px 0 rgba(0, 0, 0, .5);\n  border-radius: 4px;\n  margin: 0 auto;\n  padding-bottom: 40px;\n}\n\n.login_box .title {\n  font-size: 20px;\n  color: #9b9b9b;\n  letter-spacing: .32px;\n  border-bottom: 1px solid #e6e6e6;\n  display: flex;\n  justify-content: space-around;\n  padding: 50px 60px 0 60px;\n  margin-bottom: 20px;\n  cursor: pointer;\n}\n\n.login_box .title span:nth-of-type(1) {\n  color: #4a4a4a;\n  border-bottom: 2px solid #396fcc;\n}\n\n.inp {\n  width: 350px;\n  margin: 0 auto;\n}\n\n.inp input {\n  outline: 0;\n  width: 100%;\n  height: 45px;\n  border-radius: 4px;\n  border: 1px solid #d9d9d9;\n  text-indent: 20px;\n  font-size: 14px;\n  background: #fff !important;\n}\n\n.inp input.user {\n  margin-bottom: 16px;\n}\n\n.inp .rember {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  position: relative;\n  margin-top: 10px;\n}\n\n.inp .rember p:first-of-type {\n  font-size: 12px;\n  color: #4a4a4a;\n  letter-spacing: .19px;\n  margin-left: 22px;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: center;\n  align-items: center;\n  /*position: relative;*/\n}\n\n.inp .rember p:nth-of-type(2) {\n  font-size: 14px;\n  color: #9b9b9b;\n  letter-spacing: .19px;\n  cursor: pointer;\n}\n\n.inp .rember input {\n  outline: 0;\n  width: 30px;\n  height: 45px;\n  border-radius: 4px;\n  border: 1px solid #d9d9d9;\n  text-indent: 20px;\n  font-size: 14px;\n  background: #fff !important;\n}\n\n.inp .rember p span {\n  display: inline-block;\n  font-size: 12px;\n  width: 100px;\n  /*position: absolute;*/\n  /*left: 20px;*/\n\n}\n\n#geetest {\n  margin-top: 20px;\n}\n\n.login_btn {\n  width: 100%;\n  height: 45px;\n  background: #396fcc;\n  border-radius: 5px;\n  font-size: 16px;\n  color: #fff;\n  letter-spacing: .26px;\n  margin-top: 30px;\n}\n\n.inp .go_login {\n  text-align: center;\n  font-size: 14px;\n  color: #9b9b9b;\n  letter-spacing: .26px;\n  padding-top: 20px;\n}\n\n.inp .go_login span {\n  color: #84cc39;\n  cursor: pointer;\n}\n</style>\n')),(0,o.yg)("h2",{id:"37\u5c01\u88c5token\u7ba1\u7406\u6587\u4ef6"},"3.7\u3001\u5c01\u88c5token\u7ba1\u7406\u6587\u4ef6"),(0,o.yg)("p",null,"\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f1a\u5728js\u6587\u4ef6\u4e2d\u5b58\u653e\u4e00\u4e9b\u9700\u8981\u5728\u591a\u4e2a\u754c\u9762\u4e2d\u8fdb\u884c\u5171\u4eab\u7684\u4fe1\u606f\u3002\u6bd4\u5982\u7528\u6237\u7684\u767b\u5f55\u72b6\u6001\u3001\u7528\u6237\u540d\u79f0\u3001\u5934\u50cf\u3001\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u3001\u5546\u54c1\u7684\u6536\u85cf\u3001\u8d2d\u7269\u8f66\u4e2d\u7684\u7269\u54c1\u7b49\uff0c\u8fd9\u4e9b\u72b6\u6001\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u653e\u5728\u7edf\u4e00\u7684\u5730\u65b9\uff0c\u5bf9\u5b83\u8fdb\u884c\u4fdd\u5b58\u548c\u7ba1\u7406\u3002"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"Login.vue"),"\u4e2d\u8c03\u7528storage.js\u4e2d\u7684\u65b9\u6cd5\u7ba1\u7406token"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="login box">\n    <img src=".https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/login.jpg" alt="">\n    <div class="login">\n      <div class="login-title">\n        <p class="hi">Hello,bingo!</p>\n      </div>\n      <div class="login_box">\n        <div class="title">\n          <span>\u767b\u5f55</span>\n        </div>\n        <div class="inp">\n          <a-input v-model:value="user.account" type="text" placeholder="\u7528\u6237\u540d" class="user"></a-input>\n          <a-input v-model:value="user.password" type="password" class="pwd" placeholder="\u5bc6\u7801"></a-input>\n          <div class="rember">\n            <p>\n              <a-checkbox v-model:checked="user.remember">\u8bb0\u4f4f\u5bc6\u7801</a-checkbox>\n            </p>\n          </div>\n          <button class="login_btn" @click="loginHandler">\u767b\u5f55</button>\n\n        </div>\n\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport http from "../http"\nimport {reactive} from "vue"\nimport {message} from \'ant-design-vue\';\nimport router from \'@/router/index.js\'\nimport storage from \'@/utils/storage.js\'\n\n\nconst user = reactive({\n  account: "",  // \u767b\u5f55\u8d26\u53f7/\u624b\u673a\u53f7/\u90ae\u7bb1\n  password: "", // \u767b\u5f55\u5bc6\u7801\n  remember: false, // \u662f\u5426\u8bb0\u4f4f\u767b\u5f55\u72b6\u6001\n  login() {\n    // \u7528\u6237\u767b\u5f55\n    return http.post("/user/authenticate", {\n      "username": this.account,\n      "password": this.password,\n    })\n  }\n})\n\nconst loginHandler = () => {\n  user.login().then((response) => {\n    \n    if (response.data.code === 0) {\n      // vuex\u5b58\u50a8\u7528\u6237\u767b\u5f55\u4fe1\u606f\uff0c\u4fdd\u5b58token\n      storage.tokenHandle(response.data.data.token)\n\n      // \u8df3\u8f6c\u5230\u9996\u9875\n      message.success({\n        duration: 0.8,\n        content: `\u767b\u5f55\u6210\u529f\uff01`,\n        onClose() {\n          router.push("/bingo/")\n        }\n      })\n    } else {\n      message.error(\'\u7528\u6237\u540d\u6216\u8005\u5bc6\u7801\u6709\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01\');\n    }\n\n  })\n}\n\n<\/script>\n\n<style scoped>\n.login .hi {\n  font-size: 20px;\n  font-family: "Times New Roman";\n  font-style: italic;\n}\n\n.box {\n  width: 100%;\n  height: 100%;\n  position: relative;\n  overflow: hidden;\n}\n\n.box img {\n  width: 100%;\n  min-height: 100%;\n}\n\n.box .login {\n  position: absolute;\n  width: 500px;\n  height: 400px;\n  left: 0;\n  margin: auto;\n  right: 0;\n  bottom: 0;\n  top: -338px;\n}\n\n.login .login-title {\n  width: 100%;\n  text-align: center;\n}\n\n.login-title img {\n  width: 190px;\n  height: auto;\n}\n\n.login-title p {\n  font-size: 18px;\n  color: #fff;\n  letter-spacing: .29px;\n  padding-top: 10px;\n  padding-bottom: 50px;\n}\n\n.login_box {\n  width: 400px;\n  height: auto;\n  background: rgba(255, 255, 255, 0.3);\n  box-shadow: 0 2px 4px 0 rgba(0, 0, 0, .5);\n  border-radius: 4px;\n  margin: 0 auto;\n  padding-bottom: 40px;\n}\n\n.login_box .title {\n  font-size: 20px;\n  color: #9b9b9b;\n  letter-spacing: .32px;\n  border-bottom: 1px solid #e6e6e6;\n  display: flex;\n  justify-content: space-around;\n  padding: 50px 60px 0 60px;\n  margin-bottom: 20px;\n  cursor: pointer;\n}\n\n.login_box .title span:nth-of-type(1) {\n  color: #4a4a4a;\n  border-bottom: 2px solid #396fcc;\n}\n\n.inp {\n  width: 350px;\n  margin: 0 auto;\n}\n\n.inp input {\n  outline: 0;\n  width: 100%;\n  height: 45px;\n  border-radius: 4px;\n  border: 1px solid #d9d9d9;\n  text-indent: 20px;\n  font-size: 14px;\n  background: #fff !important;\n}\n\n.inp input.user {\n  margin-bottom: 16px;\n}\n\n.inp .rember {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  position: relative;\n  margin-top: 10px;\n}\n\n.inp .rember p:first-of-type {\n  font-size: 12px;\n  color: #4a4a4a;\n  letter-spacing: .19px;\n  margin-left: 22px;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: center;\n  align-items: center;\n  /*position: relative;*/\n}\n\n.inp .rember p:nth-of-type(2) {\n  font-size: 14px;\n  color: #9b9b9b;\n  letter-spacing: .19px;\n  cursor: pointer;\n}\n\n.inp .rember input {\n  outline: 0;\n  width: 30px;\n  height: 45px;\n  border-radius: 4px;\n  border: 1px solid #d9d9d9;\n  text-indent: 20px;\n  font-size: 14px;\n  background: #fff !important;\n}\n\n.inp .rember p span {\n  display: inline-block;\n  font-size: 12px;\n  width: 100px;\n  /*position: absolute;*/\n  /*left: 20px;*/\n\n}\n\n#geetest {\n  margin-top: 20px;\n}\n\n.login_btn {\n  width: 100%;\n  height: 45px;\n  background: #396fcc;\n  border-radius: 5px;\n  font-size: 16px;\n  color: #fff;\n  letter-spacing: .26px;\n  margin-top: 30px;\n}\n\n.inp .go_login {\n  text-align: center;\n  font-size: 14px;\n  color: #9b9b9b;\n  letter-spacing: .26px;\n  padding-top: 20px;\n}\n\n.inp .go_login span {\n  color: #84cc39;\n  cursor: pointer;\n}\n</style>\n')),(0,o.yg)("p",null,"\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"src/utils"),"\u4e2d\u521b\u5efastorage.js\u6587\u4ef6"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'const storage = {\n    state: {\n        user: {},\n        token: "",\n        remember: false\n    },\n    getUserInfo() {\n        console.log("this.state.token:::", this.state)\n        if (this.state.token === "") {\n            return false\n        }\n        let payload = this.state.token.split(".")[1]  // \u8f7d\u8377\n        let payload_data = JSON.parse(atob(payload)) // \u7528\u6237\u4fe1\u606f\n        console.log("payload_data:::", payload_data)\n        // \u4ecejwt\u7684\u8f7d\u8377\u4e2d\u63d0\u53d6\u7528\u6237\u4fe1\u606f\n        let now = parseInt((new Date() - 0) / 1000);\n        if (payload_data.exp === undefined) {\n            // \u6ca1\u767b\u5f55\n            this.clearStorage()\n            return {}\n        }\n\n        if (parseInt(payload_data.exp) < now) {\n            // \u8fc7\u671f\u5904\u7406\n            this.clearStorage()\n            return {}\n        }\n        return payload_data;\n    },\n    tokenHandle(token) {\n        this.state.token = token;\n        // \u89e3\u6790token\uff0c\u83b7\u53d6\u7528\u6237\u8f7d\u8377\n        this.state.user = this.getUserInfo()\n        // \u540c\u6b65\u672c\u5730\u5b58\u50a8\n        this.setStorage()\n\n    },\n    key: \'login\',\n    setStorage() {\n        if (this.state.remember) {\n            localStorage[this.key] = JSON.stringify(this.state)\n        } else {\n            sessionStorage[this.key] = JSON.stringify(this.state)\n        }\n    },\n    getStorage() {\n        console.log("localStorage[this.key]:::", localStorage[this.key])\n        console.log("sessionStorage[this.key]:::", sessionStorage[this.key])\n\n        if (localStorage[this.key] === undefined && sessionStorage[this.key] === undefined) {\n            return {}\n        }\n        if (localStorage[this.key]) {\n            this.state = JSON.parse(localStorage[this.key])\n        } else {\n            this.state = JSON.parse(sessionStorage[this.key])\n        }\n        console.log("state:::", this.state)\n    },\n    clearStorage() {\n\n        this.state = {\n            user: {},\n            token: "",\n            remember: false\n        }\n        localStorage.removeItem(this.key)\n        sessionStorage.removeItem(this.key)\n\n    }\n\n}\n\n\nexport default storage\n')),(0,o.yg)("h2",{id:"38\u8def\u7531\u5b88\u536b"},"3.8\u3001\u8def\u7531\u5b88\u536b"),(0,o.yg)("p",null,"\u5b8c\u6210\u4e86\u767b\u5f55\u529f\u80fd\u4ee5\u540e\uff0c\u6211\u4eec\u8981\u9632\u6b62\u7528\u6237\u7ffb\u5899\u8bbf\u95ee\u9700\u8981\u8ba4\u8bc1\u8eab\u4efd\u7684\u9875\u9762\u65f6\uff0c\u53ef\u4ee5\u57fa\u4e8evue-router\u7684\u5bfc\u822a\u5b88\u536b\u6765\u5b8c\u6210\u3002"),(0,o.yg)("p",null,"\u6ca1\u6709\u767b\u9646\u72b6\u6001\uff0c\u6ca1\u6709token\u7684\u7528\u6237\u65e0\u6cd5\u8fdb\u5165\u9879\u76ee\u7ad9\u70b9\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/router/index.js"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},'import {createRouter, createWebHistory} from \'vue-router\'\nimport storage from "../utils/storage";\n\nconst routes = [\n\n    {\n        path: \'/bingo\',\n        name: \'Base\',\n        component: () => import("../views/Base.vue"),\n        children: [\n            {\n                path: \'\',\n                meta: {\n                    title: "\u9762\u677f\u7ba1\u7406",\n                    authorization: false\n                },\n                name: \'bingo\',\n                component: () => import("../views/Bingo.vue")\n            },\n            {\n                path: \'manage/host\',\n                meta: {\n                    title: "\u4e3b\u673a\u7ba1\u7406",\n                    authorization: true\n                },\n                name: \'host\',\n                component: () => import("../views/Host.vue")\n            },\n        ]\n    },\n\n    {\n        path: \'/\',\n        meta: {\n            title: \'\u8d26\u6237\u767b\u9646\',\n            authorization: false\n        },\n        name: \'login\',\n        component: () => import("../views/Login.vue")\n    },\n]\n\nconst router = createRouter({\n    history: createWebHistory(),\n    routes\n});\n\n\nrouter.beforeEach((to, from, next) => {\n    console.log("from:", from)\n    console.log("to:", to)\n    document.title = to.meta.title\n    storage.getStorage()\n\n\n    if (to.meta.authorization && !storage.getUserInfo()) {\n        next({"name": "login"})\n    } else {\n        next()\n    }\n});\n\n\nexport default router;\n')),(0,o.yg)("p",null,"\u672c\u5730\u62ff\u5230token\u4ee5\u540e\uff0c\u6211\u4eec\u53d1\u9001\u4efb\u4f55\u9700\u8981\u767b\u5f55\u4e4b\u540e\u624d\u80fd\u53d1\u9001\u7684\u8bf7\u6c42\uff0c\u90fd\u9700\u8981\u5148\u5bf9token\u7684\u6709\u6548\u6027\u8fdb\u884c\u8ba4\u8bc1\uff0c\u7136\u540e\u5c06token\u643a\u5e26\u5230\u8bf7\u6c42\u5934\u4e2d\uff0c\u6765\u901a\u8fc7\u540e\u53f0\u63a5\u53e3\u7684 token\u7684\u6821\u9a8c\u3002"),(0,o.yg)("h2",{id:"39\u5ba2\u6237\u7aef\u6ce8\u9500\u767b\u9646"},"3.9\u3001\u5ba2\u6237\u7aef\u6ce8\u9500\u767b\u9646"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"src/views/Base.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"import storage from '../utils/storage.js'\n...\nconst logout = () => {\n  storage.clearStorage()\n  router.push(\"/login\")\n}\n")),(0,o.yg)("h1",{id:"\u56db\u8d44\u4ea7\u7ba1\u7406"},"\u56db\u3001\u8d44\u4ea7\u7ba1\u7406"),(0,o.yg)("h2",{id:"41\u4e3b\u673a\u7ba1\u7406"},"4.1\u3001\u4e3b\u673a\u7ba1\u7406"),(0,o.yg)("h3",{id:"1-\u4e3b\u673a\u524d\u7aef\u9875\u9762"},"1. \u4e3b\u673a\u524d\u7aef\u9875\u9762"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"Host.vue")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},"<template>\n  <div class=\"host\">\n\n    <div>\n      <a-button type=\"primary\" @click=\"showModal\" style=\"margin: 8px 0\">\u6dfb\u52a0\u4e3b\u673a</a-button>\n      <a-modal width=\"860px\" v-model:visible=\"visible\" title=\"Basic Modal\" @ok=\"handleOk\" @cancel=\"cancelForm\">\n\n        <a-form\n            ref=\"formRef\"\n            name=\"custom-validation\"\n            :model=\"hostForm.form\"\n            :rules=\"hostForm.rules\"\n            v-bind=\"layout\"\n            @finish=\"handleFinish\"\n            @validate=\"handleValidate\"\n            @finishFailed=\"handleFinishFailed\"\n        >\n          <a-form-item label=\"\u4e3b\u673a\u7c7b\u522b\" prop=\"zone\" name=\"category\">\n            <a-row>\n              <a-col :span=\"12\">\n                <a-select\n                    ref=\"select\"\n                    v-model:value=\"hostForm.form.category\"\n                    @change=\"handleCategorySelectChange\"\n\n                >\n                  <a-select-option :value=\"category.id\" v-for=\"category in categoryList.data\" :key=\"category.id\">\n                    {{ category.name }}\n                  </a-select-option>\n                </a-select>\n              </a-col>\n\n            </a-row>\n\n          </a-form-item>\n\n          <a-form-item has-feedback label=\"\u4e3b\u673a\u540d\u79f0\" name=\"name\">\n            <a-input v-model:value=\"hostForm.form.name\" type=\"text\" autocomplete=\"off\"/>\n          </a-form-item>\n\n\n          <a-form-item label=\"\u8fde\u63a5\u5730\u5740\" name=\"username\">\n\n            <a-row>\n              <a-col :span=\"8\">\n                <a-input placeholder=\"\u7528\u6237\u540d\" addon-before=\"ssh\" v-model:value=\"hostForm.form.username\" type=\"text\"\n                         autocomplete=\"off\"/>\n              </a-col>\n              <a-col :span=\"8\">\n                <a-input placeholder=\"ip\u5730\u5740\" addon-before=\"@\" v-model:value=\"hostForm.form.ip_addr\" type=\"text\"\n                         autocomplete=\"off\"/>\n              </a-col>\n              <a-col :span=\"8\">\n                <a-input placeholder=\"\u7aef\u53e3\u53f7\" addon-before=\"-p\" v-model:value=\"hostForm.form.port\" type=\"text\"\n                         autocomplete=\"off\"/>\n              </a-col>\n            </a-row>\n          </a-form-item>\n\n          <a-form-item has-feedback label=\"\u8fde\u63a5\u5bc6\u7801\" name=\"password\">\n            <a-input v-model:value=\"hostForm.form.password\" type=\"password\" autocomplete=\"off\"/>\n          </a-form-item>\n\n          <a-form-item has-feedback label=\"\u5907\u6ce8\u4fe1\u606f\" name=\"remark\">\n            <a-textarea placeholder=\"\u8bf7\u8f93\u5165\u4e3b\u673a\u5907\u6ce8\u4fe1\u606f\" v-model:value=\"hostForm.form.remark\" type=\"text\"\n                        :auto-size=\"{ minRows: 3, maxRows: 5 }\" autocomplete=\"off\"/>\n          </a-form-item>\n\n\n          <a-form-item :wrapper-col=\"{ span: 14, offset: 4 }\">\n            <a-button @click=\"resetForm\">Reset</a-button>\n          </a-form-item>\n        </a-form>\n\n      </a-modal>\n    </div>\n\n    <a-table bordered :data-source=\"dataSource\" :columns=\"columns\">\n      <template #bodyCell=\"{ column, text, record }\">\n        <template v-if=\"column.dataIndex === 'name'\">\n          <div class=\"editable-cell\">\n            <div v-if=\"editableData[record.key]\" class=\"editable-cell-input-wrapper\">\n              <a-input v-model:value=\"editableData[record.key].name\" @pressEnter=\"save(record.key)\"/>\n              <check-outlined class=\"editable-cell-icon-check\" @click=\"save(record.key)\"/>\n            </div>\n            <div v-else class=\"editable-cell-text-wrapper\">\n              {{ text || ' ' }}\n              <edit-outlined class=\"editable-cell-icon\" @click=\"edit(record.key)\"/>\n            </div>\n          </div>\n        </template>\n        <template v-else-if=\"column.dataIndex === 'operation_edit'\">\n\n          <a>edit</a>\n\n        </template>\n        <template v-else-if=\"column.dataIndex === 'operation_del'\">\n          <a-popconfirm\n              v-if=\"dataSource.length\"\n              title=\"Sure to delete?\"\n              @confirm=\"onDelete(record.key)\"\n          >\n            <a>Delete</a>\n          </a-popconfirm>\n        </template>\n      </template>\n    </a-table>\n  </div>\n</template>\n\n<script setup>\nimport {computed, reactive, ref} from 'vue';\nimport {CheckOutlined, EditOutlined} from '@ant-design/icons-vue';\nimport {cloneDeep} from 'lodash-es';\n\n\n// \u4e3b\u673a\u8868\u683c\nconst columns = [{\n  title: '\u7c7b\u522b',\n  dataIndex: 'category_name',\n}, {\n  title: '\u4e3b\u673a\u540d\u79f0',\n  dataIndex: 'name',\n}, {\n  title: 'IP\u5730\u5740',\n  dataIndex: 'ip_addr',\n}, {\n  title: '\u7aef\u53e3',\n  dataIndex: 'port',\n}, {\n  title: '\u5907\u6ce8',\n  dataIndex: 'remark',\n}, {\n  title: '\u7f16\u8f91',\n  dataIndex: 'operation_edit',\n}, {\n  title: '\u5220\u9664',\n  dataIndex: 'operation_del',\n}];\nconst dataSource = ref([\n  {\n    'id': 1,\n    'category_name': '\u6570\u636e\u5e93\u670d\u52a1\u5668',\n    'name': 'izbp13e05jqwodd605vm3gz',\n    'ip_addr': '47.58.131.12',\n    'port': 22,\n    'remark': ''\n  },\n  {\n    'id': 2,\n    'category_name': '\u6570\u636e\u5e93\u670d\u52a1\u5668',\n    'name': 'iZbp1a3jw4l12ho53ivhkkZ',\n    'ip_addr': '12.18.125.22',\n    'port': 22,\n    'remark': ''\n  },\n  {\n    'id': 3,\n    'category_name': '\u7f13\u5b58\u670d\u52a1\u5668',\n    'name': 'iZbp1b1xqfqw257gs563k2iZ',\n    'ip_addr': '12.19.135.130',\n    'port': 22,\n    'remark': ''\n  },\n  {\n    'id': 4,\n    'category_name': '\u7f13\u5b58\u670d\u52a1\u5668',\n    'name': 'iZbp1b1jw4l01ho53muhkkZ',\n    'ip_addr': '47.98.101.89',\n    'port': 22,\n    'remark': ''\n  }\n]);\nconst count = computed(() => dataSource.value.length + 1);\nconst editableData = reactive({});\nconst edit = key => {\n  editableData[key] = cloneDeep(dataSource.value.filter(item => key === item.key)[0]);\n};\nconst save = key => {\n  Object.assign(dataSource.value.filter(item => key === item.key)[0], editableData[key]);\n  delete editableData[key];\n};\nconst onDelete = key => {\n  dataSource.value = dataSource.value.filter(item => item.key !== key);\n};\n\n// \u6dfb\u52a0\u4e3b\u673a\nconst visible = ref(false);\nconst showModal = () => {\n  visible.value = true;\n};\nconst handleOk = e => {\n  resetForm()\n  visible.value = false;\n};\n\nconst cancelForm = e => {\n  resetForm()\n  visible.value = false;\n};\nconst hostForm = reactive({\n  labelCol: {span: 6},\n  wrapperCol: {span: 14},\n  other: '',\n  form: {\n    name: '',\n    category: \"\",\n    ip_addr: '',\n    username: '',\n    port: '',\n    remark: '',\n    password: ''\n  },\n  rules: {\n    name: [\n      {required: true, message: '\u8bf7\u8f93\u5165\u4e3b\u673a\u540d\u79f0', trigger: 'blur'},\n      {min: 3, max: 30, message: '\u957f\u5ea6\u57283-10\u4f4d\u4e4b\u95f4', trigger: 'blur'}\n    ],\n    password: [\n      {required: true, message: '\u8bf7\u8f93\u5165\u8fde\u63a5\u5bc6\u7801', trigger: 'blur'},\n      {min: 3, max: 30, message: '\u957f\u5ea6\u57283-10\u4f4d\u4e4b\u95f4', trigger: 'blur'}\n    ],\n    category: [\n      {required: true, message: '\u8bf7\u9009\u62e9\u7c7b\u522b', trigger: 'change'}\n    ],\n    username: [\n      {required: true, message: '\u8bf7\u8f93\u5165\u7528\u6237\u540d', trigger: 'blur'},\n      {min: 3, max: 30, message: '\u957f\u5ea6\u57283-10\u4f4d', trigger: 'blur'}\n    ],\n    ip_addr: [\n      {required: true, message: '\u8bf7\u8f93\u5165\u8fde\u63a5\u5730\u5740', trigger: 'blur'},\n      {max: 30, message: '\u957f\u5ea6\u6700\u592715\u4f4d', trigger: 'blur'}\n    ],\n    port: [\n      {required: true, message: '\u8bf7\u8f93\u5165\u7aef\u53e3\u53f7', trigger: 'blur'},\n      {max: 5, message: '\u957f\u5ea6\u6700\u59275\u4f4d', trigger: 'blur'}\n    ]\n  }\n});\nconst formRef = ref();\nconst layout = {\n  labelCol: {\n    span: 4,\n  },\n  wrapperCol: {\n    span: 24,\n  },\n};\nconst handleFinish = values => {\n  console.log(values, hostForm);\n};\n\nconst handleFinishFailed = errors => {\n  console.log(errors);\n};\n\nconst resetForm = () => {\n  formRef.value.resetFields();\n};\n\nconst handleValidate = (...args) => {\n  console.log(args);\n};\nconst categoryList = reactive({\n  data: []\n})\n<\/script>\n\n<style scoped>\n\n</style>\n")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910075648592-4303811.png",alt:"image-20230910075648592"})),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910075737013-4303858.png",alt:"image-20230910075737013"})),(0,o.yg)("h3",{id:"2-\u4e3b\u673a\u6a21\u578b"},"2. \u4e3b\u673a\u6a21\u578b"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/model/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package model\n\nimport (\n    "github.com/jinzhu/gorm"\n    . "bingo_api/application/database"\n)\n\n/**\n\u4e3b\u673a\u7c7b\u522b\u5b9e\u4f53\n*/\n\ntype HostCategory struct {\n    gorm.Model\n    // \u552f\u4e00\u7d22\u5f15 unique_index\n    Name string `json:"name" gorm:"type:varchar(255); unique_index"`\n}\n\ntype HostCategoryInstance struct {\n    ID   uint   `json:"id"`\n    Name string `json:"name"`\n}\n\n/**\n\u8bbe\u7f6e\u8868\u540d\n*/\n\nfunc (category HostCategory) TableName() string {\n    return "host_category"\n}\n\n/**\n\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b\n*/\n\nfunc (category *HostCategory) Insert() error {\n    err := Orm.Create(&category).Error\n    return err\n}\n\n/**\n\u83b7\u53d6\u4e3b\u673a\u5206\u7c7b\u5217\u8868\n*/\n\nfunc (category HostCategory) GetAll() ([]HostCategoryInstance, error) {\n    var categories []HostCategoryInstance\n    err := Orm.Table(category.TableName()).Order(" id DESC ").Select("id, name").Scan(&categories).Error\n    return categories, err\n}\n\n/**\n\u6839\u636e\u6307\u5b9aID\u83b7\u53d6\u4e3b\u673a\u7c7b\u522b\n*/\n\nfunc (category *HostCategory) GetOneById(id uint) error {\n    err := Orm.First(&category, id).Error\n    return err\n}\n\n/**\n\u4e3b\u673a\u4fe1\u606f\u6a21\u578b\n*/\n\ntype Host struct {\n    gorm.Model\n    Name           string       `json:"name" gorm:"type:varchar(255)"`\n    IpAddr         string       `json:"ip_addr" gorm:"type:varchar(255)"`\n    Port           uint         `json:"port" gorm:"type:int"`\n    Username       string       `json:"username" gorm:"varchar(255)"`\n    Password       string       `json:"password,omitempty" gorm:"varchar(255)"`\n    Remark         string       `json:"remark,omitempty" gorm:"varchar(255)"`\n    HostCategoryID uint         `json:"host_category_id"`\n    HostCategory   HostCategory `json:"host_category"  gorm:"foreignKey:HostCategoryID;references:ID"`\n}\n\ntype HostInstance struct {\n    ID           uint   `json:"id"`\n    Name         string `json:"name"`\n    IpAddr       string `json:"ip_addr"`\n    Port         uint   `json:"port"`\n    Username     string `json:"username"`\n    CategoryID   uint   `json:"category_id"`\n    CategoryName string `json:"category_name"`\n    Remark       string `json:"remark"`\n}\n\n/**\n\u8bbe\u7f6e\u8868\u540d\n*/\n\nfunc (host Host) TableName() string {\n    return "host_info"\n}\n\n/**\n\u6dfb\u52a0\u4e3b\u673a\n*/\n\nfunc (host *Host) Insert() error {\n    err := Orm.Create(&host).Error\n    return err\n}\n\n/**\n\u83b7\u53d6\u6240\u6709\u4e3b\u673a\u5217\u8868\n*/\n\nfunc (host Host) GetAll(name string, hostCategoryId uint, IpAddr string) ([]Host, error) {\n    var hosts []Host\n    query := Orm.Table(host.TableName())\n    if name != "" {\n        query = query.Where(" name LIKE ? ", "%"+name+"%")\n    }\n    if hostCategoryId > 0 {\n        query = query.Where(" host_category_id = ? ", hostCategoryId)\n    }\n    if IpAddr != "" {\n        query = query.Where(" ip_addr LIKE ? ", "%"+IpAddr+"%")\n    }\n\n    err := query.Order(" id DESC ").Preload("HostCategory").Find(&hosts).Error\n    return hosts, err\n}\n\n/**\n\u6839\u636e\u6307\u5b9aID\u83b7\u53d6\u4e3b\u673a\n*/\n\nfunc (host *Host) GetOneById(id uint) error {\n    err := Orm.First(&host, id).Error\n    return err\n}\n\n/**\n\u5220\u9664\u4e3b\u673a\n*/\n\nfunc (host *Host) Delete() (err error) {\n    err = Orm.Delete(&host).Error\n    return err\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/main.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"func main() {\n    // ... \u4ee3\u7801\u7701\u7565\n    // ... \u4ee3\u7801\u7701\u7565\n  \n    // \u6570\u636e\u8fc1\u79fb\n    Orm.AutoMigrate(&model.User{})\n    Orm.AutoMigrate(&model.Host{})\n    Orm.AutoMigrate(&model.HostCategory{})\n\n    // ... \u4ee3\u7801\u7701\u7565\n    // ... \u4ee3\u7801\u7701\u7565\n}\n")),(0,o.yg)("p",null,"\u9879\u76ee\u91cd\u542f\u540e\uff0c\u9879\u76ee\u5c31\u4f1a\u81ea\u52a8\u65b0\u751f\u6210\u4e3b\u673a\u8868\u548c\u4e3b\u673a\u5206\u7c7b\u8868\u3002"),(0,o.yg)("h3",{id:"3\u4e3b\u673a\u76f8\u5173api\u5f00\u53d1"},"3\u3001\u4e3b\u673a\u76f8\u5173API\u5f00\u53d1"),(0,o.yg)("h4",{id:"1\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b"},"\u30101\u3011\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/services/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-golang"},'package services\n\nimport (\n    "github.com/gin-gonic/gin"\n    . "bingo_api/application/model"\n    "bingo_api/application/validator"\n)\n\n/**\n\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b\n*/\n\nfunc CreateHostCategory(ctx *gin.Context) (HostCategoryInstance, error) {\n    hostCategory := HostCategory{}\n    var instance HostCategoryInstance\n    var err error\n    if err = ctx.ShouldBindJSON(&hostCategory); err != nil {\n        return instance, err\n    }\n    if err = validator.HostCategoryValidator(&hostCategory); err != nil {\n        return instance, err\n    }\n    err = hostCategory.Insert()\n    instance = HostCategoryInstance{\n        ID:   hostCategory.ID,\n        Name: hostCategory.Name,\n    }\n    return instance, err\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/validator/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-golang"},'package validator\n\nimport (\n    "errors"\n    "github.com/go-playground/validator/v10"\n    . "bingo_api/application/model"\n    . "bingo_api/application/utils"\n)\n\n/**\n\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b\u7684\u9a8c\u8bc1\u5668\n*/\n\nfunc HostCategoryValidator(hostCategory *HostCategory) error {\n    validate, trans := GenValidate()\n    err := validate.Struct(hostCategory)\n    if err != nil {\n        for _, err := range err.(validator.ValidationErrors) {\n            return errors.New(err.Translate(trans))\n        }\n    }\n    return nil\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/api/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-golang"},'package api\n\nimport (\n    "github.com/gin-gonic/gin"\n    "net/http"\n    "bingo_api/application/constants"\n    "bingo_api/application/model"\n    . "bingo_api/application/services"\n)\n\n/**\n\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b\n*/\n\nfunc HostCategoryCreate(ctx *gin.Context) {\n    hostCategory, err := CreateHostCategory(ctx)\n    if err != nil || hostCategory.ID < 1 {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeCreateHostCategoryFail,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusOK, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n        "data": map[string]model.HostCategoryInstance{\n            "hostCategory": hostCategory,\n        },\n    })\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/constants/code.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"CodeCreateHostCategoryFail = 1010 // \u521b\u5efa\u4e3b\u673a\u7c7b\u522b\u5931\u8d25\uff01\nCodeGetHostCategoryFail    = 1011 // \u65e0\u6cd5\u83b7\u53d6\u4e3b\u673a\u7c7b\u522b\u5217\u8868\uff01\nCodeCreateHostFail         = 1012 // \u6dfb\u52a0\u4e3b\u673a\u4fe1\u606f\u5931\u8d25\uff01\nCodeHostCategoryNotExist   = 1013 // \u4e3b\u673a\u7c7b\u522b\u4e0d\u5b58\u5728\uff01\nCodeGetHostFail            = 1014 // \u65e0\u6cd5\u83b7\u53d6\u4e3b\u673a\u5217\u8868\n")),(0,o.yg)("p",null,"\u8bbe\u8ba1\u4e3b\u673a\u5e94\u7528\u8def\u7531\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/router/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-golang"},'package router\n\nimport (\n    "github.com/gin-gonic/gin"\n    "bingo_api/application/api"\n    "bingo_api/application/middleware"\n    "bingo_api/application/utils"\n)\n\nfunc InitHostRouter(Router *gin.RouterGroup) {\n    /**\n    \u4e3b\u673a\u76f8\u5173\u7684\u8def\u7531\u7ec4\n    */\n    HostRouter := Router.Group("host")\n\n    {\n        // \u4e3b\u673a\u7c7b\u522b-\u6dfb\u52a0\n        utils.Register(HostRouter, []string{"POST"}, "category", middleware.JWTAuthorization(), api.HostCategoryCreate)\n    }\n}\n\n')),(0,o.yg)("p",null,"\u6ce8\u518c\u4e3b\u673a\u5e94\u7528\u8def\u7531 ",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/initialize/router.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-golang"},'package initialize\n\nimport (\n    "github.com/gin-gonic/gin"\n    "go.uber.org/zap"\n    "bingo_api/application/middleware"\n    "bingo_api/application/router"\n)\n\nfunc InitRouter() *gin.Engine {\n    // 1. \u521b\u5efa\u8def\u7531\n    Router := gin.Default()\n    Router.Use(middleware.GinLogger(), middleware.GinRecovery(true))\n    Router.Use(middleware.ExceptionMiddleware)\n    Router.Use(middleware.CORS)\n    // 2. Api\u8def\u7531\u5206\u7ec4\n    ApiGroup := Router.Group("/api")\n    // 3. \u521d\u59cb\u5316\u7528\u6237\u76f8\u5173\u8def\u7531\n    router.InitUserRouter(ApiGroup)\n    router.InitHostRouter(ApiGroup)\n    zap.S().Info("\u8def\u7531\u521d\u59cb\u5316\u5b8c\u6210....")\n    return Router\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910075834197-4303915.png",alt:"image-20230910075834197"})),(0,o.yg)("h4",{id:"2\u67e5\u770b\u4e3b\u673a\u7c7b\u522b"},"\u30102\u3011\u67e5\u770b\u4e3b\u673a\u7c7b\u522b"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/services/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-golang"},"/**\n\u83b7\u53d6\u4e3b\u673a\u7c7b\u522b\u5217\u8868\n*/\n\nfunc GetHostCategoryList(ctx *gin.Context) ([]HostCategoryInstance, error){\n    hostCategory := HostCategory{}\n    hostCategoryList, err := hostCategory.GetAll()\n    return hostCategoryList, err\n}\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/api/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-golang",metastring:"l",l:!0},'/**\n\u83b7\u53d6\u6240\u6709\u4e3b\u673a\u7c7b\u522b\n*/\n\nfunc HostCategoryList(ctx *gin.Context){\n    // \u8c03\u7528\u4e1a\u52a1\u5c42\u83b7\u53d6\u4e3b\u673a\u7c7b\u522b\u5217\u8868\n    hostCategoryList, err := GetHostCategoryList(ctx)\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeGetHostCategoryFail,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusOK, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n        "data": map[string]interface{}{\n            "host_category_list": hostCategoryList,\n        },\n    })\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/router/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package router\n\nimport (\n    "github.com/gin-gonic/gin"\n    "bingo_api/application/api"\n    "bingo_api/application/middleware"\n    "bingo_api/application/utils"\n)\n\nfunc InitHostRouter(Router *gin.RouterGroup) {\n    /**\n    \u4e3b\u673a\u76f8\u5173\u7684\u8def\u7531\u7ec4\n    */\n    HostRouter := Router.Group("host")\n\n    {\n        // \u4e3b\u673a\u7c7b\u522b-\u6dfb\u52a0\n        utils.Register(HostRouter, []string{"POST"}, "category", middleware.JWTAuthorization(), api.HostCategoryCreate)\n        // \u4e3b\u673a\u7c7b\u522b-\u67e5\u770b\n        utils.Register(HostRouter, []string{"GET"}, "category", middleware.JWTAuthorization(), api.HostCategoryList)\n    }\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910080028512-4304029.png",alt:"image-20230910080028512"})),(0,o.yg)("h4",{id:"3\u6dfb\u52a0\u4e3b\u673a"},"\u30103\u3011\u6dfb\u52a0\u4e3b\u673a"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/services/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"/**\n\u6dfb\u52a0\u4e3b\u673a\n*/\n\nfunc CreateHost(ctx *gin.Context) (HostInstance, error){\n    host := Host{}\n    var err error\n    var instance HostInstance\n    var hostCategory HostCategory\n    if err = ctx.ShouldBindJSON(&host) ;err !=nil {\n        return instance, err\n    }\n\n    if err = validator.HostValidator(&host); err != nil {\n        return instance, err\n    }\n\n    err = host.Insert()\n    if err != nil {\n        return instance, err\n    }\n\n    err = hostCategory.GetOneById(host.HostCategoryID)\n    if err != nil {\n        return instance, err\n    }\n\n    instance = HostInstance{\n        ID:               host.ID,\n        Name:             host.Name,\n        IpAddr:           host.IpAddr,\n        Port:             host.Port,\n        Username:         host.Username,\n        Remark:           host.Remark,\n        CategoryID:       host.HostCategoryID,\n        CategoryName:     hostCategory.Name,\n    }\n    return instance, err\n}\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/validator/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"/**\n\u6dfb\u52a0\u4e3b\u673a\u7684\u9a8c\u8bc1\u5668\n*/\n\nfunc HostValidator(host *Host) error {\n    validate, trans := GenValidate()\n    err := validate.Struct(host)\n    if err != nil {\n        for _, err := range err.(validator.ValidationErrors) {\n            return errors.New(err.Translate(trans))\n        }\n    }\n\n    if host.HostCategoryID < 1 {\n        return errors.New(constants.HostCategoryNotExist)\n    }\n\n    var hostCategory HostCategory\n    err = hostCategory.GetOneById(host.HostCategoryID)\n    if err != nil {\n        return errors.New(constants.HostCategoryNotExist)\n    }\n\n    return nil\n}\n\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/constants/message.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},'HostCategoryNotExist = "\u4e3b\u673a\u7c7b\u522b\u4e0d\u5b58\u5728\uff01"\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/api/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'/**\n\u6dfb\u52a0\u4e3b\u673a\n*/\n\nfunc HostCreate(ctx *gin.Context){\n    // \u8c03\u7528\u4e1a\u52a1\u5c42\u521b\u5efa\u4e3b\u673a\u4fe1\u606f\n    host, err := CreateHost(ctx)\n    if err != nil || host.ID < 1 {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeCreateHostFail,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusOK, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n        "data": map[string]interface{}{\n            "host": host,\n        },\n    })\n}\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/router/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package router\n\nimport (\n    "github.com/gin-gonic/gin"\n    "bingo_api/application/api"\n    "bingo_api/application/middleware"\n    "bingo_api/application/utils"\n)\n\nfunc InitHostRouter(Router *gin.RouterGroup) {\n    /**\n    \u4e3b\u673a\u76f8\u5173\u7684\u8def\u7531\u7ec4\n    */\n    HostRouter := Router.Group("host")\n\n    {\n        // \u4e3b\u673a\u7c7b\u522b-\u6dfb\u52a0\n        utils.Register(HostRouter, []string{"POST"}, "category", middleware.JWTAuthorization(), api.HostCategoryCreate)\n        // \u4e3b\u673a\u7c7b\u522b-\u67e5\u770b\n        utils.Register(HostRouter, []string{"GET"}, "category", middleware.JWTAuthorization(), api.HostCategoryList)\n        // \u4e3b\u673a\u4fe1\u606f-\u6dfb\u52a0\n        utils.Register(HostRouter, []string{"POST"}, "", middleware.JWTAuthorization(), api.HostCreate)\n    }\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910080007204-4304008.png",alt:"image-20230910080007204"})),(0,o.yg)("h4",{id:"4\u67e5\u770b\u4e3b\u673a"},"\u30104\u3011\u67e5\u770b\u4e3b\u673a"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/services/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"/**\n\u83b7\u53d6\u4e3b\u673a\u5217\u8868\u4fe1\u606f\n*/\n\nfunc GetHostList(name string, hostCategoryId uint, hostname string) ([]HostInstance, error) {\n    var hostList []Host\n    var instanceList []HostInstance\n    var host Host\n    var err error\n    hostList, err = host.GetAll(name, uint(hostCategoryId), hostname)\n    for _, hostItem := range hostList {\n        instanceList = append(instanceList, HostInstance{\n            ID:           hostItem.ID,\n            Name:         hostItem.Name,\n            IpAddr:       hostItem.IpAddr,\n            Port:         hostItem.Port,\n            Username:     hostItem.Username,\n            CategoryID:   hostItem.HostCategory.ID,\n            CategoryName: hostItem.HostCategory.Name,\n            Remark:       hostItem.Remark,\n        })\n    }\n    return instanceList, err\n}\n\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/api/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'/**\n \u4e3b\u673a\u5217\u8868\n */\n\nfunc HostList(ctx *gin.Context){\n    // \u63a5\u53d7\u53c2\u6570\n    name, _ := ctx.GetQuery("name")\n    hostname, _ := ctx.GetQuery("host")\n    hostCategoryId, _ := strconv.Atoi(ctx.Query("host_category_id"))\n    hostList, err := GetHostList(name, uint(hostCategoryId), hostname)\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeGetHostFail,\n            "message": err.Error(),\n        })\n        return\n    }\n    ctx.JSON(http.StatusOK, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n        "data": map[string]interface{}{\n            "host_list": hostList,\n        },\n    })\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/router/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package router\n\nimport (\n    "github.com/gin-gonic/gin"\n    "bingo_api/application/api"\n    "bingo_api/application/middleware"\n    "bingo_api/application/utils"\n)\n\nfunc InitHostRouter(Router *gin.RouterGroup) {\n    /**\n    \u4e3b\u673a\u76f8\u5173\u7684\u8def\u7531\u7ec4\n    */\n    HostRouter := Router.Group("host")\n\n    {\n        // \u4e3b\u673a\u7c7b\u522b-\u6dfb\u52a0\n        utils.Register(HostRouter, []string{"POST"}, "category", middleware.JWTAuthorization(), api.HostCategoryCreate)\n        // \u4e3b\u673a\u7c7b\u522b-\u67e5\u770b\n        utils.Register(HostRouter, []string{"GET"}, "category", middleware.JWTAuthorization(), api.HostCategoryList)\n        // \u4e3b\u673a\u4fe1\u606f-\u6dfb\u52a0\n        utils.Register(HostRouter, []string{"POST"}, "", middleware.JWTAuthorization(), api.HostCreate)\n        // \u4e3b\u673a - \u5217\u8868\n        utils.Register(HostRouter, []string{"GET"}, "", middleware.JWTAuthorization(), api.HostList)\n    }\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910080059356-4304060.png",alt:"image-20230910080059356"})),(0,o.yg)("p",null," \u67e5\u770b\u4e3b\u673a\u5217\u8868\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'{\n    "code": 0,\n    "data": {\n        "host_list": [\n            {\n                "id": 8,\n                "name": "izbp13e05jqwodd605vm3gz",\n                "ip_addr": "47.58.131.12",\n                "port": 22,\n                "username": "root",\n                "category_id": 1,\n                "category_name": "\u6d4b\u8bd5\u670d\u52a1\u5668",\n                "remark": "remark..."\n            },\n            {\n                "id": 2,\n                "name": "iZbp1b1jw4l01ho53muhkkZ",\n                "ip_addr": "47.98.101.89",\n                "port": 22,\n                "username": "root",\n                "category_id": 1,\n                "category_name": "\u6d4b\u8bd5\u670d\u52a1\u5668",\n                "remark": "remark..."\n            },\n            {\n                "id": 1,\n                "name": "iZbp1b1xqfqw257gs563k2iZ",\n                "ip_addr": "12.19.135.130",\n                "port": 22,\n                "username": "root",\n                "category_id": 2,\n                "category_name": "\u6570\u636e\u5e93\u670d\u52a1\u5668",\n                "remark": "remark..."\n            }\n        ]\n    },\n    "message": "\u6210\u529f\uff01"\n}\n')),(0,o.yg)("h4",{id:"5\u5220\u9664\u4e3b\u673a\u63a5\u53e3"},"\u30105\u3011\u5220\u9664\u4e3b\u673a\u63a5\u53e3"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/services/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"/**\n\u5220\u9664\u4e3b\u673a\u5217\u8868\u4fe1\u606f\n*/\n\nfunc DeleteHost(hostId uint) (HostInstance, error) {\n    var delHost Host\n    var instance HostInstance\n\n    err := delHost.GetOneById(hostId)\n    if err != nil {\n        return instance, err\n    }\n    err = delHost.Delete()\n    if err != nil {\n        return instance, err\n    }\n\n    instance = HostInstance{\n        Name:       delHost.Name,\n        IpAddr:     delHost.IpAddr,\n        Port:       delHost.Port,\n        Username:   delHost.Username,\n        Remark:     delHost.Remark,\n        CategoryID: delHost.HostCategoryID,\n    }\n\n    return instance, err\n}\n\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/api/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'/*\n\u5220\u9664\u4e3b\u673a\n*/\n\nfunc HostDelete(ctx *gin.Context) {\n    // \u63a5\u53d7\u53c2\u6570\n    idStr, _ := ctx.GetQuery("id")\n    delId, _ := strconv.Atoi(idStr)\n    host, err := DeleteHost(uint(delId))\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeDelHostFail,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusOK, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n        "data": map[string]interface{}{\n            "delete_host": host,\n        },\n    })\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/application/router/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'// \u4e3b\u673a - \u5220\u9664\nutils.Register(HostRouter, []string{"DELETE"}, "", middleware.JWTAuthorization(), api.HostDelete)\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910080131346-4304093.png",alt:"image-20230910080131346"})),(0,o.yg)("h3",{id:"4\u5ba2\u6237\u7aef\u4e0eapi\u8054\u8c03"},"4\u3001\u5ba2\u6237\u7aef\u4e0eapi\u8054\u8c03"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"Host.vue")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="host">\n\n    <div>\n      <a-button type="primary" @click="showModal" style="margin: 8px 0">\u6dfb\u52a0\u4e3b\u673a</a-button>\n      <a-modal width="860px" v-model:visible="visible" title="Basic Modal" @ok="handleOk" @cancel="cancelForm">\n\n        <a-form\n            ref="formRef"\n            name="custom-validation"\n            :model="hostForm.form"\n            :rules="hostForm.rules"\n            v-bind="layout"\n            @finish="handleFinish"\n            @validate="handleValidate"\n            @finishFailed="handleFinishFailed"\n        >\n          <a-form-item label="\u4e3b\u673a\u7c7b\u522b" prop="zone" name="category">\n            <a-row>\n              <a-col :span="12">\n                <a-select\n                    ref="select"\n                    v-model:value="hostForm.form.category"\n                    @change="handleCategorySelectChange"\n\n                >\n                  <a-select-option :value="category.id" v-for="category in categoryList.data" :key="category.id">\n                    {{ category.name }}\n                  </a-select-option>\n                </a-select>\n              </a-col>\n\n            </a-row>\n\n          </a-form-item>\n\n          <a-form-item has-feedback label="\u4e3b\u673a\u540d\u79f0" name="name">\n            <a-input v-model:value="hostForm.form.name" type="text" autocomplete="off"/>\n          </a-form-item>\n\n\n          <a-form-item label="\u8fde\u63a5\u5730\u5740" name="username">\n\n            <a-row>\n              <a-col :span="8">\n                <a-input placeholder="\u7528\u6237\u540d" addon-before="ssh" v-model:value="hostForm.form.username" type="text"\n                         autocomplete="off"/>\n              </a-col>\n              <a-col :span="8">\n                <a-input placeholder="ip\u5730\u5740" addon-before="@" v-model:value="hostForm.form.ip_addr" type="text"\n                         autocomplete="off"/>\n              </a-col>\n              <a-col :span="8">\n                <a-input placeholder="\u7aef\u53e3\u53f7" addon-before="-p" v-model:value="hostForm.form.port" type="text"\n                         autocomplete="off"/>\n              </a-col>\n            </a-row>\n          </a-form-item>\n\n          <a-form-item has-feedback label="\u8fde\u63a5\u5bc6\u7801" name="password">\n            <a-input v-model:value="hostForm.form.password" type="password" autocomplete="off"/>\n          </a-form-item>\n\n          <a-form-item has-feedback label="\u5907\u6ce8\u4fe1\u606f" name="remark">\n            <a-textarea placeholder="\u8bf7\u8f93\u5165\u4e3b\u673a\u5907\u6ce8\u4fe1\u606f" v-model:value="hostForm.form.remark" type="text"\n                        :auto-size="{ minRows: 3, maxRows: 5 }" autocomplete="off"/>\n          </a-form-item>\n\n\n          <a-form-item :wrapper-col="{ span: 14, offset: 4 }">\n            <a-button @click="resetForm">Reset</a-button>\n          </a-form-item>\n        </a-form>\n\n      </a-modal>\n    </div>\n\n    <a-table bordered :data-source="dataSource" :columns="columns">\n      <template #bodyCell="{ column, text, record }">\n        <template v-if="column.dataIndex === \'name\'">\n          <div class="editable-cell">\n            <div v-if="editableData[record.key]" class="editable-cell-input-wrapper">\n              <a-input v-model:value="editableData[record.key].name" @pressEnter="save(record.key)"/>\n              <check-outlined class="editable-cell-icon-check" @click="save(record.key)"/>\n            </div>\n            <div v-else class="editable-cell-text-wrapper">\n              {{ text || \' \' }}\n              <edit-outlined class="editable-cell-icon" @click="edit(record.key)"/>\n            </div>\n          </div>\n        </template>\n        <template v-else-if="column.dataIndex === \'operation_edit\'">\n\n          <a>edit</a>\n\n        </template>\n        <template v-else-if="column.dataIndex === \'operation_del\'">\n          <a-popconfirm\n              v-if="dataSource.length"\n              title="Sure to delete?"\n              @confirm="onDelete(record.key)"\n          >\n            <a>Delete</a>\n          </a-popconfirm>\n        </template>\n      </template>\n    </a-table>\n  </div>\n</template>\n\n<script setup>\nimport {computed, reactive, ref,onMounted} from \'vue\';\nimport {CheckOutlined, EditOutlined} from \'@ant-design/icons-vue\';\nimport {cloneDeep} from \'lodash-es\';\nimport http from "../http/index.js";\n\n// \u4e3b\u673a\u8868\u683c\nconst columns = [{\n  title: \'\u7c7b\u522b\',\n  dataIndex: \'category_name\',\n}, {\n  title: \'\u4e3b\u673a\u540d\u79f0\',\n  dataIndex: \'name\',\n}, {\n  title: \'IP\u5730\u5740\',\n  dataIndex: \'ip_addr\',\n}, {\n  title: \'\u7aef\u53e3\',\n  dataIndex: \'port\',\n}, {\n  title: \'\u5907\u6ce8\',\n  dataIndex: \'remark\',\n}, {\n  title: \'\u7f16\u8f91\',\n  dataIndex: \'operation_edit\',\n}, {\n  title: \'\u5220\u9664\',\n  dataIndex: \'operation_del\',\n}];\nconst dataSource = ref([\n  {\n    \'id\': 1,\n    \'category_name\': \'\u6570\u636e\u5e93\u670d\u52a1\u5668\',\n    \'name\': \'izbp13e05jqwodd605vm3gz\',\n    \'ip_addr\': \'47.58.131.12\',\n    \'port\': 22,\n    \'remark\': \'\'\n  },\n  {\n    \'id\': 2,\n    \'category_name\': \'\u6570\u636e\u5e93\u670d\u52a1\u5668\',\n    \'name\': \'iZbp1a3jw4l12ho53ivhkkZ\',\n    \'ip_addr\': \'12.18.125.22\',\n    \'port\': 22,\n    \'remark\': \'\'\n  },\n  {\n    \'id\': 3,\n    \'category_name\': \'\u7f13\u5b58\u670d\u52a1\u5668\',\n    \'name\': \'iZbp1b1xqfqw257gs563k2iZ\',\n    \'ip_addr\': \'12.19.135.130\',\n    \'port\': 22,\n    \'remark\': \'\'\n  },\n  {\n    \'id\': 4,\n    \'category_name\': \'\u7f13\u5b58\u670d\u52a1\u5668\',\n    \'name\': \'iZbp1b1jw4l01ho53muhkkZ\',\n    \'ip_addr\': \'47.98.101.89\',\n    \'port\': 22,\n    \'remark\': \'\'\n  }\n]);\nconst count = computed(() => dataSource.value.length + 1);\nconst editableData = reactive({});\nconst edit = key => {\n  editableData[key] = cloneDeep(dataSource.value.filter(item => key === item.key)[0]);\n};\nconst save = key => {\n  Object.assign(dataSource.value.filter(item => key === item.key)[0], editableData[key]);\n  delete editableData[key];\n};\nconst onDelete = key => {\n  dataSource.value = dataSource.value.filter(item => item.key !== key);\n};\n\n// \u6dfb\u52a0\u4e3b\u673a\nconst visible = ref(false);\nconst showModal = () => {\n  visible.value = true;\n};\nconst handleOk = e => {\n  resetForm()\n  visible.value = false;\n};\n\nconst cancelForm = e => {\n  resetForm()\n  visible.value = false;\n};\nconst hostForm = reactive({\n  labelCol: {span: 6},\n  wrapperCol: {span: 14},\n  other: \'\',\n  form: {\n    name: \'\',\n    category: "",\n    ip_addr: \'\',\n    username: \'\',\n    port: \'\',\n    remark: \'\',\n    password: \'\'\n  },\n  rules: {\n    name: [\n      {required: true, message: \'\u8bf7\u8f93\u5165\u4e3b\u673a\u540d\u79f0\', trigger: \'blur\'},\n      {min: 3, max: 30, message: \'\u957f\u5ea6\u57283-10\u4f4d\u4e4b\u95f4\', trigger: \'blur\'}\n    ],\n    password: [\n      {required: true, message: \'\u8bf7\u8f93\u5165\u8fde\u63a5\u5bc6\u7801\', trigger: \'blur\'},\n      {min: 3, max: 30, message: \'\u957f\u5ea6\u57283-10\u4f4d\u4e4b\u95f4\', trigger: \'blur\'}\n    ],\n    category: [\n      {required: true, message: \'\u8bf7\u9009\u62e9\u7c7b\u522b\', trigger: \'change\'}\n    ],\n    username: [\n      {required: true, message: \'\u8bf7\u8f93\u5165\u7528\u6237\u540d\', trigger: \'blur\'},\n      {min: 3, max: 30, message: \'\u957f\u5ea6\u57283-10\u4f4d\', trigger: \'blur\'}\n    ],\n    ip_addr: [\n      {required: true, message: \'\u8bf7\u8f93\u5165\u8fde\u63a5\u5730\u5740\', trigger: \'blur\'},\n      {max: 30, message: \'\u957f\u5ea6\u6700\u592715\u4f4d\', trigger: \'blur\'}\n    ],\n    port: [\n      {required: true, message: \'\u8bf7\u8f93\u5165\u7aef\u53e3\u53f7\', trigger: \'blur\'},\n      {max: 5, message: \'\u957f\u5ea6\u6700\u59275\u4f4d\', trigger: \'blur\'}\n    ]\n  }\n});\nconst formRef = ref();\nconst layout = {\n  labelCol: {\n    span: 4,\n  },\n  wrapperCol: {\n    span: 24,\n  },\n};\nconst handleFinish = values => {\n  console.log(values, hostForm);\n};\n\nconst handleFinishFailed = errors => {\n  console.log(errors);\n};\n\nconst resetForm = () => {\n  formRef.value.resetFields();\n};\n\nconst handleValidate = (...args) => {\n  console.log(args);\n};\nconst categoryList = reactive({\n  data: []\n})\n\n// \u524d\u540e\u7aef\u8054\u8c03\n\n// \u67e5\u770b\u4e3b\u673a\u5217\u8868\nconst getHostList = () => {\n  http.get("/host").then((res) => {\n    console.log("host_list:::", res)\n    dataSource.value = res.data.data.host_list\n  })\n}\n// \u67e5\u770b\u4e3b\u673a\u7c7b\u522b\u5217\u8868\nconst getHostCategory = () => {\n  http.get("/host/category").then((res) => {\n    console.log("host_category_list:::", res)\n    categoryList.data = res.data.data.host_category_list\n  })\n}\n\n\nonMounted(function (){\n   // ajax\u8bf7\u6c42\uff1a\u83b7\u53d6\u540e\u7aef\u7684\u4e3b\u673a\u5217\u8868\n   getHostList()\n\n   // ajax\uff1a\u83b7\u53d6\u4e3b\u673a\u7c7b\u522b\u5217\u8868\n  getHostCategory()\n\n})\n\n<\/script>\n\n<style scoped>\n\n</style>\n')),(0,o.yg)("p",null,"\u56e0\u4e3a\u540e\u7aef\u63a5\u53e3\u8bbe\u7f6e\u4e86token\u8ba4\u8bc1\uff0c\u6240\u4ee5\u5728\u53d1\u8bf7\u6c42\u65f6\u9700\u8981\u643a\u5e26token\uff0c\u4e3a\u4e86\u65b9\u4fbf\u5904\u7406\uff0c\u653e\u7f6e\u5728axios\u8bf7\u6c42\u62e6\u622a\u5668\u4e2d\uff0c\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"utils/http.js"),"\u4e2d\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},'import axios from "axios"\nimport storage from "@/utils/storage";\n\nconst http = axios.create({\n    // timeout: 2500,                          // \u8bf7\u6c42\u8d85\u65f6\uff0c\u6709\u5927\u6587\u4ef6\u4e0a\u4f20\u9700\u8981\u5173\u95ed\u8fd9\u4e2a\u914d\u7f6e\n    baseURL: "http://api.bingo.cn:8080/api",     // \u8bbe\u7f6eapi\u670d\u52a1\u7aef\u7684\u9ed8\u8ba4\u5730\u5740[\u5982\u679c\u57fa\u4e8e\u670d\u52a1\u7aef\u5b9e\u73b0\u7684\u8de8\u57df\uff0c\u8fd9\u91cc\u53ef\u4ee5\u586b\u5199api\u670d\u52a1\u7aef\u7684\u5730\u5740\uff0c\u5982\u679c\u57fa\u4e8enodejs\u5ba2\u6237\u7aef\u6d4b\u8bd5\u670d\u52a1\u5668\u5b9e\u73b0\u7684\u8de8\u57df\uff0c\u5219\u8fd9\u91cc\u4e0d\u80fd\u586b\u5199api\u670d\u52a1\u7aef\u5730\u5740]\n    withCredentials: false,                    // \u662f\u5426\u5141\u8bb8\u5ba2\u6237\u7aefajax\u8bf7\u6c42\u65f6\u643a\u5e26cookie\n})\n\n// \u8bf7\u6c42\u62e6\u622a\u5668\nhttp.interceptors.request.use((config) => {\n    console.log("http\u8bf7\u6c42\u4e4b\u524d");\n    console.log("storage.state.token::::::::", storage.state.token)\n    console.log("storage.state.user::::::::", storage.state.user)\n    // \u8bbe\u7f6etoken \uff0c\u6bcf\u4e00\u4e2ahttp\u53d1\u51fa\u7684axios\u8bf7\u6c42\u90fd\u4f1a\u643a\u5e26\u8be5\u8bf7\u6c42\u5934\n    config.headers.Authorization = storage.state.token\n\n    return config;\n}, (error) => {\n    console.log("http\u8bf7\u6c42\u9519\u8bef");\n    return Promise.reject(error);\n});\n\n// \u54cd\u5e94\u62e6\u622a\u5668\nhttp.interceptors.response.use((response) => {\n    console.log("\u670d\u52a1\u7aef\u54cd\u5e94\u6570\u636e\u6210\u529f\u4ee5\u540e\uff0c\u8fd4\u56de\u7ed3\u679c\u7ed9\u5ba2\u6237\u7aef\u7684\u7b2c\u4e00\u65f6\u95f4\uff0c\u6267\u884cthen\u4e4b\u524d");\n    return response;\n}, (error) => {\n    console.log("\u670d\u52a1\u7aef\u54cd\u5e94\u9519\u8bef\u5185\u5bb9\u7684\u65f6\u5019\u3002...");\n    return Promise.reject(error);\n});\n\nexport default http;\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910080156304.png",alt:"image-20230910080156304"})),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910080204521-4304126.png",alt:"image-20230910080204521"})),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910080215038-4304136.png",alt:"image-20230910080215038"})),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910080226670-4304148.png",alt:"image-20230910080226670"})),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910080239800-4304161.png",alt:"image-20230910080239800"})),(0,o.yg)("h2",{id:"42\u57fa\u4e8essh\u7684\u4e3b\u673a\u9a8c\u8bc1"},"4.2\u3001\u57fa\u4e8essh\u7684\u4e3b\u673a\u9a8c\u8bc1"),(0,o.yg)("h3",{id:"421ssh\u547d\u4ee4"},"4.2.1\u3001ssh\u547d\u4ee4"),(0,o.yg)("p",null,"ssh\u547d\u4ee4\u662fopenssh\u5957\u4ef6\u4e2d\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u5de5\u5177\uff0c\u53ef\u4ee5\u7ed9\u4e88ssh\u52a0\u5bc6\u534f\u8bae\u5b9e\u73b0\u5b89\u5168\u7684\u8fdc\u7a0b\u767b\u5f55\u670d\u52a1\u5668\uff0c\u5b9e\u73b0\u5bf9\u670d\u52a1\u5668\u7684\u8fdc\u7a0b\u7ba1\u7406\u3002"),(0,o.yg)("p",null,"\u7b80\u5355\u8bf4\uff0cSSH\u662f\u4e00\u79cd\u7f51\u7edc\u534f\u8bae\uff0c\u7528\u4e8e\u8ba1\u7b97\u673a\u4e4b\u95f4\u7684\u52a0\u5bc6\u767b\u5f55\u3002\u5982\u679c\u4e00\u4e2a\u7528\u6237\u4ece\u672c\u5730\u8ba1\u7b97\u673a\uff0c\u4f7f\u7528SSH\u534f\u8bae\u767b\u5f55\u53e6\u4e00\u53f0\u8fdc\u7a0b\u8ba1\u7b97\u673a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u4e3a\uff0c\u8fd9\u79cd\u767b\u5f55\u662f\u5b89\u5168\u7684\uff0c\u5373\u4f7f\u88ab\u4e2d\u9014\u622a\u83b7\uff0c\u5bc6\u7801\u4e5f\u4e0d\u4f1a\u6cc4\u9732\u3002\u6700\u65e9\u7684\u65f6\u5019\uff0c\u4e92\u8054\u7f51\u901a\u4fe1\u90fd\u662f\u660e\u6587\u901a\u4fe1\uff0c\u4e00\u65e6\u88ab\u622a\u83b7\uff0c\u5185\u5bb9\u5c31\u66b4\u9732\u65e0\u7591\u30021995\u5e74\uff0c\u82ac\u5170\u5b66\u8005Tatu Ylonen\u8bbe\u8ba1\u4e86SSH\u534f\u8bae\uff0c\u5c06\u767b\u5f55\u4fe1\u606f\u5168\u90e8\u52a0\u5bc6\uff0c\u6210\u4e3a\u4e92\u8054\u7f51\u5b89\u5168\u7684\u4e00\u4e2a\u57fa\u672c\u89e3\u51b3\u65b9\u6848\uff0c\u8fc5\u901f\u5728\u5168\u4e16\u754c\u83b7\u5f97\u63a8\u5e7f\uff0c\u76ee\u524d\u5df2\u7ecf\u6210\u4e3aLinux\u7cfb\u7edf\u7684\u6807\u51c6\u914d\u7f6e\u3002"),(0,o.yg)("p",null,"SSH(\u8fdc\u7a0b\u8fde\u63a5\u5de5\u5177)\u8fde\u63a5\u539f\u7406\uff1assh\u670d\u52a1\u662f\u4e00\u4e2a\u5b88\u62a4\u8fdb\u7a0b(demon)\uff0c\u7cfb\u7edf\u540e\u53f0\u76d1\u542c\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\uff0cssh\u670d\u52a1\u7aef\u7684\u8fdb\u7a0b\u540d\u4e3asshd,\u8d1f\u8d23\u5b9e\u65f6\u76d1\u542c\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42(IP 22\u7aef\u53e3)\uff0c\u5305\u62ec\u516c\u5171\u79d8\u94a5\u7b49\u4ea4\u6362\u7b49\u4fe1\u606f\u3002"),(0,o.yg)("p",null,"ssh\u670d\u52a1\u7aef\u75312\u90e8\u5206\u7ec4\u6210\uff1a openssh(\u63d0\u4f9bssh\u670d\u52a1) openssl(\u63d0\u4f9b\u52a0\u5bc6\u7684\u7a0b\u5e8f)"),(0,o.yg)("blockquote",null,(0,o.yg)("ol",{parentName:"blockquote"},(0,o.yg)("li",{parentName:"ol"},"\u68c0\u67e5\u4e3b\u673a\u4e0a\u6709\u6ca1\u6709\u5b89\u88c5SSH\u670d\u52a1\uff0c\u4f7f\u7528\u547d\u4ee4\uff1assh \u82e5\u63d0\u793a\u547d\u4ee4\u672a\u627e\u5230\uff0c\u5219\u9700\u8981\u5b89\u88c5ssh\u670d\u52a1\uff1b\u6b65\u9aa4\u5982\u4e0b\uff1a\u8f93\u5165sudo apt-get update\u547d\u4ee4\u4ee5\u5b9e\u73b0\u66f4\u65b0Ubuntu\u7cfb\u7edf\u2013>\u8f93\u5165sudo apt-get install openssh-server\u547d\u4ee4\u4ee5\u5b89\u88c5ssh \u82e5\u8f93\u51fassh\u547d\u4ee4\u7684\u4f7f\u7528\u8bf4\u660e\uff0c\u5219\u4ee3\u8868\u5df2\u7ecf\u5b89\u88c5\u4e86\u3002"),(0,o.yg)("li",{parentName:"ol"},"\u68c0\u67e5\u4e3b\u673a\u4e0a\u6709\u6ca1\u6709\u542f\u52a8SSH\u670d\u52a1\uff0c\u4f7f\u7528\u547d\u4ee4\uff1aservice \u2013status-all | grep ssh \u82e5\u670d\u52a1\u5df2\u7ecf\u542f\u52a8\u7684\u8bdd\uff0c\u53ef\u4ee5\u770b\u5230","[+]"," ssh \u82e5\u670d\u52a1\u8fd8\u6ca1\u542f\u52a8\u7684\u8bdd\uff0c\u53ef\u4ee5\u770b\u5230","[-]"," ssh"),(0,o.yg)("li",{parentName:"ol"},"\u542f\u52a8ssh\u670d\u52a1\uff0c\u4f7f\u7528\u547d\u4ee4sudo service sshd start"))),(0,o.yg)("p",null,"SSH\u8fdc\u7a0b\u767b\u5f55\u4e4b\u53e3\u4ee4\u767b\u5f55"),(0,o.yg)("blockquote",null,(0,o.yg)("p",{parentName:"blockquote"},(0,o.yg)("inlineCode",{parentName:"p"},"ssh \u7528\u6237\u540d@IP\u5730\u5740 -p \u7aef\u53e3\u53f7 ")),(0,o.yg)("p",{parentName:"blockquote"},"SSH\u7684\u9ed8\u8ba4\u7aef\u53e3\u662f22")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910081413677-4304855.png",alt:"image-20230910081413677"})),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910081425482-4304866.png",alt:"image-20230910081425482"})),(0,o.yg)("h3",{id:"422go\u8bed\u8a00\u7684ssh\u5305"},"4.2.2\u3001go\u8bed\u8a00\u7684ssh\u5305"),(0,o.yg)("p",null,"\u4f9d\u8d56\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'go get "golang.org/x/crypto/ssh"\ngo get "github.com/pkg/sftp"\n')),(0,o.yg)("p",null,"ssh\u6587\u6863\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://pkg.go.dev/golang.org/x/crypto/ssh#Client"},"https://pkg.go.dev/golang.org/x/crypto/ssh#Client")),(0,o.yg)("p",null,"sftp\u6587\u6863\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/pkg/sftp#Client"},"https://pkg.go.dev/github.com/pkg/sftp#Client")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"ssh/utils/ssh.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package utils\n\nimport (\n    "errors"\n    "fmt"\n    "github.com/pkg/sftp"\n    "go.uber.org/zap"\n    "golang.org/x/crypto/ssh"\n    "strings"\n    "time"\n)\n\n// SSH \u5ba2\u6237\u7aef\u8fde\u63a5\u4fe1\u606f\u7684\u7ed3\u6784\u4f53\ntype SSH struct {\n    IP         string       // IP\u5730\u5740\n    Port       int          // \u7aef\u53e3\u53f7\n    Username   string       // \u7528\u6237\u540d\n    Mode       string       // \u8ba4\u8bc1\u65b9\u5f0f[password:\u5bc6\u7801\uff0ckey:\u79d8\u94a5\u8ba4\u8bc1]\n    Password   string       // \u5bc6\u7801\n    Key        string       // \u8ba4\u8bc1\u79c1\u94a5\n    Client     *ssh.Client  // ssh\u5ba2\u6237\u7aef\n    SftpClient *sftp.Client // sftp\u5ba2\u6237\u7aef\n    LastResult string       // \u6700\u8fd1\u4e00\u6b21\u6267\u884c\u547d\u4ee4\u7684\u7ed3\u679c\n}\n\nfunc NewSSH(ip string, username string, password string, key string, mode string, port ...int) *SSH {\n    /**\n    \u521b\u5efa\u547d\u4ee4\u884c\u5b9e\u4f8b\n    @param ip IP\u5730\u5740\n    @param username \u7528\u6237\u540d\n    @param password \u767b\u9646\u5bc6\u7801\n    @param key \u8ba4\u8bc1\u79c1\u94a5\n    @param mode \u8ba4\u8bc1\u6a21\u5f0f( password: \u5bc6\u7801 | key: \u79d8\u94a5 )\n    @param port \u7aef\u53e3\u53f7, \u4e0d\u586b\u5199\u5219\u9ed8\u8ba4\u4e3a22\n    */\n\n    client := new(SSH)\n    client.IP = ip\n    client.Username = username\n    client.Password = password\n    client.Key = key\n    client.Mode = mode\n\n    if len(port) <= 0 {\n        client.Port = 22\n    } else {\n        client.Port = port[0]\n    }\n\n    return client\n}\n\nfunc (s *SSH) Connect() error {\n    /**\n    SSH\u8fde\u63a5\n    */\n    config := ssh.ClientConfig{\n        User:            s.Username,\n        HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n        Timeout:         10 * time.Second,\n    }\n\n    // \u5224\u65adSSH\u8fde\u63a5\u7684\u8ba4\u8bc1\u65b9\u5f0f\n    if s.Mode == "key" {\n        signer, err := ssh.ParsePrivateKey([]byte(s.Key))\n        if err != nil {\n            zap.S().Fatalf("ssh key signer failed: %v", err)\n        }\n        config.Auth = []ssh.AuthMethod{ssh.PublicKeys(signer)}\n    } else {\n        fmt.Println("s.Password", s.Password)\n        config.Auth = []ssh.AuthMethod{ssh.Password(s.Password)}\n    }\n\n    // \u521b\u5efaSSH\u5ba2\u6237\u7aef\n    addr := fmt.Sprintf("%s:%d", s.IP, s.Port)\n    sshClient, err := ssh.Dial("tcp", addr, &config)\n    if err != nil {\n        return err\n    }\n    s.Client = sshClient\n    return nil\n}\n\nfunc (s SSH) Run(command string) (string, error) {\n    /**\n    \u6267\u884cShell\u547d\u4ee4\n    @param command \u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u591a\u4e2a\u547d\u4ee4\u91c7\u7528 ; \u9694\u5f00\n    */\n    if s.Client == nil {\n        if err := s.Connect(); err != nil {\n            return "", err\n        }\n    }\n    // \u521b\u5efa\u4e00\u4e2a\u5ba2\u6237\u7aefSSH\n    session, err := s.Client.NewSession()\n    if err != nil {\n        return "", err\n    }\n    defer session.Close()\n    // \u6267\u884cShell\u547d\u4ee4\n    buf, err := session.CombinedOutput(command)\n\n    s.LastResult = string(buf)\n    return s.LastResult, err\n}\n\nfunc (s SSH) AddPublicKeyToRemoteHost(publicKey string) error {\n    /**\n    \u5c06\u516c\u94a5\u5199\u5165\u76ee\u6807\u4e3b\u673a\n    700 \u662f\u6587\u6863\u62e5\u6709\u53ef\u8bfb\u53ef\u5199\u53ef\u6267\u884c\uff0c\u540c\u4e00\u7ec4\u7528\u6237\u6216\u8005\u5176\u4ed6\u7528\u6237\u90fd\u4e0d\u5177\u6709\u64cd\u4f5c\u6743\u9650\n    600 \u662f\u6587\u4ef6\u62e5\u6709\u8005\u53ef\u8bfb\u53ef\u5199\uff0c\u4e0d\u53ef\u6267\u884c\uff0c\u540c\u4e00\u7ec4\u7528\u6237\u6216\u8005\u5176\u4ed6\u7528\u6237\u90fd\u4e0d\u5177\u6709\u64cd\u4f5c\u6743\u9650\n    */\n    command := fmt.Sprintf("mkdir -p -m 700 ~/.ssh && echo %v >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys", strings.TrimSpace(publicKey))\n    _, err := s.Run(command)\n    if err != nil {\n        message := fmt.Sprintf("%v: %v", "\u6dfb\u52a0\u516c\u94a5\u5931\u8d25\uff01", err)\n        return errors.New(message)\n    }\n    return nil\n}\n\n')),(0,o.yg)("p",null,"OK\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6d4b\u8bd5\u4e0b\u5c01\u88c5\u6548\u679c\u4e86\u3002"),(0,o.yg)("p",null,"\u9996\u5148\u6d4b\u8bd5\u57fa\u4e8e\u5bc6\u7801\u7684ssh\u8fde\u63a5\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"test/ssh/main.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910081644136-4305005.png",alt:"image-20230910081644136"})),(0,o.yg)("p",null,"\u6d4b\u8bd5\u57fa\u4e8e\u5bc6\u94a5\u7684ssh\u8fde\u63a5\uff0c\u9996\u5148\u5728\u672c\u5730\u521b\u5efa\u516c\u79c1\u94a5\uff0c\u901a\u8fc7ssh\u76f8\u5173\u547d\u4ee4"),(0,o.yg)("blockquote",null,(0,o.yg)("p",{parentName:"blockquote"},"ssh-keygen -t rsa")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910081622738-4304985.png",alt:"image-20230910081622738"})),(0,o.yg)("p",null,"\u8fd0\u884c\u7ed3\u675f\u4ee5\u540e\uff0c\u5728$HOME/.ssh/\u76ee\u5f55\u4e0b\uff0c\u4f1a\u65b0\u751f\u6210\u4e24\u4e2a\u6587\u4ef6\uff1aid_rsa.pub\u548cid_rsa\u3002\u524d\u8005\u662f\u4f60\u7684\u516c\u94a5\uff0c\u540e\u8005\u662f\u4f60\u7684\u79c1\u94a5\u3002"),(0,o.yg)("p",null,"\u57fa\u4e8e\u5bc6\u7801\u767b\u5f55\uff0c\u5c06\u516c\u94a5\u53d1\u9001\u5230\u8fde\u63a5\u7684\u8fdc\u7a0b\u670d\u52a1\u5668",(0,o.yg)("inlineCode",{parentName:"p"},"/.ssh/authorized_keys"),"\u4e2d\uff0c\u540e\u9762\u5728\u57fa\u4e8e\u79c1\u94a5\u5c31\u53ef\u4ee5\u514d\u5bc6\u767b\u5f55\u4e86\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "fmt"\n    "os"\n    "ssh_test/utils"\n)\n\nfunc main() {\n    Host := "10.211.55.3"\n    User := "root"\n    Password := "yuan0316"\n    Port := 22\n    Key := ""\n    Mode := "password"\n\n    // \u9996\u6b21SSH\u8fde\u63a5\u4f7f\u7528\u5bc6\u7801\n    cli := utils.NewSSH(Host, User, Password, Key, Mode, Port)\n    fmt.Println(cli.Password, cli.Username, cli.IP)\n    if err := cli.Connect(); err != nil {\n        print("\u8fde\u63a5\u5931\u8d25\uff01", err.Error())\n        return\n    } else {\n        print("\u8fde\u63a5\u6210\u529f\uff01")\n    }\n\n    publicKey, _ := os.ReadFile("./keys/id_rsa.pub") // \u8fd9\u91cc\u653e\u516c\u94a5\u5b57\u7b26\u4e32\n    fmt.Println("publicKey:::", string(publicKey))\n    err := cli.AddPublicKeyToRemoteHost(string(publicKey)) // \u5c06\u672c\u5730\u7684\u516c\u94a5\u53d1\u9001\u5230\u8fdc\u7a0b\u670d\u52a1\u5668\u7684\u6307\u5b9a\u4f4d\u7f6e\n    if err != nil {\n        panic(err)\n    }\n\n}\n')),(0,o.yg)("p",null,"\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u57fa\u4e8e\u79c1\u94a5\u8fdb\u884c\u514d\u5bc6\u767b\u5f55\u4e86\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "fmt"\n    "os"\n    "ssh_test/utils"\n)\n\nfunc main() {\n    Host := "10.211.55.3"\n    User := "root"\n    Password := "yuan0316"\n    Port := 22\n    Key := ""\n    Mode := "password"\n\n    // \u7b2c2\u6b21\u4ee5\u540e\u91c7\u7528\u79d8\u94a5\u8fde\u63a5\n    Mode = "key"\n    Password = ""\n\n    privateKey, _ := os.ReadFile("./keys/id_rsa") // \u8fd9\u91cc\u653e\u516c\u94a5\u5b57\u7b26\u4e32\n\n    Key = string(privateKey)\n\n    cli := utils.NewSSH(Host, User, Password, Key, Mode, Port)\n\n    if err := cli.Connect(); err != nil {\n        fmt.Printf("\u8fde\u63a5\u5931\u8d25:%v", err)\n        return\n    } else {\n        print("\u8fde\u63a5\u6210\u529f\uff01\\n")\n    }\n\n    defer cli.Client.Close()\n\n    output, err := cli.Run("ls")\n    if err != nil {\n        print("\u6267\u884c\u5931\u8d25\uff01")\n    }\n    fmt.Printf("output:\\n%v", output)\n}\n\n')),(0,o.yg)("h3",{id:"423\u57fa\u4e8essh\u7684\u4e3b\u673a\u9a8c\u8bc1"},"4.2.3\u3001\u57fa\u4e8essh\u7684\u4e3b\u673a\u9a8c\u8bc1"),(0,o.yg)("p",null,"\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u5b8c\u6210\u4e86\u4e3b\u673a\u5217\u8868\u5c55\u793a\u548c\u6dfb\u52a0\u4e86\uff0c\u6211\u4eec\u5b9e\u73b0\u6dfb\u52a0\u4e3b\u673a\u65f6\uff0c\u65b0\u6dfb\u52a0\u4e3b\u673a\u9700\u8981\u586b\u5199\u8fde\u63a5\u4e3b\u673a\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u5c31\u9700\u8981\u901a\u8fc7\u5bc6\u7801\u6765\u8fdb\u884c\u4e3b\u673a\u9996\u6b21\u8fde\u63a5\u9a8c\u8bc1\uff0c\u5982\u679c\u7528\u6237\u540d\u548c\u5bc6\u7801\u6ca1\u6709\u95ee\u9898\uff0c\u63a5\u7740\u6211\u4eec\u5c31\u8981\u7ed9\u8be5\u4e3b\u673a\u5199\u5165\u516c\u94a5\u8bbe\u7f6e\u514d\u5bc6\u767b\u9646\uff0c\u4e4b\u540e\u624d\u80fd\u6dfb\u52a0\u5230\u4e3b\u673a\u5217\u8868\u4e2d\uff0c\u4ee5\u540e\u5bf9\u8fd9\u4e2a\u4e3b\u673a\u7684\u64cd\u4f5c\u90fd\u80fd\u591f\u5b8c\u6210\u514d\u5bc6\u64cd\u4f5c\uff0c\u6240\u4ee5\u57fa\u4e8e\u4e0a\u9762\u5c01\u88c5\u597d\u7684SSH\u5de5\u5177\u5305\uff0c\u6211\u4eec\u6709\u4e24\u4ef6\u4e8b\u60c5\u8981\u505a\uff1a"),(0,o.yg)("blockquote",null,(0,o.yg)("ol",{parentName:"blockquote"},(0,o.yg)("li",{parentName:"ol"},"\u5728\u6dfb\u52a0\u4e3b\u673a\u65f6\u8fde\u63a5\u4e00\u6b21\u8fdc\u7a0b\u4e3b\u673a"),(0,o.yg)("li",{parentName:"ol"},"\u914d\u7f6e\u8fdc\u7a0b\u7684\u516c\u79c1\u94a5\u8fdb\u884c\u514d\u5bc6\u767b\u5f55"))),(0,o.yg)("p",null,"\u6d41\u7a0b\u56fe\uff1a"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910081722160.png",alt:"image-20230910081722160"})),(0,o.yg)("h4",{id:"1\u8bbe\u7f6e\u5168\u5c40\u516c\u79c1\u94a5"},"\u30101\u3011\u8bbe\u7f6e\u5168\u5c40\u516c\u79c1\u94a5"),(0,o.yg)("p",null,"\u56e0\u4e3a\u6dfb\u52a0\u4e3b\u673a\u65f6\uff0c\u5141\u8bb8\u4e0d\u4e0a\u4f20\u79d8\u94a5\uff0c\u6240\u4ee5\u4e3a\u4e86\u5b9e\u73b0\u514d\u5bc6\u767b\u9646\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u63d0\u524d\u51c6\u5907\u4e00\u4e2a\u5168\u5c40\u7684\u79d8\u94a5\u5bf9\u4fdd\u5b58\u5728\u670d\u52a1\u7aef\u3002"),(0,o.yg)("p",null,"\u57fa\u4e8e\u524d\u9762\u6211\u4eec\u63d0\u5230\u7684\u751f\u6210\u516c\u79c1\u94a5\u7684\u6307\u4ee4\u4f7f\u7528ssh-keygen\u751f\u6210\u4e00\u5bf9\u79d8\u94a5\u3002\u5f53\u7136\uff0c\u524d\u9762\u5982\u679c\u5df2\u7ecf\u751f\u6210\u4e86\uff0c\u5219\u76f4\u63a5\u590d\u52362\u4e2a\u6587\u4ef6\uff0c\u4fdd\u5b58\u5230\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u7684keys\u76ee\u5f55\u4e0b\u5373\u53ef\u3002"),(0,o.yg)("blockquote",null,(0,o.yg)("ol",{parentName:"blockquote"},(0,o.yg)("li",{parentName:"ol"},"bingo_api/keys/id_rsa\u6587\u4ef6\u4fdd\u5b58\u79c1\u94a5\u5185\u5bb9\uff0cbingo_api/keys/id_rsa.pub\u4fdd\u5b58\u516c\u94a5\u5185\u5bb9"),(0,o.yg)("li",{parentName:"ol"},"\u6ce8\u610f\uff1a\u751f\u6210\u7684\u79d8\u94a5\u5982\u679c\u662f\u6362\u884c\u7684\uff0c\u4e0d\u8981\u80e1\u4e71\u4fee\u6539\uff01\uff01\uff01\u672b\u5c3e\u6ca1\u6709\u7a7a\u884c\u7684\uff01\uff01\uff01\u5207\u8bb0\uff01\uff01\uff01"),(0,o.yg)("li",{parentName:"ol"},"\u4fdd\u5b58\u4e86\u79d8\u94a5\u6587\u4ef6\u4ee5\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u5728\u9879\u76ee\u542f\u52a8\u521d\u59cb\u5316\u9879\u76ee\u914d\u7f6e\u7684\u65f6\u5019\uff0c\u8bfb\u53d6\u5230\u8bfb\u53d6\u4e2d\u3002"))),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/config/config.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'// ...\n\n// SSHGlobalKeys SSH\u5168\u5c40\u79d8\u94a5\u5bf9\ntype SSHGlobalKeys struct {\n    PrivateKeyPath string `json:"private_key_path"`\n    PublicKeyPath  string `json:"public_key_path"`\n    PrivateKey     string `json:"private_key"`\n    PublicKey      string `json:"public_key"`\n}\n\n// Config \u6574\u4e2a\u9879\u76ee\u7684\u914d\u7f6e\ntype Config struct {\n    Mode                string `json:"mode"`\n    Port                int    `json:"port"`\n    SecretKey           string `json:"secret_key"`\n    *LogConfig          `json:"log"`\n    *DatabaseConfig     `json:"database"`\n    *RedisConfigGroup   `json:"redis"`\n    *jwt.StandardClaims `json:"jwt"`\n    *SSHGlobalKeys      `json:"ssh_global_keys"`\n}\n\n// Conf \u5168\u5c40\u914d\u7f6e\u53d8\u91cf\nvar Conf = new(Config)\n\n// Init \u521d\u59cb\u5316\u914d\u7f6e\uff1b\u4ece\u6307\u5b9a\u6587\u4ef6\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\nfunc Init(filePath string) error {\n    /**\n    filePath \u914d\u7f6e\u6587\u4ef6json\u6587\u4ef6\u7684\u8def\u5f84\n    */\n    b, err := ioutil.ReadFile(filePath)\n    if err != nil {\n        return err\n    }\n    err = json.Unmarshal(b, Conf)\n    // \u8bfb\u53d6SSH\u5168\u5c40\u79d8\u94a5\u5bf9\n    publicKey, _ := ioutil.ReadFile(Conf.SSHGlobalKeys.PublicKeyPath)\n    privateKey, _ := ioutil.ReadFile(Conf.SSHGlobalKeys.PrivateKeyPath)\n    Conf.SSHGlobalKeys.PublicKey = string(publicKey)\n    Conf.SSHGlobalKeys.PrivateKey = string(privateKey)\n    return err\n}\n\n')),(0,o.yg)("p",null,"config.json\u4e2d\u6ce8\u610f\uff0c\u52a1\u5fc5\u586b\u5199\u7edd\u5bf9\u8def\u5f84\uff0c\u5426\u5219\u65e0\u6cd5\u8bc6\u522b\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-json"},'  "ssh_global_keys": {\n    "private_key_path": "....../bingo/bingo_api/keys/id_rsa",\n    "public_key_path": "....../bingo/bingo_api/keys/id_rsa.pub"\n  }\n')),(0,o.yg)("p",null,"\u5b8c\u6210\u4e0a\u9762\u6b65\u9aa4\u4ee5\u540e\uff0c\u90a3\u4e48\u6211\u4eec\u7684Urils\u9879\u76ee\u4e2d\u5c31\u5b58\u5728\u4e86\u4e00\u5bf9\u968f\u65f6\u53ef\u4ee5\u66f4\u65b0\uff0c\u968f\u65f6\u53ef\u4ee5\u4f7f\u7528\u7684\u5168\u5c40\u79d8\u94a5\u5bf9\u4e86\u3002"),(0,o.yg)("p",null,"\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u5728\u6dfb\u52a0\u4e3b\u673a\u65f6\uff0c\u76f4\u63a5\u5b8c\u6210\u4e3b\u673a\u4fe1\u606f\u7684\u9a8c\u8bc1\u548c\u5199\u5165\u516c\u94a5\u4fe1\u606f\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e86\u3002"),(0,o.yg)("h4",{id:"2\u4e3b\u673a\u7ba1\u7406\u5b9e\u73b0\u514d\u5bc6\u767b\u5f55"},"\u30102\u3011\u4e3b\u673a\u7ba1\u7406\u5b9e\u73b0\u514d\u5bc6\u767b\u5f55"),(0,o.yg)("p",null,"\u4e3b\u673a\u4fe1\u606f\u5b58\u50a8\u516c\u79c1\u94a5\uff0c\u539f\u6765\u7684\u4e3b\u673a\u6a21\u578b\u4e2d\uff0c\u4ec5\u6709\u4e00\u4e2akey\u5b57\u6bb5\uff0c\u6240\u4ee5\u4e3a\u4e86\u65b9\u4fbf\u4fdd\u5b58\u516c\u79c1\u94a5\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u62c6\u5206\u62102\u4e2a\u5b57\u6bb5\u4fdd\u5b58\u3002"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/models/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'type Host struct {\n    gorm.Model\n    Name           string       `json:"name" gorm:"type:varchar(255)"`\n    IpAddr         string       `json:"ip_addr" gorm:"type:varchar(255)"`\n    Port           uint         `json:"port" gorm:"type:int"`\n    Username       string       `json:"username" gorm:"varchar(255)"`\n    Password       string       `json:"password,omitempty" gorm:"varchar(255)"`\n    Remark         string       `json:"remark,omitempty" gorm:"varchar(255)"`\n    HostCategoryID uint         `json:"host_category_id"`\n    HostCategory   HostCategory `json:"host_category"  gorm:"foreignKey:HostCategoryID;references:ID"`\n\n    PrivateKey string `json:"private_key,omitempty" gorm:"type:text"`\n    PublicKey  string `json:"public_key,omitempty" gorm:"type:text"`\n}\n')),(0,o.yg)("p",null,"\u8c03\u6574\u4e86\u6a21\u578b\u4ee5\u540e\uff0c\u6211\u4eec\u5c31\u9700\u8981\u8ba9orm\u6846\u67b6\u91cd\u65b0\u8fc1\u79fb\u5f53\u524dHost\u6a21\u578b\u3002"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/service/host.go")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"// \u6570\u636e\u89e3\u6790\u6ce8\u91ca\uff0c\u5728validator\u7684host.go\u4e2d\u89e3\u6790\n/*if err = ctx.ShouldBindJSON(&host); err != nil {\n        return instance, err\n    }*/\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/validator/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package validator\n\nimport (\n    "bingo_api/application/config"\n    "bingo_api/application/constants"\n    . "bingo_api/application/model"\n    . "bingo_api/application/utils"\n    "errors"\n    "fmt"\n    "github.com/gin-gonic/gin"\n    "github.com/go-playground/validator/v10"\n    "io/ioutil"\n    "mime/multipart"\n    "strconv"\n    "strings"\n)\n\n/**\n\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b\u7684\u9a8c\u8bc1\u5668\n*/\n\nfunc HostCategoryValidator(hostCategory *HostCategory) error {\n    validate, trans := GenValidate()\n    err := validate.Struct(hostCategory)\n    if err != nil {\n        for _, err := range err.(validator.ValidationErrors) {\n            return errors.New(err.Translate(trans))\n        }\n    }\n    return nil\n}\n\n/**\n\u6dfb\u52a0\u4e3b\u673a\u7684\u9a8c\u8bc1\u5668\n*/\n\nfunc HostValidator(host *Host, ctx *gin.Context) error {\n  // (1) \u63a5\u6536\u6570\u636e\n\n    // \u63a5\u6536\u591a\u6587\u4ef6\u4e0a\u4f20\u7684\u8868\u5355\u6570\u636e\n    form, err := ctx.MultipartForm()\n    if err != nil {\n        return err\n    }\n    fmt.Println("form:::", form)\n\n    // \u624b\u52a8\u63a5\u6536\u8868\u5355\u4fe1\u606f\u5e76\u8d4b\u503c\n    // form.Value\u63a5\u6536\u6587\u672c\u5b57\u6bb5 form.File\u63a5\u6536\u4e0a\u4f20\u6587\u4ef6\n    hostCategoryId, _ := strconv.Atoi(form.Value["host_category_id"][0])\n    host.HostCategoryID = uint(hostCategoryId)\n    port, _ := strconv.Atoi(form.Value["port"][0])\n    host.Port = uint(port)\n    host.Username = form.Value["username"][0]\n    host.Password = form.Value["password"][0]\n    host.Name = form.Value["name"][0]\n    host.IpAddr = form.Value["ip_addr"][0]\n    host.Remark = form.Value["remark"][0]\n    fmt.Println("host:::", host)\n\n  // (2) \u6821\u9a8c\u6570\u636e\n  // \u6821\u9a8c\u57fa\u672c\u89c4\u5219\n    validate, trans := GenValidate()\n    err = validate.Struct(host)\n    if err != nil {\n        for _, err := range err.(validator.ValidationErrors) {\n            fmt.Println("err:::", err)\n\n            return errors.New(err.Translate(trans))\n        }\n    }\n\n    // \u6821\u9a8c\u7c7b\u578b\u8303\u56f4\n    if host.HostCategoryID < 1 {\n        return errors.New(constants.HostCategoryNotExist)\n    }\n\n    var hostCategory HostCategory\n    err = hostCategory.GetOneById(host.HostCategoryID)\n    if err != nil {\n        return errors.New(constants.HostCategoryNotExist)\n    }\n    // \u6821\u9a8c\u4e3b\u673a\u662f\u5426\u53ef\u4ee5ping\u901a\uff0c\u53ef\u4ee5\u7684\u8bdd\uff0c\u5c06\u516c\u94a5\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u6307\u5b9a\u4f4d\u7f6e\uff0c\u65b9\u4fbf\u540e\u9762\u7684\u514d\u5bc6\u767b\u5f55\n    err = ping(host, form)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n\nfunc ping(host *Host, form *multipart.Form) error {\n    var err error\n  \n  // \uff081\uff09\u83b7\u53d6\u516c\u79c1\u94a5\n    // \u4ece\u8868\u5355\u4e2d\u63d0\u53d6\u4e0a\u4f20\u6587\u4ef6\n    keys := form.File["files[]"] // \u52a1\u5fc5\u4e0e\u5ba2\u6237\u7aef\u4e0a\u4f20\u65f6\u8bbe\u7f6e\u7684\u5b57\u6bb5\u540d\u4e00\u81f4\uff0c\u5426\u65e0\u63a5\u6536\u4e0d\u4e86\n    // \u6839\u636e\u4e0a\u4f20\u6587\u4ef6\u4e2a\u6570\u5224\u65ad\n    if len(keys) == 1 {\n        // \u62a5\u9519\uff0c\u5141\u8bb8\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\n        return errors.New(constants.Missingkeys)\n    } else if len(keys) == 2 {\n        // \u4e0a\u4f20\u79d8\u94a5\u5bf9\u4e24\u4e2a\u6587\u4ef6\n        // \u83b7\u53d6\u7b2c\u4e00\u4e2a\u6587\u4ef6\n        fileHandle1, err := keys[0].Open()\n        if err != nil {\n            return err\n        }\n        defer fileHandle1.Close()\n        fileByte, _ := ioutil.ReadAll(fileHandle1)\n        key1 := string(fileByte)\n\n        // \u83b7\u53d6\u7b2c\u4e8c\u4e2a\u6587\u4ef6\n        fileHandle2, err := keys[1].Open()\n        defer fileHandle2.Close()\n        fileByte, _ = ioutil.ReadAll(fileHandle2)\n        key2 := string(fileByte)\n\n        if strings.Contains(key1, "PRIVATE") { // \u901a\u8fc7\u5224\u65ad\u79d8\u94a5\u4e2d\u7684\u5185\u5bb9\uff0c\u533a\u5206\u516c\u94a5\u548c\u79c1\u94a5\u3002\n            host.PrivateKey, host.PublicKey = key1, key2\n        } else {\n            host.PrivateKey, host.PublicKey = key2, key1\n        }\n\n    } else {\n        // todo \u91c7\u7528\u5168\u5c40\u516c\u79c1\u94a5\u4f5c\u4e3a\u9ed8\u8ba4\u503c\n        host.PublicKey, host.PrivateKey = config.Conf.PublicKey, config.Conf.PrivateKey\n    }\n\n    // \uff082\uff09\u786e\u8ba4\u597d\u516c\u79c1\u94a5\uff0c\u521b\u5efassh\u5bf9\u8c61\uff0c\u8fdb\u884cssh\u64cd\u4f5c\n    cli := NewSSH(host.IpAddr, host.Username, host.Password, "", "password", int(host.Port))\n    // \u57fa\u4e8e\u5bc6\u7801\u9996\u6b21SSH\u8fde\u63a5\n    if err := cli.Connect(); err != nil {\n        fmt.Println("err", err)\n        return errors.New(constants.HostInfoEror)\n    }\n    fmt.Println("cli.Client:::", cli.Client)\n    fmt.Println("host.PublicKey:::", host.PublicKey)\n\n    // \u9a8c\u8bc1\u4e3b\u673a\u4fe1\u606f\u6210\u529f\u4ee5\u540e\uff0c\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u628a\u516c\u94a5\u5199\u5165\u5230\u8fdc\u7a0b\u4e3b\u673a\u4e86\u3002\n    if err := cli.AddPublicKeyToRemoteHost(host.PublicKey); err != nil {\n        return errors.New(constants.SSHKeyIsInvalid)\n    }\n\n    return err\n\n}\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"constants/message.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package constants\n\nconst (\n    // ....\n    HostInfoEror    = "\u4e3b\u673a\u4fe1\u606f\u6709\u8bef\uff01\uff01"\n    SSHKeyIsInvalid = "\u65e0\u6548\u7684\u79d8\u94a5\u4fe1\u606f\uff01"\n    Missingkeys     = "\u4e22\u5931\u516c\u94a5\u6216\u8005\u79c1\u94a5"\n)\n')),(0,o.yg)("p",null,"\u63a5\u4e0b\u6765\uff0c\u6e05\u9664\u8fde\u63a5\u670d\u52a1\u7aef\u7684"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cd ~/.ssh\ncat authorized_keys\nrm -rf authorized_keys\ntouch authorized_keys\n")),(0,o.yg)("p",null,"\u8fd9\u6837\u8be5\u76ee\u6807\u4e3b\u673a\u7684ssh\u8bb0\u5f55\u5c31\u5168\u90e8\u5220\u9664\u4e86\u3002\u6211\u4eec\u5c31\u53ef\u4ee5\u57fa\u4e8e",(0,o.yg)("inlineCode",{parentName:"p"},"bingo_api/test/ssh/main.go"),"\u6587\u4ef6\u7684\u6d4b\u8bd5\u4f8b\u5b50\uff0c\u9a8c\u8bc1\u662f\u5426\u5df2\u7ecf\u7ed9\u8fdc\u7a0b\u4e3b\u673a\u5efa\u7acb\u4e86\u514d\u5bc6\u767b\u9646\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "fmt"\n    "os"\n    "ssh_test/utils"\n)\n\nfunc main() {\n    Host := "10.211.55.3"\n    User := "root"\n    Password := "yuan0316"\n    Port := 22\n    Key := ""\n    Mode := "password"\n\n    // \u7b2c2\u6b21\u4ee5\u540e\u91c7\u7528\u79d8\u94a5\u8fde\u63a5\n    Mode = "key"\n    Password = ""\n\n    privateKey, _ := os.ReadFile("./keys/id_rsa") // \u8fd9\u91cc\u653e\u516c\u94a5\u5b57\u7b26\u4e32\n    fmt.Println("publicKey:::", string(privateKey))\n\n    Key = string(privateKey)\n\n    cli := utils.NewSSH(Host, User, Password, Key, Mode, Port)\n\n    if err := cli.Connect(); err != nil {\n        fmt.Printf("\u8fde\u63a5\u5931\u8d25:%v", err)\n        return\n    } else {\n        print("\u8fde\u63a5\u6210\u529f\uff01\\n")\n    }\n\n    defer cli.Client.Close()\n\n    output, err := cli.Run("ls")\n    if err != nil {\n        print("\u6267\u884c\u5931\u8d25\uff01")\n    }\n    fmt.Printf("output:\\n%v", output)\n}\n')),(0,o.yg)("p",null,"\u6b63\u5e38\u8fdc\u7a0b\u670d\u52a1\u5668\u4e2d\u7684\u516c\u94a5\u5220\u9664\u540e\uff0c\u76f4\u63a5\u8fd0\u884c\u4e0a\u9762\u7684\u4ee3\u7801\u4f1a\u8fde\u63a5\u5931\u8d25\u3002"),(0,o.yg)("h4",{id:"3postman\u6d4b\u8bd5\u63a5\u53e3"},"\u30103\u3011postman\u6d4b\u8bd5\u63a5\u53e3"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230916172514218-4856315.png",alt:"image-20230916172514218"})),(0,o.yg)("h4",{id:"4\u524d\u7aef\u8054\u8c03"},"\u30104\u3011\u524d\u7aef\u8054\u8c03"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"Host.vue")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="host">\n\n    <div>\n      <a-button type="primary" @click="showModal" style="margin: 8px 0">\u6dfb\u52a0\u4e3b\u673a</a-button>\n      <a-modal width="860px" v-model:visible="visible" title="Basic Modal" @ok="onHostFormSubmit" @cancel="cancelForm">\n\n        <a-form\n            ref="formRef"\n            name="custom-validation"\n            :model="hostForm.form"\n            :rules="hostForm.rules"\n            v-bind="layout"\n            @finish="handleFinish"\n            @validate="handleValidate"\n            @finishFailed="handleFinishFailed"\n        >\n          <a-form-item label="\u4e3b\u673a\u7c7b\u522b" prop="zone" name="category">\n            <a-row>\n              <a-col :span="12">\n                <a-select\n                    ref="select"\n                    v-model:value="hostForm.form.host_category_id"\n                    @change="handleCategorySelectChange"\n                >\n                  <a-select-option :value="category.id" v-for="category in categoryList.data" :key="category.id">\n                    {{ category.name }}\n                  </a-select-option>\n                </a-select>\n              </a-col>\n\n            </a-row>\n\n          </a-form-item>\n\n          <a-form-item has-feedback label="\u4e3b\u673a\u540d\u79f0" name="name">\n            <a-input v-model:value="hostForm.form.name" type="text" autocomplete="off"/>\n          </a-form-item>\n\n\n          <a-form-item label="\u8fde\u63a5\u5730\u5740" name="username">\n\n            <a-row>\n              <a-col :span="8">\n                <a-input placeholder="\u7528\u6237\u540d" addon-before="ssh" v-model:value="hostForm.form.username" type="text"\n                         autocomplete="off"/>\n              </a-col>\n              <a-col :span="8">\n                <a-input placeholder="ip\u5730\u5740" addon-before="@" v-model:value="hostForm.form.ip_addr" type="text"\n                         autocomplete="off"/>\n              </a-col>\n              <a-col :span="8">\n                <a-input placeholder="\u7aef\u53e3\u53f7" addon-before="-p" v-model:value="hostForm.form.port" type="number"\n                         autocomplete="off"/>\n              </a-col>\n            </a-row>\n          </a-form-item>\n\n          <a-form-item has-feedback label="\u8fde\u63a5\u5bc6\u7801" name="password">\n            <a-input v-model:value="hostForm.form.password" type="password" autocomplete="off"/>\n          </a-form-item>\n\n          <a-form-item has-feedback label="\u5907\u6ce8\u4fe1\u606f" name="remark">\n            <a-textarea placeholder="\u8bf7\u8f93\u5165\u4e3b\u673a\u5907\u6ce8\u4fe1\u606f" v-model:value="hostForm.form.remark" type="text"\n                        :auto-size="{ minRows: 3, maxRows: 5 }" autocomplete="off"/>\n          </a-form-item>\n\n\n          <a-form-item :wrapper-col="{ span: 14, offset: 4 }">\n            <a-button @click="resetForm">Reset</a-button>\n          </a-form-item>\n        </a-form>\n\n      </a-modal>\n    </div>\n\n    <a-table bordered :data-source="hostList.data" :columns="columns">\n      <template #bodyCell="{ column, text, record }">\n        <template v-if="column.dataIndex === \'name\'">\n          <div class="editable-cell">\n            <div v-if="editableData[record.key]" class="editable-cell-input-wrapper">\n              <a-input v-model:value="editableData[record.key].name" @pressEnter="save(record.key)"/>\n              <check-outlined class="editable-cell-icon-check" @click="save(record.key)"/>\n            </div>\n            <div v-else class="editable-cell-text-wrapper">\n              {{ text || \' \' }}\n              <edit-outlined class="editable-cell-icon" @click="edit(record.key)"/>\n            </div>\n          </div>\n        </template>\n        <template v-else-if="column.dataIndex === \'operation_edit\'">\n\n          <a>\n            <edit-outlined/>\n          </a>\n\n        </template>\n        <template v-else-if="column.dataIndex === \'operation_del\'">\n          <a-popconfirm\n              v-if="hostList.data.length"\n              title="Sure to delete?"\n              @confirm="onDelete(record)"\n          >\n            <a>\n              <delete-outlined/>\n            </a>\n          </a-popconfirm>\n        </template>\n      </template>\n    </a-table>\n  </div>\n</template>\n\n<script setup>\nimport {computed, onMounted, reactive, ref} from \'vue\';\nimport {CheckOutlined, DeleteOutlined, EditOutlined} from \'@ant-design/icons-vue\';\nimport {cloneDeep} from \'lodash-es\';\nimport http from "@/utils/http";\nimport {message} from \'ant-design-vue\';\n\n// \u4e3b\u673a\u8868\u683c\nconst columns = [{\n  title: \'\u7c7b\u522b\',\n  dataIndex: \'category_name\',\n}, {\n  title: \'\u4e3b\u673a\u540d\u79f0\',\n  dataIndex: \'name\',\n}, {\n  title: \'IP\u5730\u5740\',\n  dataIndex: \'ip_addr\',\n}, {\n  title: \'\u7aef\u53e3\',\n  dataIndex: \'port\',\n}, {\n  title: \'\u5907\u6ce8\',\n  dataIndex: \'remark\',\n}, {\n  title: \'\u7f16\u8f91\',\n  dataIndex: \'operation_edit\',\n}, {\n  title: \'\u5220\u9664\',\n  dataIndex: \'operation_del\',\n}];\nconst hostList = reactive({data: []})\n;\nconst count = computed(() => hostList.data.length + 1);\nconst editableData = reactive({});\nconst edit = key => {\n  editableData[key] = cloneDeep(hostList.data.filter(item => key === item.key)[0]);\n};\nconst save = key => {\n  Object.assign(hostList.data.filter(item => key === item.key)[0], editableData[key]);\n  delete editableData[key];\n};\nconst onDelete = record => {\n\n  console.log("delete id", record)\n  http.delete(`/host`, {\n    params: {\n      "id": record.id\n    }\n  }).then((response) => {\n\n    hostList.data = hostList.data.filter(item => item.id !== record.id);\n    message.success(\'\u5220\u9664\u4e3b\u673a\u6210\u529f\uff01\')\n\n  }).catch((err) => {\n    message.error(\'\u5220\u9664\u4e3b\u673a\u5931\u8d25\uff01\')\n  });\n\n\n};\n\n// \u6dfb\u52a0\u4e3b\u673a\nconst visible = ref(false);\nconst showModal = () => {\n  visible.value = true;\n};\n\nconst onHostFormSubmit = () => {\n\n  // \u5c06\u6570\u636e\u63d0\u4ea4\u5230\u540e\u53f0\u8fdb\u884c\u4fdd\u5b58\uff0c\u4f46\u662f\u5148\u8fdb\u884c\u8fde\u63a5\u6821\u9a8c\uff0c\u9a8c\u8bc1\u6ca1\u6709\u95ee\u9898\uff0c\u518d\u4fdd\u5b58\n  hostForm.form.port = parseInt(hostForm.form.port)\n\n  const formData = new FormData();\n  for (let attr in hostForm.form) {\n    formData.append(attr, hostForm.form[attr])\n  }\n\n  http.post(`/host`, formData).then((response) => {\n    console.log("response.data.data.host:::", response.data.data.host)\n    hostList.data.unshift(response.data.data.host)\n    // \u6e05\u7a7a\n    resetForm()\n    visible.value = false;\n    message.success(\'\u6210\u529f\u6dfb\u52a0\u4e3b\u673a\u4fe1\u606f\uff01\', 1)\n\n  }).catch((err) => {\n    // \u6e05\u7a7a\n    resetForm()\n    visible.value = false;\n    console.log("err:::", err)\n    message.error(\'\u6dfb\u52a0\u4e3b\u673a\u5931\u8d25!\', 1.5)\n  });\n}\n\nconst cancelForm = e => {\n  resetForm()\n  visible.value = false;\n};\nconst hostForm = reactive({\n  labelCol: {span: 6},\n  wrapperCol: {span: 14},\n  other: \'\',\n  form: {\n    name: \'\',\n    host_category_id: "",\n    ip_addr: \'\',\n    username: \'\',\n    port: \'\',\n    remark: \'\',\n    password: \'\'\n  },\n  rules: {\n    name: [\n      {required: true, message: \'\u8bf7\u8f93\u5165\u4e3b\u673a\u540d\u79f0\', trigger: \'blur\'},\n      {min: 3, max: 30, message: \'\u957f\u5ea6\u57283-10\u4f4d\u4e4b\u95f4\', trigger: \'blur\'}\n    ],\n    password: [\n      {required: true, message: \'\u8bf7\u8f93\u5165\u8fde\u63a5\u5bc6\u7801\', trigger: \'blur\'},\n      {min: 3, max: 30, message: \'\u957f\u5ea6\u57283-10\u4f4d\u4e4b\u95f4\', trigger: \'blur\'}\n    ],\n    host_category_id: [\n      {required: true, message: \'\u8bf7\u9009\u62e9\u7c7b\u522b\', trigger: \'change\'}\n    ],\n    username: [\n      {required: true, message: \'\u8bf7\u8f93\u5165\u7528\u6237\u540d\', trigger: \'blur\'},\n      {min: 3, max: 30, message: \'\u957f\u5ea6\u57283-10\u4f4d\', trigger: \'blur\'}\n    ],\n    ip_addr: [\n      {required: true, message: \'\u8bf7\u8f93\u5165\u8fde\u63a5\u5730\u5740\', trigger: \'blur\'},\n      {max: 30, message: \'\u957f\u5ea6\u6700\u592715\u4f4d\', trigger: \'blur\'}\n    ],\n    port: [\n      {required: true, message: \'\u8bf7\u8f93\u5165\u7aef\u53e3\u53f7\', trigger: \'blur\'},\n      {max: 5, message: \'\u957f\u5ea6\u6700\u59275\u4f4d\', trigger: \'blur\'}\n    ]\n  }\n});\nconst formRef = ref();\nconst layout = {\n  labelCol: {\n    span: 4,\n  },\n  wrapperCol: {\n    span: 24,\n  },\n};\nconst handleFinish = values => {\n  console.log(values, hostForm);\n};\n\nconst handleFinishFailed = errors => {\n  console.log(errors);\n};\n\nconst resetForm = () => {\n  formRef.value.resetFields();\n};\n\nconst handleValidate = (...args) => {\n  console.log(args);\n};\n\nconst handleCategorySelectChange = (value) => {\n  // \u5207\u6362\u4e3b\u673a\u7c7b\u522b\u7684\u56de\u8c03\u5904\u7406\n  console.log(value)\n}\n\nconst categoryList = reactive({\n  data: []\n})\n\n// \u67e5\u770b\u4e3b\u673a\u5217\u8868\nconst getHostList = () => {\n  http.get("/host").then((res) => {\n    console.log("host_list:::", res)\n    hostList.data = res.data.data.host_list\n  })\n}\n// \u67e5\u770b\u4e3b\u673a\u7c7b\u522b\u5217\u8868\nconst getHostCategory = () => {\n  http.get("/host/category").then((res) => {\n    console.log("host_category_list:::", res.data.data.host_category_list)\n    categoryList.data = res.data.data.host_category_list\n  })\n}\n\n\nonMounted(() => {\n  getHostList()\n  getHostCategory()\n})\n\n\n<\/script>\n\n<style scoped>\n\n\n</style>\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910081758234.png",alt:"image-20230910081758234"})),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910081811850.png",alt:"image-20230910081811850"})),(0,o.yg)("p",null,"\u6dfb\u52a0\u6210\u529f\u540e\u68c0\u67e5\u8fdc\u7a0b\u670d\u52a1\u5668\u7684",(0,o.yg)("inlineCode",{parentName:"p"},"~/.ssh/authorized_keys"),"\u4e2d\u662f\u5426\u6dfb\u52a0\u516c\u94a5\u6210\u529f\uff0c\u6210\u529f\u540e\u518d\u6267\u884c\u4e0a\u9762\u7684\u6d4b\u8bd5\u4ee3\u7801\uff0c\u5373\u53ef\u8fde\u63a5\u6210\u529f\u3002"),(0,o.yg)("p",null,"\u8fd9\u91cc\u6709\u4e00\u4e2a\u529f\u80fd\uff0c\u5728\u6dfb\u52a0\u4e3b\u673a\u7684\u6a21\u6001\u5bf9\u8bdd\u6846\u4e2d\u5e94\u8be5\u914d\u6709\u4e0a\u4f20\u516c\u79c1\u94a5\u7684\u6309\u94ae\uff0c\u540c\u5b66\u4eec\u53ef\u4ee5\u81ea\u5df1\u8865\u5145\uff01"),(0,o.yg)("p",null,"\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u7684ssh\u514d\u5bc6\u767b\u5f55\u529f\u80fd\u5c31\u5b9e\u73b0\u5b8c\u6210\u4e86\u3002"),(0,o.yg)("h2",{id:"43\u57fa\u4e8ews\u5b9e\u73b0console"},"4.3\u3001\u57fa\u4e8ews\u5b9e\u73b0Console"),(0,o.yg)("h3",{id:"431websocket\u4ecb\u7ecd"},"4.3.1\u3001Websocket\u4ecb\u7ecd"),(0,o.yg)("p",null,"Websocket\uff08\u7b80\u79f0\uff1aws\uff09\u662fweb\u524d\u7aefHTML5\u63d0\u4f9b\u7684\u4e00\u79cd\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u5168\u53cc\u5de5\u901a\u8baf\u7684\u7f51\u7edc\u6280\u672f\uff0c\u5c5e\u4e8e\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u5b83\u57fa\u4e8eTCP\u534f\u8bae\u5f00\u53d1\u800c\u6765\uff0c\u5e76\u590d\u7528HTTP\u7684\u63e1\u624b\u901a\u9053\u3002"),(0,o.yg)("blockquote",null,(0,o.yg)("ol",{parentName:"blockquote"},(0,o.yg)("li",{parentName:"ol"},"\u8c03\u7528\u7b80\u5355\uff0c\u7531\u6d4f\u89c8\u5668\u8fdb\u884c\u4e86\u5c01\u88c5\u63d0\u4f9b\u5f3a\u5927\u7684\u64cd\u4f5c\u63a5\u53e3\uff0c\u76f4\u63a5\u4f7f\u7528\u6d4f\u89c8\u5668\u7684websocket\u5bf9\u8c61\u5373\u53ef\u901a\u8fc7\u4e8b\u4ef6\u4e0e\u670d\u52a1\u7aef\u8fdb\u884cwebsocket\u901a\u4fe1\u3002"),(0,o.yg)("li",{parentName:"ol"},"\u652f\u6301\u4e8c\u8fdb\u5236\uff0c"),(0,o.yg)("li",{parentName:"ol"},"\u652f\u6301\u53cc\u5411\u901a\u4fe1, \u66f4\u7075\u6d3b, \u66f4\u5b9e\u65f6\u6027\uff0c \u66f4\u9ad8\u6548\uff0c\u53ef\u6269\u5c55\u6027\u66f4\u597d"))),(0,o.yg)("p",null," \u57fa\u4e8eWebSocket\u5b9e\u73b0WebSSH\u7684\u76ee\u7684\u5728\u4e8e\u89e3\u51b3\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a"),(0,o.yg)("blockquote",null,(0,o.yg)("ol",{parentName:"blockquote"},(0,o.yg)("li",{parentName:"ol"},"\u53d6\u4ee3xshell\uff0csecureRT\uff0cputty\u7b49ssh\u7ec8\u7aef\uff0c\u8fbe\u5230\u4e3b\u673a\u4fe1\u606f\u7ba1\u7406\u548c\u8fdc\u7a0b\u63a7\u5236\u7ba1\u7406\u4e00\u4f53\u5316\u3002"),(0,o.yg)("li",{parentName:"ol"},"\u53ef\u4ee5\u65b9\u4fbf\u8eab\u4efd\u8ba4\u8bc1, \u8bbf\u95ee\u63a7\u5236"),(0,o.yg)("li",{parentName:"ol"},"\u65b9\u4fbf\u4f7f\u7528, \u4e0d\u53d7\u7535\u8111\u73af\u5883\u7684\u5f71\u54cd"))),(0,o.yg)("p",null,"\u6d41\u7a0b\u56fe\uff1a"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910082059006.png",alt:"image-20230910082059006"})),(0,o.yg)("p",null,"\u5927\u6982\u6b65\u9aa4\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-htaccess"},"1. \u6d4f\u89c8\u5668\u63d0\u4f9bconsole\u70b9\u51fb\u6309\u94ae\uff0c\u5f53\u7528\u6237\u70b9\u51fb\u4ee5\u540e\uff0c\u5c06\u4e3b\u673a\u7684id\u53d1\u9001\u7ed9gin\u540e\u53f0, \u5e76\u901a\u8fc7HTTP\u8bf7\u6c42\u4e0e\u540e\u53f0\u534f\u5546\u5347\u7ea7ws\u534f\u8bae. \u534f\u8bae\u5347\u7ea7\u5b8c\u6210\u540e, \u540e\u7eed\u7684\u6570\u636e\u4ea4\u6362\u5219\u9075\u7167webSocket\u7684\u534f\u8bae.\n\n2. \u540e\u53f0\u5c06HTTP\u8bf7\u6c42\u5347\u7ea7\u4e3aweb Socket\u534f\u8bae, \u5f97\u5230\u4e00\u4e2a\u548c\u6d4f\u89c8\u5668\u6570\u636e\u4ea4\u6362\u7684\u8fde\u63a5\u901a\u9053\n\n3. \u540e\u53f0\u5c06\u6570\u636e\u8fdb\u884c\u89e3\u5bc6\u62ff\u5230\u4e3b\u673a\u4fe1\u606f, \u521b\u5efa\u4e00\u4e2aSSH \u5ba2\u6237\u7aef, \u4e0e\u8fdc\u7a0b\u4e3b\u673a\u7684SSH \u670d\u52a1\u7aef\u534f\u5546\u52a0\u5bc6, \u4e92\u76f8\u8ba4\u8bc1, \u7136\u540e\u901a\u8fc7OpenChannel\u5efa\u7acb\u4e00\u4e2aSSH Channel\n\n4. \u540e\u53f0\u548c\u8fdc\u7a0b\u4e3b\u673a\u6709\u4e86\u901a\u8baf\u7684\u4fe1\u9053, \u7136\u540e\u540e\u53f0\u5c06\u7ec8\u7aef\u7684\u5927\u5c0f\u7b49\u4fe1\u606f\u901a\u8fc7SSH Channel\u8bf7\u6c42\u8fdc\u7a0b\u4e3b\u673a\u521b\u5efa\u4e00\u4e2a pty(\u4f2a\u7ec8\u7aef), \u5e76\u8bf7\u6c42\u542f\u52a8\u5f53\u524d\u7528\u6237\u7684\u9ed8\u8ba4 shell\n\n5. \u540e\u53f0\u901a\u8fc7 Socket\u8fde\u63a5\u901a\u9053\u62ff\u5230\u7528\u6237\u8f93\u5165, \u518d\u901a\u8fc7SSH Channel\u5c06\u8f93\u5165\u4f20\u7ed9pty, pty\u5c06\u8fd9\u4e9b\u6570\u636e\u4ea4\u7ed9\u8fdc\u7a0b\u4e3b\u673a\u5904\u7406\u540e\u6309\u7167\u524d\u9762\u6307\u5b9a\u7684\u7ec8\u7aef\u6807\u51c6\u8f93\u51fa\u5230SSH Channel\u4e2d, \u540c\u65f6\u952e\u76d8\u8f93\u5165\u4e5f\u4f1a\u53d1\u9001\u7ed9SSH Channel\n\n6. \u540e\u53f0\u4eceSSH Channel\u4e2d\u62ff\u5230\u6309\u7167\u7ec8\u7aef\u5927\u5c0f\u7684\u6807\u51c6\u8f93\u51fa\u540e\u53c8\u901a\u8fc7Socket\u8fde\u63a5\u5c06\u8f93\u51fa\u8fd4\u56de\u7ed9\u6d4f\u89c8\u5668, \u7531\u6b64\u53d8\u5b9e\u73b0\u4e86Web SSH Terminal\n")),(0,o.yg)("h3",{id:"432\u57fa\u4e8ews\u7684websocket\u6d4b\u8bd5"},"4.3.2\u3001\u57fa\u4e8ews\u7684websocket\u6d4b\u8bd5"),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"\u524d\u7aef\u5b9e\u73b0")),(0,o.yg)("p",null,"\u524d\u7aef\u7684\u7ec8\u7aef\u6548\u679c\u6211\u4eec\u4f7f\u7528xterm.js\u6765\u5b8c\u6210\u3002"),(0,o.yg)("p",null,"Xterm.js\u7684\u5b89\u88c5\u548c\u4f7f\u7528"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"npm install xterm\n")),(0,o.yg)("p",null,"\u521d\u59cb\u5316xterm.js\uff0c\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"src/main.js"),"\u4e2d\u6dfb\u52a0\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-javascript"},"import 'xterm/css/xterm.css'\nimport 'xterm/lib/xterm'\n")),(0,o.yg)("p",null,"\u521b\u5efa\u7ec4\u4ef6\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"views/Console.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},"<template>\n  <div class=\"console\">\n    <div id=\"terminal\"></div>\n  </div>\n</template>\n\n<script setup>\nimport {onMounted} from \"vue\";\nimport {Terminal} from 'xterm'\nimport settings from \"@/settings\";\nimport {useRoute} from \"vue-router\"\n\nconst route = useRoute()\n\n// \u56e0\u7232xterm\u7ec8\u7aef\u9700\u8981\u4fee\u6539HTML\u4ee3\u7801\uff0c\u6240\u4ee5\u5fc5\u987b\u7b49vue\u663e\u793a\u4e86\u9875\u9762\u5185\u5bb9\u4ee5\u540e\u624d\u80fd\u6267\u884cxterm\u76f8\u5173\u7684\u4ee3\u7801\nonMounted(\n    () => {\n      let term = new Terminal({\n        rendererType: 'canvas', // \u6e32\u67d3\u7c7b\u578b\n        cols: 100, // \u5217\u6570\n        rows: 50, // \u884c\u6570\n        convertEol: true, // \u542f\u7528\u65f6\uff0c\u5149\u6807\u5c06\u8bbe\u7f6e\u4e3a\u4e0b\u4e00\u884c\u7684\u5f00\u5934\n        scrollback: 100, // \u7ec8\u7aef\u4e2d\u7684\u56de\u6eda\u91cf\n        disableStdin: false, // \u662f\u5426\u5e94\u7981\u7528\u8f93\u5165\u3002\n        cursorStyle: 'underline', // \u5149\u6807\u6837\u5f0f\n        cursorBlink: true, // \u5149\u6807\u95ea\u70c1\n        theme: {\n          foreground: '#ffffff', // \u5b57\u4f53\n          background: '#060101', // \u80cc\u666f\u8272\n          cursor: 'help' // \u8bbe\u7f6e\u5149\u6807\n        }\n      })\n\n      // \u8fde\u63a5Websocket\n      // let ws = new WebSocket(`${settings.wsHost}/host/${route.params.id}/console`)\n      let ws = new WebSocket(`ws://localhost:8888/ping`)\n      let cmd = '';  // \u62fc\u63a5\u7528\u6237\u8f93\u5165\u7684\u5185\u5bb9\n\n      ws.onmessage = (event) => {\n        term.write(event.data);\n      }\n\n      term.prompt = () => {\n        term.write('\\r\\n')\n      }\n\n      // \u5f53\u7528\u6237\u6309\u4e86\u952e\u76d8\u65f6\n      term.onKey(e => {\n        console.log(e.key)\n        const ev = e.domEvent\n        const printable = !ev.altKey && !ev.altGraphKey && !ev.ctrlKey && !ev.metaKey\n\n        if (ev.key === \"Enter\") { // \u56de\u8f66\n          // \u6309\u4e0b\u56de\u8f66\u952e\u8fdb\u884c\u6307\u4ee4\u7684\u53d1\u9001\n          console.log(\"cmd\", cmd)\n          ws.send(cmd)\n          term.write('\\r\\n')\n        } else if (ev.key === \"Backspace\") { // \u5220\u9664\n\n          cmd -= e.key\n          // Do not delete the prompt\n          if (term._core.buffer.x > 2) {\n            term.write('\\b \\b')\n          }\n        } else if (printable) {\n          term.write(e.key)\n          cmd += e.key\n        }\n      })\n\n      // \u663e\u793a\u4e00\u4e2assh\u7ec8\u7aef\u7a97\u53e3\n      term.open(document.getElementById('terminal'))\n    }\n)\n<\/script>\n\n<style scoped>\n\n</style>\n")),(0,o.yg)("p",null,"\u8bbe\u7f6e\u8def\u7531router\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"import Console from '../views/Console'\n// ...\n{\n    meta: {\n        title: '\u8fdc\u7a0b\u4e3b\u673a\u7ba1\u7406',\n        authentication: true\n    },\n    path: 'host/console/:id', // :id \u5c31\u662f\u5f53\u524d\u70b9\u51fb\u7684\u4e3b\u673a\u4fe1\u606f\u7684ID\u4e3b\u952e\n      name: 'Console',\n      component: Console\n},\n")),(0,o.yg)("p",null,"\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"Host.vue"),"\u4e2d\uff0c\u4e3b\u673a\u5217\u8868\u540e\u9762\u7684console\u5bf9\u5e94\u7684\u5730\u5740\uff0c\u5b9e\u73b0\u53c2\u6570\u8df3\u8f6c\u3002"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},"const columns = [\n...\n{\n  title: 'console',\n  dataIndex: 'console',\n},\n...\n]\n...\n<template v-else-if=\"column.dataIndex === 'console'\">\n<router-link :to=\"`/bingo/host/console/${record.id}`\">Console</router-link>\n</template>\n")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910082121387.png",alt:"image-20230910082121387"})),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"\u540e\u7aef\u5b9e\u73b0")),(0,o.yg)("p",null,"\u5b89\u88c5\u4f9d\u8d56\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"go get github.com/gorilla/websocket\n")),(0,o.yg)("p",null,"\u5b98\u65b9\u6587\u6863\uff1a",(0,o.yg)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/gorilla/websocket"},"https://pkg.go.dev/github.com/gorilla/websocket")),(0,o.yg)("p",null,"\u540e\u7aef\u5b9e\u73b0websocket\u7684\u53c2\u8003\u4ee3\u7801\uff0c\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"test/webssh/main.go"),"\u4e2d"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "github.com/gin-gonic/gin"\n    "github.com/gorilla/websocket"\n    "net/http"\n)\n\nvar upGrader = websocket.Upgrader{\n    CheckOrigin: func(r *http.Request) bool {\n        return true\n    },\n}\n\n//webSocket\u8bf7\u6c42ping \u8fd4\u56depong\nfunc ping(c *gin.Context) {\n    //\u5347\u7ea7get\u8bf7\u6c42\u4e3awebSocket\u534f\u8bae\n    ws, err := upGrader.Upgrade(c.Writer, c.Request, nil)\n    if err != nil {\n        return\n    }\n\n    defer func(ws *websocket.Conn) {\n        _ = ws.Close()\n    }(ws)\n\n    for {\n        // \u8bfb\u53d6ws\u4e2d\u7684\u6570\u636e\n        mt, message, err := ws.ReadMessage()\n        if err != nil {\n            break\n        }\n        if string(message) == "ping" {\n            message = []byte("pong")\n        }\n        //\u5199\u5165ws\u6570\u636e\n        err = ws.WriteMessage(mt, message)\n        if err != nil {\n            break\n        }\n    }\n}\n\nfunc main() {\n    bindAddress := "localhost:8888"\n    r := gin.Default()\n    r.GET("/ping", ping)\n    r.Run(bindAddress)\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910082138205-4305300.png",alt:"image-20230910082138205"})),(0,o.yg)("h3",{id:"433console\u529f\u80fd"},"4.3.3\u3001Console\u529f\u80fd"),(0,o.yg)("h4",{id:"\u524d\u7aef\u5b9e\u73b0"},(0,o.yg)("strong",{parentName:"h4"},"\u3010\u524d\u7aef\u5b9e\u73b0\u3011")),(0,o.yg)("p",null,"\u4fee\u6539\u7ec4\u4ef6",(0,o.yg)("inlineCode",{parentName:"p"},"views/Console.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},"<template>\n  <div className=\"console\">\n    <div id=\"terminal\"></div>\n  </div>\n</template>\n\n<script setup>\nimport {onMounted} from \"vue\";\nimport {Terminal} from 'xterm'\nimport settings from \"@/settings\";\nimport {useRoute} from \"vue-router\"\n\nconst route = useRoute()\n\n// \u56e0\u7232xterm\u7ec8\u7aef\u9700\u8981\u4fee\u6539HTML\u4ee3\u7801\uff0c\u6240\u4ee5\u5fc5\u987b\u7b49vue\u663e\u793a\u4e86\u9875\u9762\u5185\u5bb9\u4ee5\u540e\u624d\u80fd\u6267\u884cxterm\u76f8\u5173\u7684\u4ee3\u7801\nonMounted(\n    () => {\n      let term = new Terminal({\n        rendererType: 'canvas', // \u6e32\u67d3\u7c7b\u578b\n        cols: 100, // \u5217\u6570\n        rows: 50, // \u884c\u6570\n        convertEol: true, // \u542f\u7528\u65f6\uff0c\u5149\u6807\u5c06\u8bbe\u7f6e\u4e3a\u4e0b\u4e00\u884c\u7684\u5f00\u5934\n        scrollback: 100, // \u7ec8\u7aef\u4e2d\u7684\u56de\u6eda\u91cf\n        disableStdin: false, // \u662f\u5426\u5e94\u7981\u7528\u8f93\u5165\u3002\n        cursorStyle: 'underline', // \u5149\u6807\u6837\u5f0f\n        cursorBlink: true, // \u5149\u6807\u95ea\u70c1\n        theme: {\n          foreground: '#ffffff', // \u5b57\u4f53\n          background: '#060101', // \u80cc\u666f\u8272\n          cursor: 'help' // \u8bbe\u7f6e\u5149\u6807\n        }\n      })\n\n      // \u8fde\u63a5Websocket\n      let ws = new WebSocket(`${settings.wsHost}/host/${route.params.id}/console`)\n      let cmd = '';  // \u62fc\u63a5\u7528\u6237\u8f93\u5165\u7684\u5185\u5bb9\n\n      ws.onmessage = (event) => {\n\n        console.log(\"cmd:\", cmd)\n        console.log(\"event.data:\", event.data)\n\n        if (!cmd) {\n          //\u6240\u8981\u6267\u884c\u7684\u64cd\u4f5c\n          term.write(event.data);\n        } else {\n          cmd = ''\n          term.write(event.data)\n        }\n      }\n\n      term.prompt = () => {\n        term.write('\\r\\n')\n      }\n\n      // \u5f53\u7528\u6237\u6309\u4e86\u952e\u76d8\u65f6\n      term.onKey(e => {\n        console.log(e.key)\n        const ev = e.domEvent\n        const printable = !ev.altKey && !ev.altGraphKey && !ev.ctrlKey && !ev.metaKey\n\n        if (ev.key === \"Enter\") { // \u56de\u8f66\n          // \u6309\u4e0b\u56de\u8f66\u952e\u8fdb\u884c\u6307\u4ee4\u7684\u53d1\u9001\n          console.log(\"cmd\", cmd)\n          ws.send(cmd)\n          term.write('\\r\\n')\n        } else if (ev.key === \"Backspace\") { // \u5220\u9664\n          cmd = cmd.slice(0, cmd.length - 1)\n          // Do not delete the prompt\n          if (term._core.buffer.x > 2) {\n            term.write('\\b \\b')\n          }\n        } else if (printable) {\n          term.write(e.key)\n          cmd += e.key\n        }\n      })\n\n      // \u663e\u793a\u4e00\u4e2assh\u7ec8\u7aef\u7a97\u53e3\n      term.open(document.getElementById('terminal'))\n    }\n)\n<\/script>\n\n<style scoped>\n\n</style>\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"setting.js")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"const settings = {\n    host: \"http://127.0.0.1:8090/api\",\n    wsHost: 'ws://127.0.0.1:8090/api', // websocket\u670d\u52a1\u7aef\u7684api\u670d\u52a1\u7aef\u5730\u5740\n}\n\nexport default settings;\n")),(0,o.yg)("h4",{id:"\u540e\u7aef\u5b9e\u73b0"},(0,o.yg)("strong",{parentName:"h4"},"\u3010\u540e\u7aef\u5b9e\u73b0\u3011")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/utils/ws.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package utils\n\nimport (\n    "github.com/gorilla/websocket"\n    "net/http"\n)\n\nvar UpGrader = websocket.Upgrader{\n    // \u8bbe\u7f6e\u5141\u8bb8\u8de8\u57df\u8fdb\u884cws\u901a\u4fe1\n    CheckOrigin: func(r *http.Request) bool {\n        return true\n    },\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/utils/ssh.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package utils\n\nimport (\n    "bingo_api/application/constants"\n    "errors"\n    "fmt"\n    "github.com/gorilla/websocket"\n    "go.uber.org/zap"\n    "golang.org/x/crypto/ssh"\n    "strings"\n    "time"\n)\n\n// SSH \u5ba2\u6237\u7aef\u8fde\u63a5\u4fe1\u606f\u7684\u7ed3\u6784\u4f53\ntype SSH struct {\n    IP       string      // IP\u5730\u5740\n    Port     int         // \u7aef\u53e3\u53f7\n    Username string      // \u7528\u6237\u540d\n    Mode     string      // \u8ba4\u8bc1\u65b9\u5f0f[password:\u5bc6\u7801\uff0ckey:\u79d8\u94a5\u8ba4\u8bc1]\n    Password string      // \u5bc6\u7801\n    Key      string      // \u8ba4\u8bc1\u79c1\u94a5\n    Client   *ssh.Client // ssh\u5ba2\u6237\u7aef\n\n    // console\n    Session    *ssh.Session // ssh\u4f1a\u8bdd\u5bf9\u8c61\n    Channel    ssh.Channel  // ssh\u901a\u4fe1\u7ba1\u9053\n    LastResult string       // \u6700\u8fd1\u4e00\u6b21\u6267\u884c\u547d\u4ee4\u7684\u7ed3\u679c\n\n}\n\nfunc NewSSH(ip string, username string, password string, key string, mode string, port ...int) *SSH {\n    /**\n    \u521b\u5efa\u547d\u4ee4\u884c\u5b9e\u4f8b\n    @param ip IP\u5730\u5740\n    @param username \u7528\u6237\u540d\n    @param password \u767b\u9646\u5bc6\u7801\n    @param key \u8ba4\u8bc1\u79c1\u94a5\n    @param mode \u8ba4\u8bc1\u6a21\u5f0f( password: \u5bc6\u7801 | key: \u79d8\u94a5 )\n    @param port \u7aef\u53e3\u53f7, \u4e0d\u586b\u5199\u5219\u9ed8\u8ba4\u4e3a22\n    */\n\n    client := new(SSH)\n    client.IP = ip\n    client.Username = username\n    client.Password = password\n    client.Key = key\n    client.Mode = mode\n\n    if len(port) <= 0 {\n        client.Port = 22\n    } else {\n        client.Port = port[0]\n    }\n\n    return client\n}\n\nfunc (s *SSH) Connect() error {\n    /**\n    SSH\u8fde\u63a5\n    */\n    config := ssh.ClientConfig{\n        User:            s.Username,\n        HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n        Timeout:         10 * time.Second,\n    }\n\n    // \u5224\u65adSSH\u8fde\u63a5\u7684\u8ba4\u8bc1\u65b9\u5f0f\n    if s.Mode == "key" {\n        //fmt.Println("s.Key", s.Key)\n        signer, err := ssh.ParsePrivateKey([]byte(s.Key))\n        fmt.Println("signer", signer)\n        if err != nil {\n            zap.S().Fatalf("ssh key signer failed: %v", err)\n        }\n        config.Auth = []ssh.AuthMethod{ssh.PublicKeys(signer)}\n    } else {\n        fmt.Println("s.Password", s.Password)\n        config.Auth = []ssh.AuthMethod{ssh.Password(s.Password)}\n    }\n\n    // \u521b\u5efaSSH\u5ba2\u6237\u7aef\n    addr := fmt.Sprintf("%s:%d", s.IP, s.Port)\n    sshClient, err := ssh.Dial("tcp", addr, &config)\n    if err != nil {\n        return err\n    }\n    s.Client = sshClient\n    fmt.Println("sshClient", sshClient)\n\n    // \u521b\u5efa\u4e00\u4e2a\u5ba2\u6237\u7aefSSH\n    session, err := s.Client.NewSession()\n    if err != nil {\n        return err\n    }\n    s.Session = session\n\n    return nil\n\n}\n\nfunc (s SSH) Run(command string) (string, error) {\n    /**\n    \u6267\u884cShell\u547d\u4ee4\n    @param command \u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u591a\u4e2a\u547d\u4ee4\u91c7\u7528 ; \u9694\u5f00\n    */\n    if s.Client == nil {\n        if err := s.Connect(); err != nil {\n            return "", err\n        }\n    }\n    // \u521b\u5efa\u4e00\u4e2a\u5ba2\u6237\u7aefSSH\n    session, err := s.Client.NewSession()\n    if err != nil {\n        return "", err\n    }\n    defer session.Close()\n    // \u6267\u884cShell\u547d\u4ee4\n    buf, err := session.CombinedOutput(command)\n\n    s.LastResult = string(buf)\n    return s.LastResult, err\n}\n\nfunc (s SSH) AddPublicKeyToRemoteHost(publicKey string) error {\n    /**\n    \u5c06\u516c\u94a5\u5199\u5165\u76ee\u6807\u4e3b\u673a\n    700 \u662f\u6587\u6863\u62e5\u6709\u53ef\u8bfb\u53ef\u5199\u53ef\u6267\u884c\uff0c\u540c\u4e00\u7ec4\u7528\u6237\u6216\u8005\u5176\u4ed6\u7528\u6237\u90fd\u4e0d\u5177\u6709\u64cd\u4f5c\u6743\u9650\n    600 \u662f\u6587\u4ef6\u62e5\u6709\u8005\u53ef\u8bfb\u53ef\u5199\uff0c\u4e0d\u53ef\u6267\u884c\uff0c\u540c\u4e00\u7ec4\u7528\u6237\u6216\u8005\u5176\u4ed6\u7528\u6237\u90fd\u4e0d\u5177\u6709\u64cd\u4f5c\u6743\u9650\n    */\n    command := fmt.Sprintf("mkdir -p -m 700 ~/.ssh && echo %v >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys", strings.TrimSpace(publicKey))\n    _, err := s.Run(command)\n    if err != nil {\n        message := fmt.Sprintf("%v: %v", constants.AddPublicKeyFail, err)\n        return errors.New(message)\n    }\n    return nil\n}\n\n/*\n*************************** Web2SSH  ***************************\n */\n\ntype MyReader struct {\n    // \u76d1\u542cwebsocket\n    ws *websocket.Conn\n}\n\nfunc (r MyReader) Read(p []byte) (n int, err error) {\n    // \u4ece\u5ba2\u6237\u7aef\uff08VUE\uff09\u63a5\u53d7\u7684\u547d\u4ee4\u5b57\u7b26\u4e32\n    fmt.Println("\u6b63\u5728\u76d1\u542c\uff1a", r.ws.RemoteAddr())\n    _, cmd, err := r.ws.ReadMessage()\n    fmt.Println("received cmd:", cmd)\n    if err != nil {\n        fmt.Println("err", err)\n    }\n    cmdB := []byte(string(cmd) + "\\n")\n    // \u5c06\u547d\u4ee4\u5b57\u7b26\u4e32\u5199\u5165\u5230p\u4e2d\n    for i, v := range cmdB {\n        p[i] = v\n    }\n    n = len(cmdB)\n\n    return n, err\n}\n\ntype MyWriter struct {\n    ws *websocket.Conn\n}\n\nfunc (w MyWriter) Write(p []byte) (n int, err error) {\n\n    if len(p) != 0 {\n        err := w.ws.WriteMessage(websocket.TextMessage, p)\n        if err != nil {\n            fmt.Println("err", err)\n            return len(p), err\n        }\n    }\n\n    return len(p), err\n}\n\nfunc (s SSH) Web2SSH(ws *websocket.Conn) {\n\n    // \uff081\uff09\u914d\u7f6e\u548c\u521b\u5efa\u4e00\u4e2a\u4f2a\u7ec8\u7aef\n    modes := ssh.TerminalModes{\n        ssh.ECHO:          0,     // \u5173\u95ed\u56de\u663e\u793a,\n        ssh.TTY_OP_ISPEED: 14400, // \u8bbe\u7f6e\u4f20\u8f93\u901f\u7387\n        ssh.TTY_OP_OSPEED: 14400, // \u8bbe\u7f6e\u4f20\u8f93\u901f\u7387\n    }\n    // \u6fc0\u6d3b\u7ec8\u7aef\n    err := s.Session.RequestPty("xterm", 25, 80, modes)\n    if err != nil {\n        fmt.Println("err", err)\n    }\n    // \uff082\uff09\u6fc0\u6d3bshell\n    // stdin,stdout\u8d4b\u503c\n    r := new(MyReader)\n    r.ws = ws\n    w := new(MyWriter)\n    w.ws = ws\n    s.Session.Stdin = r\n    s.Session.Stdout = w\n\n    err = s.Session.Shell() // \u5173\u4e8esession\u6fc0\u6d3b\n    if err != nil {\n        fmt.Println("err", err)\n    }\n    // \u7ed3\u679c\u7b49\u5f85\n    err = s.Session.Wait()\n    if err != nil {\n        fmt.Println("err", err)\n    }\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"appliation/api/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'/*websocket\u8bf7\u6c42*/\n\nfunc HostConsole(ctx *gin.Context) {\n    // \u4e00\u3001\u51c6\u5907\u9636\u6bb5\n    // \u540c\u610f\u5347\u7ea7websocket\u8bf7\u6c42\n    ws, err := UpGrader.Upgrade(ctx.Writer, ctx.Request, nil)\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeFail,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    // \u6839\u636eID\u83b7\u53d6\u4e3b\u673a\u8fde\u63a5\u4fe1\u606f\n    id, err := strconv.Atoi(ctx.Param("id"))\n    fmt.Println("id", id)\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeFail,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    host := model.Host{}\n    err = host.GetOneById(uint(int(id)))\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeFail,\n            "message": err.Error(),\n        })\n        return\n    }\n    fmt.Println("host:::", host)\n\n    // \u521b\u5efaSSh\u8fdc\u7a0b\u8fde\u63a5\uff0c\n    cli := NewSSH(host.IpAddr, host.Username, "", host.PrivateKey, "key", int(host.Port))\n    if err := cli.Connect(); err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeFail,\n            "message": err.Error(),\n        })\n        return\n    }\n    fmt.Println("\u5bc6\u94a5\u767b\u5f55\u6210\u529f\uff01")\n\n    // \u4e8c\u3001\u5b9e\u73b0\u4e00\u4e2aweb-ssh\u547d\u4ee4\u901a\u4fe1\n\n    cli.Web2SSH(ws)\n\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/router/host.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'HostRouter := Router.Group("host")\n// HostRouter.Use(middleware.JWTAuthorization())\n{\n// \u7528\u6237\u8ba4\u8bc1\u767b\u9646\nHostRouter.POST("/", api.HostCreate)\nHostRouter.GET("/", api.HostList)\n\n// \u4e3b\u673a\u7c7b\u522b-\u6dfb\u52a0\nutils.Register(HostRouter, []string{"POST"}, "category", api.HostCategoryCreate)\n// \u4e3b\u673a\u7c7b\u522b-\u67e5\u770b\nutils.Register(HostRouter, []string{"GET"}, "category", api.HostCategoryList)\n// \u4e3b\u673a - \u5217\u8868\nutils.Register(HostRouter, []string{"GET"}, "", api.HostList)\n// \u4e3b\u673a - \u5220\u9664\nutils.Register(HostRouter, []string{"DELETE"}, "", api.HostDelete)\n// \u4e3b\u673a - console\u529f\u80fd\nutils.Register(HostRouter, []string{"GET"}, ":id/console", api.HostConsole)\n\n    }\n\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230910082208783.png",alt:"image-20230910082208783"})),(0,o.yg)("h1",{id:"\u4e94\u6279\u91cf\u547d\u4ee4"},"\u4e94\u3001\u6279\u91cf\u547d\u4ee4"),(0,o.yg)("h2",{id:"51-\u5c55\u793a\u4e3b\u673a\u4fe1\u606f"},"5.1 \u5c55\u793a\u4e3b\u673a\u4fe1\u606f"),(0,o.yg)("p",null,"\u521b\u5efa\u7ec4\u4ef6\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/views/MultiExec.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="multi_exec">\n    <div>\n      <h3>\u6267\u884c\u4e3b\u673a\uff1a</h3>\n      <div>\n        <a-tag closable @close="log(info_index)" v-for="(info,info_index) in show_host_info.data" :key="info.id">\n          {{`${info.name}(${info.ip_addr}:${info.port})`}}\n        </a-tag>\n      </div>\n    </div>\n    <div style="margin-top: 10px;">\n      <a-button @click="showModal"><plus-outlined />\u4ece\u4e3b\u673a\u5217\u8868\u4e2d\u9009\u62e9</a-button>\n      <a-modal :visible="visible" title="\u9009\u62e9\u6267\u884c\u4e3b\u673a" @ok="handleOk" @cancel="hideModel" width="960px">\n        <div>\n          <a-row>\n            <a-col :span="8">\n              <a-form-item label="\u4e3b\u673a\u7c7b\u522b\uff1a" :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol">\n                <a-select style="width: 160px;" placeholder="\u8bf7\u9009\u62e9" v-model="host_form.form.category">\n                  <a-select-option :value="value.id" v-for="(value, index) in category_list.data" :key="value.id">\n                    {{value.name}}\n                  </a-select-option>\n                </a-select>\n              </a-form-item>\n            </a-col>\n            <a-col :span="8">\n              <a-form-item :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol" label="\u4e3b\u673a\u522b\u540d\uff1a">\n                <a-input placeholder="\u8bf7\u8f93\u5165"/>\n              </a-form-item>\n            </a-col>\n            <a-col :span="4">\n              <a-form-item :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol" label="\u5df2\u9009\uff1a">\n                <span style="margin-left: 8px">\n                  <template v-if="hasSelected">\n                    {{ `${selectedRowKeys.length}` }} \u53f0\u4e3b\u673a\n                  </template>\n                </span>\n              </a-form-item>\n            </a-col>\n            <a-col :span="4">\n              <a-button type="primary" style="margin-top: 3px;"> <sync-outlined></sync-outlined>\u5237\u65b0</a-button>\n            </a-col>\n          </a-row>\n        </div>\n        <div>\n          <a-table\n              :columns="columns"\n              :data-source="host_list.data"\n              :pagination="false"\n              :rowKey="record => record.id"\n              :row-selection="{ selectedRowKeys: selectedRowKeys, onChange: onSelectChange }"\n          ></a-table>\n        </div>\n      </a-modal>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport {ref, reactive, computed} from "vue";\nimport {PlusOutlined, SyncOutlined} from \'@ant-design/icons-vue\';\n\n// \u8868\u5355\u5206\u680f\u5e03\u5c40\u957f\u5ea6\uff0c\u5f39\u7a97\u7684\u9996\u884c\u8868\u5355\u914d\u7f6e\u4fe1\u606f\nconst formItemLayout = reactive({\n  labelCol: {span: 8},\n  wrapperCol: {span: 14}\n})\n// \u8868\u5355\u7684\u5b57\u6bb5\u8bbe\u7f6e\uff0c\u5f39\u7a97\u7684\u8868\u683c\u7684\u6bcf\u4e00\u5217\u6570\u636e\u7684\u914d\u7f6e\u4fe1\u606f\nconst columns = ref([\n  {\n    slots: {title: \'customTitle\'},\n    scopedSlots: {customRender: \'action\'}\n  }, {\n    title: \'\u7c7b\u522b\',\n    dataIndex: \'category_name\',\n    key: \'category_name\'\n  }, {\n    title: \'\u4e3b\u673a\u540d\u79f0\',\n    dataIndex: \'name\',\n    key: \'name\'\n  }, {\n    title: \'\u8fde\u63a5\u5730\u5740\',\n    dataIndex: \'ip_addr\',\n    key: \'ip_addr\',\n    width: 200\n  }, {\n    title: \'\u7aef\u53e3\',\n    dataIndex: \'port\',\n    key: \'port\'\n  }, {\n    title: \'\u5907\u6ce8\u4fe1\u606f\',\n    dataIndex: \'description\',\n    key: \'description\'\n  }\n])\n\n// \u663e\u793a\u9009\u4e2d\u7684\u6240\u6709\u4e3b\u673a\u5185\u5bb9\nconst show_host_info = reactive({\n  data:[]\n})\nconst visible = ref(false) // \u662f\u5426\u663e\u793a\u4e3b\u673a\u5217\u8868\u7684\u5f39\u7a97\n\n// \u4e3b\u673a\u8868\u5355\u4fe1\u606f\nconst host_form = reactive({\n  form: {\n    category: undefined // \u5f53\u524d\u9009\u62e9\u7684\u4e3b\u673a\u5206\u7c7bID\n  }\n})\n\n// \u5f53\u524d\u663e\u793a\u548b\u8868\u683c\u4e2d\u7684\u4e3b\u673a\u5217\u8868\u6570\u636e\nconst host_list = reactive({\n  data: []\n})\n\n// \u4e3b\u673a\u5206\u7c7b\u5217\u8868\nconst category_list = reactive({\n  data: []\n})\n\n// \u5df2\u7ecf\u52fe\u9009\u7684\u4e3b\u673aID\u5217\u8868\nconst selectedRowKeys = ref([])\n// \u9009\u4e2d\u7684\u4e3b\u673aid\u5217\u8868\nconst selected_host_ids = ref([])\n\n// \u8ba1\u7b97\u5c5e\u6027\nconst hasSelected = computed(()=>{\n  return selectedRowKeys.length > 0\n})\n\n// \u663e\u793a\u5f39\u7a97\nconst showModal = ()=>{\n  visible.value = true\n}\n\n// \u5173\u95ed\u5f39\u7a97\nconst hideModel = ()=>{\n  visible.value = false;\n}\n\n// \u9009\u4e2d\u4e3b\u673a\u65f6\u89e6\u53d1\u7684\uff0cselectedRowKeys\u88ab\u9009\u4e2d\u7684\u4e3b\u673aid\u5217\u8868\nconst onSelectChange = (selectedKeys)=>{\n  selectedRowKeys.value = selectedKeys\n}\n\nconst handleOk = ()=>{\n\n}\n\n<\/script>\n\n<style scoped>\n.multi_exec{\n  text-align: left;\n}\n</style>\n')),(0,o.yg)("p",null,"\u8def\u7531\u4ee3\u7801\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/router/index.js"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"import MultiExec from '../views/MultiExec'\n// ...       \n{\n        meta: {\n            title: '\u6279\u91cf\u4efb\u52a1',\n            authenticate: true\n        },\n        path: 'multi_exec',\n        name: 'MultiExec',\n        component: MultiExec\n},\n")),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230108152017505-8013031.png",alt:"image-20230108152017505"})),(0,o.yg)("p",null,"\u83b7\u53d6\u4e3b\u673a\u5206\u7c7b\u548c\u4e3b\u673a\u4fe1\u606f\u7684\u5217\u8868\u6570\u636e\u5e76\u5c55\u793a\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/views/MultiExec.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="multi_exec">\n    <div>\n      <h3>\u6267\u884c\u4e3b\u673a\uff1a</h3>\n      <div>\n        <a-tag closable @close="delete_select_host(info_index)" v-for="(info,info_index) in show_host_info.data"\n               :key="info.id">\n          {{ `${info.name}(${info.ip_addr}:${info.port})` }}\n        </a-tag>\n      </div>\n    </div>\n    <div style="margin-top: 10px;">\n      <a-button @click="showModal">\n        <plus-outlined/>\n        \u4ece\u4e3b\u673a\u5217\u8868\u4e2d\u9009\u62e9\n      </a-button>\n      <a-modal :visible="visible" title="\u9009\u62e9\u6267\u884c\u4e3b\u673a" @ok="handleOk" @cancel="hideModel" width="960px">\n        <div>\n          <a-row>\n            <a-col :span="8">\n              <a-form-item label="\u4e3b\u673a\u7c7b\u522b\uff1a" :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol">\n                <a-select style="width: 160px;" placeholder="\u8bf7\u9009\u62e9" v-model:value="host_form.form.host_category_id"\n                          @change="has_change_category">\n                  <a-select-option :value="value.id" v-for="(value, index) in category_list.data" :key="value.id">\n                    {{ value.name }}\n                  </a-select-option>\n                </a-select>\n              </a-form-item>\n            </a-col>\n            <a-col :span="8">\n              <a-form-item :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol" label="\u4e3b\u673a\u522b\u540d\uff1a">\n                <a-input @blur="nameFilter" v-model:value="host_form.form.name" placeholder="\u8bf7\u8f93\u5165"/>\n              </a-form-item>\n            </a-col>\n            <a-col :span="4">\n              <a-form-item :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol" label="\u5df2\u9009\uff1a">\n                <span style="margin-left: 8px">\n                                    {{ `${selectedRowKeys.length}` }}\u53f0\u4e3b\u673a\n                </span>\n              </a-form-item>\n            </a-col>\n            <a-col :span="4">\n              <a-button type="primary" style="margin-top: 3px;" @click="refresh_data">\n                <sync-outlined></sync-outlined>\n                \u5237\u65b0\n              </a-button>\n            </a-col>\n          </a-row>\n        </div>\n        <div>\n          <a-table\n              :columns="columns"\n              :data-source="host_list.data"\n              :pagination="false"\n              :rowKey="record => record.id"\n              :row-selection="{ selectedRowKeys: selectedRowKeys, onChange: onSelectChange }"\n          ></a-table>\n        </div>\n      </a-modal>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport {computed, reactive, ref} from "vue";\nimport {PlusOutlined, SyncOutlined} from \'@ant-design/icons-vue\';\nimport settings from "../settings";\nimport axios from "@/utils/http";\n\n// \u8868\u5355\u5206\u680f\u5e03\u5c40\u957f\u5ea6\uff0c\u5f39\u7a97\u7684\u9996\u884c\u8868\u5355\u914d\u7f6e\u4fe1\u606f\nconst formItemLayout = reactive({\n  labelCol: {span: 8},\n  wrapperCol: {span: 14}\n})\n// \u8868\u5355\u7684\u5b57\u6bb5\u8bbe\u7f6e\uff0c\u5f39\u7a97\u7684\u8868\u683c\u7684\u6bcf\u4e00\u5217\u6570\u636e\u7684\u914d\u7f6e\u4fe1\u606f\nconst columns = ref([\n  {\n    slots: {title: \'customTitle\'},\n    scopedSlots: {customRender: \'action\'}\n  }, {\n    title: \'\u7c7b\u522b\',\n    dataIndex: \'category_name\',\n    key: \'category_name\'\n  }, {\n    title: \'\u4e3b\u673a\u540d\u79f0\',\n    dataIndex: \'name\',\n    key: \'name\'\n  }, {\n    title: \'\u8fde\u63a5\u5730\u5740\',\n    dataIndex: \'ip_addr\',\n    key: \'ip_addr\',\n    width: 200\n  }, {\n    title: \'\u7aef\u53e3\',\n    dataIndex: \'port\',\n    key: \'port\'\n  }, {\n    title: \'\u5907\u6ce8\u4fe1\u606f\',\n    dataIndex: \'description\',\n    key: \'description\'\n  }\n])\n\n// \u663e\u793a\u9009\u4e2d\u7684\u6240\u6709\u4e3b\u673a\u5185\u5bb9\nconst show_host_info = reactive({\n  data: []\n})\nconst visible = ref(false) // \u662f\u5426\u663e\u793a\u4e3b\u673a\u5217\u8868\u7684\u5f39\u7a97\n\n// \u4e3b\u673a\u8868\u5355\u4fe1\u606f\nconst host_form = reactive({\n  form: {\n    host_category_id: undefined,// \u5f53\u524d\u9009\u62e9\u7684\u4e3b\u673a\u5206\u7c7bID\n    name:""\n  }\n})\n\n// \u5f53\u524d\u663e\u793a\u548b\u8868\u683c\u4e2d\u7684\u4e3b\u673a\u5217\u8868\u6570\u636e\nconst host_list = reactive({\n  data: []\n})\n\n// \u4e3b\u673a\u5206\u7c7b\u5217\u8868\nconst category_list = reactive({\n  data: []\n})\n\n// \u5df2\u7ecf\u52fe\u9009\u7684\u4e3b\u673aID\u5217\u8868\nconst selectedRowKeys = ref([])\n// \u9009\u4e2d\u7684\u4e3b\u673aid\u5217\u8868\nconst selected_host_ids = ref([])\n\n// \u8ba1\u7b97\u5c5e\u6027\nconst hasSelected = computed(() => {\n  return selectedRowKeys.length > 0\n})\n\n// \u663e\u793a\u5f39\u7a97\nconst showModal = () => {\n  visible.value = true\n}\n\n// \u5173\u95ed\u5f39\u7a97\nconst hideModel = () => {\n  visible.value = false;\n}\n\n// \u9009\u4e2d\u4e3b\u673a\u65f6\u89e6\u53d1\u7684\uff0cselectedRowKeys\u88ab\u9009\u4e2d\u7684\u4e3b\u673aid\u5217\u8868\nconst onSelectChange = (selectedKeys) => {\n  selectedRowKeys.value = selectedKeys\n}\n\nconst get_host_category_list = () => {\n  // \u83b7\u53d6\u4e3b\u673a\u7c7b\u522b\n  axios.get(`${settings.host}/host/category`).then((response) => {\n    category_list.data = response.data.data.host_category_list\n  })\n}\nget_host_category_list()\n\n\nconst get_host_list = () => {\n  // \u83b7\u53d6\u4e3b\u673a\u5217\u8868\n  console.log("host_form.form",host_form.form)\n  let params = host_form.form\n  axios.get(`${settings.host}/host`, {\n    params: params,\n  }).then((response) => {\n    host_list.data = response.data.data.host_list\n  })\n}\n\nget_host_list()\n\nconst has_change_category = (category) => {\n  // \u5207\u6362\u4e3b\u673a\u5206\u7c7b\u65f6\uff0c\u91cd\u65b0\u83b7\u53d6\u4e3b\u673a\u5217\u8868\n  console.log("category", category)\n  get_host_list()\n}\n\nconst nameFilter = (event) => {\n  // \u5207\u6362\u4e3b\u673a\u5206\u7c7b\u65f6\uff0c\u91cd\u65b0\u83b7\u53d6\u4e3b\u673a\u5217\u8868\n  console.log(host_form.form.name)\n  get_host_list()\n}\n\n\nconst refresh_data = () => {\n  // \u5237\u65b0\u9875\u9762\n  // location.reload()\n  // \u5237\u65b0\u6570\u636e\n  get_host_list()\n  host_form.form.host_category_id = undefined\n  selectedRowKeys.value = []\n}\n\nconst handleOk = () => {\n  selected_host_ids.value = []\n  show_host_info.data = []\n  host_list.data.forEach((v, k) => {\n    if (selectedRowKeys.value.includes(v.id)) { // \u5224\u65ad\u67d0\u5143\u7d20\u662f\u5426\u5728\u6570\u7ec4\u4e2d\u7528includes\u6bd4\u8f83\u5408\u9002\uff0c\u4e0d\u80fd\u7528in\n      show_host_info.data.push({\n        id: v.id,\n        name: v.name,\n        ip_addr: v.ip_addr,\n        port: v.port\n      })\n      selected_host_ids.value.push(v.id)\n    }\n  })\n  // \u5173\u95ed\u5f39\u7a97\n  visible.value = false\n}\n\nconst delete_select_host = (infoIndex) => {\n  // \u79fb\u9664\u5df2\u7ecf\u52fe\u9009\u7684\u4e3b\u673a\u4fe1\u606f\n  show_host_info.data.splice(infoIndex, 1)\n  let idsList = selected_host_ids.value.splice(infoIndex, 1)\n  let idIndex = selectedRowKeys.value.indexOf(idsList[0])\n  selectedRowKeys.value.splice(idIndex, 1)\n}\n\n<\/script>\n\n<style scoped>\n.multi_exec {\n  text-align: left;\n}\n</style>\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230108160337125-8013031.png",alt:"image-20230108160337125"})),(0,o.yg)("h2",{id:"52-\u6307\u4ee4\u8f93\u5165\u6846"},"5.2 \u6307\u4ee4\u8f93\u5165\u6846"),(0,o.yg)("h3",{id:"521ace-editor-\u7f16\u8f91\u5668"},"5.2.1\u3001Ace-editor \u7f16\u8f91\u5668"),(0,o.yg)("p",null,"\u6587\u6863\u5730\u5740\uff1a ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/CarterLi/vue3-ace-editor"},"https://github.com/CarterLi/vue3-ace-editor")),(0,o.yg)("p",null,"\u5ba2\u6237\u7aef\u6839\u76ee\u5f55\u4e0b\uff0c\u4e0b\u8f7d\u5b89\u88c5"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-shell"},"npm install --save-dev vue3-ace-editor\n")),(0,o.yg)("p",null,"\u5728\u9700\u8981\u5f15\u5165\u7f16\u8f91\u5668\u63d2\u4ef6\u5230MultiExec.vue\u4e2d\u4f7f\u7528\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/views/MultiExec.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<div class="cmd">\n      <div>\u6267\u884c\u6307\u4ee4\uff1a </div>\n      <v-ace-editor v-model:value="content" lang="sh" theme="chrome" style="height: 300px; font-size: 20px;margin-bottom: 1rem;"></v-ace-editor>\n</div>\n<div>\n  <a-button type="primary" ><thunderbolt-outlined></thunderbolt-outlined>\u5f00\u59cb\u6267\u884c</a-button>\n</div>\n\n...\n<script setup>\n...\nimport {VAceEditor} from \'vue3-ace-editor\';\nimport \'ace-builds/src-noconflict/theme-chrome\';\nimport \'ace-builds/src-noconflict/ext-language_tools\';\nimport \'ace-builds/src-noconflict/mode-sh\';\nimport {ThunderboltOutlined} from \'@ant-design/icons-vue\';\n...  \n\n\n// \u7528\u6237\u8f93\u5165\u7684\u6a21\u677f\u547d\u4ee4\nconst content = ref("")\n<\/script>  \n  \n\n')),(0,o.yg)("p",null,"\u5b8c\u6574\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="multi_exec">\n    <div>\n      <h3>\u6267\u884c\u4e3b\u673a\uff1a</h3>\n      <div>\n        <a-tag closable @close="delete_select_host(info_index)" v-for="(info,info_index) in show_host_info.data"\n               :key="info.id">\n          {{ `${info.name}(${info.ip_addr}:${info.port})` }}\n        </a-tag>\n      </div>\n    </div>\n    <div style="margin-top: 10px;">\n      <a-button @click="showModal">\n        <plus-outlined/>\n        \u4ece\u4e3b\u673a\u5217\u8868\u4e2d\u9009\u62e9\n      </a-button>\n      <a-modal :visible="visible" title="\u9009\u62e9\u6267\u884c\u4e3b\u673a" @ok="handleOk" @cancel="hideModel" width="960px">\n        <div>\n          <a-row>\n            <a-col :span="8">\n              <a-form-item label="\u4e3b\u673a\u7c7b\u522b\uff1a" :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol">\n                <a-select style="width: 160px;" placeholder="\u8bf7\u9009\u62e9" v-model:value="host_form.form.category"\n                          @change="has_change_category">\n                  <a-select-option :value="value.id" v-for="(value, index) in category_list.data" :key="value.id">\n                    {{ value.name }}\n                  </a-select-option>\n                </a-select>\n              </a-form-item>\n            </a-col>\n            <a-col :span="8">\n              <a-form-item :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol" label="\u4e3b\u673a\u522b\u540d\uff1a">\n                <a-input placeholder="\u8bf7\u8f93\u5165"/>\n              </a-form-item>\n            </a-col>\n            <a-col :span="4">\n              <a-form-item :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol" label="\u5df2\u9009\uff1a">\n                <span style="margin-left: 8px">\n                                    {{ `${selectedRowKeys.length}` }}\u53f0\u4e3b\u673a\n                </span>\n              </a-form-item>\n            </a-col>\n            <a-col :span="4">\n              <a-button type="primary" style="margin-top: 3px;" @click="refresh_data">\n                <sync-outlined></sync-outlined>\n                \u5237\u65b0\n              </a-button>\n            </a-col>\n          </a-row>\n        </div>\n        <div>\n          <a-table\n              :columns="columns"\n              :data-source="host_list.data"\n              :pagination="false"\n              :rowKey="record => record.id"\n              :row-selection="{ selectedRowKeys: selectedRowKeys, onChange: onSelectChange }"\n          ></a-table>\n        </div>\n      </a-modal>\n    </div>\n\n\n    <div class="cmd">\n      <div>\u6267\u884c\u6307\u4ee4\uff1a</div>\n      <v-ace-editor v-model:value="content" lang="sh" theme="chrome"\n                    style="height: 300px; font-size: 20px;margin-bottom: 1rem;"></v-ace-editor>\n    </div>\n    <div>\n      <a-button type="primary">\n        <thunderbolt-outlined></thunderbolt-outlined>\n        \u5f00\u59cb\u6267\u884c\n      </a-button>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport {computed, reactive, ref} from "vue";\nimport {PlusOutlined, SyncOutlined} from \'@ant-design/icons-vue\';\nimport settings from "../settings";\nimport axios from "@/utils/http";\n\n\n// vue3-ace-editor\nimport {VAceEditor} from \'vue3-ace-editor\';\nimport \'ace-builds/src-noconflict/theme-chrome\';\nimport \'ace-builds/src-noconflict/ext-language_tools\';\nimport \'ace-builds/src-noconflict/mode-sh\';\nimport {ThunderboltOutlined} from \'@ant-design/icons-vue\';\n\n// \u8868\u5355\u5206\u680f\u5e03\u5c40\u957f\u5ea6\uff0c\u5f39\u7a97\u7684\u9996\u884c\u8868\u5355\u914d\u7f6e\u4fe1\u606f\nconst formItemLayout = reactive({\n  labelCol: {span: 8},\n  wrapperCol: {span: 14}\n})\n// \u8868\u5355\u7684\u5b57\u6bb5\u8bbe\u7f6e\uff0c\u5f39\u7a97\u7684\u8868\u683c\u7684\u6bcf\u4e00\u5217\u6570\u636e\u7684\u914d\u7f6e\u4fe1\u606f\nconst columns = ref([\n  {\n    slots: {title: \'customTitle\'},\n    scopedSlots: {customRender: \'action\'}\n  }, {\n    title: \'\u7c7b\u522b\',\n    dataIndex: \'category_name\',\n    key: \'category_name\'\n  }, {\n    title: \'\u4e3b\u673a\u540d\u79f0\',\n    dataIndex: \'name\',\n    key: \'name\'\n  }, {\n    title: \'\u8fde\u63a5\u5730\u5740\',\n    dataIndex: \'ip_addr\',\n    key: \'ip_addr\',\n    width: 200\n  }, {\n    title: \'\u7aef\u53e3\',\n    dataIndex: \'port\',\n    key: \'port\'\n  }, {\n    title: \'\u5907\u6ce8\u4fe1\u606f\',\n    dataIndex: \'description\',\n    key: \'description\'\n  }\n])\n\n// \u663e\u793a\u9009\u4e2d\u7684\u6240\u6709\u4e3b\u673a\u5185\u5bb9\nconst show_host_info = reactive({\n  data: []\n})\nconst visible = ref(false) // \u662f\u5426\u663e\u793a\u4e3b\u673a\u5217\u8868\u7684\u5f39\u7a97\n\n// \u4e3b\u673a\u8868\u5355\u4fe1\u606f\nconst host_form = reactive({\n  form: {\n    category: undefined // \u5f53\u524d\u9009\u62e9\u7684\u4e3b\u673a\u5206\u7c7bID\n  }\n})\n\n// \u5f53\u524d\u663e\u793a\u548b\u8868\u683c\u4e2d\u7684\u4e3b\u673a\u5217\u8868\u6570\u636e\nconst host_list = reactive({\n  data: []\n})\n\n// \u4e3b\u673a\u5206\u7c7b\u5217\u8868\nconst category_list = reactive({\n  data: []\n})\n\n// \u5df2\u7ecf\u52fe\u9009\u7684\u4e3b\u673aID\u5217\u8868\nconst selectedRowKeys = ref([])\n// \u9009\u4e2d\u7684\u4e3b\u673aid\u5217\u8868\nconst selected_host_ids = ref([])\n\n// \u8ba1\u7b97\u5c5e\u6027\nconst hasSelected = computed(() => {\n  return selectedRowKeys.length > 0\n})\n\n// \u663e\u793a\u5f39\u7a97\nconst showModal = () => {\n  visible.value = true\n}\n\n// \u5173\u95ed\u5f39\u7a97\nconst hideModel = () => {\n  visible.value = false;\n}\n\n// \u9009\u4e2d\u4e3b\u673a\u65f6\u89e6\u53d1\u7684\uff0cselectedRowKeys\u88ab\u9009\u4e2d\u7684\u4e3b\u673aid\u5217\u8868\nconst onSelectChange = (selectedKeys) => {\n  selectedRowKeys.value = selectedKeys\n}\n\nconst get_host_category_list = () => {\n  // \u83b7\u53d6\u4e3b\u673a\u7c7b\u522b\n  axios.get(`${settings.host}/host/category`).then((response) => {\n    category_list.data = response.data.data.host_category_list\n  })\n}\nget_host_category_list()\n\n\nconst get_host_list = (category = null) => {\n  // \u83b7\u53d6\u4e3b\u673a\u5217\u8868\n  let params = {}\n  if (category !== null) {\n    params.host_category_id = category\n  }\n  axios.get(`${settings.host}/host`, {\n    params: params,\n  }).then((response) => {\n    host_list.data = response.data.data.host_list\n  })\n}\n\nget_host_list()\n\nconst has_change_category = (category) => {\n  // \u5207\u6362\u4e3b\u673a\u5206\u7c7b\u65f6\uff0c\u91cd\u65b0\u83b7\u53d6\u4e3b\u673a\u5217\u8868\n  get_host_list(category)\n}\n\nconst refresh_data = () => {\n  // \u5237\u65b0\u9875\u9762\n  // location.reload()\n  // \u5237\u65b0\u6570\u636e\n  get_host_list()\n  host_form.form.category = undefined\n  selectedRowKeys.value = []\n}\n\nconst handleOk = () => {\n  selected_host_ids.value = []\n  show_host_info.data = []\n  host_list.data.forEach((v, k) => {\n    if (selectedRowKeys.value.includes(v.id)) { // \u5224\u65ad\u67d0\u5143\u7d20\u662f\u5426\u5728\u6570\u7ec4\u4e2d\u7528includes\u6bd4\u8f83\u5408\u9002\uff0c\u4e0d\u80fd\u7528in\n      show_host_info.data.push({\n        id: v.id,\n        name: v.name,\n        ip_addr: v.ip_addr,\n        port: v.port\n      })\n      selected_host_ids.value.push(v.id)\n    }\n  })\n  // \u5173\u95ed\u5f39\u7a97\n  visible.value = false\n}\n\nconst delete_select_host = (infoIndex) => {\n  // \u79fb\u9664\u5df2\u7ecf\u52fe\u9009\u7684\u4e3b\u673a\u4fe1\u606f\n  show_host_info.data.splice(infoIndex, 1)\n  let idsList = selected_host_ids.value.splice(infoIndex, 1)\n  let idIndex = selectedRowKeys.value.indexOf(idsList[0])\n  selectedRowKeys.value.splice(idIndex, 1)\n}\n\n// \u7528\u6237\u8f93\u5165\u7684\u6a21\u677f\u547d\u4ee4\nconst content = ref("")\n\n<\/script>\n\n<style scoped>\n.multi_exec {\n  text-align: left;\n}\n</style>\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230108160556610-8013031.png",alt:"image-20230108160556610"})),(0,o.yg)("h3",{id:"522\u53d1\u9001\u6267\u884c\u6307\u4ee4\u8bf7\u6c42"},"5.2.2\u3001\u53d1\u9001\u6267\u884c\u6307\u4ee4\u8bf7\u6c42"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"src/views/MultiExec.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-html"},'<div>\n            <a-button type="primary" @click="execute_cmd"><thunderbolt-outlined></thunderbolt-outlined>\u5f00\u59cb\u6267\u884c</a-button>\n</div>\n')),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<script>\n// \u4e2d\u95f4\u4ee3\u7801\u7701\u7565....\nimport {message} from "ant-design-vue";\n// \u4e2d\u95f4\u4ee3\u7801\u7701\u7565....\nconst execute_cmd = () => {\n  // \u8fdc\u7a0b\u6267\u884c\u547d\u4ee4\n  console.log(content.value)\n  console.log(selected_host_ids)\n  // \u6267\u884c\u6307\u4ee4\u64cd\u4f5c\n  axios.post(`${settings.host}/host/cmd`, {\n    host_ids: selected_host_ids.value,\n    cmd: content.value\n  }).then((res) => {\n    message.success("\u8fdc\u7a0b\u4e3b\u673a\u5df2\u7ecf\u6267\u884c\u547d\u4ee4...")\n  }).catch((error => {\n    message.error("\u8fdc\u7a0b\u4e3b\u673a\u6267\u884c\u547d\u4ee4\u5931\u8d25\uff01")\n  }))\n}\n<\/script>\n')),(0,o.yg)("h3",{id:"523\u670d\u52a1\u7aef\u6279\u91cf\u5904\u7406\u6307\u4ee4"},"5.2.3\u3001\u670d\u52a1\u7aef\u6279\u91cf\u5904\u7406\u6307\u4ee4"),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/model/host.go"),"\uff0c\u6a21\u578b\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'type CmdParam struct {\n    Cmd     string `json:"cmd"`\n    HostIds []int  `json:"host_ids"`\n}\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/services/host.go"),"\uff0c\u4e1a\u52a1\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'/**\n\u6267\u884c\u7ec8\u7aef\u547d\u4ee4\n*/\n\nfunc ExecuteCMD(id int, cmd string) (string, error) {\n    host := Host{}\n    err := host.GetOneById(uint(id))\n    if err != nil {\n        return "", err\n    }\n\n    cli := utils.NewSSH(host.IpAddr, host.Username, "", host.PrivateKey, "key", int(host.Port))\n    if err := cli.Connect(); err != nil {\n        return "", errors.New(constants.HostInfoEror)\n    }\n\n    defer func(cli *utils.SSH) {\n        _ = cli.Client.Close()\n        _ = cli.Session.Close()\n    }(cli)\n\n    output, err := cli.Run(cmd)\n    if err != nil {\n        return "", err\n    }\n    return output, err\n}\n\n/**\n\u6279\u91cf\u4e3b\u673a\u6267\u884c\u6307\u4ee4\n*/\n\nfunc ExecuteCMDList(HostIds []int, Cmd string) error {\n    for _, id := range HostIds {\n        fmt.Println(id)\n        _, err := ExecuteCMD(id, Cmd)\n        if err != nil {\n            return err\n        }\n    }\n    return nil\n}\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/api/host.go"),"\uff0c\u63a5\u53e3\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'/**\n\u8fdc\u7a0b\u4e3b\u673a\u6279\u91cf\u6267\u884c\u6307\u4ee4\n*/\n\nfunc HostRunCmdList(ctx *gin.Context) {\n    // \u6839\u636e\u4e3b\u673aID\u83b7\u53d6\u4e3b\u673a\u4fe1\u606f\n    var param = model.CmdParam{}\n    err := ctx.ShouldBindJSON(&param)\n    fmt.Println("param:::", param)\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.ParamError,\n            "message": err,\n        })\n        return\n    }\n    err = ExecuteCMDList(param.HostIds, param.Cmd)\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.ExecuteCMDFail,\n            "message": err,\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusOK, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n    })\n}\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/constants/code.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-htaccess"},"ParamError     = -3   // \u5ba2\u6237\u7aef\u8bf7\u6c42\u53c2\u6570\u6709\u8bef\uff01\nExecuteCMDFail = 1015 // \u6267\u884c\u547d\u4ee4\u5931\u8d25\uff01\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/router/host.go"),"\uff0c\u8def\u7531\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'// \u4e3b\u673a - \u6279\u91cf\u4efb\u52a1-\u6267\u884c\u6307\u4ee4\nutils.Register(HostRouter, []string{"POST"}, "cmd", middleware.JWTAuthorization(), api.HostRunCmdList)\n')),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230109102502280-8013031.png",alt:"image-20230109102502280"})),(0,o.yg)("p",null,"\u5728\u8fdb\u5165\u9009\u4e2d\u670d\u52a1\u5668\u7684\u7ec8\u7aef\u73af\u5883\uff0c\u4fbf\u53ef\u4ee5\u67e5\u5230\u65b0\u521b\u5efa\u7684\u6587\u4ef6\u3002"),(0,o.yg)("p",null,"\u5728\u65e5\u5e38\u8fd0\u7ef4\u8fc7\u7a0b\u4e2d\uff0c\u6709\u4e9b\u6307\u4ee4\u4f1a\u7ecf\u5e38\u91cd\u590d\u88ab\u8c03\u7528\uff0c\u6240\u4ee5\u524d\u7aef\u8fd8\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u6307\u4ee4\u6a21\u677f\u6301\u4e45\u5316\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u7136\u540e\u6267\u884c\u6307\u4ee4\u6a21\u677f\u7684\u65b9\u5f0f\u6765\u6267\u884c\u6a21\u677f\u4e2d\u63d0\u524d\u5199\u597d\u7684\u6307\u4ee4\u3002"),(0,o.yg)("h2",{id:"53-\u6307\u4ee4\u6a21\u677f"},"5.3 \u6307\u4ee4\u6a21\u677f"),(0,o.yg)("h3",{id:"531-\u670d\u52a1\u7aef\u5b9e\u73b0\u6307\u4ee4\u6a21\u677f\u7ba1\u7406"},"5.3.1 \u670d\u52a1\u7aef\u5b9e\u73b0\u6307\u4ee4\u6a21\u677f\u7ba1\u7406"),(0,o.yg)("p",null,"\u670d\u52a1\u7aef\u63d0\u4f9b\u6307\u4ee4\u6a21\u677f\u7684\u5b58\u50a8\u6a21\u578b\u4ee5\u53ca\u64cd\u4f5c\u63a5\u53e3\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"application/model/command.go"),"\uff0c\u6a21\u578b\uff0c\u4ee3\u7801"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package model\n\nimport (\n    "github.com/jinzhu/gorm"\n    . "uricgo_api/application/database"\n)\n\n/**\n\u6307\u4ee4\u6a21\u677f\u7c7b\u522b\n*/\n\ntype CommandCategory struct {\n    gorm.Model\n    Name string `json:"name" gorm:"type:varchar(255);unique_index"`\n}\n\ntype CommandCategoryInstance struct {\n    ID   uint   `json:"id"`\n    Name string `json:"name"`\n}\n\n/**\n\u8bbe\u7f6e\u8868\u540d\n*/\n\nfunc (category CommandCategory) TableName() string {\n    return "command_category"\n}\n\n/**\n\u6dfb\u52a0\u6307\u4ee4\u6a21\u677f\u7c7b\u522b\n*/\n\nfunc (category *CommandCategory) Insert() error {\n    err := Orm.Create(&category).Error\n    return err\n}\n\n/**\n\u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u5206\u7c7b\u5217\u8868\n*/\n\nfunc (category CommandCategory) GetAll() ([]CommandCategoryInstance, error) {\n    var categories []CommandCategoryInstance\n    err := Orm.Table(category.TableName()).Order(" id DESC ").Select("id, name").Scan(&categories).Error\n    return categories, err\n}\n\n/**\n\u6839\u636e\u6307\u5b9aID\u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u7c7b\u522b\n*/\n\nfunc (category *CommandCategory) GetOneById(id uint) error {\n    err := Orm.First(&category, id).Error\n    return err\n}\n\n/**\n\u6307\u4ee4\u6a21\u677f\n*/\n\ntype Command struct {\n    gorm.Model\n    Name              string          `json:"name" gorm:"type:varchar(255)"`\n    Content           string          `json:"content" gorm:"type:text"`\n    CommandCategoryID uint            `json:"command_category_id"`\n    CommandCategory   CommandCategory `json:"command_category"  gorm:"foreignKey:CommandCategoryID;references:ID"`\n}\n\ntype CommandInstance struct {\n    ID           uint   `json:"id"`\n    Name         string `json:"name"`\n    Content      string `json:"content"`\n    CategoryID   uint   `json:"category_id"`\n    CategoryName string `json:"category_name"`\n}\n\n/**\n\u8bbe\u7f6e\u8868\u540d\n*/\n\nfunc (command Command) TableName() string {\n    return "command_template"\n}\n\n/**\n\u6dfb\u52a0\u6307\u4ee4\u6a21\u677f\n*/\n\nfunc (command *Command) Insert() error {\n    err := Orm.Create(&command).Error\n    return err\n}\n\n/**\n\u83b7\u53d6\u6240\u6709\u6307\u4ee4\u6a21\u677f\u5217\u8868\n*/\n\nfunc (command Command) GetAll(name string, commandCategoryId uint) ([]Command, error) {\n    var commands []Command\n    query := Orm.Table(command.TableName())\n    if name != "" {\n        query = query.Where(" name LIKE ? ", "%"+name+"%")\n    }\n    if commandCategoryId > 0 {\n        query = query.Where(" command_category_id = ? ", commandCategoryId)\n    }\n\n    err := query.Order(" id DESC ").Preload("CommandCategory").Find(&commands).Error\n    return commands, err\n}\n\n/**\n\u6839\u636e\u6307\u5b9aID\u83b7\u53d6\u6307\u4ee4\u6a21\u677f\n*/\n\nfunc (command *Command) GetOneById(id uint) error {\n    err := Orm.Preload("CommandCategory").First(&command, id).Error\n    return err\n}\n\n/**\n\u5220\u9664\u6307\u4ee4\u6a21\u677f\n*/\n\nfunc (command *Command) Delete() (err error) {\n    err = Orm.Delete(&command).Error\n    return err\n}\n')),(0,o.yg)("p",null,"\u6ce8\u518c\u8def\u7531\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"application/main.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"Orm.AutoMigrate(&model.CommandCategory{})\nOrm.AutoMigrate(&model.Command{})\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/services/command.go"),"\uff0c\u4e1a\u52a1\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package services\n\nimport (\n    "github.com/gin-gonic/gin"\n    . "uricgo_api/application/model"\n)\n\n/**\n\u6dfb\u52a0\u6307\u4ee4\u6a21\u677f\u7c7b\u522b\n*/\n\nfunc CreateCmdCategory(ctx *gin.Context) (CommandCategoryInstance, error) {\n    hostCategory := CommandCategory{}\n    var instance CommandCategoryInstance\n    var err error\n    if err = ctx.ShouldBindJSON(&hostCategory); err != nil {\n        return instance, err\n    }\n    err = hostCategory.Insert()\n    instance = CommandCategoryInstance{\n        ID:   hostCategory.ID,\n        Name: hostCategory.Name,\n    }\n    return instance, err\n}\n\n/**\n\u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u7c7b\u522b\u5217\u8868\n*/\n\nfunc GetCmdCategoryList(ctx *gin.Context) ([]CommandCategoryInstance, error) {\n    hostCategory := CommandCategory{}\n    hostCategoryList, err := hostCategory.GetAll()\n    return hostCategoryList, err\n}\n\n/**\n\u6dfb\u52a0\u6307\u4ee4\u6a21\u677f\n*/\n\nfunc CreateCmd(ctx *gin.Context) (CommandInstance, error) {\n    cmd := Command{}\n    var err error\n    var instance CommandInstance\n    var cmdCategory CommandCategory\n\n    if err = ctx.ShouldBindJSON(&cmd); err != nil {\n        return instance, err\n    }\n\n    err = cmd.Insert()\n    if err != nil {\n        return instance, err\n    }\n\n    err = cmdCategory.GetOneById(cmd.CommandCategoryID)\n    if err != nil {\n        return instance, err\n    }\n\n    instance = CommandInstance{\n        ID:           cmd.ID,\n        Name:         cmd.Name,\n        Content:      cmd.Content,\n        CategoryID:   cmdCategory.ID,\n        CategoryName: cmdCategory.Name,\n    }\n    return instance, err\n}\n\n/**\n\u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u5217\u8868\n*/\n\nfunc GetCmdList(name string, cmdCategoryId uint) ([]CommandInstance, error) {\n    var cmdList []Command\n    var instanceList []CommandInstance\n    var cmd Command\n    var err error\n    cmdList, err = cmd.GetAll(name, cmdCategoryId)\n    for _, cmdItem := range cmdList {\n        instanceList = append(instanceList, CommandInstance{\n            ID:           cmdItem.ID,\n            Name:         cmdItem.Name,\n            Content:      cmdItem.Content,\n            CategoryID:   cmdItem.CommandCategory.ID,\n            CategoryName: cmdItem.CommandCategory.Name,\n        })\n    }\n    return instanceList, err\n}\n\n/**\n\u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u4fe1\u606f\n*/\n\nfunc GetCmd(id int) (CommandInstance, error) {\n    cmd := Command{}\n    err := cmd.GetOneById(uint(id))\n    instance := CommandInstance{\n        ID:           uint(id),\n        Name:         cmd.Name,\n        Content:      cmd.Content,\n        CategoryID:   cmd.CommandCategory.ID,\n        CategoryName: cmd.CommandCategory.Name,\n    }\n    return instance, err\n}\n\n')),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/api/command.go"),"\uff0c\u63a5\u53e3\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package api\n\nimport (\n    "github.com/gin-gonic/gin"\n    "net/http"\n    "strconv"\n    "urils/application/constants"\n    "urils/application/services"\n)\n\n/**\n\u6dfb\u52a0\u6307\u4ee4\u6a21\u677f\u7c7b\u522b\n*/\n\nfunc CmdCategoryCreate(ctx *gin.Context) {\n    // \u8c03\u7528\u4e1a\u52a1\u5c42\u5b8c\u6210\u6307\u4ee4\u6a21\u677f\u7c7b\u522b\u7684\u6dfb\u52a0\u64cd\u4f5c\n    cmdCategory, err := services.CreateCmdCategory(ctx)\n    if err != nil || cmdCategory.ID < 1 {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeCreateCmdCategoryFail,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusOK, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n        "data": map[string]interface{}{\n            "cmdCategory": cmdCategory,\n        },\n    })\n}\n\n/**\n\u83b7\u53d6\u6240\u6709\u6307\u4ee4\u6a21\u677f\u7c7b\u522b\n*/\n\nfunc CmdCategoryList(ctx *gin.Context) {\n    // \u8c03\u7528\u4e1a\u52a1\u5c42\u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u7c7b\u522b\u5217\u8868\n    cmdCategoryList, err := services.GetCmdCategoryList(ctx)\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeGetCmdCategoryFail,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusOK, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n        "data": map[string]interface{}{\n            "cmd_category_list": cmdCategoryList,\n        },\n    })\n}\n\n/**\n\u6dfb\u52a0\u6307\u4ee4\u6a21\u677f\n*/\n\nfunc CmdCreate(ctx *gin.Context) {\n    // \u8c03\u7528\u4e1a\u52a1\u5c42\u521b\u5efa\u6307\u4ee4\u6a21\u677f\u4fe1\u606f\n    cmd, err := services.CreateCmd(ctx)\n    if err != nil || cmd.ID < 1 {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeCreateCmdFail,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusOK, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n        "data": map[string]interface{}{\n            "cmd": cmd,\n        },\n    })\n}\n\n/**\n\u6307\u4ee4\u6a21\u677f\u5217\u8868\n*/\n\nfunc CmdList(ctx *gin.Context) {\n    // \u63a5\u53d7\u67e5\u8be2\u6307\u4ee4\u6a21\u677f\u5217\u8868\u65f6\u7684\u7b5b\u9009\u53c2\u6570\n    name, _ := ctx.GetQuery("name")\n    cmdCategoryId, _ := strconv.Atoi(ctx.Query("command_category_id"))\n    // \u8c03\u7528\u4e1a\u52a1\u5c42\u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u5217\u8868\n    cmdList, err := services.GetCmdList(name, uint(cmdCategoryId))\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeGetCmdFail,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    ctx.JSON(http.StatusOK, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n        "data": map[string]interface{}{\n            "cmd_list": cmdList,\n        },\n    })\n}\n\n/**\n\u6307\u4ee4\u6a21\u677f\u4fe1\u606f\n*/\n\nfunc CmdInfo(ctx *gin.Context) {\n    // \u6839\u636e\u6a21\u677fID\u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u4fe1\u606f\n    id, err := strconv.Atoi(ctx.Param("id"))\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeGetCmdFail,\n            "message": err.Error(),\n        })\n        return\n    }\n\n    cmd, err := services.GetCmd(id)\n    if err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            "code":    constants.CodeGetCmdFail,\n            "message": err.Error(),\n        })\n        return\n    }\n    ctx.JSON(http.StatusOK, gin.H{\n        "code":    constants.CodeSuccess,\n        "message": constants.Success,\n        "data": map[string]interface{}{\n            "cmd": cmd,\n        },\n    })\n}\n\n')),(0,o.yg)("p",null,"\u5e38\u91cf\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"constants/code.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},"CodeCreateCmdCategoryFail = 1020  // \u521b\u5efa\u6307\u4ee4\u6a21\u677f\u7c7b\u522b\u5931\u8d25\nCodeGetCmdCategoryFail = 1021 // \u65e0\u6cd5\u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u7c7b\u522b\u5217\u8868\uff01\nCodeCreateCmdFail = 1022 // \u6dfb\u52a0\u6307\u4ee4\u6a21\u677f\u4fe1\u606f\u5931\u8d25\uff01\nCodeGetCmdFail = 1023 // \u6307\u4ee4\u6a21\u677f\u4e0d\u5b58\u5728\uff01\uff01\n")),(0,o.yg)("p",null,(0,o.yg)("inlineCode",{parentName:"p"},"application/router/command.go"),"\uff0c\u8def\u7531\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package router\n\nimport (\n    "github.com/gin-gonic/gin"\n    "uricgo_api/application/api"\n    "uricgo_api/application/middleware"\n    "uricgo_api/application/utils"\n)\n\nfunc InitCmdRouter(Router *gin.RouterGroup) {\n    /**\n    \u6307\u4ee4\u6a21\u677f\u76f8\u5173\u7684\u8def\u7531\u7ec4\n    */\n    cmdRouter := Router.Group("cmd")\n\n    {\n        // \u6307\u4ee4\u6a21\u677f\u7c7b\u522b-\u6dfb\u52a0\n        utils.Register(cmdRouter, []string{"POST"}, "category", middleware.JWTAuthorization(), api.CmdCategoryCreate)\n        // \u6307\u4ee4\u6a21\u677f\u7c7b\u522b-\u5217\u8868\n        utils.Register(cmdRouter, []string{"GET"}, "category", middleware.JWTAuthorization(), api.CmdCategoryList)\n        // \u6307\u4ee4\u6a21\u677f-\u6dfb\u52a0\n        utils.Register(cmdRouter, []string{"POST"}, "", middleware.JWTAuthorization(), api.CmdCreate)\n        // \u6307\u4ee4\u6a21\u677f-\u5217\u8868\n        utils.Register(cmdRouter, []string{"GET"}, "", middleware.JWTAuthorization(), api.CmdList)\n        // \u6307\u4ee4\u6a21\u677f-\u4fe1\u606f\n        utils.Register(cmdRouter, []string{"GET"}, ":id/info", middleware.JWTAuthorization(), api.CmdInfo)\n    }\n}\n')),(0,o.yg)("p",null,"\u8def\u7531\u521d\u59cb\u5316\u6587\u4ef6\u4e2d\u52a0\u8f7dcommand.go\u4e2d\u7684\u8def\u7531\u7ec4\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"application/initialize/router.go"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-go"},'package initialize\n\nimport (\n    "github.com/gin-gonic/gin"\n    "go.uber.org/zap"\n    "uricgo_api/application/middleware"\n    "uricgo_api/application/router"\n)\n\nfunc InitRouter() *gin.Engine {\n    // 1. \u521b\u5efa\u8def\u7531\n    Router := gin.Default()\n    Router.Use(middleware.GinLogger(), middleware.GinRecovery(true))\n    Router.Use(middleware.ExceptionMiddleware)\n    Router.Use(middleware.CORS)\n    // 2. Api\u8def\u7531\u5206\u7ec4\n    ApiGroup := Router.Group("/api")\n    // 3. \u521d\u59cb\u5316\u7528\u6237\u76f8\u5173\u8def\u7531\n    router.InitUserRouter(ApiGroup)\n    router.InitHostRouter(ApiGroup)\n    router.InitCmdRouter(ApiGroup)\n    zap.S().Info("\u8def\u7531\u521d\u59cb\u5316\u5b8c\u6210....")\n    return Router\n}\n')),(0,o.yg)("h3",{id:"532\u5ba2\u6237\u7aef\u5c55\u793a\u6307\u4ee4\u6a21\u677f\u754c\u9762\u4e0e\u529f\u80fd\u7684\u5b9e\u73b0"},"5.3.2\u3001\u5ba2\u6237\u7aef\u5c55\u793a\u6307\u4ee4\u6a21\u677f\u754c\u9762\u4e0e\u529f\u80fd\u7684\u5b9e\u73b0"),(0,o.yg)("p",null,"\u5c55\u793a\u6a21\u677f\u5217\u8868\u9875\u9762\u4ee5\u53ca\u83b7\u53d6\u6a21\u677f\u5206\u7c7b\u548c\u6a21\u677f\u4fe1\u606f\u7684\u5217\u8868\u6570\u636e\uff0c\u521b\u5efa\u7ec4\u4ef6\uff0c",(0,o.yg)("inlineCode",{parentName:"p"},"src/views/TemplateManage.vue"),"\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="template_manager">\n    <div class="template-top">\n      <a-row>\n        <a-col :span="5">\n          <a-form-item label="\u6a21\u677f\u7c7b\u522b\uff1a" :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol">\n            <a-select style="width: 160px;" placeholder="\u8bf7\u9009\u62e9" @change="handleSelectChange"\n                      v-model:value="search.category_id">\n              <a-select-option :value="value.id" v-for="(value) in template_category_list.data" :key="value.id">\n                {{ value.name }}\n              </a-select-option>\n            </a-select>\n          </a-form-item>\n        </a-col>\n        <a-col :span="10">\n          <a-form-item :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol" label="\u6a21\u677f\u540d\u79f0\uff1a">\n            <a-input v-model:value="search.name" placeholder="\u8bf7\u8f93\u5165" @change="handleInputChange"/>\n          </a-form-item>\n        </a-col>\n        <a-col :span="2">\n          <a-button type="primary" style="margin-top: 3px;" @click="refresh_data">\n            <sync-outlined></sync-outlined>\n            \u5237\u65b0\n          </a-button>\n        </a-col>\n      </a-row>\n    </div>\n    <div style="margin-top: 20px;">\n      <a-button type="primary" @click="showModal">\n        <plus-outlined></plus-outlined>\n        \u65b0\u5efa\n      </a-button>\n      \x3c!-- \u65b0\u5efa\u6307\u4ee4\u6a21\u677f\u7684\u5f39\u7a97 --\x3e\n      <a-modal :visible="visible" title="\u65b0\u5efa\u6a21\u677f" ok-text="\u6dfb\u52a0" cancel-text="\u53d6\u6d88" @ok="handleSubmit" @cancel="hideModel"\n               width="960px">\n        <a-form-item label="\u6a21\u677f\u7c7b\u522b">\n          <a-row>\n            <a-col :span="6">\n              <a-select placeholder="" v-model:value="template_form.category_id">\n                <a-select-option :value="value.id" v-for="(value) in template_category_list.data" :key="value.id">\n                  {{ value.name }}\n                </a-select-option>\n              </a-select>\n            </a-col>\n            <a-col :span="6">\n              <a-button type="link" @click="showTemplateCategoryFormModal">\u6dfb\u52a0\u7c7b\u522b</a-button>\n            </a-col>\n          </a-row>\n        </a-form-item>\n        <a-form-item label="\u6a21\u677f\u540d\u79f0">\n          <a-input v-model:value="template_form.name"/>\n        </a-form-item>\n        <a-form-item label="\u6a21\u677f\u5185\u5bb9">\n          <v-ace-editor v-model:value="template_form.content" lang="sh" theme="chrome"\n                        style="height: 300px; font-size: 20px;margin-bottom: 1rem;"></v-ace-editor>\n        </a-form-item>\n      </a-modal>\n    </div>\n    \x3c!-- \u65b0\u5efa\u6a21\u677f\u5206\u7c7b\u5f39\u7a97 --\x3e\n    <a-modal\n        :width="600"\n        title="\u65b0\u5efa\u6a21\u677f\u7c7b\u522b"\n        :visible="templateCategoryFromVisible"\n        @cancel="templateCategoryFormCancel"\n        ok-text="\u63d0\u4ea4"\n        cancel-text="\u53d6\u6d88"\n        @ok="onTemplateCategoryFromSubmit"\n    >\n      <a-form-model ref="hostCategoryRuleForm" :model="templateCategoryForm.form" :rules="templateCategoryForm.rules"\n                    :label-col="templateCategoryForm.labelCol" :wrapper-col="templateCategoryForm.wrapperCol">\n        <a-form-model-item ref="name" label="\u7c7b\u522b\u540d\u79f0" prop="name">\n          <a-row>\n            <a-col :span="24">\n              <a-input placeholder="\u8bf7\u8f93\u5165\u6a21\u677f\u7c7b\u522b\u540d\u79f0" v-model:value="templateCategoryForm.form.name"/>\n            </a-col>\n          </a-row>\n        </a-form-model-item>\n      </a-form-model>\n    </a-modal>\n    <div style="margin-top: 10px;">\n      <a-table :columns="columns" :data-source="templates_list.data" :rowKey="record => record.id">\n        <template #bodyCell="{ column, text, record }">\n          <template v-if="column.dataIndex === \'action\'">\n            <a-popconfirm v-if="templates_list.data.length" title="\u60a8\u786e\u8ba4\u8981\u5220\u9664\u5f53\u524d\u4e3b\u673a\u4fe1\u606f\u5417?">\n              <a href="javascript:;">\u5220\u9664</a> |\n            </a-popconfirm>\n            <a href="javascript:;">\u7f16\u8f91</a>\n          </template>\n        </template>\n      </a-table>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport {reactive, ref} from "vue";\nimport axios from "@/utils/http";\nimport {message} from "ant-design-vue";\nimport settings from "@/settings";\nimport {PlusOutlined, SyncOutlined} from \'@ant-design/icons-vue\';\nimport {VAceEditor} from \'vue3-ace-editor\';\nimport \'ace-builds/src-noconflict/theme-chrome\';\nimport \'ace-builds/src-noconflict/ext-language_tools\';\nimport \'ace-builds/src-noconflict/mode-sh\';\n\nconst formItemLayout = reactive({\n  labelCol: {span: 6},\n  wrapperCol: {span: 14}\n})\n\nconst columns = ref([\n  {\n    title: \'ID\',\n    dataIndex: \'id\',\n    key: \'id\',\n    sorter: {\n      compare: (a, b) => a.id - b.id,\n      multiple: 3,\n    },\n  },\n  {\n    title: \'\u6a21\u677f\u7c7b\u578b\',\n    dataIndex: \'category_name\',\n    key: \'category_name\'\n  },\n  {\n    title: \'\u6a21\u677f\u540d\u79f0\',\n    dataIndex: \'name\',\n    key: \'name\',\n  },\n  {\n    title: \'\u6a21\u677f\u5185\u5bb9\',\n    dataIndex: \'content\',\n    key: \'content\',\n    width: 200\n  },\n  {\n    title: \'\u64cd\u4f5c\',\n    key: \'action\',\n    dataIndex: \'action\',\n    width: 200,\n    scopedSlots: {customRender: \'action\'}\n  }\n])\n\n// \u662f\u5426\u663e\u793a\u5f39\u7a97\nconst visible = ref(false)\n\n// \u6307\u4ee4\u6a21\u677f\u5206\u7c7b\u5217\u8868\nconst template_category_list = reactive({\n  data: []\n})\n\n// \u6307\u4ee4\u6a21\u677f\u5217\u8868\nconst templates_list = reactive({\n  data: []\n})\n\n// \u6dfb\u52a0\u6307\u4ee4\u6a21\u677f\u65f6\u7684cmd\u6307\u4ee4\nconst content = ref(\'\')\n\nconst template_form = reactive({\n  category_id: undefined,\n  name: \'\',\n  content: \'\'\n})\n\nconst search = reactive({\n  category: null,\n  name: "",\n})\n\n\nconst showModal = () => {\n  visible.value = true\n}\n\nconst hideModel = () => {\n  visible.value = false;\n}\n\nconst refresh_data = () => {\n  search.category = null\n  search.name = "";\n  get_templates_list(search.category)\n}\n\nconst handleSelectChange = (value) => {\n  // \u5207\u6362\u6a21\u677f\u5206\u7c7b\n  search.name = "";\n  get_templates_list(value)\n}\n\nconst handleInputChange = () => {\n  search.category_id = undefined\n  console.log(search.name)\n  get_templates_list(null, search.name)\n}\n\n// \u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u5217\u8868\nconst get_templates_list = (category = null, template_name = null) => {\n  // \u67e5\u8be2\u53c2\u6570\n  let params = {}\n  if (category !== null) {\n    // \u5982\u679c\u6709\u6307\u5b9a\u6a21\u677f\u5206\u7c7bID\uff0c\u5219\u6839\u636e\u6a21\u677f\u5206\u7c7bID\u67e5\u8be2\u6a21\u677f\u5217\u8868\n    params.command_category_id = category\n  }\n  if (template_name !== null) {\n    // \u5982\u679c\u6709\u6267\u884c\u6a21\u677f\u540d\u79f0\uff0c\u5219\u6839\u636e\u6a21\u677f\u540d\u79f0\u67e5\u8be2\u6a21\u677f\u5217\u8868\n    params.name = template_name\n  }\n  axios.get(`${settings.host}/cmd`, {\n    params: params,\n  }).then(response => {\n    templates_list.data = response.data.data.cmd_list\n  })\n}\n\nget_templates_list()\n\n\n// \u83b7\u53d6\u6a21\u677f\u6307\u4ee4\u5206\u7c7b\u5217\u8868\nconst get_templates_category_list = () => {\n  axios.get(`${settings.host}/cmd/category`).then(response => {\n    template_category_list.data = response.data.data.cmd_category_list\n  })\n}\nget_templates_category_list()\n\nconst handleSubmit = () => { // handleSubmit\u5fc5\u987b\u58f0\u660e\u5e76\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u540d\u5b57\u4e0d\u80fd\u6539\n  let params = {}\n  params.name = template_form.name\n  params.command_category_id = template_form.category_id\n  params.content = template_form.content\n  // \u62ff\u5230\u9a8c\u8bc1\u6210\u529f\u4e4b\u540e\u7684\u6570\u636e\n  // \u53d1\u9001\u6dfb\u52a0\u6a21\u677f\u7684\u8bf7\u6c42\n  axios.post(`${settings.host}/cmd`, params)\n      .then(response => {\n        console.log(response)\n        visible.value = false\n        get_templates_list()\n      })\n}\n\n// \u662f\u5426\u663e\u793a\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b\u7684\u5f39\u7a97\nconst templateCategoryFromVisible = ref(false)\n\n// \u6dfb\u52a0\u6a21\u677f\u7c7b\u522b\u9700\u8981\u7684\u6570\u636e\u5c5e\u6027\nconst templateCategoryForm = reactive({\n  labelCol: {span: 6},\n  wrapperCol: {span: 14},\n  other: \'\',\n  form: {\n    name: \'\'\n  },\n  rules: {\n    name: [\n      {required: true, message: \'\u8bf7\u8f93\u5165\u7c7b\u522b\u540d\u79f0\', trigger: \'blur\'},\n      {min: 3, max: 10, message: \'\u957f\u5ea6\u57283-10\u4f4d\u4e4b\u95f4\', trigger: \'blur\'}\n    ]\n  }\n})\n\nconst showTemplateCategoryFormModal = () => {\n  // \u663e\u793a\u65b0\u5efa\u4e3b\u673a\u7c7b\u522b\u7684\u8868\u5355\u7a97\u53e3\n  templateCategoryFromVisible.value = true\n}\n\nconst hostCategoryFormCancel = () => {\n  // \u53d6\u6d88\u5e76\u5173\u95ed\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b\u7684\u8868\u5355\u7a97\u53e3\n  resetTemplateCategoryForm() // \u6e05\u7a7a\u8868\u5355\u5185\u5bb9\n  templateCategoryFromVisible.value = false // \u5173\u95ed\u5bf9\u8bdd\u6846\n}\n\nconst resetTemplateCategoryForm = () => {\n  // \u91cd\u7f6e\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b\u7684\u8868\u5355\u4fe1\u606f\n  templateCategoryForm.form.name = "";\n}\n\nconst templateCategoryFormCancel = () => {\n  // \u53d6\u6d88\u5e76\u5173\u95ed\u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b\u7684\u8868\u5355\u7a97\u53e3\n  resetTemplateCategoryForm() // \u6e05\u7a7a\u8868\u5355\u5185\u5bb9\n  templateCategoryFromVisible.value = false // \u5173\u95ed\u5bf9\u8bdd\u6846\n}\n\nconst onTemplateCategoryFromSubmit = () => {\n  // \u6dfb\u52a0\u4e3b\u673a\u7c7b\u522b\u7684\u8868\u5355\u63d0\u4ea4\u5904\u7406\n  axios.post("cmd/category", templateCategoryForm.form).then(response => {\n    if (response.data.code === 0) {\n      message.success({\n        content: "\u521b\u5efa\u6a21\u677f\u7c7b\u522b\u6210\u529f!",\n        duration: 2,\n      }).then(() => {\n        template_category_list.data.push(response.data.data.cmdCategory)\n        // \u6e05\u7a7a\u8868\u5355\u6570\u636e\uff0c\u5e76\u5173\u95ed\u6dfb\u52a0\u4e3b\u673a\u5206\u7c7b\u8868\u5355\u7a97\u53e3\n        hostCategoryFormCancel()\n      })\n    }\n  })\n}\n\n<\/script>\n\n<style scoped>\n.template-top {\n  margin-top: 15px;\n  margin-bottom: 15px;\n}\n\n.template_manager {\n  text-align: left;\n}\n</style>\n\n')),(0,o.yg)("p",null,"\u8def\u7531\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"}," // \u4ee3\u7801\u7701\u7565\u3002\u3002\u3002\u3002\n {\n meta: {\n        title: '\u6307\u4ee4\u6a21\u677f',\n        authenticate: true\n },\n path: 'template_manage',\n name: 'TemplateManage',\n component: TemplateManage\n },\n")),(0,o.yg)("p",null,"\u597d\u4e86\uff0c\u6307\u4ee4\u6a21\u677f\u53ef\u4ee5\u521b\u5efa\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5728\u6279\u91cf\u6267\u884c\u6307\u4ee4\u7684\u529f\u80fd\u4e0a\uff0c\u6dfb\u52a0\u4e0a\u9009\u62e9\u6a21\u677f\u6267\u884c\u6307\u4ee4\u7684\u529f\u80fd\uff0c\u5e76\u70b9\u51fb\u6267\u884c\u3002"),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230109111857349-8013031.png",alt:"image-20230109111857349"})),(0,o.yg)("p",null,(0,o.yg)("img",{parentName:"p",src:"https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/golang/assets/image-20230109111921050-8013031.png",alt:"image-20230109111921050"})),(0,o.yg)("h3",{id:"533\u6267\u884c\u5df2\u6709\u7684\u6307\u4ee4"},"5.3.3\u3001\u6267\u884c\u5df2\u6709\u7684\u6307\u4ee4"),(0,o.yg)("p",null,"\u5728",(0,o.yg)("inlineCode",{parentName:"p"},"src/views/MultiExec.vue"),"\uff0c\u4e2d\u65b0\u589e\u9009\u62e9\u6307\u4ee4\u6a21\u677f\u529f\u80fd\uff0c\u4ee3\u7801\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-vue"},'<template>\n  <div class="multi_exec">\n    <div>\n      <h3>\u6267\u884c\u4e3b\u673a\uff1a</h3>\n      <div>\n        <a-tag closable @close="delete_select_host(info_index)" v-for="(info,info_index) in show_host_info.data"\n               :key="info.id">\n          {{ `${info.name}(${info.ip_addr}:${info.port})` }}\n        </a-tag>\n      </div>\n    </div>\n    <div style="margin-top: 10px;">\n      <a-button @click="showModal">\n        <plus-outlined/>\n        \u4ece\u4e3b\u673a\u5217\u8868\u4e2d\u9009\u62e9\n      </a-button>\n      <a-modal :visible="visible" title="\u9009\u62e9\u6267\u884c\u4e3b\u673a" @ok="handleOk" @cancel="hideModel" width="960px">\n        <div>\n          <a-row>\n            <a-col :span="8">\n              <a-form-item label="\u4e3b\u673a\u7c7b\u522b\uff1a" :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol">\n                <a-select style="width: 160px;" placeholder="\u8bf7\u9009\u62e9" v-model:value="host_form.form.category"\n                          @change="has_change_category">\n                  <a-select-option :value="value.id" v-for="(value, index) in category_list.data" :key="value.id">\n                    {{ value.name }}\n                  </a-select-option>\n                </a-select>\n              </a-form-item>\n            </a-col>\n            <a-col :span="8">\n              <a-form-item :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol" label="\u4e3b\u673a\u522b\u540d\uff1a">\n                <a-input placeholder="\u8bf7\u8f93\u5165"/>\n              </a-form-item>\n            </a-col>\n            <a-col :span="4">\n              <a-form-item :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol" label="\u5df2\u9009\uff1a">\n                <span style="margin-left: 8px">\n                                    {{ `${selectedRowKeys.length}` }}\u53f0\u4e3b\u673a\n                </span>\n              </a-form-item>\n            </a-col>\n            <a-col :span="4">\n              <a-button type="primary" style="margin-top: 3px;" @click="refresh_data">\n                <sync-outlined></sync-outlined>\n                \u5237\u65b0\n              </a-button>\n            </a-col>\n          </a-row>\n        </div>\n        <div>\n          <a-table\n              :columns="columns"\n              :data-source="host_list.data"\n              :pagination="false"\n              :rowKey="record => record.id"\n              :row-selection="{ selectedRowKeys: selectedRowKeys, onChange: onSelectChange }"\n          ></a-table>\n        </div>\n      </a-modal>\n    </div>\n\n    <div class="cmd">\n      <div>\u6267\u884c\u6307\u4ee4\uff1a</div>\n      <v-ace-editor v-model:value="content" lang="sh" theme="chrome"\n                    style="height: 300px; font-size: 20px;margin-bottom: 1rem;"></v-ace-editor>\n    </div>\n    <div style="margin-top: 20px; margin-bottom: 20px;">\n      <a-button @click="showModal2">\n        <plus-outlined/>\n        \u4ece\u6267\u884c\u6a21\u677f\u4e2d\u9009\u62e9\n      </a-button>\n      <a-modal :visible="visible2" title="\u9009\u62e9\u6267\u884c\u6a21\u677f" @ok="handleOk2" width="960px" @cancel="hideModel2">\n        <div>\n          <a-row>\n            <a-col :span="10">\n              <a-form-item label="\u6a21\u677f\u7c7b\u522b\uff1a" :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol">\n                <a-select style="width: 160px;" placeholder="\u8bf7\u9009\u62e9" @change="handleSelectChange2"\n                          v-model="template_form.form.category">\n                  <a-select-option :value="value.id" v-for="(value) in template_category_list.data" :key="value.id">\n                    {{ value.name }}\n                  </a-select-option>\n                </a-select>\n              </a-form-item>\n            </a-col>\n            <a-col :span="10">\n              <a-form-item :label-col="formItemLayout.labelCol" :wrapper-col="formItemLayout.wrapperCol" label="\u6a21\u677f\u540d\u79f0\uff1a">\n                <a-input placeholder="\u8bf7\u8f93\u5165" v-model:value="template_form.form.name"/>\n              </a-form-item>\n            </a-col>\n            <a-col :span="4">\n              <a-button type="primary" style="margin-top: 3px;" @click="refresh_data2">\n                <sync-outlined></sync-outlined>\n                \u5237\u65b0\n              </a-button>\n            </a-col>\n          </a-row>\n        </div>\n        <div>\n          <a-table\n              :columns="tem_columns"\n              :data-source="template_list.data"\n              :rowKey="record => record.id"\n              :row-selection="{ radioselectedRow: radioselectedRow, onChange: onSelectChange2,type: \'radio\' }"\n          >\n          </a-table>\n        </div>\n      </a-modal>\n    </div>\n    <div>\n      <a-button type="primary" @click="execute_cmd">\n        <thunderbolt-outlined></thunderbolt-outlined>\n        \u5f00\u59cb\u6267\u884c\n      </a-button>\n    </div>\n\n  </div>\n</template>\n\n<script setup>\nimport {computed, reactive, ref} from "vue";\nimport {PlusOutlined, SyncOutlined, ThunderboltOutlined} from \'@ant-design/icons-vue\';\nimport settings from "../settings";\nimport axios from "@/utils/http";\nimport {message} from "ant-design-vue";\n\nimport {VAceEditor} from \'vue3-ace-editor\';\nimport \'ace-builds/src-noconflict/theme-chrome\';\nimport \'ace-builds/src-noconflict/ext-language_tools\';\nimport \'ace-builds/src-noconflict/mode-sh\';\n\n\n// \u8868\u5355\u5206\u680f\u5e03\u5c40\u957f\u5ea6\uff0c\u5f39\u7a97\u7684\u9996\u884c\u8868\u5355\u914d\u7f6e\u4fe1\u606f\nconst formItemLayout = reactive({\n  labelCol: {span: 8},\n  wrapperCol: {span: 14}\n})\n// \u8868\u5355\u7684\u5b57\u6bb5\u8bbe\u7f6e\uff0c\u5f39\u7a97\u7684\u8868\u683c\u7684\u6bcf\u4e00\u5217\u6570\u636e\u7684\u914d\u7f6e\u4fe1\u606f\nconst columns = ref([\n  {\n    slots: {title: \'customTitle\'},\n    scopedSlots: {customRender: \'action\'}\n  }, {\n    title: \'\u7c7b\u522b\',\n    dataIndex: \'category_name\',\n    key: \'category_name\'\n  }, {\n    title: \'\u4e3b\u673a\u540d\u79f0\',\n    dataIndex: \'name\',\n    key: \'name\'\n  }, {\n    title: \'\u8fde\u63a5\u5730\u5740\',\n    dataIndex: \'ip_addr\',\n    key: \'ip_addr\',\n    width: 200\n  }, {\n    title: \'\u7aef\u53e3\',\n    dataIndex: \'port\',\n    key: \'port\'\n  }, {\n    title: \'\u5907\u6ce8\u4fe1\u606f\',\n    dataIndex: \'description\',\n    key: \'description\'\n  }\n])\n\n// \u663e\u793a\u9009\u4e2d\u7684\u6240\u6709\u4e3b\u673a\u5185\u5bb9\nconst show_host_info = reactive({\n  data: []\n})\nconst visible = ref(false) // \u662f\u5426\u663e\u793a\u4e3b\u673a\u5217\u8868\u7684\u5f39\u7a97\n\n// \u4e3b\u673a\u8868\u5355\u4fe1\u606f\nconst host_form = reactive({\n  form: {\n    category: undefined // \u5f53\u524d\u9009\u62e9\u7684\u4e3b\u673a\u5206\u7c7bID\n  }\n})\n\n// \u5f53\u524d\u663e\u793a\u548b\u8868\u683c\u4e2d\u7684\u4e3b\u673a\u5217\u8868\u6570\u636e\nconst host_list = reactive({\n  data: []\n})\n\n// \u4e3b\u673a\u5206\u7c7b\u5217\u8868\nconst category_list = reactive({\n  data: []\n})\n\n// \u5df2\u7ecf\u52fe\u9009\u7684\u4e3b\u673aID\u5217\u8868\nconst selectedRowKeys = ref([])\n// \u9009\u4e2d\u7684\u4e3b\u673aid\u5217\u8868\nconst selected_host_ids = ref([])\n\n// \u8ba1\u7b97\u5c5e\u6027\nconst hasSelected = computed(() => {\n  return selectedRowKeys.length > 0\n})\n\n// \u663e\u793a\u5f39\u7a97\nconst showModal = () => {\n  visible.value = true\n}\n\n// \u5173\u95ed\u5f39\u7a97\nconst hideModel = () => {\n  visible.value = false;\n}\n\n// \u9009\u4e2d\u4e3b\u673a\u65f6\u89e6\u53d1\u7684\uff0cselectedRowKeys\u88ab\u9009\u4e2d\u7684\u4e3b\u673aid\u5217\u8868\nconst onSelectChange = (selectedKeys) => {\n  selectedRowKeys.value = selectedKeys\n}\n\nconst get_host_category_list = () => {\n  // \u83b7\u53d6\u4e3b\u673a\u7c7b\u522b\n  axios.get(`${settings.host}/host/category`).then((response) => {\n    category_list.data = response.data.data.host_category_list\n  })\n}\nget_host_category_list()\n\n\nconst get_host_list = (category = null) => {\n  // \u83b7\u53d6\u4e3b\u673a\u5217\u8868\n  let params = {}\n  if (category !== null) {\n    params.host_category_id = category\n  }\n  axios.get(`${settings.host}/host`, {\n    params: params,\n  }).then((response) => {\n    host_list.data = response.data.data.host_list\n  })\n}\n\nget_host_list()\n\nconst has_change_category = (category) => {\n  // \u5207\u6362\u4e3b\u673a\u5206\u7c7b\u65f6\uff0c\u91cd\u65b0\u83b7\u53d6\u4e3b\u673a\u5217\u8868\n  get_host_list(category)\n}\n\nconst refresh_data = () => {\n  // \u5237\u65b0\u9875\u9762\n  // location.reload()\n  // \u5237\u65b0\u6570\u636e\n  get_host_list()\n  host_form.form.category = undefined\n  selectedRowKeys.value = []\n}\n\nconst handleOk = () => {\n  selected_host_ids.value = []\n  show_host_info.data = []\n  host_list.data.forEach((v, k) => {\n    if (selectedRowKeys.value.includes(v.id)) { // \u5224\u65ad\u67d0\u5143\u7d20\u662f\u5426\u5728\u6570\u7ec4\u4e2d\u7528includes\u6bd4\u8f83\u5408\u9002\uff0c\u4e0d\u80fd\u7528in\n      show_host_info.data.push({\n        id: v.id,\n        name: v.name,\n        ip_addr: v.ip_addr,\n        port: v.port\n      })\n      selected_host_ids.value.push(v.id)\n    }\n  })\n  // \u5173\u95ed\u5f39\u7a97\n  visible.value = false\n}\n\nconst delete_select_host = (infoIndex) => {\n  // \u79fb\u9664\u5df2\u7ecf\u52fe\u9009\u7684\u4e3b\u673a\u4fe1\u606f\n  show_host_info.data.splice(infoIndex, 1)\n  let idsList = selected_host_ids.value.splice(infoIndex, 1)\n  let idIndex = selectedRowKeys.value.indexOf(idsList[0])\n  selectedRowKeys.value.splice(idIndex, 1)\n}\n\n// \u7528\u6237\u8f93\u5165\u7684\u6a21\u677f\u547d\u4ee4\nconst content = ref("")\n\nconst execute_cmd = () => {\n  // \u8fdc\u7a0b\u6267\u884c\u547d\u4ee4\n  // console.log(content.value)\n  // console.log(selected_host_ids)\n  // \u6267\u884c\u6307\u4ee4\u64cd\u4f5c\n  axios.post(`${settings.host}/host/cmd`, {\n    host_ids: selected_host_ids.value,\n    cmd: content.value\n  }).then((res) => {\n    message.success("\u8fdc\u7a0b\u4e3b\u673a\u5df2\u7ecf\u6267\u884c\u547d\u4ee4...")\n  }).catch((error => {\n    message.error("\u8fdc\u7a0b\u4e3b\u673a\u6267\u884c\u547d\u4ee4\u5931\u8d25\uff01")\n  }))\n}\n\n// \u662f\u5426\u663e\u793a\u9009\u62e9\u6307\u4ee4\u6a21\u677f\u7684\u7a97\u53e3\nconst visible2 = ref(false);\n// \u641c\u7d22\u6307\u4ee4\u6a21\u677f\u7684\u6570\u636e\u7684\u8868\u5355\nconst template_form = reactive({\n  form: {\n    category: undefined,\n    name: "",\n  }\n})\n\n// \u6307\u4ee4\u6a21\u677f\u5206\u7c7b\u5217\u8868\nconst template_category_list = reactive({\n  data: [],\n})\n\nconst tem_columns = ref([\n  {\n    title: \'\u6a21\u677f\u7c7b\u578b\',\n    dataIndex: \'category_name\',\n    key: \'category_name\'\n  },\n  {\n    title: \'\u6a21\u677f\u540d\u79f0\',\n    dataIndex: \'name\',\n    key: \'name\'\n\n  },\n  {\n    title: \'\u6a21\u677f\u5185\u5bb9\',\n    dataIndex: \'content\',\n    key: \'content\',\n    width: 200\n  }\n])\n\n// \u6307\u4ee4\u6a21\u677f\u5217\u8868\nconst template_list = reactive({\n  data: [],\n})\n\n// \u9009\u9879\u7684\u6307\u4ee4\u6a21\u677f\u7684\u5217\u8868\nconst radioselectedRow = ref([]);\n\n// \u663e\u793a\u9009\u62e9\u6307\u4ee4\u6a21\u677f\u7684\u5f39\u7a97\nconst showModal2 = () => {\n  visible2.value = true\n}\n\n// \u9690\u85cf\u9009\u62e9\u6307\u4ee4\u6a21\u677f\u7684\u5f39\u7a97\nconst hideModel2 = () => {\n  visible2.value = false;\n}\n\n// \u5f53\u9009\u62e9\u6307\u4ee4\u6a21\u677f\u65f6\nconst handleOk2 = (e) => {\n  let tid = radioselectedRow.value[0] // \u9009\u4e2d\u7684\u6a21\u677fid\u503c\n  // \u901a\u8fc7\u6a21\u677fid\u503c\uff0c\u627e\u5230\u8be5\u6a21\u677f\u8bb0\u5f55\u4e2d\u7684cmd\u503c\uff0c\u5e76\u8d4b\u503c\u7ed9content\u5c5e\u6027\n  template_list.data.forEach((v, k) => {\n    if (v.id === tid) {\n      // \u628a\u7528\u6237\u9009\u62e9\u7684\u6307\u4ee4\u6a21\u677f\u5185\u5bb9\u663e\u793a\u5230\u7f16\u8f91\u5668\u4e2d\n      content.value = v.content\n    }\n  })\n  visible2.value = false\n}\n\nconst onSelectChange2 = (selectedRow) => {\n  // [6, 7, 8, 9]\n  console.log(\'>>>>> \', selectedRow)\n  radioselectedRow.value = selectedRow\n}\n\nconst handleSelectChange2 = (value) => {\n  // \u5207\u6362\u6a21\u677f\u5206\u7c7b\n  get_templates_list(value)\n}\n\nconst refresh_data2 = () => {\n  get_templates_list();\n}\n\n// \u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u5206\u7c7b\u5217\u8868\nconst get_templates_category_list = () => {\n  axios.get(`${settings.host}/cmd/category`)\n      .then(response => {\n        template_category_list.data = response.data.data.cmd_category_list\n      })\n}\n\nget_templates_category_list()\n\n// \u83b7\u53d6\u6307\u4ee4\u6a21\u677f\u5217\u8868\nconst get_templates_list = (category = null) => {\n  let params = {}\n  if (category !== null) {\n    params.command_category_id = category\n  }\n  axios.get(`${settings.host}/cmd`, {\n    params: params,\n  }).then(response => {\n    template_list.data = response.data.data.cmd_list\n  })\n}\n\nget_templates_list()\n\n<\/script>\n\n<style scoped>\n.multi_exec {\n  text-align: left;\n}\n</style>\n')))}m.isMDXComponent=!0}}]);