## logstash

同步脚本

```shell
root@ecs-5483-0001:/mnt/opt/logstash/config# cat rsync.sh 
#!/bin/bash

set -e 
local_config_path="/mnt/opt/logstash/config/logstash.conf"
remote_servers=("logstash@192.168.1.162" "logstash@192.168.1.190")
remote_config_path="/mnt/opt/logstash/config/logstash.conf"
current_date=`date  +%Y-%m-%d-%H-%M`


rsynclogstashconf(){
echo "[INFO] 备份logstash.conf文件..."
cp -rav ${local_config_path} ${local_config_path}.bak.${current_date}
echo "[INFO] 开始语法检查，预估需要30s中..."
/mnt/opt/logstash/bin/logstash  -f ${local_config_path} -t
check_status "语法检查!!"


for remote_server in "${remote_servers[@]}"; do
    echo "[INFO] 开始同步$remote_server配置.."
    rsync -avz --delete-after -e ssh "$local_config_path" "$remote_server:$remote_config_path"
    check_status "RSYNC  $remote_server"
    echo "[INFO] 同步$remote_server完成.." 
    ssh "$remote_server" "sudo systemctl restart logstash"
    check_status "Restarted Logstash on $remote_server"
    echo "[INFO] 等待40s之后重启下一个..."
    sleep 40
done
}

check_status() {
    if [ $? -eq 0 ]; then
        echo "[INFO] $1 [SUCCESS]"
    else
        echo "[ERROR] $1  [FAILURE]"
        exit 1
    fi
}
rsynclogstashconf
systemctl restart logstash
check_status "Restarted Logstash on $remote_server"
sleep 20
echo "[INFO] 同步已完成更新"

```

