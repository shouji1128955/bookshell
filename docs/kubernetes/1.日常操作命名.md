

### 打印所有pod使用的镜像

![](./images/20231012182503.png)
###  清理k8s各个节点的镜像,需要验证

```shell
for i in `kubectl get nodes -o jsonpath='{range .items[*]}{.status.addresses[0].address}{"\n"}{end}' `; do
    ssh -i XXX USER@$i 'docker image prune -a -f'; exit 0
done
```


###  其他命令
```shell
kubectl get nodes -o jsonpath='{range .items[*]}{.status.addresses[?(@.type=="InternalIP")].address}{"\n"}{end}'
```



patch镜像

```shell
kubectl patch deployment itz-test-aaa   --patch '{"spec": {"template": {"spec": {"containers": [{"name": "tz-test-aaa-1","image":"harbor.zlqit.com/tz_aaa/tz-test-aaa:1.1.93"}]}}}}' -n  tz-aaa
```





## configmap热更新插件

https://github.com/stakater/Reloader





## 更新证书

https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/202401121030436.png

```shell
#获取ingress-对应的域名
kubectl  get ingress -A | grep file

#找到ingress之后，查看绑定的证书secret 
kubectl  get  ingress be-filesystem-api -n smart -o yaml | grep secretName

#创建证书-提前将证书上传到文件夹
kubectl  create secret tls be-filesystem-api-tls-20231123 --cert=filesystem-api.aaa.com_bundle.pem --key=filesystem-api.aaa.com.key  --dry-run=client -o yaml > be-filesystem-api-tls-20231123.yaml

#创建secret 
kubectl  apply -f fe-video-foundation-tls-20231123.yaml

#替换secret
kubectl  edit ingress be-filesystem-api -n smart
```





## 替换容器启动命令



​        command: ["/bin/sh", "-c"]        
​        args: ["sleep 1000000"]

![image-20231220181249656](images/image-20231220181249656.png)





## OOM问题

一般情况： Limit分配的资源不够用，导致Kubelet就自动杀掉了服务

  解决方式，调高limit限制，根据宿主机物理内存给



第二种情况： 物理内存不够用，本身limit就需要这些资源 

  解决方式： 更好资源充足的节点