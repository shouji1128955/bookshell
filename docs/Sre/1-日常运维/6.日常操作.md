





## 常用查询命令

```sql
use bjgsbp20200828

SELECT * FROM GPSContDataH3  WHERE timestamp_column >= toDateTime('2023-01-01 00:00:00') AND timestamp_column < toDateTime('2023-01-02 00:00:00');


SELECT * FROM GPSContDataH3  WHERE timestamp_column >= toDateTime('2022-12-30 00:00:00') AND timestamp_column < toDateTime('2022-12-31 00:00:00');

SELECT * FROM GPSContDataH3 WHERE unix_time= toDateTime('2023-01-01 00:00:00', 'Asia/Istanbul')


select * from GPSContDataH3 order by unix_time desc limit 1 \G


tmux new -s  datazip
tmux  attach -t 

121.36.244.174
123.60.41.178

tar zcvf  202307-202311.tar.gz ./202307new ./202308 ./202309 ./202310  ./202311


nohup bash select.sh 1 > select.log 2>&1 &
nohup bash select.sh 2 > select2.log 2>&1 &
```








select count(1) from bshdq20220123.StressData_local WHERE unix_time<toDateTime('2023-01-01 00:00:00', 'Asia/Istanbul')



## 查看当前数据库执行的语句

```sql
##delete
select * from system.query_log where type='Delete'  order by event_time desc limit 10 \G;

##alert -> delete
select * from system.query_log where query_kind='Alter'  order by event_time desc limit 10 \G;
```







## 查询单个库的大小

```sql
SELECT
        table AS `表名`,
        sum(rows) AS `总行数`,
        formatReadableSize(sum(data_uncompressed_bytes)) AS `原始大小`,
        formatReadableSize(sum(data_compressed_bytes)) AS `压缩大小`,
        round(
                (
                        sum(data_compressed_bytes) / sum(data_uncompressed_bytes)
                ) * 100,
                0
        ) AS `压缩率`
FROM
        system.parts
WHERE
        database = 'ckhdq20200728' -- table IN ('temp_1')
GROUP BY
        table;
		
```



## 查询多个库的大小

```sql
		
SELECT
        database,
        formatReadableSize (sum(bytes)) AS bytes_size,
        formatReadableSize (sum(primary_key_bytes_in_memory)) AS primary_keys_size,
        formatReadableSize (sum(data_uncompressed_bytes)) AS `原始大小`,
        formatReadableSize (sum(data_compressed_bytes)) AS `压缩大小`,
        round(
                (
                        sum(data_compressed_bytes) / sum(data_uncompressed_bytes)
                ) * 100,
                0
        ) AS `压缩率`
FROM
        system.parts
WHERE
        1 = 1 AND database in ('ckhdq20200728','bzhhdq20220906','bshdq20220123','bjhdq20200722','bjgsbp20200828')
GROUP BY
        database
ORDER BY
        bytes_size DESC
LIMIT
        10;		
```




​		
